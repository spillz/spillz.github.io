var $=e=>{throw TypeError(e)};var ut=(e,t,i)=>t.has(e)||$("Cannot "+i);var K=(e,t,i)=>t.has(e)?$("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);var N=(e,t,i)=>(ut(e,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();var X=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function B(){var e=new w(16);return w!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function nt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function D(e,t,i){var s=i[0],r=i[1],n=i[2],o,h,a,l,f,u,p,d,T,c,g,m;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*n+t[12],e[13]=t[1]*s+t[5]*r+t[9]*n+t[13],e[14]=t[2]*s+t[6]*r+t[10]*n+t[14],e[15]=t[3]*s+t[7]*r+t[11]*n+t[15]):(o=t[0],h=t[1],a=t[2],l=t[3],f=t[4],u=t[5],p=t[6],d=t[7],T=t[8],c=t[9],g=t[10],m=t[11],e[0]=o,e[1]=h,e[2]=a,e[3]=l,e[4]=f,e[5]=u,e[6]=p,e[7]=d,e[8]=T,e[9]=c,e[10]=g,e[11]=m,e[12]=o*s+f*r+T*n+t[12],e[13]=h*s+u*r+c*n+t[13],e[14]=a*s+p*r+g*n+t[14],e[15]=l*s+d*r+m*n+t[15]),e}function Y(e,t,i){var s=i[0],r=i[1],n=i[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pt(e,t,i){var s=Math.sin(i),r=Math.cos(i),n=t[4],o=t[5],h=t[6],a=t[7],l=t[8],f=t[9],u=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*r+l*s,e[5]=o*r+f*s,e[6]=h*r+u*s,e[7]=a*r+p*s,e[8]=l*r-n*s,e[9]=f*r-o*s,e[10]=u*r-h*s,e[11]=p*r-a*s,e}function gt(e,t,i,s,r){var n=1/Math.tan(t/2),o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(o=1/(s-r),e[10]=(r+s)*o,e[14]=2*r*s*o):(e[10]=-1,e[14]=-2*s),e}var vt=gt;function Tt(e,t,i,s){var r,n,o,h,a,l,f,u,p,d,T=t[0],c=t[1],g=t[2],m=s[0],A=s[1],v=s[2],y=i[0],R=i[1],_=i[2];return Math.abs(T-y)<X&&Math.abs(c-R)<X&&Math.abs(g-_)<X?nt(e):(f=T-y,u=c-R,p=g-_,d=1/Math.hypot(f,u,p),f*=d,u*=d,p*=d,r=A*p-v*u,n=v*f-m*p,o=m*u-A*f,d=Math.hypot(r,n,o),d?(d=1/d,r*=d,n*=d,o*=d):(r=0,n=0,o=0),h=u*o-p*n,a=p*r-f*o,l=f*n-u*r,d=Math.hypot(h,a,l),d?(d=1/d,h*=d,a*=d,l*=d):(h=0,a=0,l=0),e[0]=r,e[1]=h,e[2]=f,e[3]=0,e[4]=n,e[5]=a,e[6]=u,e[7]=0,e[8]=o,e[9]=l,e[10]=p,e[11]=0,e[12]=-(r*T+n*c+o*g),e[13]=-(h*T+a*c+l*g),e[14]=-(f*T+u*c+p*g),e[15]=1,e)}function ot(){var e=new w(3);return w!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function q(e){var t=new w(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function At(e){var t=e[0],i=e[1],s=e[2];return Math.hypot(t,i,s)}function S(e,t,i){var s=new w(3);return s[0]=e,s[1]=t,s[2]=i,s}function W(e,t,i,s){return e[0]=t,e[1]=i,e[2]=s,e}function j(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function U(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Q(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e}function yt(e,t){var i=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2];return Math.hypot(i,s,r)}function Et(e){var t=e[0],i=e[1],s=e[2];return t*t+i*i+s*s}function G(e,t){var i=t[0],s=t[1],r=t[2],n=i*i+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}var J=yt,Rt=Et;(function(){var e=ot();return function(t,i,s,r,n,o){var h,a;for(i||(i=3),s||(s=0),r?a=Math.min(r*i+s,t.length):a=t.length,h=s;h<a;h+=i)e[0]=t[h],e[1]=t[h+1],e[2]=t[h+2],n(e,e,o),t[h]=e[0],t[h+1]=e[1],t[h+2]=e[2];return t}})();function _t(){var e=new w(2);return w!=Float32Array&&(e[0]=0,e[1]=0),e}function Pt(e,t){var i=new w(2);return i[0]=e,i[1]=t,i}function Ft(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function St(e){var t=e[0],i=e[1];return Math.hypot(t,i)}(function(){var e=_t();return function(t,i,s,r,n,o){var h,a;for(i||(i=2),s||(s=0),r?a=Math.min(r*i+s,t.length):a=t.length,h=s;h<a;h+=i)e[0]=t[h],e[1]=t[h+1],n(e,e,o),t[h]=e[0],t[h+1]=e[1];return t}})();function Mt(e,t){const i=e.pos[0]-t.pos[0],s=e.pos[1]-t.pos[1],r=e.pos[2]-t.pos[2],n=i*i+s*s+r*r,o=.5*Math.sqrt(e.width*e.width+e.height*e.height),h=.5*Math.sqrt(t.width*t.width+t.height*t.height),a=o+h;return n<=a*a}class Z{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}update(t,i){this.usesGravity&&Q(this.vel,this.vel,this.gravity,t),Q(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return Mt(this,t)}}const tt={home:Object.freeze({idle:[[0,0,0]],run:[[1,0,0],[2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0]],kickRightFoot:[[1,0,0],[2,0,0]],kickLeftFoot:[[4,0,0],[5,0,0]],handpassRightHand:[[1,0,0],[0,0,0]],handpassLeftHand:[[4,0,0],[0,0,0]],jumpMark:[[1,0,0],[2,0,0],[0,0,0]],jumpSpoil:[[1,0,0],[2,0,0],[0,0,0]]}),away:Object.freeze({idle:[[0,4,0]],run:[[1,4,0],[2,4,0],[3,4,0],[4,4,0],[5,4,0],[6,4,0]],kickRightFoot:[[1,4,0],[2,4,0]],kickLeftFoot:[[4,4,0],[5,4,0]],handpassRightHand:[[1,4,0],[0,4,0]],handpassLeftHand:[[4,4,0],[0,4,0]],jumpMark:[[1,4,0],[2,4,0],[0,4,0]],jumpSpoil:[[1,4,0],[2,4,0],[0,4,0]]})};class wt extends Z{constructor(t,i,s){super(s),this.name=t,this.team=i,this.activeController=!1,this.width=1.6,this.height=2.4,this.aiming=!1,this.jogVel=S(0,0,0),this.joltVel=S(0,0,0),this.jogSpeed=5,this.joltSpeed=5,this.joltDecayRate=8,this.animations=tt[i]??tt.home,this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=8}update(t,i){if(!this.activeController)return;const s=i.controls,r=i.ball,{kickPressed:n,kickReleased:o,kickHeldTime:h,moveX:a,moveZ:l,aimTarget:f}=s.state,u=1e-4;if((a!==0||l!==0)&&!this.aiming){const T=S(a,0,l);if(Rt(T)>u){G(T,T),U(this.joltVel,T,this.joltSpeed);const c=q(this.jogVel),g=ot();U(g,T,.1),j(c,c,g),At(c)>u?(G(c,c),U(this.jogVel,c,this.jogSpeed)):W(this.jogVel,0,0,0)}}j(this.vel,this.jogVel,this.joltVel);const p=Math.exp(-this.joltDecayRate*t);U(this.joltVel,this.joltVel,p),super.update(t,i),!r.carried&&r.collidesWith(this)&&r.pickup(this);const d=Pt(0,-10);if(f&&Ft(d,d,f),r.carried&&r.carrier===this&&(n&&(this.aiming=!0),o&&f)){const T=h<.25,c=St(d);if(c>.1){const g=-this.gravity[1],m=45*Math.PI/180,A=Math.sin(2*m),v=T?15:Math.sqrt(c*g/A),y=S(d[0],0,d[1]);G(y,y);const R=S(y[0]*Math.cos(m),Math.sin(m),y[2]*Math.cos(m));j(r.pos,this.pos,[0,0,-3]),r.launch(R,v)}this.aiming=!1}this.aiming&&i.aimTarget.setPosition([this.pos[0]+d[0],.002,this.pos[2]+d[1]]),this.updateAnimation(t,o)}updateAnimation(t,i){const s=this.animations[this.animState];if(s.length===0)return;this.animTimer+=t;const r=1/this.animFPS;this.animTimer>=r&&(this.animTimer-=r,this.animFrame=this.animFrame+1),i&&(this.animState="kickRightFoot",this.animFrame=0,this.animTimer=0),this.animState==="run"&&J(this.vel,[0,0,0])===0&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animState==="idle"&&J(this.vel,[0,0,0])!==0&&(this.animState="run",this.animFrame=0,this.animTimer=0);const n=this.animState==="run"||this.animState==="idle";this.animFrame>=s.length&&(this.animFrame=n?0:s.length-1,n||(this.animState="run",this.animFrame=0,this.animTimer=0))}render(t){var o;const i=(o=this.animations)==null?void 0:o[this.animState],[s,r,n]=(i==null?void 0:i[this.animFrame])??[0,0,void 0];t.renderSprite(this.pos,this.width,this.height,s,r)}}class xt extends Z{constructor(t){super(t),this.carried=!1,this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0,this.animations=Object.freeze({idle:[[0,1,0]],backSpin:[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[8,1,0]],forwardSpin:[[8,1,0],[7,1,0],[6,1,0],[5,1,0],[4,1,0],[3,1,0],[2,1,0],[1,1,0]],backSpinRight:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]],backSpinLeft:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinRight:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinLeft:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=12,this.lastTouchedBy=null,this.lastTouchedType=null,this.hasBounced=!1}update(t,i){if(this.carried&&this.carrier){const s=S(0,0,-1),r=q(this.carrier.pos);j(this.pos,r,s)}else{const s=this.vel[1]<0;super.update(t,i),this.hasBounced=this.hasBounced||s&&this.vel[1]>0&&this.pos[1]<=this.floorY,this.pos[1]<=this.floorY&&U(this.vel,this.vel,.97)}this.updateAnimation(t)}pickup(t){this.carried=!0,this.carrier=t,this.lastTouchedBy=t,this.lastTouchedType=null,this.hasBounced=!1,W(this.pos,t.pos[0],t.pos[1],t.pos[2]-1),W(this.vel,0,0,0)}launch(t,i,s="kick"){this.carried=!1,this.carrier=null,this.launchType="kick",U(this.vel,t,i),this.lastTouchedType=s,this.hasBounced=!1}updateAnimation(t){this.animTimer+=t;const i=1/this.animFPS;this.animTimer>=i&&(this.animTimer-=i,this.animFrame=this.animFrame+1);const s=this.animState;this.carried?this.animState="idle":this.lastTouchedType==="kick"&&!this.hasBounced?this.animState="backSpin":this.lastTouchedType==="handpass"&&!this.hasBounced?this.animState="backSpinRight":this.hasBounced?Math.abs(this.vel[1])<.05&&this.pos[1]<=this.floorY+.01?this.animState="idle":this.animState="forwardSpin":this.animState="idle",this.animState!==s&&(this.animFrame=0,this.animTimer=0);const r=this.animations[this.animState];r.length!==0&&this.animFrame>=r.length&&(this.animFrame=0)}render(t){var o;const i=(o=this.animations)==null?void 0:o[this.animState],[s,r,n]=(i==null?void 0:i[this.animFrame])??[0,1,void 0];t.renderSprite(this.pos,this.width,this.height,s,r)}}class Lt{constructor(t=[0,.001,0]){this.pos=q(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const i=t.gl;i.useProgram(t.program),i.bindVertexArray(t.quadVao);const[s,r]=this.spriteCoord,n=s/t.sheetCols,o=r/t.sheetRows,h=(s+1)/t.sheetCols,a=(r+1)/t.sheetRows;i.uniform4f(t.uTileUV,n,o,h,a);const l=B();D(l,l,[this.pos[0],.001,this.pos[2]]),pt(l,l,-Math.PI/2),Y(l,l,[this.size,this.size,1]),i.uniformMatrix4fv(t.uModel,!1,l),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}}function et(e,t,i){const s=(h,a)=>{const l=e.createShader(a);if(!l)throw new Error("Failed to create shader");if(e.shaderSource(l,h),e.compileShader(l),!e.getShaderParameter(l,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(l));return l},r=s(t,e.VERTEX_SHADER),n=s(i,e.FRAGMENT_SHADER),o=e.createProgram();if(e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o));return o}async function kt(e){const t=new Image;return t.src=e,await t.decode(),t}function bt(e,t,i,s=1){const o=e*2/1.6/s,h=t*2/2/s,a=[0,0,0,.5,.5],l=[];for(let f=0;f<=i;f++){const u=f/i*2*Math.PI,p=Math.cos(u)*e,d=Math.sin(u)*t,T=p/(e*2)*o+.5,c=d/(t*2)*h+.5;a.push(p,0,d,T,c),f>0&&l.push(0,f,f+1)}return{vertices:new Float32Array(a),indices:new Uint16Array(l)}}function Bt(e=160,t=170,i=50,s=50,r=.4){const n=[],o=[];let h=0;const a=(c,g,m,A,v)=>{const y=m-c,R=A-g,_=Math.hypot(y,R),F=-R/_,x=y/_,P=v/2,H=c+F*P,C=g+x*P,O=c-F*P,b=g-x*P,lt=m+F*P,dt=A+x*P,ft=m-F*P,mt=A-x*P;n.push(H,0,C,lt,0,dt,ft,0,mt,O,0,b),o.push(h,h+1,h+2,h,h+2,h+3),h+=4},l=e/2,f=t/2,u=64;for(let c=0;c<u;c++){const g=c/u*2*Math.PI,m=(c+1)/u*2*Math.PI,A=Math.cos(g)*l,v=Math.sin(g)*f,y=Math.cos(m)*l,R=Math.sin(m)*f;a(A,v,y,R,r)}const p=[[-s/2,-s/2],[s/2,-s/2],[s/2,s/2],[-s/2,s/2]];for(let c=0;c<4;c++){const[g,m]=p[c],[A,v]=p[(c+1)%4];a(g,m,A,v,r)}function d(c){const g=c>0?-1:1,m=[];for(let A=0;A<=1e3;A++){const v=-Math.PI+A/1e3*2*Math.PI,y=Math.sin(v)*i,R=c+g*Math.cos(v)*i,_=y/l,F=R/f;_*_+F*F<=1&&m.push(v)}return m.length===0?[-Math.PI/3,Math.PI/3]:[m[0],m[m.length-1]]}const T=40;for(let c of[-t/2,t/2]){const g=c>0?-1:1,[m,A]=d(c);for(let v=0;v<T;v++){const y=m+v/T*(A-m),R=m+(v+1)/T*(A-m),_=Math.sin(y)*i,F=c+g*Math.cos(y)*i,x=Math.sin(R)*i,P=c+g*Math.cos(R)*i;a(_,F,x,P,r)}}return{vertices:new Float32Array(n),indices:new Uint16Array(o)}}const V=170,It=80,it=V/2;class Ut{constructor(t,i,s){this.gl=t,this.canvas=i,this.spriteSheet=s,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,i=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 tileUV = mod(v_texcoord, 1.0);
  vec2 texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=et(this.gl,t,i),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,i=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=et(this.gl,t,i),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const i=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),s=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:i,indices:s}=bt(It,it,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.fieldIndices=s.length,this.fieldLineMesh=Bt(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,V],[-3,0,V],[3,0,V],[9,0,V],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=B(),vt(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=B(),this.model=B()}renderSprite(t,i,s,r,n){const{gl:o,program:h,quadVao:a,uModel:l,uTileUV:f,sheetCols:u,sheetRows:p}=this;o.useProgram(h),o.bindVertexArray(a);const d=B();D(d,d,t),Y(d,d,[i,s,1]),o.uniformMatrix4fv(l,!1,d);const T=r/u,c=n/p,g=(r+1)/u,m=(n+1)/p;o.uniform4f(f,T,c,g,m),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}renderScene(t,i){const s=this.gl;s.viewport(0,0,this.canvas.width,this.canvas.height),s.clearColor(.2,.6,.2,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const r=S(t.player.pos[0],t.player.pos[1]+10,t.player.pos[2]+15),n=S(t.player.pos[0],t.player.pos[1],t.player.pos[2]-20);Tt(this.view,r,n,[0,1,0]),s.useProgram(this.program),s.uniformMatrix4fv(this.uProjection,!1,this.projection),s.uniformMatrix4fv(this.uView,!1,this.view),s.activeTexture(s.TEXTURE0),s.uniform1i(this.uTexture,0),s.bindVertexArray(this.fieldVao),nt(this.model),D(this.model,this.model,[0,0,it]),s.uniformMatrix4fv(this.uModel,!1,this.model);const o=0,h=2,a=o/this.sheetCols,l=h/this.sheetRows,f=(o+1)/this.sheetCols,u=(h+1)/this.sheetRows;s.uniform4f(this.uTileUV,a,l,f,u),s.drawElements(s.TRIANGLES,this.fieldIndices,s.UNSIGNED_SHORT,0),s.useProgram(this.lineProgram),s.uniformMatrix4fv(this.lineProj,!1,this.projection),s.uniformMatrix4fv(this.lineView,!1,this.view);const p=B();D(p,this.model,[0,.001,0]),s.uniformMatrix4fv(this.lineModel,!1,p),s.bindVertexArray(this.lineVao),s.drawElements(s.TRIANGLES,this.fieldLineMesh.indices.length,s.UNSIGNED_SHORT,0),s.useProgram(this.program),s.bindVertexArray(this.quadVao);const d=1,T=2,c=d/this.sheetCols,g=T/this.sheetRows,m=(d+1)/this.sheetCols,A=(T+1)/this.sheetRows;s.uniform4f(this.uTileUV,c,g,m,A);for(let v=0;v<this.goalPostPositions.length;v++){const[y,R,_]=this.goalPostPositions[v],x=v%4===0||v%4===3?6:10,P=r[0]-y,H=r[2]-_,C=Math.sqrt(P*P+H*H),O=C>50?1.5:C>150?2:1,b=B();D(b,b,[y,R,_]),Y(b,b,[O,x,1]),s.uniformMatrix4fv(this.uModel,!1,b),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}s.bindVertexArray(this.quadVao);for(const v of i)v instanceof Z?v.render(this):this.renderSprite(v.pos,v.width,v.height,1,0);t.player.aiming&&t.aimTarget.render(this)}}var k,ht,at,ct;class Dt{constructor(t){K(this,k);this.state={moveX:0,moveZ:0,kickPressed:!1,kickReleased:!1,kickHeldTime:0,aimTarget:null},this.keys={},this.lastKeys={},this.touchMove=null,this.touchAim=null,this.kPressTime=0,t.addEventListener("touchstart",N(this,k,ht).bind(this),{passive:!1}),t.addEventListener("touchmove",N(this,k,at).bind(this),{passive:!1}),t.addEventListener("touchend",N(this,k,ct).bind(this)),window.addEventListener("keydown",i=>this.keys[i.key.toLowerCase()]=!0),window.addEventListener("keyup",i=>this.keys[i.key.toLowerCase()]=!1)}endUpdate(){this.state.moveX=0,this.state.moveZ=0,this.state.kickPressed=!1,this.state.kickReleased=!1}update(t){var n;const i=!!this.keys.k,s=!!this.lastKeys.k;if(i&&!s&&(this.state.kickPressed=!0,this.kPressTime=0,this.state.aimTarget=[0,0]),i?(this.kPressTime+=t,this.state.aimTarget&&(this.keys.a&&(this.state.aimTarget[0]-=30*t),this.keys.d&&(this.state.aimTarget[0]+=30*t),this.keys.w&&(this.state.aimTarget[1]-=30*t),this.keys.s&&(this.state.aimTarget[1]+=30*t))):(this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1)),!i&&s&&(this.state.kickReleased=!0),this.state.kickHeldTime=this.kPressTime,this.touchMove&&!this.touchAim&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=this.touchMove.dy/50),this.touchAim){this.kPressTime+=t;const o=this.touchAim.dx,h=this.touchAim.dy;console.log("Touch aim:",o,h);const a=10;this.state.aimTarget=[-o/a,-h/a],this.state.kickHeldTime=this.kPressTime}const r=(n=navigator.getGamepads)==null?void 0:n.call(navigator)[0];if(r){this.state.moveX+=r.axes[0]||0,this.state.moveZ+=-(r.axes[1]||0);const o=r.axes[2]||0,h=-(r.axes[3]||0),a=Math.hypot(o,h);a>.2&&(this.state.aimTarget=[o/a,h/a])}this.lastKeys={...this.keys}}getState(){return this.state}}k=new WeakSet,ht=function(t){t.preventDefault();for(const i of t.changedTouches)i.clientX<window.innerWidth/2?this.touchMove={id:i.identifier,startX:i.clientX,startY:i.clientY,dx:0,dy:0}:(this.touchAim={id:i.identifier,startX:i.clientX,startY:i.clientY,dx:0,dy:0},this.state.kickPressed=!0,this.kPressTime=0)},at=function(t){t.preventDefault();for(const i of t.changedTouches)this.touchMove&&i.identifier===this.touchMove.id&&(this.touchMove.dx=i.clientX-this.touchMove.startX,this.touchMove.dy=i.clientY-this.touchMove.startY),this.touchAim&&i.identifier===this.touchAim.id&&(this.touchAim.dx=i.clientX-this.touchAim.startX,this.touchAim.dy=i.clientY-this.touchAim.startY)},ct=function(t){t.preventDefault();for(const i of t.changedTouches)this.touchAim&&i.identifier===this.touchAim.id&&(this.touchAim=null,this.state.kickReleased=!0),this.touchMove&&i.identifier===this.touchMove.id&&(this.touchMove=null)};const Vt=160,I=170,st=Vt/2,M=I/2,L=6,z=6;function E(e,t,i){return S(e,t,i)}Object.freeze([E(-.5*L-z,0,I),E(-.5*L,0,I),E(.5*L,0,I),E(.5*L+z,0,I)]);Object.freeze([E(-.5*L-z,0,0),E(-.5*L,0,0),E(.5*L,0,0),E(.5*L+z,0,0)]);function rt(e=!1){const i={fullForward:70,halfForward:35,halfBack:-35,fullBack:-70},s={LFP:-45,FF:0,RFP:45,LHF:-50,CHF:0,RHF:50,LHB:-50,CHB:0,RHB:50,LBP:-45,FB:0,RBP:45};function r(a,l){const f=a*Math.PI/180,u=st*Math.sin(f)*(Math.abs(l)/M)-(e?2:-2),p=M+l*(e?-1:1);return E(u,0,p)}const n=-st+2,o=a=>M+(e?1:-1)*a;return{LFP:r(s.LFP,i.fullForward),FF:r(s.FF,i.fullForward),RFP:r(s.RFP,i.fullForward),LHF:r(s.LHF,i.halfForward),CHF:r(s.CHF,i.halfForward),RHF:r(s.RHF,i.halfForward),LW:E(-25,0,M-(e?2:-2)),C:E(8,0,M-(e?-5:5)),RW:E(25,0,M-(e?2:-2)),LHB:r(s.LHB,i.halfBack),CHB:r(s.CHB,i.halfBack),RHB:r(s.RHB,i.halfBack),LBP:r(s.LBP,i.fullBack),FB:r(s.FB,i.fullBack),RBP:r(s.RBP,i.fullBack),Ruck:E(0,0,M-(e?10:-10)),RR:E(-10,0,M-(e?10:-10)),Rover:E(10,0,M-(e?10:-10)),Bench1:E(n,0,o(10)),Bench2:E(n,0,o(13)),Bench3:E(n,0,o(16)),Bench4:E(n,0,o(19)),Bench5:E(n,0,o(22))}}class Ht{constructor(t,i){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new Ut(this.gl,t,i),this.controls=new Dt(t),this.entities=[],this.aimTarget=new Lt([5,.001,I/2]),this.ball=new xt(S(0,0,I/2)),this.entities.push(this.ball),this.homePositions=rt(),this.awayPositions=rt(!0);const s=[[this.homePositions,"home"],[this.awayPositions,"away"]];for(let[r,n]of s)for(const[o,h]of Object.entries(r)){const a=new wt(o,n,h);this.entities.push(a),o==="RR"&&n==="home"&&(this.player=a,a.activeController=!0)}this.resize(),window.addEventListener("resize",()=>this.resize()),this.lastTime=performance.now()}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){const i=(t-this.lastTime)/1e3,s=Math.min(i,1/30);this.lastTime=t,this.controls.update(s);for(const r of this.entities)r.update(s,this);this.renderer.renderScene(this,this.entities),this.controls.endUpdate(),requestAnimationFrame(this.loop.bind(this))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.renderer.setupCamera()}}const Ct="/footy/assets/spritesheet-OezrhueQ.png";function Nt(e){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");new Ht(t,e).start()}kt(Ct).then(e=>{if(!e.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");Nt(e)});
