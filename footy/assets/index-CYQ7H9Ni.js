var at=e=>{throw TypeError(e)};var Et=(e,t,i)=>t.has(e)||at("Cannot "+i);var ht=(e,t,i)=>t.has(e)?at("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);var K=(e,t,i)=>(Et(e,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();var tt=1e-6,H=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function G(){var e=new H(16);return H!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function pt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Y(e,t,i){var s=i[0],o=i[1],n=i[2],r,h,a,l,c,u,p,v,f,d,g,m;return t===e?(e[12]=t[0]*s+t[4]*o+t[8]*n+t[12],e[13]=t[1]*s+t[5]*o+t[9]*n+t[13],e[14]=t[2]*s+t[6]*o+t[10]*n+t[14],e[15]=t[3]*s+t[7]*o+t[11]*n+t[15]):(r=t[0],h=t[1],a=t[2],l=t[3],c=t[4],u=t[5],p=t[6],v=t[7],f=t[8],d=t[9],g=t[10],m=t[11],e[0]=r,e[1]=h,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=p,e[7]=v,e[8]=f,e[9]=d,e[10]=g,e[11]=m,e[12]=r*s+c*o+f*n+t[12],e[13]=h*s+u*o+d*n+t[13],e[14]=a*s+p*o+g*n+t[14],e[15]=l*s+v*o+m*n+t[15]),e}function it(e,t,i){var s=i[0],o=i[1],n=i[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Pt(e,t,i){var s=Math.sin(i),o=Math.cos(i),n=t[4],r=t[5],h=t[6],a=t[7],l=t[8],c=t[9],u=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*o+l*s,e[5]=r*o+c*s,e[6]=h*o+u*s,e[7]=a*o+p*s,e[8]=l*o-n*s,e[9]=c*o-r*s,e[10]=u*o-h*s,e[11]=p*o-a*s,e}function wt(e,t,i,s,o){var n=1/Math.tan(t/2),r;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0?(r=1/(s-o),e[10]=(o+s)*r,e[14]=2*o*s*r):(e[10]=-1,e[14]=-2*s),e}var _t=wt;function kt(e,t,i,s){var o,n,r,h,a,l,c,u,p,v,f=t[0],d=t[1],g=t[2],m=s[0],T=s[1],A=s[2],S=i[0],y=i[1],_=i[2];return Math.abs(f-S)<tt&&Math.abs(d-y)<tt&&Math.abs(g-_)<tt?pt(e):(c=f-S,u=d-y,p=g-_,v=1/Math.hypot(c,u,p),c*=v,u*=v,p*=v,o=T*p-A*u,n=A*c-m*p,r=m*u-T*c,v=Math.hypot(o,n,r),v?(v=1/v,o*=v,n*=v,r*=v):(o=0,n=0,r=0),h=u*r-p*n,a=p*o-c*r,l=c*n-u*o,v=Math.hypot(h,a,l),v?(v=1/v,h*=v,a*=v,l*=v):(h=0,a=0,l=0),e[0]=o,e[1]=h,e[2]=c,e[3]=0,e[4]=n,e[5]=a,e[6]=u,e[7]=0,e[8]=r,e[9]=l,e[10]=p,e[11]=0,e[12]=-(o*f+n*d+r*g),e[13]=-(h*f+a*d+l*g),e[14]=-(c*f+u*d+p*g),e[15]=1,e)}function w(){var e=new H(3);return H!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=new H(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function D(e){var t=e[0],i=e[1],s=e[2];return Math.hypot(t,i,s)}function R(e,t,i){var s=new H(3);return s[0]=e,s[1]=t,s[2]=i,s}function B(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function st(e,t,i,s){return e[0]=t,e[1]=i,e[2]=s,e}function U(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function j(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function M(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function O(e,t,i,s){return e[0]=t[0]+i[0]*s,e[1]=t[1]+i[1]*s,e[2]=t[2]+i[2]*s,e}function Ft(e,t){var i=t[0]-e[0],s=t[1]-e[1],o=t[2]-e[2];return Math.hypot(i,s,o)}function gt(e){var t=e[0],i=e[1],s=e[2];return t*t+i*i+s*s}function E(e,t){var i=t[0],s=t[1],o=t[2],n=i*i+s*s+o*o;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function et(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function nt(e,t,i,s){var o=t[0],n=t[1],r=t[2];return e[0]=o+s*(i[0]-o),e[1]=n+s*(i[1]-n),e[2]=r+s*(i[2]-r),e}var I=Ft,Mt=gt;(function(){var e=w();return function(t,i,s,o,n,r){var h,a;for(i||(i=3),s||(s=0),o?a=Math.min(o*i+s,t.length):a=t.length,h=s;h<a;h+=i)e[0]=t[h],e[1]=t[h+1],e[2]=t[h+2],n(e,e,r),t[h]=e[0],t[h+1]=e[1],t[h+2]=e[2];return t}})();function xt(){var e=new H(2);return H!=Float32Array&&(e[0]=0,e[1]=0),e}function Lt(e,t){var i=new H(2);return i[0]=e,i[1]=t,i}function bt(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function vt(e){var t=e[0],i=e[1];return Math.hypot(t,i)}var ct=vt;(function(){var e=xt();return function(t,i,s,o,n,r){var h,a;for(i||(i=2),s||(s=0),o?a=Math.min(o*i+s,t.length):a=t.length,h=s;h<a;h+=i)e[0]=t[h],e[1]=t[h+1],n(e,e,r),t[h]=e[0],t[h+1]=e[1];return t}})();const Bt=160,L=170,ot=Bt/2,x=L/2,C=6,Q=6,lt=.5;function P(e,t,i){return R(e,t,i)}const Vt=Object.freeze([P(-.5*C-Q,0,L),P(-.5*C,0,L),P(.5*C,0,L),P(.5*C+Q,0,L)]),It=Object.freeze([P(-.5*C-Q,0,0),P(-.5*C,0,0),P(.5*C,0,0),P(.5*C+Q,0,0)]),Ut=Object.freeze({Away:Vt,Home:It});function Ht(e){const t=e[0]/ot,i=(e[2]-x)/x;return t*t+i*i>1}function Dt(e,t,i,s,o,n){const r=o-i,h=n-s;if(r===0&&h===0){const f=e-i,d=t-s;return f*f+d*d}const a=((e-i)*r+(t-s)*h)/(r*r+h*h),l=Math.max(0,Math.min(1,a)),c=i+l*r,u=s+l*h,p=e-c,v=t-u;return p*p+v*v}function jt(e,t){for(const i of["Away","Home"]){const s=Ut[i];if(i==="Home"?t[2]>x:t[2]<x,i==="Away"){if(e[2]<L&&t[2]>=L){const n=t[0];if(n>=-3&&n<=3)return"goalAway";if(n>=-9&&n<-3||n>3&&n<=9)return"behindAway"}}else if(i==="Home"&&e[2]>0&&t[2]<=0){const n=t[0];if(n>=-3&&n<=3)return"goalHome";if(n>=-9&&n<-3||n>3&&n<=9)return"behindHome"}const o=["outerLeftPost","innerLeftPost","innerRightPost","outerRightPost"];for(let n=0;n<s.length;n++){const r=s[n][0],h=s[n][2];if(Dt(r,h,e[0],e[2],t[0],t[2])<lt*lt)return`${o[n]}${i}`}}return Ht(t)?"outOfBounds":null}function ft(e=!1){const i={fullForward:70,halfForward:35,halfBack:-35,fullBack:-70},s={LFP:-45,FF:0,RFP:45,LHF:-50,CHF:0,RHF:50,LHB:-50,CHB:0,RHB:50,LBP:-45,FB:0,RBP:45};function o(a,l){const c=a*Math.PI/180,u=ot*Math.sin(c)*(Math.abs(l)/x)-(e?2:-2),p=x+l*(e?-1:1);return P(u,0,p)}const n=-ot+2,r=a=>x+(e?1:-1)*a;return{LFP:o(s.LFP,i.fullForward),FF:o(s.FF,i.fullForward),RFP:o(s.RFP,i.fullForward),LHF:o(s.LHF,i.halfForward),CHF:o(s.CHF,i.halfForward),RHF:o(s.RHF,i.halfForward),LW:P(-25,0,x-(e?2:-2)),C:P(8,0,x-(e?-5:5)),RW:P(25,0,x-(e?2:-2)),LHB:o(s.LHB,i.halfBack),CHB:o(s.CHB,i.halfBack),RHB:o(s.RHB,i.halfBack),LBP:o(s.LBP,i.fullBack),FB:o(s.FB,i.fullBack),RBP:o(s.RBP,i.fullBack),Ruck:P(0,0,x-(e?10:-10)),RR:P(-10,0,x-(e?10:-10)),Rover:P(10,0,x-(e?10:-10)),Bench1:P(n,0,r(10)),Bench2:P(n,0,r(13)),Bench3:P(n,0,r(16)),Bench4:P(n,0,r(19)),Bench5:P(n,0,r(22))}}function Ot(e,t){const i=e.pos[0]-t.pos[0],s=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],n=i*i+s*s+o*o,[r,h]=e.collideBounds(),[a,l]=t.collideBounds(),c=.5*ct(e.collideBounds()),u=.5*ct(t.collideBounds()),p=c+u;return n<=p*p}class rt{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}setupForBoundary(t,i){}update(t,i){this.usesGravity&&O(this.vel,this.vel,this.gravity,t),O(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return Ot(this,t)}collideBounds(){return[.5,1.8]}}const dt={home:Object.freeze({idle:[[0,0,0]],run:[[1,0,0],[2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0]],kickRightFoot:[[1,0,0],[2,0,0]],kickLeftFoot:[[4,0,0],[5,0,0]],handpassRightHand:[[1,0,0],[0,0,0]],handpassLeftHand:[[4,0,0],[0,0,0]],jumpMark:[[1,0,0],[2,0,0],[0,0,0]],jumpSpoil:[[1,0,0],[2,0,0],[0,0,0]]}),away:Object.freeze({idle:[[0,4,0]],run:[[1,4,0],[2,4,0],[3,4,0],[4,4,0],[5,4,0],[6,4,0]],kickRightFoot:[[1,4,0],[2,4,0]],kickLeftFoot:[[4,4,0],[5,4,0]],handpassRightHand:[[1,4,0],[0,4,0]],handpassLeftHand:[[4,4,0],[0,4,0]],jumpMark:[[1,4,0],[2,4,0],[0,4,0]],jumpSpoil:[[1,4,0],[2,4,0],[0,4,0]]})};class Ct extends rt{constructor(t,i,s,o=!1){super(s),this.positionPos=b(s),this.name=t,this.team=i,this.playing=o,this.width=1.6,this.height=2.4,this.aiming=!1,this.jogVel=R(0,0,0),this.joltVel=R(0,0,0),this.jogSpeed=5,this.joltSpeed=5,this.energy=10,this.energyRecovery=0,this.kickRange=45,this.joltDecayRate=8,this.animations=dt[i]??dt.home,this.animState="idle",this.actionState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=8,this.stateTimer=0,this.animSprite=R(0,0,0)}updateAI(t,i){var h;const o=i.ball;let n=null;if(o.carried&&o.carrier===this)if(this.stateTimer+=t,this.stateTimer<1)n="run";else{let a=!1;for(const f of i.players)if(!(f===this||f.team===this.team)&&I(f.pos,this.pos)<7){a=!0;break}const l=i.players.filter(f=>f.team===this.team&&f!==this);if(a){let f=null,d=-1/0;const g=R(0,0,this.team==="home"?-1:1);for(const m of l){if(m===this)continue;const T=I(this.pos,m.pos);if(T>20)continue;let A=!1;for(const X of i.players)if(X.team!==this.team&&I(X.pos,m.pos)<5){A=!0;break}if(A)continue;const S=w();j(S,m.pos,this.pos),E(S,S);const y=et(g,S),_=b(m.vel);_[1]=0;const F=et(g,_),V=T*.2,k=5*y+2*F-V;k>d&&(d=k,f=m)}if(f){const m=w();j(m,f.pos,this.pos),E(m,m);const T=R(m[0],.5,m[2]);E(T,T);const A=12;return B(o.pos,this.pos),o.launch(T,A),this.aiming=!1,this.stateTimer=.5,"handpass"}}const u=this.team==="home"?0:L,p=0;if(Math.abs(this.pos[2]-u)<=this.kickRange){const f=R(p,0,u),d=(Math.random()-.5)*6;f[0]+=d;const g=w();j(g,f,this.pos),g[1]=.3*D(g),E(g,g);const m=25;return B(o.pos,this.pos),o.launch(g,m),this.stateTimer=.5,"kick"}if(a||this.stateTimer>5){let f=null,d=-1/0;for(const g of l){const m=I(this.pos,g.pos);if(m>this.kickRange)continue;const T=this.team==="home"?-1:1,A=(g.pos[2]-this.pos[2])*T,S=Math.abs(g.pos[0]-this.pos[0]),y=A-S-m;y>d&&(d=y,f=g)}if(f){const g=w();j(g,f.pos,this.pos),E(g,g);const m=R(g[0],.5,g[2]);E(m,m);const T=20;return B(o.pos,this.pos),o.launch(m,T),this.stateTimer=.5,"kick"}}n="run"}let r=null;if(o.carried&&o.carrier===this){const a=this.team==="home"?-1:1,l=R(0,0,a);let c=w();for(const p of i.players){if(p===this||p.team===this.team)continue;const v=w();j(v,this.pos,p.pos),v[1]=0;const f=D(v);if(f<5&&f>.5){const d=1/f;E(v,v),O(c,c,v,d)}}const u=w();U(u,l,c),E(u,u),r=b(this.pos),O(r,r,u,10)}else if(o.carried)if(o.carrier&&o.carrier.team!==this.team&&I(o.pos,this.pos)<=15&&this.energy>0){const a=(((h=this.positionPos)==null?void 0:h[0])??0)<0?-5:5;r=b(o.carrier.pos),r[0]+=a,r[2]+=this.team==="home"?-7:7}else if(o.carrier&&o.carrier.team===this.team&&I(o.pos,this.pos)>5&&this.energy>.3){const a=b(o.carrier.jogVel);D(a)<.01&&(a[2]=this.team==="home"?-1:1),E(a,a);const l=R(-a[2],0,a[0]);E(l,l);let c=0,u=12;switch(this.name){case"wing":c=12*(this.team==="home"?-1:1),u=15;break;case"forward":c=6,u=18;break;case"half-forward":case"half-back":c=4,u=10;break;case"center":case"mid":c=0,u=10;break;case"back":default:c=-6,u=8;break}const p=b(o.carrier.pos);O(p,p,a,u),O(p,p,l,c),r=p}else r=this.positionPos??this.pos;else if(o.pos[1]>.1||o.vel[1]>.1){const a=o.gravity[1]??-9.8,l=o.vel[1],c=o.pos[1],u=.5*a,p=l,v=c;let f=0;const d=p*p-4*u*v;if(d>=0&&Math.abs(u)>1e-5){const m=Math.sqrt(d),T=(-p+m)/(2*u),A=(-p-m)/(2*u);f=Math.max(T,A)}const g=w();O(g,o.pos,o.vel,f),g[1]=0,I(g,this.pos)<=25?r=g:r=this.positionPos??this.pos}else I(o.pos,this.pos)<=25?r=o.pos:r=this.positionPos??this.pos;if(r){const a=w();if(j(a,r,this.pos),a[1]=0,gt(a)>1e-4){E(a,a),M(this.joltVel,a,this.joltSpeed);const c=w();D(this.jogVel)>1e-4?(E(c,this.jogVel),nt(c,c,a,.15),E(c,c),M(this.jogVel,c,this.jogSpeed)):M(this.jogVel,a,this.jogSpeed)}}this.energy>0?(U(this.vel,this.jogVel,this.joltVel),this.energy-=t):(U(this.vel,this.jogVel,M(this.joltVel,this.joltVel,.5)),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),M(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),super.update(t,i);for(const a of i.players){if(a===this||!o.carried||o.carrier!==a||a.team===this.team||!this.collidesWith(a))continue;const l=w();j(l,a.pos,this.pos),l[1]=0,E(l,l);const c=b(this.jogVel);if(c[1]=0,D(c)<1e-4)continue;E(c,c);const u=et(c,l),p=I(this.pos,a.pos);if(u>.5&&p<1.5){o.carried=!1,o.carrier=null;const f=w();j(f,a.pos,this.pos),E(f,f),M(f,f,8+Math.random()*4),B(o.vel,f),B(o.pos,a.pos),o.lastTouchedType="spill",o.hasBounced=!1,n="tackle",this.stateTimer=1,a.actionState="tackled",a.stateTimer=1;break}}return!o.carried&&o.collidesWith(this)&&n===null&&(o.pickup(this),n="pickup",this.team==="home")?(i.player=this,null):(n||(n=D(this.vel)>1e-4?"run":"idle"),n)}collideBounds(){return[.5,1.8]}updateHuman(t,i){const s=i.controls,o=i.ball,{kickPressed:n,kickReleased:r,kickHeldTime:h,moveX:a,moveZ:l,aimTarget:c}=s.state,u=1e-4;let p=null;if((a!==0||l!==0)&&!this.aiming){const f=R(a,0,l);if(Mt(f)>u){E(f,f),M(this.joltVel,f,this.joltSpeed);const d=b(this.jogVel),g=w();M(g,f,.1),U(d,d,g),D(d)>u?(E(d,d),M(this.jogVel,d,this.jogSpeed)):st(this.jogVel,0,0,0)}}this.energy>0?(U(this.vel,this.jogVel,this.joltVel),this.energy-=t):(U(this.vel,this.jogVel,M(this.joltVel,this.joltVel,.5)),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),M(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),super.update(t,i),!o.carried&&o.collidesWith(this)&&(o.pickup(this),p="pickup");const v=Lt(0,-10);if(c&&bt(v,v,c),o.carried&&o.carrier===this&&(n&&(this.aiming=!0),r&&console.log("Kick released:",r,"aimTarget:",c,"player: ",this),r&&c)){const f=h<.25,d=vt(v);if(d>.1){const g=-this.gravity[1],m=45*Math.PI/180,T=Math.sin(2*m),A=f?15:Math.sqrt(d*g/T),S=R(v[0],0,v[1]);E(S,S);const y=R(S[0]*Math.cos(m),Math.sin(m),S[2]*Math.cos(m));o.launch(y,A),o.lastTouchedType=f?"handpass":"kick",o.hasBounced=!1,p=f?"handpass":"kick",this.stateTimer=.5}this.aiming=!1}return this.aiming?i.aimTarget.setPosition([this.pos[0]+v[0],.002,this.pos[2]+v[1]]):i.aimTarget.setPosition(R(this.pos[0],.002,this.pos[2]+.8)),!p&&this.actionState!=="run"&&this.actionState!=="idle"&&(p=D(this.vel)>u?"run":"idle"),p}update(t,i){if(!this.playing)return;if(this.actionState==="pickup"&&(this.actionState="run"),this.actionState==="tackled"||this.actionState==="tackle"||this.actionState==="kick"||this.actionState==="handpass"){this.vel=R(0,0,0),this.stateTimer-=t,this.stateTimer<=0&&(this.actionState="idle",this.stateTimer=0),this.updateAnimation(t,null,i.ball);return}let s=null;i.player===this?s=this.updateHuman(t,i):s=this.updateAI(t,i),this.updateAnimation(t,s,i.ball),s!==null&&(this.actionState=s)}updateAnimation(t,i,s){const o=this.animations[this.animState];if(o.length===0)return;this.animTimer+=t;const n=1/this.animFPS;this.animTimer>=n&&(this.animTimer-=n,this.animFrame=this.animFrame+1),i==="kick"&&(this.animState="kickRightFoot",this.animFrame=0,this.animTimer=0),this.animState==="run"&&I(this.vel,[0,0,0])===0&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animState==="idle"&&I(this.vel,[0,0,0])!==0&&(this.animState="run",this.animFrame=0,this.animTimer=0);const r=this.animState==="run"||this.animState==="idle";this.animFrame>=o.length&&(this.animFrame=r?0:o.length-1,r||(this.animState="run",this.animFrame=0,this.animTimer=0));const h=this.animations[this.animState];this.animSprite=b(h[this.animFrame])??R(0,0,0),(this.vel[2]>0?"away":this.vel[2]<0||this.pos[2]<s.pos[2]?"home":"away")==="away"&&(this.animSprite[0]+=7)}render(t){const[i,s,o]=this.animSprite;t.renderSprite(this.pos,this.width,this.height,i,s)}setupForBoundary(t,i){B(this.pos,this.positionPos)}}class Nt extends rt{constructor(t){super(t),this.carried=!1,this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0,this.animations=Object.freeze({idle:[[0,1,0]],backSpin:[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[8,1,0]],forwardSpin:[[8,1,0],[7,1,0],[6,1,0],[5,1,0],[4,1,0],[3,1,0],[2,1,0],[1,1,0]],backSpinRight:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]],backSpinLeft:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinRight:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinLeft:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=12,this.lastTouchedBy=null,this.lastTouchedType=null,this.hasBounced=!1}update(t,i){if(this.carried&&this.carrier){const s=R(0,.5,this.carrier.vel[2]>0?.2:-.2),o=b(this.carrier.pos);U(this.pos,o,s)}else{const s=this.vel[1]<0;super.update(t,i),this.hasBounced=this.hasBounced||s&&this.vel[1]>0&&this.pos[1]<=this.floorY,this.pos[1]<=this.floorY&&M(this.vel,this.vel,.97)}this.updateAnimation(t)}pickup(t){this.carried=!0,this.carrier=t,this.lastTouchedBy=t,this.lastTouchedType=null,this.hasBounced=!1,st(this.pos,t.pos[0],t.pos[1],t.pos[2]-1),st(this.vel,0,0,0)}launch(t,i,s="kick"){this.carried=!1,this.carrier=null,M(this.vel,t,i),this.lastTouchedType=s,this.hasBounced=!1}updateAnimation(t){this.animTimer+=t;const i=1/this.animFPS;this.animTimer>=i&&(this.animTimer-=i,this.animFrame=this.animFrame+1);const s=this.animState;this.carried?this.animState="idle":this.lastTouchedType==="kick"&&!this.hasBounced?this.animState="backSpin":this.lastTouchedType==="handpass"&&!this.hasBounced?this.animState="backSpinRight":this.hasBounced?Math.abs(this.vel[1])<.05&&this.pos[1]<=this.floorY+.01?this.animState="idle":this.animState="forwardSpin":this.animState="idle",this.animState!==s&&(this.animFrame=0,this.animTimer=0);const o=this.animations[this.animState];o.length!==0&&this.animFrame>=o.length&&(this.animFrame=0)}render(t){var r;const i=(r=this.animations)==null?void 0:r[this.animState],[s,o,n]=(i==null?void 0:i[this.animFrame])??[0,1,void 0];t.renderSprite(this.pos,this.width,this.height,s,o)}setupForBoundary(t,i){if(this.carried=!1,this.carrier=null,t==="goalAway"||t==="goalHome")B(this.pos,[0,0,L/2]),B(this.vel,[0,0,0]);else if(t==="behindAway")B(this.pos,[0,0,L]),this.launch([0,0,1],20,"kick");else if(t==="behindHome")B(this.pos,[0,0,0]),this.launch([0,0,-1],20,"kick");else if(t==="outOfBounds"){B(this.pos,i);const s=w();O(s,[0,0,L/2],i,-1),E(s,s),this.launch(s,15,"kick")}}}class zt{constructor(t=[0,.001,0]){this.pos=b(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const i=t.gl;i.useProgram(t.program),i.bindVertexArray(t.quadVao);const[s,o]=this.spriteCoord,n=s/t.sheetCols,r=o/t.sheetRows,h=(s+1)/t.sheetCols,a=(o+1)/t.sheetRows;i.uniform4f(t.uTileUV,n,r,h,a);const l=G();Y(l,l,[this.pos[0],.001,this.pos[2]]),Pt(l,l,-Math.PI/2),it(l,l,[this.size,this.size,1]),i.uniformMatrix4fv(t.uModel,!1,l),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}}function mt(e,t,i){const s=(h,a)=>{const l=e.createShader(a);if(!l)throw new Error("Failed to create shader");if(e.shaderSource(l,h),e.compileShader(l),!e.getShaderParameter(l,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(l));return l},o=s(t,e.VERTEX_SHADER),n=s(i,e.FRAGMENT_SHADER),r=e.createProgram();if(e.attachShader(r,o),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(r));return r}async function Gt(e){const t=new Image;return t.src=e,await t.decode(),t}function Xt(e,t,i,s=1){const r=e*2/1.6/s,h=t*2/2/s,a=[0,0,0,.5,.5],l=[];for(let c=0;c<=i;c++){const u=c/i*2*Math.PI,p=Math.cos(u)*e,v=Math.sin(u)*t,f=p/(e*2)*r+.5,d=v/(t*2)*h+.5;a.push(p,0,v,f,d),c>0&&l.push(0,c,c+1)}return{vertices:new Float32Array(a),indices:new Uint16Array(l)}}function Yt(e=160,t=170,i=50,s=50,o=.4){const n=[],r=[];let h=0;const a=(d,g,m,T,A)=>{const S=m-d,y=T-g,_=Math.hypot(S,y),F=-y/_,V=S/_,k=A/2,X=d+F*k,W=g+V*k,Z=d-F*k,$=g-V*k,J=m+F*k,z=T+V*k,St=m-F*k,Rt=T-V*k;n.push(X,0,W,J,0,z,St,0,Rt,Z,0,$),r.push(h,h+1,h+2,h,h+2,h+3),h+=4},l=e/2,c=t/2,u=64;for(let d=0;d<u;d++){const g=d/u*2*Math.PI,m=(d+1)/u*2*Math.PI,T=Math.cos(g)*l,A=Math.sin(g)*c,S=Math.cos(m)*l,y=Math.sin(m)*c;a(T,A,S,y,o)}const p=[[-s/2,-s/2],[s/2,-s/2],[s/2,s/2],[-s/2,s/2]];for(let d=0;d<4;d++){const[g,m]=p[d],[T,A]=p[(d+1)%4];a(g,m,T,A,o)}function v(d){const g=d>0?-1:1,m=[];for(let T=0;T<=1e3;T++){const A=-Math.PI+T/1e3*2*Math.PI,S=Math.sin(A)*i,y=d+g*Math.cos(A)*i,_=S/l,F=y/c;_*_+F*F<=1&&m.push(A)}return m.length===0?[-Math.PI/3,Math.PI/3]:[m[0],m[m.length-1]]}const f=40;for(let d of[-t/2,t/2]){const g=d>0?-1:1,[m,T]=v(d);for(let A=0;A<f;A++){const S=m+A/f*(T-m),y=m+(A+1)/f*(T-m),_=Math.sin(S)*i,F=d+g*Math.cos(S)*i,V=Math.sin(y)*i,k=d+g*Math.cos(y)*i;a(_,F,V,k,o)}}return{vertices:new Float32Array(n),indices:new Uint16Array(r)}}const q=170,qt=80,ut=q/2;class Wt{constructor(t,i,s){this.gl=t,this.canvas=i,this.spriteSheet=s,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,i=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 tileUV = mod(v_texcoord, 1.0);
  vec2 texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=mt(this.gl,t,i),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,i=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=mt(this.gl,t,i),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const i=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),s=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:i,indices:s}=Xt(qt,ut,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.fieldIndices=s.length,this.fieldLineMesh=Yt(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,q],[-3,0,q],[3,0,q],[9,0,q],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=G(),_t(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=G(),this.model=G()}renderSprite(t,i,s,o,n){const{gl:r,program:h,quadVao:a,uModel:l,uTileUV:c,sheetCols:u,sheetRows:p}=this;r.useProgram(h),r.bindVertexArray(a);const v=G();Y(v,v,t),it(v,v,[i,s,1]),r.uniformMatrix4fv(l,!1,v);const f=o/u,d=n/p,g=(o+1)/u,m=(n+1)/p;r.uniform4f(c,f,d,g,m),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}renderScene(t,i){const s=this.gl;s.viewport(0,0,this.canvas.width,this.canvas.height),s.clearColor(.2,.6,.2,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const o=R(t.cameraTarget[0],t.cameraTarget[1]+10,t.cameraTarget[2]+15);nt(t.cameraTarget,t.cameraTarget,o,.05);const n=R(t.cameraTarget[0],t.cameraTarget[1]+10,t.cameraTarget[2]+15),r=R(0,0,-20),h=w();U(h,t.cameraTarget,r),kt(this.view,n,h,[0,1,0]),s.useProgram(this.program),s.uniformMatrix4fv(this.uProjection,!1,this.projection),s.uniformMatrix4fv(this.uView,!1,this.view),s.activeTexture(s.TEXTURE0),s.uniform1i(this.uTexture,0),s.bindVertexArray(this.fieldVao),pt(this.model),Y(this.model,this.model,[0,0,ut]),s.uniformMatrix4fv(this.uModel,!1,this.model);const a=0,l=2,c=a/this.sheetCols,u=l/this.sheetRows,p=(a+1)/this.sheetCols,v=(l+1)/this.sheetRows;s.uniform4f(this.uTileUV,c,u,p,v),s.drawElements(s.TRIANGLES,this.fieldIndices,s.UNSIGNED_SHORT,0),s.useProgram(this.lineProgram),s.uniformMatrix4fv(this.lineProj,!1,this.projection),s.uniformMatrix4fv(this.lineView,!1,this.view);const f=G();Y(f,this.model,[0,.001,0]),s.uniformMatrix4fv(this.lineModel,!1,f),s.bindVertexArray(this.lineVao),s.drawElements(s.TRIANGLES,this.fieldLineMesh.indices.length,s.UNSIGNED_SHORT,0),s.useProgram(this.program),s.bindVertexArray(this.quadVao);const d=1,g=2,m=d/this.sheetCols,T=g/this.sheetRows,A=(d+1)/this.sheetCols,S=(g+1)/this.sheetRows;s.uniform4f(this.uTileUV,m,T,A,S);for(let y=0;y<this.goalPostPositions.length;y++){const[_,F,V]=this.goalPostPositions[y],X=y%4===0||y%4===3?6:10,W=t.cameraPos[0]-_,Z=t.cameraPos[2]-V,$=Math.sqrt(W*W+Z*Z),J=$>50?1.5:$>150?2:1,z=G();Y(z,z,[_,F,V]),it(z,z,[J,X,1]),s.uniformMatrix4fv(this.uModel,!1,z),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}s.bindVertexArray(this.quadVao);for(const y of i)y instanceof rt?y.render(this):this.renderSprite(y.pos,y.width,y.height,1,0);t.aimTarget.render(this)}}var N,Tt,yt,At;class Zt{constructor(t){ht(this,N);this.state={moveX:0,moveZ:0,kickPressed:!1,kickReleased:!1,kickHeldTime:0,aimTarget:null},this.keys={},this.lastKeys={},this.touchMove=null,this.touchAim=null,this.kPressTime=0,t.addEventListener("touchstart",K(this,N,Tt).bind(this),{passive:!1}),t.addEventListener("touchmove",K(this,N,yt).bind(this),{passive:!1}),t.addEventListener("touchend",K(this,N,At).bind(this)),window.addEventListener("keydown",i=>this.keys[i.key.toLowerCase()]=!0),window.addEventListener("keyup",i=>this.keys[i.key.toLowerCase()]=!1)}endUpdate(){this.state.moveX=0,this.state.moveZ=0,this.state.kickPressed=!1,this.state.kickReleased=!1}update(t){var n;const i=!!this.keys.k,s=!!this.lastKeys.k;if(i&&!s&&(this.state.kickPressed=!0,this.kPressTime=0,this.state.aimTarget=[0,0]),i?(this.kPressTime+=t,this.state.aimTarget&&(this.keys.a&&(this.state.aimTarget[0]-=30*t),this.keys.d&&(this.state.aimTarget[0]+=30*t),this.keys.w&&(this.state.aimTarget[1]-=30*t),this.keys.s&&(this.state.aimTarget[1]+=30*t))):(this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1)),!i&&s&&(this.state.kickReleased=!0),this.state.kickHeldTime=this.kPressTime,this.touchMove&&!this.touchAim&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=this.touchMove.dy/50),this.touchAim){this.kPressTime+=t;const r=this.touchAim.dx,h=this.touchAim.dy;console.log("Touch aim:",r,h);const a=10;this.state.aimTarget=[-r/a,-h/a],this.state.kickHeldTime=this.kPressTime}const o=(n=navigator.getGamepads)==null?void 0:n.call(navigator)[0];if(o){this.state.moveX+=o.axes[0]||0,this.state.moveZ+=-(o.axes[1]||0);const r=o.axes[2]||0,h=-(o.axes[3]||0),a=Math.hypot(r,h);a>.2&&(this.state.aimTarget=[r/a,h/a])}this.lastKeys={...this.keys}}getState(){return this.state}}N=new WeakSet,Tt=function(t){t.preventDefault();for(const i of t.changedTouches)i.clientX<window.innerWidth/2?this.touchMove={id:i.identifier,startX:i.clientX,startY:i.clientY,dx:0,dy:0}:(this.touchAim={id:i.identifier,startX:i.clientX,startY:i.clientY,dx:0,dy:0},this.state.kickPressed=!0,this.kPressTime=0)},yt=function(t){t.preventDefault();for(const i of t.changedTouches)this.touchMove&&i.identifier===this.touchMove.id&&(this.touchMove.dx=i.clientX-this.touchMove.startX,this.touchMove.dy=i.clientY-this.touchMove.startY),this.touchAim&&i.identifier===this.touchAim.id&&(this.touchAim.dx=i.clientX-this.touchAim.startX,this.touchAim.dy=i.clientY-this.touchAim.startY)},At=function(t){t.preventDefault();for(const i of t.changedTouches)this.touchAim&&i.identifier===this.touchAim.id&&(this.touchAim=null,this.state.kickReleased=!0),this.touchMove&&i.identifier===this.touchMove.id&&(this.touchMove=null)};class $t{constructor(t,i){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new Wt(this.gl,t,i),this.controls=new Zt(t),this.entities=[],this.aimTarget=new zt([5,.001,L/2]),this.ball=new Nt(R(0,0,L/2)),this.entities.push(this.ball),this.players=[],this.homePositions=ft(),this.awayPositions=ft(!0);const s=[[this.homePositions,"home"],[this.awayPositions,"away"]];for(let[o,n]of s)for(const[r,h]of Object.entries(o)){const a=new Ct(r,n,h,!r.toLowerCase().startsWith("bench"));this.entities.push(a),this.players.push(a),r==="RR"&&n==="home"&&(this.player=a)}this.cameraTarget=w(),this.cameraPos=R(0,10,15),this.resize(),window.addEventListener("resize",()=>this.resize()),this.lastTime=performance.now()}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){const i=(t-this.lastTime)/1e3,s=Math.min(i,1/30);this.lastTime=t,this.controls.update(s);const o=b(this.ball.pos);for(const r of this.entities)r.update(s,this);const n=jt(o,this.ball.pos);if(n!==null)for(const r of this.entities)r.setupForBoundary(n,this.ball.pos);this.updateCameraTarget(),this.renderer.renderScene(this,this.entities),this.controls.endUpdate(),requestAnimationFrame(this.loop.bind(this))}updateCameraTarget(){const t=this.ball,i=t.carrier;if(i)if(i.team==="home")B(this.cameraTarget,i.pos);else{const o=R(0,0,15);U(this.cameraTarget,i.pos,o)}else{const s=R(0,0,15);nt(this.cameraTarget,this.cameraTarget,U(w(),t.pos,s),.2)}}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.renderer.setupCamera()}}const Kt="/footy/assets/spritesheet-C9G_3zho.png";function Qt(e){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");new $t(t,e).start()}Gt(Kt).then(e=>{if(!e.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");Qt(e)});
