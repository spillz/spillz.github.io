var O=i=>{throw TypeError(i)};var ot=(i,t,e)=>t.has(i)||O("Cannot "+e);var H=(i,t,e)=>t.has(i)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e);var D=(i,t,e)=>(ot(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();var j=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function L(){var i=new x(16);return x!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function $(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function b(i,t,e){var s=e[0],r=e[1],n=e[2],o,h,a,m,f,p,v,l,T,c,u,d;return t===i?(i[12]=t[0]*s+t[4]*r+t[8]*n+t[12],i[13]=t[1]*s+t[5]*r+t[9]*n+t[13],i[14]=t[2]*s+t[6]*r+t[10]*n+t[14],i[15]=t[3]*s+t[7]*r+t[11]*n+t[15]):(o=t[0],h=t[1],a=t[2],m=t[3],f=t[4],p=t[5],v=t[6],l=t[7],T=t[8],c=t[9],u=t[10],d=t[11],i[0]=o,i[1]=h,i[2]=a,i[3]=m,i[4]=f,i[5]=p,i[6]=v,i[7]=l,i[8]=T,i[9]=c,i[10]=u,i[11]=d,i[12]=o*s+f*r+T*n+t[12],i[13]=h*s+p*r+c*n+t[13],i[14]=a*s+v*r+u*n+t[14],i[15]=m*s+l*r+d*n+t[15]),i}function B(i,t,e){var s=e[0],r=e[1],n=e[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*n,i[9]=t[9]*n,i[10]=t[10]*n,i[11]=t[11]*n,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function ht(i,t,e){var s=Math.sin(e),r=Math.cos(e),n=t[4],o=t[5],h=t[6],a=t[7],m=t[8],f=t[9],p=t[10],v=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=n*r+m*s,i[5]=o*r+f*s,i[6]=h*r+p*s,i[7]=a*r+v*s,i[8]=m*r-n*s,i[9]=f*r-o*s,i[10]=p*r-h*s,i[11]=v*r-a*s,i}function at(i,t,e,s,r){var n=1/Math.tan(t/2),o;return i[0]=n/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,r!=null&&r!==1/0?(o=1/(s-r),i[10]=(r+s)*o,i[14]=2*r*s*o):(i[10]=-1,i[14]=-2*s),i}var ct=at;function lt(i,t,e,s){var r,n,o,h,a,m,f,p,v,l,T=t[0],c=t[1],u=t[2],d=s[0],A=s[1],g=s[2],E=e[0],y=e[1],_=e[2];return Math.abs(T-E)<j&&Math.abs(c-y)<j&&Math.abs(u-_)<j?$(i):(f=T-E,p=c-y,v=u-_,l=1/Math.hypot(f,p,v),f*=l,p*=l,v*=l,r=A*v-g*p,n=g*f-d*v,o=d*p-A*f,l=Math.hypot(r,n,o),l?(l=1/l,r*=l,n*=l,o*=l):(r=0,n=0,o=0),h=p*o-v*n,a=v*r-f*o,m=f*n-p*r,l=Math.hypot(h,a,m),l?(l=1/l,h*=l,a*=l,m*=l):(h=0,a=0,m=0),i[0]=r,i[1]=h,i[2]=f,i[3]=0,i[4]=n,i[5]=a,i[6]=p,i[7]=0,i[8]=o,i[9]=m,i[10]=v,i[11]=0,i[12]=-(r*T+n*c+o*u),i[13]=-(h*T+a*c+m*u),i[14]=-(f*T+p*c+v*u),i[15]=1,i)}function Q(){var i=new x(3);return x!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function G(i){var t=new x(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function mt(i){var t=i[0],e=i[1],s=i[2];return Math.hypot(t,e,s)}function M(i,t,e){var s=new x(3);return s[0]=i,s[1]=t,s[2]=e,s}function X(i,t,e,s){return i[0]=t,i[1]=e,i[2]=s,i}function N(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function U(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function q(i,t,e,s){return i[0]=t[0]+e[0]*s,i[1]=t[1]+e[1]*s,i[2]=t[2]+e[2]*s,i}function dt(i,t){var e=t[0]-i[0],s=t[1]-i[1],r=t[2]-i[2];return Math.hypot(e,s,r)}function ft(i){var t=i[0],e=i[1],s=i[2];return t*t+e*e+s*s}function z(i,t){var e=t[0],s=t[1],r=t[2],n=e*e+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}var W=dt,ut=ft;(function(){var i=Q();return function(t,e,s,r,n,o){var h,a;for(e||(e=3),s||(s=0),r?a=Math.min(r*e+s,t.length):a=t.length,h=s;h<a;h+=e)i[0]=t[h],i[1]=t[h+1],i[2]=t[h+2],n(i,i,o),t[h]=i[0],t[h+1]=i[1],t[h+2]=i[2];return t}})();function pt(){var i=new x(2);return x!=Float32Array&&(i[0]=0,i[1]=0),i}function gt(i,t){var e=new x(2);return e[0]=i,e[1]=t,e}function vt(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function Tt(i){var t=i[0],e=i[1];return Math.hypot(t,e)}(function(){var i=pt();return function(t,e,s,r,n,o){var h,a;for(e||(e=2),s||(s=0),r?a=Math.min(r*e+s,t.length):a=t.length,h=s;h<a;h+=e)i[0]=t[h],i[1]=t[h+1],n(i,i,o),t[h]=i[0],t[h+1]=i[1];return t}})();function At(i,t){const e=i.pos[0]-t.pos[0],s=i.pos[1]-t.pos[1],r=i.pos[2]-t.pos[2],n=e*e+s*s+r*r,o=.5*Math.sqrt(i.width*i.width+i.height*i.height),h=.5*Math.sqrt(t.width*t.width+t.height*t.height),a=o+h;return n<=a*a}class Y{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}update(t,e){this.usesGravity&&q(this.vel,this.vel,this.gravity,t),q(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return At(this,t)}}class Et extends Y{constructor(t){super(t),this.width=1.6,this.height=2.4,this.aiming=!1,this.jogVel=M(0,0,0),this.joltVel=M(0,0,0),this.jogSpeed=5,this.joltSpeed=5,this.joltDecayRate=8,this.animations=Object.freeze({idle:[[0,0,0]],run:[[1,0,0],[2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0]],kickRightFoot:[[1,0,0],[2,0,0]],kickLeftFoot:[[4,0,0],[5,0,0]],handpassRightHand:[[1,0,0],[0,0,0]],handpassLeftHand:[[4,0,0],[0,0,0]],jumpMark:[[1,0,0],[2,0,0],[0,0,0]],jumpSpoil:[[1,0,0],[2,0,0],[0,0,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=8}update(t,e){const s=e.controls,r=e.ball,{kickPressed:n,kickReleased:o,kickHeldTime:h,moveX:a,moveZ:m,aimTarget:f}=s.state,p=1e-4;if((a!==0||m!==0)&&!this.aiming){const T=M(a,0,m);if(ut(T)>p){z(T,T),U(this.joltVel,T,this.joltSpeed);const c=G(this.jogVel),u=Q();U(u,T,.1),N(c,c,u),mt(c)>p?(z(c,c),U(this.jogVel,c,this.jogSpeed)):X(this.jogVel,0,0,0)}}N(this.vel,this.jogVel,this.joltVel);const v=Math.exp(-this.joltDecayRate*t);U(this.joltVel,this.joltVel,v),super.update(t,e),!r.carried&&r.collidesWith(this)&&r.pickup(this);const l=gt(0,-10);if(f&&vt(l,l,f),r.carried&&r.carrier===this&&(n&&(this.aiming=!0),o&&f)){const T=h<.25,c=Tt(l);if(c>.1){const u=-this.gravity[1],d=45*Math.PI/180,A=Math.sin(2*d),g=T?15:Math.sqrt(c*u/A),E=M(l[0],0,l[1]);z(E,E);const y=M(E[0]*Math.cos(d),Math.sin(d),E[2]*Math.cos(d));N(r.pos,this.pos,[0,0,-3]),r.launch(y,g)}this.aiming=!1}this.aiming&&e.aimTarget.setPosition([this.pos[0]+l[0],.002,this.pos[2]+l[1]]),this.updateAnimation(t,o)}updateAnimation(t,e){const s=this.animations[this.animState];if(s.length===0)return;this.animTimer+=t;const r=1/this.animFPS;this.animTimer>=r&&(this.animTimer-=r,this.animFrame=this.animFrame+1),e&&(this.animState="kickRightFoot",this.animFrame=0,this.animTimer=0),this.animState==="run"&&W(this.vel,[0,0,0])===0&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animState==="idle"&&W(this.vel,[0,0,0])!==0&&(this.animState="run",this.animFrame=0,this.animTimer=0);const n=this.animState==="run"||this.animState==="idle";this.animFrame>=s.length&&(this.animFrame=n?0:s.length-1,n||(this.animState="run",this.animFrame=0,this.animTimer=0))}render(t){var o;const e=(o=this.animations)==null?void 0:o[this.animState],[s,r,n]=(e==null?void 0:e[this.animFrame])??[0,0,void 0];t.renderSprite(this.pos,this.width,this.height,s,r)}}class yt extends Y{constructor(t){super(t),this.carried=!1,this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0,this.animations=Object.freeze({idle:[[0,1,0]],backSpin:[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[8,1,0]],forwardSpin:[[8,1,0],[7,1,0],[6,1,0],[5,1,0],[4,1,0],[3,1,0],[2,1,0],[1,1,0]],backSpinRight:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]],backSpinLeft:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinRight:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinLeft:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=12}update(t,e){let s=!1;if(this.carried&&this.carrier){const r=M(0,0,-1),n=G(this.carrier.pos);N(this.pos,n,r)}else{const r=this.vel[1]<0;super.update(t,e),s=r&&this.vel[1]>0&&this.pos[1]<=this.floorY,this.pos[1]<=this.floorY&&U(this.vel,this.vel,.99)}this.updateAnimation(t,e.controls.state.kickReleased,s)}pickup(t){this.carried=!0,this.carrier=t,X(this.pos,t.pos[0],t.pos[1],t.pos[2]-1),X(this.vel,0,0,0)}launch(t,e){this.carried=!1,this.carrier=null,U(this.vel,t,e)}updateAnimation(t,e,s){const r=this.animations[this.animState];if(r.length===0)return;this.animTimer+=t;const n=1/this.animFPS;if(this.animTimer>=n&&(this.animTimer-=n,this.animFrame=this.animFrame+1),this.carried){this.animState="idle",this.animFrame=0,this.animTimer=0;return}e&&(this.animState="backSpin",this.animFrame=0,this.animTimer=0),this.animState==="backSpin"&&s&&(this.animState="forwardSpin",this.animFrame=0,this.animTimer=0),this.animState==="forwardSpin"&&this.vel[1]===0&&this.pos[1]<=this.floorY&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animFrame>=r.length&&(this.animFrame=0)}render(t){var o;const e=(o=this.animations)==null?void 0:o[this.animState],[s,r,n]=(e==null?void 0:e[this.animFrame])??[0,1,void 0];t.renderSprite(this.pos,this.width,this.height,s,r)}}class _t{constructor(t=[0,.001,0]){this.pos=G(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const e=t.gl;e.useProgram(t.program),e.bindVertexArray(t.quadVao);const[s,r]=this.spriteCoord,n=s/t.sheetCols,o=r/t.sheetRows,h=(s+1)/t.sheetCols,a=(r+1)/t.sheetRows;e.uniform4f(t.uTileUV,n,o,h,a);const m=L();b(m,m,[this.pos[0],.001,this.pos[2]]),ht(m,m,-Math.PI/2),B(m,m,[this.size,this.size,1]),e.uniformMatrix4fv(t.uModel,!1,m),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}}function Z(i,t,e){const s=(h,a)=>{const m=i.createShader(a);if(!m)throw new Error("Failed to create shader");if(i.shaderSource(m,h),i.compileShader(m),!i.getShaderParameter(m,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(m));return m},r=s(t,i.VERTEX_SHADER),n=s(e,i.FRAGMENT_SHADER),o=i.createProgram();if(i.attachShader(o,r),i.attachShader(o,n),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(i.getProgramInfoLog(o));return o}async function St(i){const t=new Image;return t.src=i,await t.decode(),t}function Rt(i,t,e,s=1){const o=i*2/1.6/s,h=t*2/2/s,a=[0,0,0,.5,.5],m=[];for(let f=0;f<=e;f++){const p=f/e*2*Math.PI,v=Math.cos(p)*i,l=Math.sin(p)*t,T=v/(i*2)*o+.5,c=l/(t*2)*h+.5;a.push(v,0,l,T,c),f>0&&m.push(0,f,f+1)}return{vertices:new Float32Array(a),indices:new Uint16Array(m)}}function Mt(i=160,t=170,e=50,s=50,r=.4){const n=[],o=[];let h=0;const a=(c,u,d,A,g)=>{const E=d-c,y=A-u,_=Math.hypot(E,y),R=-y/_,P=E/_,S=g/2,V=c+R*S,I=u+P*S,C=c-R*S,F=u-P*S,et=d+R*S,st=A+P*S,rt=d-R*S,nt=A-P*S;n.push(V,0,I,et,0,st,rt,0,nt,C,0,F),o.push(h,h+1,h+2,h,h+2,h+3),h+=4},m=i/2,f=t/2,p=64;for(let c=0;c<p;c++){const u=c/p*2*Math.PI,d=(c+1)/p*2*Math.PI,A=Math.cos(u)*m,g=Math.sin(u)*f,E=Math.cos(d)*m,y=Math.sin(d)*f;a(A,g,E,y,r)}const v=[[-s/2,-s/2],[s/2,-s/2],[s/2,s/2],[-s/2,s/2]];for(let c=0;c<4;c++){const[u,d]=v[c],[A,g]=v[(c+1)%4];a(u,d,A,g,r)}function l(c){const u=c>0?-1:1,d=[];for(let A=0;A<=1e3;A++){const g=-Math.PI+A/1e3*2*Math.PI,E=Math.sin(g)*e,y=c+u*Math.cos(g)*e,_=E/m,R=y/f;_*_+R*R<=1&&d.push(g)}return d.length===0?[-Math.PI/3,Math.PI/3]:[d[0],d[d.length-1]]}const T=40;for(let c of[-t/2,t/2]){const u=c>0?-1:1,[d,A]=l(c);for(let g=0;g<T;g++){const E=d+g/T*(A-d),y=d+(g+1)/T*(A-d),_=Math.sin(E)*e,R=c+u*Math.cos(E)*e,P=Math.sin(y)*e,S=c+u*Math.cos(y)*e;a(_,R,P,S,r)}}return{vertices:new Float32Array(n),indices:new Uint16Array(o)}}const k=170,xt=80,K=k/2;class Pt{constructor(t,e,s){this.gl=t,this.canvas=e,this.spriteSheet=s,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,e=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 tileUV = mod(v_texcoord, 1.0);
  vec2 texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=Z(this.gl,t,e),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,e=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=Z(this.gl,t,e),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const e=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),s=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:e,indices:s}=Rt(xt,K,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.fieldIndices=s.length,this.fieldLineMesh=Mt(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,k],[-3,0,k],[3,0,k],[9,0,k],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=L(),ct(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=L(),this.model=L()}renderSprite(t,e,s,r,n){const{gl:o,program:h,quadVao:a,uModel:m,uTileUV:f,sheetCols:p,sheetRows:v}=this;o.useProgram(h),o.bindVertexArray(a);const l=L();b(l,l,t),B(l,l,[e,s,1]),o.uniformMatrix4fv(m,!1,l);const T=r/p,c=n/v,u=(r+1)/p,d=(n+1)/v;o.uniform4f(f,T,c,u,d),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}renderScene(t,e){const s=this.gl;s.viewport(0,0,this.canvas.width,this.canvas.height),s.clearColor(.2,.6,.2,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const r=M(t.player.pos[0],t.player.pos[1]+10,t.player.pos[2]+15),n=M(t.player.pos[0],t.player.pos[1],t.player.pos[2]-20);lt(this.view,r,n,[0,1,0]),s.useProgram(this.program),s.uniformMatrix4fv(this.uProjection,!1,this.projection),s.uniformMatrix4fv(this.uView,!1,this.view),s.activeTexture(s.TEXTURE0),s.uniform1i(this.uTexture,0),s.bindVertexArray(this.fieldVao),$(this.model),b(this.model,this.model,[0,0,K]),s.uniformMatrix4fv(this.uModel,!1,this.model);const o=0,h=2,a=o/this.sheetCols,m=h/this.sheetRows,f=(o+1)/this.sheetCols,p=(h+1)/this.sheetRows;s.uniform4f(this.uTileUV,a,m,f,p),s.drawElements(s.TRIANGLES,this.fieldIndices,s.UNSIGNED_SHORT,0),s.useProgram(this.lineProgram),s.uniformMatrix4fv(this.lineProj,!1,this.projection),s.uniformMatrix4fv(this.lineView,!1,this.view);const v=L();b(v,this.model,[0,.001,0]),s.uniformMatrix4fv(this.lineModel,!1,v),s.bindVertexArray(this.lineVao),s.drawElements(s.TRIANGLES,this.fieldLineMesh.indices.length,s.UNSIGNED_SHORT,0),s.useProgram(this.program),s.bindVertexArray(this.quadVao);const l=1,T=2,c=l/this.sheetCols,u=T/this.sheetRows,d=(l+1)/this.sheetCols,A=(T+1)/this.sheetRows;s.uniform4f(this.uTileUV,c,u,d,A);for(let g=0;g<this.goalPostPositions.length;g++){const[E,y,_]=this.goalPostPositions[g],P=g%4===0||g%4===3?6:10,S=r[0]-E,V=r[2]-_,I=Math.sqrt(S*S+V*V),C=I>50?1.5:I>150?2:1,F=L();b(F,F,[E,y,_]),B(F,F,[C,P,1]),s.uniformMatrix4fv(this.uModel,!1,F),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}s.bindVertexArray(this.quadVao);for(const g of e)g instanceof Y?g.render(this):this.renderSprite(g.pos,g.width,g.height,1,0);t.player.aiming&&t.aimTarget.render(this)}}var w,J,tt,it;class wt{constructor(t){H(this,w);this.state={moveX:0,moveZ:0,kickPressed:!1,kickReleased:!1,kickHeldTime:0,aimTarget:null},this.keys={},this.lastKeys={},this.touchMove=null,this.touchAim=null,this.kPressTime=0,t.addEventListener("touchstart",D(this,w,J).bind(this),{passive:!1}),t.addEventListener("touchmove",D(this,w,tt).bind(this),{passive:!1}),t.addEventListener("touchend",D(this,w,it).bind(this)),window.addEventListener("keydown",e=>this.keys[e.key.toLowerCase()]=!0),window.addEventListener("keyup",e=>this.keys[e.key.toLowerCase()]=!1)}endUpdate(){this.state.moveX=0,this.state.moveZ=0,this.state.kickPressed=!1,this.state.kickReleased=!1}update(t){var n;const e=!!this.keys.k,s=!!this.lastKeys.k;if(e&&!s&&(this.state.kickPressed=!0,this.kPressTime=0,this.state.aimTarget=[0,0]),e?(this.kPressTime+=t,this.state.aimTarget&&(this.keys.a&&(this.state.aimTarget[0]-=30*t),this.keys.d&&(this.state.aimTarget[0]+=30*t),this.keys.w&&(this.state.aimTarget[1]-=30*t),this.keys.s&&(this.state.aimTarget[1]+=30*t))):(this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1)),!e&&s&&(this.state.kickReleased=!0),this.state.kickHeldTime=this.kPressTime,this.touchMove&&!this.touchAim&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=this.touchMove.dy/50),this.touchAim){this.kPressTime+=t;const o=this.touchAim.dx,h=this.touchAim.dy;console.log("Touch aim:",o,h);const a=10;this.state.aimTarget=[-o/a,-h/a],this.state.kickHeldTime=this.kPressTime}const r=(n=navigator.getGamepads)==null?void 0:n.call(navigator)[0];if(r){this.state.moveX+=r.axes[0]||0,this.state.moveZ+=-(r.axes[1]||0);const o=r.axes[2]||0,h=-(r.axes[3]||0),a=Math.hypot(o,h);a>.2&&(this.state.aimTarget=[o/a,h/a])}this.lastKeys={...this.keys}}getState(){return this.state}}w=new WeakSet,J=function(t){t.preventDefault();for(const e of t.changedTouches)e.clientX<window.innerWidth/2?this.touchMove={id:e.identifier,startX:e.clientX,startY:e.clientY,dx:0,dy:0}:(this.touchAim={id:e.identifier,startX:e.clientX,startY:e.clientY,dx:0,dy:0},this.state.kickPressed=!0,this.kPressTime=0)},tt=function(t){t.preventDefault();for(const e of t.changedTouches)this.touchMove&&e.identifier===this.touchMove.id&&(this.touchMove.dx=e.clientX-this.touchMove.startX,this.touchMove.dy=e.clientY-this.touchMove.startY),this.touchAim&&e.identifier===this.touchAim.id&&(this.touchAim.dx=e.clientX-this.touchAim.startX,this.touchAim.dy=e.clientY-this.touchAim.startY)},it=function(t){t.preventDefault();for(const e of t.changedTouches)this.touchAim&&e.identifier===this.touchAim.id&&(this.touchAim=null,this.state.kickReleased=!0),this.touchMove&&e.identifier===this.touchMove.id&&(this.touchMove=null)};class Ft{constructor(t,e){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new Pt(this.gl,t,e),this.controls=new wt(t),this.entities=[],this.aimTarget=new _t([5,.001,150]),this.player=new Et(M(0,0,170)),this.entities.push(this.player),this.ball=new yt(M(0,0,160)),this.entities.push(this.ball),this.player.vel[2]=-5,this.resize(),window.addEventListener("resize",()=>this.resize()),this.lastTime=performance.now()}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){const e=(t-this.lastTime)/1e3;this.lastTime=t,this.controls.update(e);for(const s of this.entities)s.update(e,this);this.renderer.renderScene(this,this.entities),this.controls.endUpdate(),requestAnimationFrame(this.loop.bind(this))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.renderer.setupCamera()}}const Lt="/footy/assets/spritesheet-Cvj-n86j.png";function Ut(i){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");new Ft(t,i).start()}St(Lt).then(i=>{if(!i.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");Ut(i)});
