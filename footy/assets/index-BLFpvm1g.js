var G=e=>{throw TypeError(e)};var ot=(e,t,s)=>t.has(e)||G("Cannot "+s);var z=(e,t,s)=>t.has(e)?G("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s);var D=(e,t,s)=>(ot(e,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();var C=1e-6,R=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function L(){var e=new R(16);return R!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function j(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function U(e,t,s){var i=s[0],r=s[1],o=s[2],n,h,a,c,d,m,v,f,A,l,g,u;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*o+t[12],e[13]=t[1]*i+t[5]*r+t[9]*o+t[13],e[14]=t[2]*i+t[6]*r+t[10]*o+t[14],e[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(n=t[0],h=t[1],a=t[2],c=t[3],d=t[4],m=t[5],v=t[6],f=t[7],A=t[8],l=t[9],g=t[10],u=t[11],e[0]=n,e[1]=h,e[2]=a,e[3]=c,e[4]=d,e[5]=m,e[6]=v,e[7]=f,e[8]=A,e[9]=l,e[10]=g,e[11]=u,e[12]=n*i+d*r+A*o+t[12],e[13]=h*i+m*r+l*o+t[13],e[14]=a*i+v*r+g*o+t[14],e[15]=c*i+f*r+u*o+t[15]),e}function B(e,t,s){var i=s[0],r=s[1],o=s[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nt(e,t,s){var i=Math.sin(s),r=Math.cos(s),o=t[4],n=t[5],h=t[6],a=t[7],c=t[8],d=t[9],m=t[10],v=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=n*r+d*i,e[6]=h*r+m*i,e[7]=a*r+v*i,e[8]=c*r-o*i,e[9]=d*r-n*i,e[10]=m*r-h*i,e[11]=v*r-a*i,e}function ht(e,t,s,i,r){var o=1/Math.tan(t/2),n;return e[0]=o/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(n=1/(i-r),e[10]=(r+i)*n,e[14]=2*r*i*n):(e[10]=-1,e[14]=-2*i),e}var at=ht;function ct(e,t,s,i){var r,o,n,h,a,c,d,m,v,f,A=t[0],l=t[1],g=t[2],u=i[0],E=i[1],p=i[2],T=s[0],_=s[1],y=s[2];return Math.abs(A-T)<C&&Math.abs(l-_)<C&&Math.abs(g-y)<C?j(e):(d=A-T,m=l-_,v=g-y,f=1/Math.hypot(d,m,v),d*=f,m*=f,v*=f,r=E*v-p*m,o=p*d-u*v,n=u*m-E*d,f=Math.hypot(r,o,n),f?(f=1/f,r*=f,o*=f,n*=f):(r=0,o=0,n=0),h=m*n-v*o,a=v*r-d*n,c=d*o-m*r,f=Math.hypot(h,a,c),f?(f=1/f,h*=f,a*=f,c*=f):(h=0,a=0,c=0),e[0]=r,e[1]=h,e[2]=d,e[3]=0,e[4]=o,e[5]=a,e[6]=m,e[7]=0,e[8]=n,e[9]=c,e[10]=v,e[11]=0,e[12]=-(r*A+o*l+n*g),e[13]=-(h*A+a*l+c*g),e[14]=-(d*A+m*l+v*g),e[15]=1,e)}function lt(){var e=new R(3);return R!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Z(e){var t=new R(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(e){var t=e[0],s=e[1],i=e[2];return Math.hypot(t,s,i)}function b(e,t,s){var i=new R(3);return i[0]=e,i[1]=t,i[2]=s,i}function O(e,t,s,i){return e[0]=t,e[1]=s,e[2]=i,e}function K(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e}function k(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function H(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e}function ft(e,t){var s=t[0],i=t[1],r=t[2],o=s*s+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}(function(){var e=lt();return function(t,s,i,r,o,n){var h,a;for(s||(s=3),i||(i=0),r?a=Math.min(r*s+i,t.length):a=t.length,h=i;h<a;h+=s)e[0]=t[h],e[1]=t[h+1],e[2]=t[h+2],o(e,e,n),t[h]=e[0],t[h+1]=e[1],t[h+2]=e[2];return t}})();function dt(){var e=new R(2);return R!=Float32Array&&(e[0]=0,e[1]=0),e}function ut(e,t){var s=new R(2);return s[0]=e,s[1]=t,s}(function(){var e=dt();return function(t,s,i,r,o,n){var h,a;for(s||(s=2),i||(i=0),r?a=Math.min(r*s+i,t.length):a=t.length,h=i;h<a;h+=s)e[0]=t[h],e[1]=t[h+1],o(e,e,n),t[h]=e[0],t[h+1]=e[1];return t}})();function pt(e,t){const s=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],r=e.pos[2]-t.pos[2],o=s*s+i*i+r*r,n=.5*Math.sqrt(e.width*e.width+e.height*e.height),h=.5*Math.sqrt(t.width*t.width+t.height*t.height),a=n+h;return o<=a*a}class X{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}update(t,s){this.usesGravity&&H(this.vel,this.vel,this.gravity,t),H(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return pt(this,t)}}class mt extends X{constructor(t){super(t),this.width=1.6,this.height=2.4}update(t,s){const i=s.controls,r=s.entities.find(o=>o instanceof $);if(i.state.moveX!==0||i.state.moveZ!==0){const o=i.state.moveX,n=i.state.moveZ,h=Math.sqrt(o*o+n*n);h>0&&(this.vel[0]=o/h*5,this.vel[2]=n/h*5)}if(super.update(t,s),!r){console.warn("No ball found in game entities");return}if(!r.carried&&r.collidesWith(this)&&r.pickup(this),r.carried&&r.carrier===this&&i.state.kick){let o=i.state.aimTarget??ut(0,-10);if(o){const n=b(o[0],0,o[1]);Y(n)>.1&&(K(r.pos,this.pos,[0,0,-3]),n[1]=Y(n),ft(n,n),r.launch(n,18))}}}}class $ extends X{constructor(t){super(t),this.carried=!1,this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0}update(t,s){if(this.carried&&this.carrier){const i=b(0,0,-1),r=Z(this.carrier.pos);K(this.pos,r,i)}else super.update(t,s),this.pos[1]<=this.floorY&&k(this.vel,this.vel,.99)}render(t){t.renderSprite(this.pos,this.width,this.height,0,1)}pickup(t){this.carried=!0,this.carrier=t,O(this.pos,t.pos[0],t.pos[1],t.pos[2]-1),O(this.vel,0,0,0)}launch(t,s){this.carried=!1,this.carrier=null,k(this.vel,t,s)}}class vt{constructor(t=[0,.001,0]){this.pos=Z(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const s=t.gl;s.useProgram(t.program),s.bindVertexArray(t.quadVao);const[i,r]=this.spriteCoord,o=i/t.sheetCols,n=r/t.sheetRows,h=(i+1)/t.sheetCols,a=(r+1)/t.sheetRows;s.uniform4f(t.uTileUV,o,n,h,a);const c=L();U(c,c,[this.pos[0],.001,this.pos[2]]),nt(c,c,-Math.PI/2),B(c,c,[this.size,this.size,1]),s.uniformMatrix4fv(t.uModel,!1,c),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}}function q(e,t,s){const i=(h,a)=>{const c=e.createShader(a);if(!c)throw new Error("Failed to create shader");if(e.shaderSource(c,h),e.compileShader(c),!e.getShaderParameter(c,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(c));return c},r=i(t,e.VERTEX_SHADER),o=i(s,e.FRAGMENT_SHADER),n=e.createProgram();if(e.attachShader(n,r),e.attachShader(n,o),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(n));return n}async function gt(e){const t=new Image;return t.src=e,await t.decode(),t}function At(e,t,s,i=1){const n=e*2/1.6/i,h=t*2/2/i,a=[0,0,0,.5,.5],c=[];for(let d=0;d<=s;d++){const m=d/s*2*Math.PI,v=Math.cos(m)*e,f=Math.sin(m)*t,A=v/(e*2)*n+.5,l=f/(t*2)*h+.5;a.push(v,0,f,A,l),d>0&&c.push(0,d,d+1)}return{vertices:new Float32Array(a),indices:new Uint16Array(c)}}function Et(e=160,t=170,s=50,i=50,r=.4){const o=[],n=[];let h=0;const a=(l,g,u,E,p)=>{const T=u-l,_=E-g,y=Math.hypot(T,_),x=-_/y,w=T/y,M=p/2,I=l+x*M,V=g+w*M,N=l-x*M,S=g-w*M,et=u+x*M,it=E+w*M,st=u-x*M,rt=E-w*M;o.push(I,0,V,et,0,it,st,0,rt,N,0,S),n.push(h,h+1,h+2,h,h+2,h+3),h+=4},c=e/2,d=t/2,m=64;for(let l=0;l<m;l++){const g=l/m*2*Math.PI,u=(l+1)/m*2*Math.PI,E=Math.cos(g)*c,p=Math.sin(g)*d,T=Math.cos(u)*c,_=Math.sin(u)*d;a(E,p,T,_,r)}const v=[[-i/2,-i/2],[i/2,-i/2],[i/2,i/2],[-i/2,i/2]];for(let l=0;l<4;l++){const[g,u]=v[l],[E,p]=v[(l+1)%4];a(g,u,E,p,r)}function f(l){const g=l>0?-1:1,u=[];for(let E=0;E<=1e3;E++){const p=-Math.PI+E/1e3*2*Math.PI,T=Math.sin(p)*s,_=l+g*Math.cos(p)*s,y=T/c,x=_/d;y*y+x*x<=1&&u.push(p)}return u.length===0?[-Math.PI/3,Math.PI/3]:[u[0],u[u.length-1]]}const A=40;for(let l of[-t/2,t/2]){const g=l>0?-1:1,[u,E]=f(l);for(let p=0;p<A;p++){const T=u+p/A*(E-u),_=u+(p+1)/A*(E-u),y=Math.sin(T)*s,x=l+g*Math.cos(T)*s,w=Math.sin(_)*s,M=l+g*Math.cos(_)*s;a(y,x,w,M,r)}}return{vertices:new Float32Array(o),indices:new Uint16Array(n)}}const F=170,Tt=80,W=F/2;class _t{constructor(t,s,i){this.gl=t,this.canvas=s,this.spriteSheet=i,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,s=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 tileUV = mod(v_texcoord, 1.0);
  vec2 texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=q(this.gl,t,s),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,s=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=q(this.gl,t,s),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const s=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),i=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,i,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:s,indices:i}=At(Tt,W,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.fieldIndices=i.length,this.fieldLineMesh=Et(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,F],[-3,0,F],[3,0,F],[9,0,F],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=L(),at(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=L(),this.model=L()}renderSprite(t,s,i,r,o){const{gl:n,program:h,quadVao:a,uModel:c,uTileUV:d,sheetCols:m,sheetRows:v}=this;n.useProgram(h),n.bindVertexArray(a);const f=L();U(f,f,t),B(f,f,[s,i,1]),n.uniformMatrix4fv(c,!1,f);const A=r/m,l=o/v,g=(r+1)/m,u=(o+1)/v;n.uniform4f(d,A,l,g,u),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}renderScene(t,s){const i=this.gl;i.viewport(0,0,this.canvas.width,this.canvas.height),i.clearColor(.2,.6,.2,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);const r=b(t.player.pos[0],t.player.pos[1]+10,t.player.pos[2]+15),o=b(t.player.pos[0],t.player.pos[1],t.player.pos[2]-20);ct(this.view,r,o,[0,1,0]),i.useProgram(this.program),i.uniformMatrix4fv(this.uProjection,!1,this.projection),i.uniformMatrix4fv(this.uView,!1,this.view),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uTexture,0),i.bindVertexArray(this.fieldVao),j(this.model),U(this.model,this.model,[0,0,W]),i.uniformMatrix4fv(this.uModel,!1,this.model);const n=0,h=2,a=n/this.sheetCols,c=h/this.sheetRows,d=(n+1)/this.sheetCols,m=(h+1)/this.sheetRows;i.uniform4f(this.uTileUV,a,c,d,m),i.drawElements(i.TRIANGLES,this.fieldIndices,i.UNSIGNED_SHORT,0),i.useProgram(this.lineProgram),i.uniformMatrix4fv(this.lineProj,!1,this.projection),i.uniformMatrix4fv(this.lineView,!1,this.view);const v=L();U(v,this.model,[0,.001,0]),i.uniformMatrix4fv(this.lineModel,!1,v),i.bindVertexArray(this.lineVao),i.drawElements(i.TRIANGLES,this.fieldLineMesh.indices.length,i.UNSIGNED_SHORT,0),i.useProgram(this.program),i.bindVertexArray(this.quadVao);const f=1,A=2,l=f/this.sheetCols,g=A/this.sheetRows,u=(f+1)/this.sheetCols,E=(A+1)/this.sheetRows;i.uniform4f(this.uTileUV,l,g,u,E);for(let p=0;p<this.goalPostPositions.length;p++){const[T,_,y]=this.goalPostPositions[p],w=p%4===0||p%4===3?6:10,M=r[0]-T,I=r[2]-y,V=Math.sqrt(M*M+I*I),N=V>50?1.5:V>150?2:1,S=L();U(S,S,[T,_,y]),B(S,S,[N,w,1]),i.uniformMatrix4fv(this.uModel,!1,S),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}i.bindVertexArray(this.quadVao);for(const p of s)p instanceof X?p.render(this):this.renderSprite(p.pos,p.width,p.height,1,0);t.aimTarget.render(this)}}var P,Q,J,tt;class yt{constructor(t){z(this,P);this.state={moveX:0,moveZ:0,kick:!1,handpass:!1,aimTarget:null},this.keys={},this.touchMove=null,this.touchAim=null,t.addEventListener("touchstart",D(this,P,Q).bind(this),{passive:!1}),t.addEventListener("touchmove",D(this,P,J).bind(this),{passive:!1}),t.addEventListener("touchend",D(this,P,tt).bind(this)),window.addEventListener("keydown",s=>this.keys[s.key.toLowerCase()]=!0),window.addEventListener("keyup",s=>this.keys[s.key.toLowerCase()]=!1)}update(t,s){var r;this.state.moveX=0,this.state.moveZ=0,this.state.kick=!1,this.state.handpass=!1,this.state.aimTarget=null,this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1),this.keys.k&&(this.state.kick=!0),this.keys.j&&(this.state.handpass=!0),this.touchMove&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=-this.touchMove.dy/50);const i=(r=navigator.getGamepads)==null?void 0:r.call(navigator)[0];if(i){this.state.moveX+=i.axes[0]||0,this.state.moveZ+=-(i.axes[1]||0);const o=i.axes[2]||0,n=-(i.axes[3]||0),h=Math.hypot(o,n);h>.2&&(this.state.aimTarget=[o/h,n/h]),i.buttons[0].pressed&&(this.state.kick=!0),i.buttons[1].pressed&&(this.state.handpass=!0)}}getState(){return this.state}}P=new WeakSet,Q=function(t){for(const s of t.changedTouches)s.clientX<window.innerWidth/2?this.touchMove={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0}:this.touchAim={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0}},J=function(t){for(const s of t.changedTouches)this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove.dx=s.clientX-this.touchMove.startX,this.touchMove.dy=s.clientY-this.touchMove.startY),this.touchAim&&s.identifier===this.touchAim.id&&(this.touchAim.dx=s.clientX-this.touchAim.startX,this.touchAim.dy=s.clientY-this.touchAim.startY)},tt=function(t){for(const s of t.changedTouches){if(this.touchAim&&s.identifier===this.touchAim.id){const i=this.touchAim.dx,r=-this.touchAim.dy,o=Math.hypot(i,r);o>20&&(this.state.kick=!0,this.state.aimTarget=[i/o,r/o]),this.touchAim=null}this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove=null)}};class Mt{constructor(t,s){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new _t(this.gl,t,s),this.controls=new yt(t),this.entities=[],this.aimTarget=new vt([5,.001,150]),this.player=new mt(b(0,0,170)),this.entities.push(this.player),this.ball=new $(b(0,0,160)),this.entities.push(this.ball),this.player.vel[2]=-5,this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}start(){requestAnimationFrame(this.loop.bind(this))}loop(t){const s=(t-this.lastTime)/1e3;this.lastTime=t,this.controls.update(s,this);for(const i of this.entities)i.update(s,this);this.renderer.renderScene(this,this.entities),requestAnimationFrame(this.loop.bind(this))}}function xt(e){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");t.width=window.innerWidth,t.height=window.innerHeight,new Mt(t,e).start()}gt("../assets/spritesheet.png").then(e=>{if(!e.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");xt(e)});
