var at=e=>{throw TypeError(e)};var Ft=(e,t,s)=>t.has(e)||at("Cannot "+s);var ht=(e,t,s)=>t.has(e)?at("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s);var Q=(e,t,s)=>(Ft(e,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();var st=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function X(){var e=new C(16);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function yt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function W(e,t,s){var i=s[0],o=s[1],n=s[2],a,r,c,l,d,u,p,h,v,f,m,g;return t===e?(e[12]=t[0]*i+t[4]*o+t[8]*n+t[12],e[13]=t[1]*i+t[5]*o+t[9]*n+t[13],e[14]=t[2]*i+t[6]*o+t[10]*n+t[14],e[15]=t[3]*i+t[7]*o+t[11]*n+t[15]):(a=t[0],r=t[1],c=t[2],l=t[3],d=t[4],u=t[5],p=t[6],h=t[7],v=t[8],f=t[9],m=t[10],g=t[11],e[0]=a,e[1]=r,e[2]=c,e[3]=l,e[4]=d,e[5]=u,e[6]=p,e[7]=h,e[8]=v,e[9]=f,e[10]=m,e[11]=g,e[12]=a*i+d*o+v*n+t[12],e[13]=r*i+u*o+f*n+t[13],e[14]=c*i+p*o+m*n+t[14],e[15]=l*i+h*o+g*n+t[15]),e}function it(e,t,s){var i=s[0],o=s[1],n=s[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function kt(e,t,s){var i=Math.sin(s),o=Math.cos(s),n=t[4],a=t[5],r=t[6],c=t[7],l=t[8],d=t[9],u=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*o+l*i,e[5]=a*o+d*i,e[6]=r*o+u*i,e[7]=c*o+p*i,e[8]=l*o-n*i,e[9]=d*o-a*i,e[10]=u*o-r*i,e[11]=p*o-c*i,e}function Mt(e,t,s,i,o){var n=1/Math.tan(t/2),a;return e[0]=n/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0?(a=1/(i-o),e[10]=(o+i)*a,e[14]=2*o*i*a):(e[10]=-1,e[14]=-2*i),e}var bt=Mt;function xt(e,t,s,i){var o,n,a,r,c,l,d,u,p,h,v=t[0],f=t[1],m=t[2],g=i[0],T=i[1],y=i[2],S=s[0],A=s[1],k=s[2];return Math.abs(v-S)<st&&Math.abs(f-A)<st&&Math.abs(m-k)<st?yt(e):(d=v-S,u=f-A,p=m-k,h=1/Math.hypot(d,u,p),d*=h,u*=h,p*=h,o=T*p-y*u,n=y*d-g*p,a=g*u-T*d,h=Math.hypot(o,n,a),h?(h=1/h,o*=h,n*=h,a*=h):(o=0,n=0,a=0),r=u*a-p*n,c=p*o-d*a,l=d*n-u*o,h=Math.hypot(r,c,l),h?(h=1/h,r*=h,c*=h,l*=h):(r=0,c=0,l=0),e[0]=o,e[1]=r,e[2]=d,e[3]=0,e[4]=n,e[5]=c,e[6]=u,e[7]=0,e[8]=a,e[9]=l,e[10]=p,e[11]=0,e[12]=-(o*v+n*f+a*m),e[13]=-(r*v+c*f+l*m),e[14]=-(d*v+u*f+p*m),e[15]=1,e)}function E(){var e=new C(3);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function V(e){var t=new C(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function H(e){var t=e[0],s=e[1],i=e[2];return Math.hypot(t,s,i)}function R(e,t,s){var i=new C(3);return i[0]=e,i[1]=t,i[2]=s,i}function _(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ot(e,t,s,i){return e[0]=t,e[1]=s,e[2]=i,e}function O(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e}function U(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e}function B(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function j(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e}function Tt(e,t){var s=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.hypot(s,i,o)}function Lt(e,t){var s=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return s*s+i*i+o*o}function At(e){var t=e[0],s=e[1],i=e[2];return t*t+s*s+i*i}function P(e,t){var s=t[0],i=t[1],o=t[2],n=s*s+i*i+o*o;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function J(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $(e,t,s,i){var o=t[0],n=t[1],a=t[2];return e[0]=o+i*(s[0]-o),e[1]=n+i*(s[1]-n),e[2]=a+i*(s[2]-a),e}var ct=U,I=Tt,Bt=At;(function(){var e=E();return function(t,s,i,o,n,a){var r,c;for(s||(s=3),i||(i=0),o?c=Math.min(o*s+i,t.length):c=t.length,r=i;r<c;r+=s)e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],n(e,e,a),t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2];return t}})();function Vt(){var e=new C(2);return C!=Float32Array&&(e[0]=0,e[1]=0),e}function lt(e,t){var s=new C(2);return s[0]=e,s[1]=t,s}function ft(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e}function St(e){var t=e[0],s=e[1];return Math.hypot(t,s)}var dt=St;(function(){var e=Vt();return function(t,s,i,o,n,a){var r,c;for(s||(s=2),i||(i=0),o?c=Math.min(o*s+i,t.length):c=t.length,r=i;r<c;r+=s)e[0]=t[r],e[1]=t[r+1],n(e,e,a),t[r]=e[0],t[r+1]=e[1];return t}})();const It=160,F=170,nt=It/2,L=F/2,N=6,tt=6,mt=.5;function w(e,t,s){return R(e,t,s)}const Ht=Object.freeze([w(-.5*N-tt,0,F),w(-.5*N,0,F),w(.5*N,0,F),w(.5*N+tt,0,F)]),Dt=Object.freeze([w(-.5*N-tt,0,0),w(-.5*N,0,0),w(.5*N,0,0),w(.5*N+tt,0,0)]),Ut=Object.freeze({Away:Ht,Home:Dt});function jt(e){const t=e[0]/nt,s=(e[2]-L)/L;return t*t+s*s>1}function Ot(e,t,s,i,o,n){const a=o-s,r=n-i;if(a===0&&r===0){const v=e-s,f=t-i;return v*v+f*f}const c=((e-s)*a+(t-i)*r)/(a*a+r*r),l=Math.max(0,Math.min(1,c)),d=s+l*a,u=i+l*r,p=e-d,h=t-u;return p*p+h*h}function Ct(e,t){for(const s of["Away","Home"]){const i=Ut[s];if(s==="Home"?t[2]>L:t[2]<L,s==="Away"){if(e[2]<F&&t[2]>=F){const n=t[0];if(n>=-3&&n<=3)return"goalAway";if(n>=-9&&n<-3||n>3&&n<=9)return"behindAway"}}else if(s==="Home"&&e[2]>0&&t[2]<=0){const n=t[0];if(n>=-3&&n<=3)return"goalHome";if(n>=-9&&n<-3||n>3&&n<=9)return"behindHome"}const o=["outerLeftPost","innerLeftPost","innerRightPost","outerRightPost"];for(let n=0;n<i.length;n++){const a=i[n][0],r=i[n][2];if(Ot(a,r,e[0],e[2],t[0],t[2])<mt*mt)return`${o[n]}${s}`}}return jt(t)?"outOfBounds":null}function ut(e=!1){const s={fullForward:70,halfForward:35,halfBack:-35,fullBack:-70},i={LFP:-45,FF:0,RFP:45,LHF:-50,CHF:0,RHF:50,LHB:-50,CHB:0,RHB:50,LBP:-45,FB:0,RBP:45};function o(c,l){const d=c*Math.PI/180,u=nt*Math.sin(d)*(Math.abs(l)/L)-(e?2:-2),p=L+l*(e?-1:1);return w(u,0,p)}const n=-nt+2,a=c=>L+(e?1:-1)*c;return{LFP:o(i.LFP,s.fullForward-(e?10:-10)),FF:o(i.FF,s.fullForward),RFP:o(i.RFP,s.fullForward-(e?10:-10)),LHF:o(i.LHF,s.halfForward),CHF:o(i.CHF,s.halfForward),RHF:o(i.RHF,s.halfForward),LW:w(-25,0,L-(e?2:-2)),C:w(8,0,L-(e?-5:5)),RW:w(25,0,L-(e?2:-2)),LHB:o(i.LHB,s.halfBack),CHB:o(i.CHB,s.halfBack),RHB:o(i.RHB,s.halfBack),LBP:o(i.LBP,s.fullBack-(e?10:-10)),FB:o(i.FB,s.fullBack),RBP:o(i.RBP,s.fullBack-(e?10:-10)),Ruck:w(0,0,L-(e?10:-10)),RR:w(-10,0,L-(e?10:-10)),Rover:w(10,0,L-(e?10:-10)),Bench1:w(n,0,a(10)),Bench2:w(n,0,a(13)),Bench3:w(n,0,a(16)),Bench4:w(n,0,a(19)),Bench5:w(n,0,a(22))}}function Nt(e,t){const s=e.pos[0]-t.pos[0],i=e.pos[1]-t.pos[1],o=e.pos[2]-t.pos[2],n=s*s+i*i+o*o,[a,r]=e.collideBounds(),[c,l]=t.collideBounds(),d=.5*dt(e.collideBounds()),u=.5*dt(t.collideBounds()),p=d+u;return n<=p*p}class rt{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}setupForBoundary(t,s){}update(t,s){this.usesGravity&&j(this.vel,this.vel,this.gravity,t),j(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return Nt(this,t)}collideBounds(){return[.5,1.8]}}const pt={home:Object.freeze({idle:[[0,0,0]],run:[[1,0,0],[2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0]],kickRightFoot:[[1,0,0],[2,0,0]],kickLeftFoot:[[4,0,0],[5,0,0]],handpassRightHand:[[1,0,0],[0,0,0]],handpassLeftHand:[[4,0,0],[0,0,0]],jumpMark:[[1,0,0],[2,0,0],[0,0,0]],jumpSpoil:[[1,0,0],[2,0,0],[0,0,0]]}),away:Object.freeze({idle:[[0,4,0]],run:[[1,4,0],[2,4,0],[3,4,0],[4,4,0],[5,4,0],[6,4,0]],kickRightFoot:[[1,4,0],[2,4,0]],kickLeftFoot:[[4,4,0],[5,4,0]],handpassRightHand:[[1,4,0],[0,4,0]],handpassLeftHand:[[4,4,0],[0,4,0]],jumpMark:[[1,4,0],[2,4,0],[0,4,0]],jumpSpoil:[[1,4,0],[2,4,0],[0,4,0]]})};class zt extends rt{constructor(t,s,i,o=!1){super(i),this.positionPos=V(i),this.name=t,this.team=s,this.playing=o,this.width=1.6,this.height=2.4,this.aiming=!1,this.jogVel=R(0,0,0),this.joltVel=R(0,0,0),this.jogSpeed=5,this.joltSpeed=5,this.energy=10,this.energyRecovery=0,this.kickRange=45,this.joltDecayRate=8,this.animations=pt[s]??pt.home,this.animState="idle",this.actionState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=8,this.stateTimer=0,this.animSprite=R(0,0,0)}updateAI(t,s){const o=s.ball;let n=null;if(o.carried&&o.carrier===this)if(this.stateTimer+=t,this.stateTimer<1)n="run";else{let r=!1;for(const h of s.players)if(!(h===this||h.team===this.team)&&I(h.pos,this.pos)<7){r=!0;break}const c=s.players.filter(h=>h.team===this.team&&h!==this);if(r){let h=null,v=-1/0;const f=R(0,0,this.team==="home"?-1:1);for(const m of c){if(m===this)continue;const g=I(this.pos,m.pos);if(g>20)continue;let T=!1;for(const b of s.players)if(b.team!==this.team&&I(b.pos,m.pos)<5){T=!0;break}if(T)continue;const y=E();U(y,m.pos,this.pos),P(y,y);const S=J(f,y),A=V(m.vel);A[1]=0;const k=J(f,A),M=g*.2,x=5*S+2*k-M;x>v&&(v=x,h=m)}if(h){const m=E();U(m,h.pos,this.pos),P(m,m);const g=R(m[0],.5,m[2]);P(g,g);const T=12;return _(o.pos,this.pos),o.launch(g,T),this.aiming=!1,this.stateTimer=.5,"handpass"}}const d=this.team==="home"?0:F,u=0;if(Math.abs(this.pos[2]-d)<=this.kickRange){const h=R(u,0,d),v=(Math.random()-.5)*9;h[0]+=v;const f=E();U(f,h,this.pos),f[1]=.4*H(f),P(f,f);const m=25;return _(o.pos,this.pos),o.launch(f,m),this.stateTimer=.5,"kick"}if(r||this.stateTimer>5){let h=null,v=-1/0;for(const f of c){const m=I(this.pos,f.pos);if(m>this.kickRange)continue;const g=this.team==="home"?-1:1,T=(f.pos[2]-this.pos[2])*g,y=Math.abs(f.pos[0]-this.pos[0]),S=T-y-m;S>v&&(v=S,h=f)}if(h){const f=E();U(f,h.pos,this.pos),P(f,f);const m=R(f[0],.5,f[2]);P(m,m);const g=20;return _(o.pos,this.pos),o.launch(m,g),this.stateTimer=.5,"kick"}}n="run"}let a=null;if(o.carried&&o.carrier===this){const r=this.team==="home"?-1:1,c=R(0,0,r);let l=E();for(const u of s.players){if(u===this||u.team===this.team)continue;const p=E();U(p,this.pos,u.pos),p[1]=0;const h=H(p);if(h<5&&h>.5){const v=1/h;P(p,p),j(l,l,p,v)}}const d=E();O(d,c,l),P(d,d),a=V(this.pos),j(a,a,d,10)}else if(o.carried)if(o.carrier&&o.carrier.team!==this.team&&I(o.pos,this.pos)<=15&&this.energy>0&&s.chasers<3)a=V(o.pos),s.chasers++;else if(o.carrier&&o.carrier.team===this.team&&I(o.pos,this.pos)>5&&this.energy>.3&&s.followers<3){s.followers++;const r=V(o.carrier.jogVel);H(r)<.01&&(r[2]=this.team==="home"?-1:1),P(r,r);const c=R(-r[2],0,r[0]);P(c,c);let l=0,d=12;switch(this.name){case"wing":l=12*(this.team==="home"?-1:1),d=15;break;case"forward":l=6,d=18;break;case"half-forward":case"half-back":l=4,d=10;break;case"center":case"mid":l=0,d=10;break;case"back":default:l=-6,d=8;break}const u=V(o.carrier.pos);j(u,u,r,d),j(u,u,c,l),a=u}else a=this.positionPos??this.pos;else if(o.pos[1]>.1||o.vel[1]>.1){const r=o.gravity[1]??-9.8,c=o.vel[1],l=o.pos[1],d=.5*r,u=c,p=l;let h=0;const v=u*u-4*d*p;if(v>=0&&Math.abs(d)>1e-5){const m=Math.sqrt(v),g=(-u+m)/(2*d),T=(-u-m)/(2*d);h=Math.max(g,T)}const f=E();j(f,o.pos,o.vel,h),f[1]=0,I(f,this.pos)<=35?a=f:a=this.positionPos??this.pos}else I(o.pos,this.pos)<=25?a=o.pos:a=this.positionPos??this.pos;if(a){const r=E();if(U(r,a,this.pos),r[1]=0,At(r)>1e-4){P(r,r),B(this.joltVel,r,this.joltSpeed);const l=E();H(this.jogVel)>1e-4?(P(l,this.jogVel),$(l,l,r,.15),P(l,l),B(this.jogVel,l,this.jogSpeed)):B(this.jogVel,r,this.jogSpeed)}}this.energy>0?(O(this.vel,this.jogVel,this.joltVel),this.energy-=t):(j(this.vel,this.jogVel,this.joltVel,.5),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),B(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),super.update(t,s);for(const r of s.players){if(r===this||!o.carried||o.carrier!==r||r.team===this.team||!this.collidesWith(r))continue;const c=E();U(c,r.pos,this.pos),c[1]=0,P(c,c);const l=V(this.jogVel);if(l[1]=0,H(l)<1e-4)continue;P(l,l);const d=J(l,c),u=I(this.pos,r.pos);if(d>.5&&u<1.5){o.carried=!1,o.carrier=null;const h=E();U(h,r.pos,this.pos),P(h,h),B(h,h,8+Math.random()*4),_(o.vel,h),_(o.pos,r.pos),o.lastTouchedType="spill",o.hasBounced=!1,n="tackle",this.stateTimer=1,r.actionState="tackled",r.stateTimer=1;break}}return!o.carried&&o.collidesWith(this)&&n===null&&(o.pickup(this),n="pickup",this.team==="home")?(s.player=this,this.aiming=!1,null):(n||(n=H(this.vel)>1e-4?"run":"idle"),n)}collideBounds(){return[.5,1.8]}get stunned(){return this.actionState==="tackle"||this.actionState==="tackled"}updateHuman(t,s){const i=s.controls,o=s.ball;let{kickPressed:n,kickReleased:a,kickHeldTime:r,moveX:c,moveZ:l,aimTarget:d}=i.state;const u=1e-4;let p=null;if((c!==0||l!==0)&&!this.aiming){const h=R(c,0,l);P(h,h);const v=R(c,0,l);if(Bt(v)>u){P(v,v),B(this.joltVel,v,this.joltSpeed);const f=E();H(this.jogVel)>u?(P(f,this.jogVel),$(f,f,h,.15),P(f,f),B(this.jogVel,f,this.jogSpeed)):B(this.jogVel,h,this.jogSpeed)}}if(this.energy>0?(O(this.vel,this.jogVel,this.joltVel),this.energy-=t):(O(this.vel,this.jogVel,B(this.joltVel,this.joltVel,.5)),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),B(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),super.update(t,s),!o.carried&&o.collidesWith(this)&&(o.pickup(this),p="pickup"),o.carried&&o.carrier===this){if(n&&(this.aiming=!0),a&&console.log("Kick released:",a,"aimTarget:",d,"player: ",this),a&&r<.25){const m=c!==0||l!==0?R(c,0,l):V(this.jogVel);m[0]===0&&m[2]===0&&(_(m,this.jogVel),H(m)===0&&ot(m,0,0,1)),P(m,m);let g=null,T=-1/0;for(const y of s.players){if(y.team!==this.team||y===this||y.stunned)continue;const S=ct(E(),y.pos,this.pos),A=H(S);if(A>30)continue;const k=P(E(),S),M=J(m,k);if(M<=0)continue;let x=0;for(const D of s.players){if(D.team===this.team||D===y||D.stunned)continue;Tt(D.pos,y.pos)<=10&&x++}const b=.5*x,Y=M*2-A/30-b;Y>T&&(T=Y,g=y)}if(g){const y=ct(E(),g.pos,this.pos);d=[y[0],y[2]]}else d=[m[0]*10,m[2]*10]}const h=lt(0,-10);if(d&&ft(h,h,d),a&&d){const v=r<.25,f=St(h);if(f>.1){const m=-this.gravity[1],g=45*Math.PI/180,T=Math.sin(2*g),y=Math.sqrt(f*m/T),S=R(h[0],0,h[1]);P(S,S);const A=R(S[0]*Math.cos(g),Math.sin(g),S[2]*Math.cos(g));o.launch(A,y),o.lastTouchedType=v?"handpass":"kick",o.hasBounced=!1,p=v?"handpass":"kick",this.stateTimer=.5}this.aiming=!1}}if(this.aiming){const h=lt(0,-10);d&&ft(h,h,d),s.aimTarget.setPosition([this.pos[0]+h[0],.002,this.pos[2]+h[1]])}else s.aimTarget.setPosition(R(this.pos[0],.002,this.pos[2]+.8));return!p&&this.actionState!=="run"&&this.actionState!=="idle"&&(p=H(this.vel)>u?"run":"idle"),p}update(t,s){if(!this.playing)return;if(this.actionState==="pickup"&&(this.actionState="run"),this.actionState==="tackled"||this.actionState==="tackle"||this.actionState==="kick"||this.actionState==="handpass"){this.vel=R(0,0,0),this.stateTimer-=t,this.stateTimer<=0&&(this.actionState="idle",this.stateTimer=0),this.updateAnimation(t,null,s.ball);return}let i=null;s.player===this?i=this.updateHuman(t,s):i=this.updateAI(t,s),this.updateAnimation(t,i,s.ball),i!==null&&(this.actionState=i)}updateAnimation(t,s,i){const o=this.animations[this.animState];if(o.length===0)return;this.animTimer+=t;const n=1/this.animFPS;this.animTimer>=n&&(this.animTimer-=n,this.animFrame=this.animFrame+1),s==="kick"&&(this.animState="kickRightFoot",this.animFrame=0,this.animTimer=0),this.animState==="run"&&I(this.vel,[0,0,0])===0&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animState==="idle"&&I(this.vel,[0,0,0])!==0&&(this.animState="run",this.animFrame=0,this.animTimer=0);const a=this.animState==="run"||this.animState==="idle";this.animFrame>=o.length&&(this.animFrame=a?0:o.length-1,a||(this.animState="run",this.animFrame=0,this.animTimer=0));const r=this.animations[this.animState];this.animSprite=V(r[this.animFrame])??R(0,0,0),(this.vel[2]>0?"away":this.vel[2]<0?"home":this.pos[2]<i.pos[2]?"away":"home")==="away"&&(this.animSprite[0]+=7)}render(t){const[s,i,o]=this.animSprite;t.renderSprite(this.pos,this.width,this.height,s,i)}setupForBoundary(t,s){t==="behindAway"&&this.team==="home"&&this.name==="FB"?(_(this.pos,[0,0,F-5]),_(this.vel,[0,0,-1])):t==="behindAway"&&this.team==="away"&&this.name==="FF"?_(this.pos,[0,0,F-25]):t==="behindHome"&&this.team==="away"&&this.name==="FB"?(_(this.pos,[0,0,5]),_(this.vel,[0,0,1])):t==="behindHome"&&this.team==="home"&&this.name==="FF"?_(this.pos,[0,0,25]):_(this.pos,this.positionPos)}}class Gt extends rt{constructor(t){super(t),this.carried=!1,this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0,this.animations=Object.freeze({idle:[[0,1,0]],backSpin:[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[8,1,0]],forwardSpin:[[8,1,0],[7,1,0],[6,1,0],[5,1,0],[4,1,0],[3,1,0],[2,1,0],[1,1,0]],backSpinRight:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]],backSpinLeft:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinRight:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinLeft:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=12,this.lastTouchedBy=null,this.lastTouchedType=null,this.hasBounced=!1}update(t,s){if(this.carried&&this.carrier){const i=R(0,.5,this.carrier.vel[2]>0?.2:-.2),o=V(this.carrier.pos);O(this.pos,o,i)}else{const i=this.vel[1]<0;super.update(t,s),this.hasBounced=this.hasBounced||i&&this.vel[1]>0&&this.pos[1]<=this.floorY,this.pos[1]<=this.floorY&&B(this.vel,this.vel,.97)}this.updateAnimation(t)}pickup(t){this.carried=!0,this.carrier=t,this.lastTouchedBy=t,this.lastTouchedType=null,this.hasBounced=!1,ot(this.pos,t.pos[0],t.pos[1],t.pos[2]-1),ot(this.vel,0,0,0)}launch(t,s,i="kick"){this.carried=!1,this.carrier=null,B(this.vel,t,s),this.lastTouchedType=i,this.hasBounced=!1}updateAnimation(t){this.animTimer+=t;const s=1/this.animFPS;this.animTimer>=s&&(this.animTimer-=s,this.animFrame=this.animFrame+1);const i=this.animState;this.carried?this.animState="idle":this.lastTouchedType==="kick"&&!this.hasBounced?this.animState="backSpin":this.lastTouchedType==="handpass"&&!this.hasBounced?this.animState="backSpinRight":this.hasBounced?Math.abs(this.vel[1])<.05&&this.pos[1]<=this.floorY+.01?this.animState="idle":this.animState="forwardSpin":this.animState="idle",this.animState!==i&&(this.animFrame=0,this.animTimer=0);const o=this.animations[this.animState];o.length!==0&&this.animFrame>=o.length&&(this.animFrame=0)}render(t){var a;const s=(a=this.animations)==null?void 0:a[this.animState],[i,o,n]=(s==null?void 0:s[this.animFrame])??[0,1,void 0];t.renderSprite(this.pos,this.width,this.height,i,o)}setupForBoundary(t,s){if(this.carried=!1,this.carrier=null,t==="goalAway"||t==="goalHome")_(this.pos,[0,0,F/2]),_(this.vel,[0,15,0]);else if(t==="behindAway")_(this.pos,[0,0,F-6]);else if(t==="behindHome")_(this.pos,[0,0,6]);else{this.pos[1]=0,_(this.pos,s);const i=E();j(i,[0,F/2,F/2],s,-1),P(i,i),this.launch(i,15,"tap")}}}class Xt{constructor(t=[0,.001,0]){this.pos=V(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const s=t.gl;s.useProgram(t.program),s.bindVertexArray(t.quadVao);const[i,o]=this.spriteCoord,n=i/t.sheetCols,a=o/t.sheetRows,r=(i+1)/t.sheetCols,c=(o+1)/t.sheetRows;s.uniform4f(t.uTileUV,n,a,r,c);const l=X();W(l,l,[this.pos[0],.001,this.pos[2]]),kt(l,l,-Math.PI/2),it(l,l,[this.size,this.size,1]),s.uniformMatrix4fv(t.uModel,!1,l),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}}function gt(e,t,s){const i=(r,c)=>{const l=e.createShader(c);if(!l)throw new Error("Failed to create shader");if(e.shaderSource(l,r),e.compileShader(l),!e.getShaderParameter(l,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(l));return l},o=i(t,e.VERTEX_SHADER),n=i(s,e.FRAGMENT_SHADER),a=e.createProgram();if(e.attachShader(a,o),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(a));return a}async function Yt(e){const t=new Image;return t.src=e,await t.decode(),t}function qt(e,t,s,i=1){const a=e*2/1.6/i,r=t*2/2/i,c=[0,0,0,.5,.5],l=[];for(let d=0;d<=s;d++){const u=d/s*2*Math.PI,p=Math.cos(u)*e,h=Math.sin(u)*t,v=p/(e*2)*a+.5,f=h/(t*2)*r+.5;c.push(p,0,h,v,f),d>0&&l.push(0,d,d+1)}return{vertices:new Float32Array(c),indices:new Uint16Array(l)}}function Wt(e=160,t=170,s=50,i=50,o=.4){const n=[],a=[];let r=0;const c=(f,m,g,T,y)=>{const S=g-f,A=T-m,k=Math.hypot(S,A),M=-A/k,x=S/k,b=y/2,Y=f+M*b,D=m+x*b,q=f-M*b,K=m-x*b,et=g+M*b,G=T+x*b,wt=g-M*b,_t=T-x*b;n.push(Y,0,D,et,0,G,wt,0,_t,q,0,K),a.push(r,r+1,r+2,r,r+2,r+3),r+=4},l=e/2,d=t/2,u=64;for(let f=0;f<u;f++){const m=f/u*2*Math.PI,g=(f+1)/u*2*Math.PI,T=Math.cos(m)*l,y=Math.sin(m)*d,S=Math.cos(g)*l,A=Math.sin(g)*d;c(T,y,S,A,o)}const p=[[-i/2,-i/2],[i/2,-i/2],[i/2,i/2],[-i/2,i/2]];for(let f=0;f<4;f++){const[m,g]=p[f],[T,y]=p[(f+1)%4];c(m,g,T,y,o)}function h(f){const m=f>0?-1:1,g=[];for(let T=0;T<=1e3;T++){const y=-Math.PI+T/1e3*2*Math.PI,S=Math.sin(y)*s,A=f+m*Math.cos(y)*s,k=S/l,M=A/d;k*k+M*M<=1&&g.push(y)}return g.length===0?[-Math.PI/3,Math.PI/3]:[g[0],g[g.length-1]]}const v=40;for(let f of[-t/2,t/2]){const m=f>0?-1:1,[g,T]=h(f);for(let y=0;y<v;y++){const S=g+y/v*(T-g),A=g+(y+1)/v*(T-g),k=Math.sin(S)*s,M=f+m*Math.cos(S)*s,x=Math.sin(A)*s,b=f+m*Math.cos(A)*s;c(k,M,x,b,o)}}return{vertices:new Float32Array(n),indices:new Uint16Array(a)}}const Z=170,Zt=80,vt=Z/2;class $t{constructor(t,s,i){this.gl=t,this.canvas=s,this.spriteSheet=i,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,s=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 tileUV = mod(v_texcoord, 1.0);
  vec2 texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=gt(this.gl,t,s),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,s=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=gt(this.gl,t,s),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const s=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),i=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,i,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:s,indices:i}=qt(Zt,vt,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.fieldIndices=i.length,this.fieldLineMesh=Wt(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const r=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,Z],[-3,0,Z],[3,0,Z],[9,0,Z],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=X(),bt(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=X(),this.model=X()}renderSprite(t,s,i,o,n){const{gl:a,program:r,quadVao:c,uModel:l,uTileUV:d,sheetCols:u,sheetRows:p}=this;a.useProgram(r),a.bindVertexArray(c);const h=X();W(h,h,t),it(h,h,[s,i,1]),a.uniformMatrix4fv(l,!1,h);const v=o/u,f=n/p,m=(o+1)/u,g=(n+1)/p;a.uniform4f(d,v,f,m,g),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}renderScene(t,s){const i=this.gl;i.viewport(0,0,this.canvas.width,this.canvas.height),i.clearColor(.2,.6,.2,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);const o=R(0,10,15),n=E();O(n,t.cameraTarget,o);const a=R(0,0,-20),r=E();O(r,t.cameraTarget,a),xt(this.view,n,r,[0,1,0]),i.useProgram(this.program),i.uniformMatrix4fv(this.uProjection,!1,this.projection),i.uniformMatrix4fv(this.uView,!1,this.view),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uTexture,0),i.bindVertexArray(this.fieldVao),yt(this.model),W(this.model,this.model,[0,0,vt]),i.uniformMatrix4fv(this.uModel,!1,this.model);const c=0,l=2,d=c/this.sheetCols,u=l/this.sheetRows,p=(c+1)/this.sheetCols,h=(l+1)/this.sheetRows;i.uniform4f(this.uTileUV,d,u,p,h),i.drawElements(i.TRIANGLES,this.fieldIndices,i.UNSIGNED_SHORT,0),i.useProgram(this.lineProgram),i.uniformMatrix4fv(this.lineProj,!1,this.projection),i.uniformMatrix4fv(this.lineView,!1,this.view);const v=X();W(v,this.model,[0,.001,0]),i.uniformMatrix4fv(this.lineModel,!1,v),i.bindVertexArray(this.lineVao),i.drawElements(i.TRIANGLES,this.fieldLineMesh.indices.length,i.UNSIGNED_SHORT,0),i.useProgram(this.program),i.bindVertexArray(this.quadVao);const f=1,m=2,g=f/this.sheetCols,T=m/this.sheetRows,y=(f+1)/this.sheetCols,S=(m+1)/this.sheetRows;i.uniform4f(this.uTileUV,g,T,y,S);for(let A=0;A<this.goalPostPositions.length;A++){const[k,M,x]=this.goalPostPositions[A],Y=A%4===0||A%4===3?6:10,D=n[0]-k,q=n[2]-x,K=Math.sqrt(D*D+q*q),et=K>50?1.5:K>150?2:1,G=X();W(G,G,[k,M,x]),it(G,G,[et,Y,1]),i.uniformMatrix4fv(this.uModel,!1,G),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}i.bindVertexArray(this.quadVao);for(const A of s)A instanceof rt?A.render(this):this.renderSprite(A.pos,A.width,A.height,1,0);t.aimTarget.render(this)}}var z,Rt,Pt,Et;class Kt{constructor(t){ht(this,z);this.state={moveX:0,moveZ:0,kickPressed:!1,kickReleased:!1,kickHeldTime:0,aimTarget:null},this.keys={},this.lastKeys={},this.touchMove=null,this.touchAim=null,this.kPressTime=0,t.addEventListener("touchstart",Q(this,z,Rt).bind(this),{passive:!1}),t.addEventListener("touchmove",Q(this,z,Pt).bind(this),{passive:!1}),t.addEventListener("touchend",Q(this,z,Et).bind(this)),window.addEventListener("keydown",s=>this.keys[s.key.toLowerCase()]=!0),window.addEventListener("keyup",s=>this.keys[s.key.toLowerCase()]=!1)}endUpdate(){this.state.moveX=0,this.state.moveZ=0,this.state.kickPressed=!1,this.state.kickReleased=!1}update(t){var n;const s=!!this.keys.k,i=!!this.lastKeys.k;if(s&&!i&&(this.state.kickPressed=!0,this.kPressTime=0,this.state.aimTarget=[0,0]),s?(this.kPressTime+=t,this.state.aimTarget&&(this.keys.a&&(this.state.aimTarget[0]-=30*t),this.keys.d&&(this.state.aimTarget[0]+=30*t),this.keys.w&&(this.state.aimTarget[1]-=30*t),this.keys.s&&(this.state.aimTarget[1]+=30*t))):(this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1)),!s&&i&&(this.state.kickReleased=!0),this.state.kickHeldTime=this.kPressTime,this.touchMove&&!this.touchAim&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=this.touchMove.dy/50),this.touchAim){this.kPressTime+=t;const a=this.touchAim.dx,r=this.touchAim.dy;console.log("Touch aim:",a,r);const c=10;this.state.aimTarget=[-a/c,-r/c],this.state.kickHeldTime=this.kPressTime}const o=(n=navigator.getGamepads)==null?void 0:n.call(navigator)[0];if(o){this.state.moveX+=o.axes[0]||0,this.state.moveZ+=-(o.axes[1]||0);const a=o.axes[2]||0,r=-(o.axes[3]||0),c=Math.hypot(a,r);c>.2&&(this.state.aimTarget=[a/c,r/c])}this.lastKeys={...this.keys}}getState(){return this.state}}z=new WeakSet,Rt=function(t){t.preventDefault();for(const s of t.changedTouches)s.clientX<window.innerWidth/2?this.touchMove={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0}:(this.touchAim={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0},this.state.kickPressed=!0,this.kPressTime=0)},Pt=function(t){t.preventDefault();for(const s of t.changedTouches)this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove.dx=s.clientX-this.touchMove.startX,this.touchMove.dy=s.clientY-this.touchMove.startY),this.touchAim&&s.identifier===this.touchAim.id&&(this.touchAim.dx=s.clientX-this.touchAim.startX,this.touchAim.dy=s.clientY-this.touchAim.startY)},Et=function(t){t.preventDefault();for(const s of t.changedTouches)this.touchAim&&s.identifier===this.touchAim.id&&(this.touchAim=null,this.state.kickReleased=!0),this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove=null)};class Qt{constructor(t,s){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new $t(this.gl,t,s),this.controls=new Kt(t),this.entities=[],this.aimTarget=new Xt([5,.001,F/2]),this.ball=new Gt(R(0,0,F/2)),this.entities.push(this.ball),this.players=[],this.chasers=0,this.followers=0,this.homePositions=ut(),this.awayPositions=ut(!0);const i=[[this.homePositions,"home"],[this.awayPositions,"away"]];for(let[o,n]of i)for(const[a,r]of Object.entries(o)){const c=new zt(a,n,r,!a.toLowerCase().startsWith("bench"));this.entities.push(c),this.players.push(c),a==="RR"&&n==="home"&&(this.player=c)}this.cameraTarget=R(0,10,F/2),this.cameraPos=R(0,10,F/2+15),this.resize(),window.addEventListener("resize",()=>this.resize()),this.lastTime=performance.now()}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){var a,r;const s=(t-this.lastTime)/1e3,i=Math.min(s,1/30);this.lastTime=t,this.controls.update(i),this.chasers=0,this.followers=0;const o=V(this.ball.pos);for(const c of this.entities)c.update(i,this);let n=Ct(o,this.ball.pos);if(n!==null){n==="goalAway"&&(this.ball.lastTouchedType!=="kick"||((a=this.ball.lastTouchedBy)==null?void 0:a.team)==="home")?n="behindAway":n==="goalHome"&&(this.ball.lastTouchedType!=="kick"||((r=this.ball.lastTouchedBy)==null?void 0:r.team)==="away")?n="behindHome":n==="innerLeftPostAway"||n==="innerRightPostAway"?n="behindAway":(n==="innerLeftPostHome"||n==="innerRightPostHome")&&(n="behindHome");for(const c of this.entities)c.setupForBoundary(n,this.ball.pos)}this.updateCameraTarget(),this.renderer.renderScene(this,this.entities),this.controls.endUpdate(),requestAnimationFrame(this.loop.bind(this))}updatePlayerControl(){const t=this.players.filter(n=>n.team==="home"),s=this.ball.carrier;if(!s||s.team==="home")return;let i=null,o=1/0;for(const n of t){if(n.actionState==="tackle"||n.actionState==="handpass"||n.energy<=0)continue;const a=Lt(n.pos,s.pos),r=Math.abs(n.positionPos[0]-this.ball.pos[0])<10?-10:0;a+r<o&&(i=n,o=a+r)}i&&(this.player=i,this.player.aiming=!1)}updateCameraTarget(){const t=this.ball,s=t.carrier,i=.025;if(s)if(s.team==="home")$(this.cameraTarget,this.cameraTarget,s.pos,i);else{const n=R(0,0,15);$(this.cameraTarget,this.cameraTarget,O(E(),s.pos,n),i)}else{const o=R(0,0,15);$(this.cameraTarget,this.cameraTarget,O(E(),t.pos,o),i)}}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.renderer.setupCamera()}}const Jt="/footy/assets/spritesheet-C9G_3zho.png";function te(e){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");new Qt(t,e).start()}Yt(Jt).then(e=>{if(!e.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");te(e)});
