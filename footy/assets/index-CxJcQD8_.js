var dt=i=>{throw TypeError(i)};var Ut=(i,t,s)=>t.has(i)||dt("Cannot "+s);var mt=(i,t,s)=>t.has(i)?dt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,s);var st=(i,t,s)=>(Ut(i,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var at=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function C(){var i=new O(16);return O!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function xt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Z(i,t,s){var e=s[0],n=s[1],o=s[2],a,r,h,c,u,d,f,l,p,m,g,T;return t===i?(i[12]=t[0]*e+t[4]*n+t[8]*o+t[12],i[13]=t[1]*e+t[5]*n+t[9]*o+t[13],i[14]=t[2]*e+t[6]*n+t[10]*o+t[14],i[15]=t[3]*e+t[7]*n+t[11]*o+t[15]):(a=t[0],r=t[1],h=t[2],c=t[3],u=t[4],d=t[5],f=t[6],l=t[7],p=t[8],m=t[9],g=t[10],T=t[11],i[0]=a,i[1]=r,i[2]=h,i[3]=c,i[4]=u,i[5]=d,i[6]=f,i[7]=l,i[8]=p,i[9]=m,i[10]=g,i[11]=T,i[12]=a*e+u*n+p*o+t[12],i[13]=r*e+d*n+m*o+t[13],i[14]=h*e+f*n+g*o+t[14],i[15]=c*e+l*n+T*o+t[15]),i}function it(i,t,s){var e=s[0],n=s[1],o=s[2];return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function bt(i,t,s){var e=Math.sin(s),n=Math.cos(s),o=t[4],a=t[5],r=t[6],h=t[7],c=t[8],u=t[9],d=t[10],f=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=o*n+c*e,i[5]=a*n+u*e,i[6]=r*n+d*e,i[7]=h*n+f*e,i[8]=c*n-o*e,i[9]=u*n-a*e,i[10]=d*n-r*e,i[11]=f*n-h*e,i}function zt(i,t,s,e,n){var o=1/Math.tan(t/2),a;return i[0]=o/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(a=1/(e-n),i[10]=(n+e)*a,i[14]=2*n*e*a):(i[10]=-1,i[14]=-2*e),i}var Ot=zt;function Ct(i,t,s,e){var n,o,a,r,h,c,u,d,f,l,p=t[0],m=t[1],g=t[2],T=e[0],y=e[1],M=e[2],R=s[0],S=s[1],B=s[2];return Math.abs(p-R)<at&&Math.abs(m-S)<at&&Math.abs(g-B)<at?xt(i):(u=p-R,d=m-S,f=g-B,l=1/Math.hypot(u,d,f),u*=l,d*=l,f*=l,n=y*f-M*d,o=M*u-T*f,a=T*d-y*u,l=Math.hypot(n,o,a),l?(l=1/l,n*=l,o*=l,a*=l):(n=0,o=0,a=0),r=d*a-f*o,h=f*n-u*a,c=u*o-d*n,l=Math.hypot(r,h,c),l?(l=1/l,r*=l,h*=l,c*=l):(r=0,h=0,c=0),i[0]=n,i[1]=r,i[2]=u,i[3]=0,i[4]=o,i[5]=h,i[6]=d,i[7]=0,i[8]=a,i[9]=c,i[10]=f,i[11]=0,i[12]=-(n*p+o*m+a*g),i[13]=-(r*p+h*m+c*g),i[14]=-(u*p+d*m+f*g),i[15]=1,i)}function v(){var i=new O(3);return O!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function x(i){var t=new O(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function j(i){var t=i[0],s=i[1],e=i[2];return Math.hypot(t,s,e)}function P(i,t,s){var e=new O(3);return e[0]=i,e[1]=t,e[2]=s,e}function w(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function W(i,t,s,e){return i[0]=t,i[1]=s,i[2]=e,i}function N(i,t,s){return i[0]=t[0]+s[0],i[1]=t[1]+s[1],i[2]=t[2]+s[2],i}function $(i,t,s){return i[0]=t[0]-s[0],i[1]=t[1]-s[1],i[2]=t[2]-s[2],i}function _(i,t,s){return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i}function H(i,t,s,e){return i[0]=t[0]+s[0]*e,i[1]=t[1]+s[1]*e,i[2]=t[2]+s[2]*e,i}function K(i,t){var s=t[0]-i[0],e=t[1]-i[1],n=t[2]-i[2];return Math.hypot(s,e,n)}function Nt(i,t){var s=t[0]-i[0],e=t[1]-i[1],n=t[2]-i[2];return s*s+e*e+n*n}function Ft(i){var t=i[0],s=i[1],e=i[2];return t*t+s*s+e*e}function E(i,t){var s=t[0],e=t[1],n=t[2],o=s*s+e*e+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function Y(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function et(i,t,s,e){var n=t[0],o=t[1],a=t[2];return i[0]=n+e*(s[0]-n),i[1]=o+e*(s[1]-o),i[2]=a+e*(s[2]-a),i}var z=$,D=K,pt=j,Gt=Ft;(function(){var i=v();return function(t,s,e,n,o,a){var r,h;for(s||(s=3),e||(e=0),n?h=Math.min(n*s+e,t.length):h=t.length,r=e;r<h;r+=s)i[0]=t[r],i[1]=t[r+1],i[2]=t[r+2],o(i,i,a),t[r]=i[0],t[r+1]=i[1],t[r+2]=i[2];return t}})();function Xt(){var i=new O(2);return O!=Float32Array&&(i[0]=0,i[1]=0),i}function gt(i,t){var s=new O(2);return s[0]=i,s[1]=t,s}function Tt(i,t,s){return i[0]=t[0]+s[0],i[1]=t[1]+s[1],i}function Yt(i){var t=i[0],s=i[1];return Math.hypot(t,s)}(function(){var i=Xt();return function(t,s,e,n,o,a){var r,h;for(s||(s=2),e||(e=0),n?h=Math.min(n*s+e,t.length):h=t.length,r=e;r<h;r+=s)i[0]=t[r],i[1]=t[r+1],o(i,i,a),t[r]=i[0],t[r+1]=i[1];return t}})();const Wt=160,b=170,ht=Wt/2,U=b/2,G=6,nt=6,yt=.5;function L(i,t,s){return P(i,t,s)}const qt=Object.freeze([L(-.5*G-nt,0,b),L(-.5*G,0,b),L(.5*G,0,b),L(.5*G+nt,0,b)]),Zt=Object.freeze([L(-.5*G-nt,0,0),L(-.5*G,0,0),L(.5*G,0,0),L(.5*G+nt,0,0)]),Kt=Object.freeze({Away:qt,Home:Zt});function vt(i){const t=i[0]/ht,s=(i[2]-U)/U;return t*t+s*s>1}function $t(i,t,s,e,n,o){const a=n-s,r=o-e;if(a===0&&r===0){const p=i-s,m=t-e;return p*p+m*m}const h=((i-s)*a+(t-e)*r)/(a*a+r*r),c=Math.max(0,Math.min(1,h)),u=s+c*a,d=e+c*r,f=i-u,l=t-d;return f*f+l*l}function Qt(i,t){const s=vt(i),e=vt(t);for(const n of["Away","Home"]){const o=Kt[n];if(e&&!s){if(n==="Away"){if(i[2]>b-10){const r=t[0];if(r>=-3&&r<=3)return"goalAway";if(r>=-9&&r<-3||r>3&&r<=9)return"behindAway"}}else if(n==="Home"&&i[2]<10){const r=t[0];if(r>=-3&&r<=3)return"goalHome";if(r>=-9&&r<-3||r>3&&r<=9)return"behindHome"}}const a=["outerLeftPost","innerLeftPost","innerRightPost","outerRightPost"];for(let r=0;r<o.length;r++){const h=o[r][0],c=o[r][2];if($t(h,c,i[0],i[2],t[0],t[2])<yt*yt)return`${a[r]}${n}`}}return!s&&e?"outOfBounds":null}function Mt(i=!1){const s={fullForward:70,halfForward:35,halfBack:-35,fullBack:-70},e={LFP:-45,FF:0,RFP:45,LHF:-50,CHF:0,RHF:50,LHB:-50,CHB:0,RHB:50,LBP:-45,FB:0,RBP:45};function n(h,c){const u=h*Math.PI/180,d=ht*Math.sin(u)*(Math.abs(c)/U)-(i?2:-2),f=U+c*(i?-1:1);return L(d,0,f)}const o=-ht-4,a=h=>U+(i?1:-1)*h;return{LFP:n(e.LFP,s.fullForward-(i?10:-10)),FF:n(e.FF,s.fullForward),RFP:n(e.RFP,s.fullForward-(i?10:-10)),LHF:n(e.LHF,s.halfForward),CHF:n(e.CHF,s.halfForward),RHF:n(e.RHF,s.halfForward),LW:L(-25,0,U-(i?2:-2)),C:L(8,0,U-(i?-5:5)),RW:L(25,0,U-(i?2:-2)),LHB:n(e.LHB,s.halfBack),CHB:n(e.CHB,s.halfBack),RHB:n(e.RHB,s.halfBack),LBP:n(e.LBP,s.fullBack-(i?10:-10)),FB:n(e.FB,s.fullBack),RBP:n(e.RBP,s.fullBack-(i?10:-10)),Ruck:L(0,0,U-(i?10:-10)),RR:L(-10,0,U-(i?10:-10)),Rover:L(10,0,U-(i?10:-10)),Bench1:L(o,0,a(10)),Bench2:L(o,0,a(13)),Bench3:L(o,0,a(16)),Bench4:L(o,0,a(19)),Bench5:L(o,0,a(22))}}function Jt(i,t,s){let e=null,n=1/0;for(const o of t)if(o.team!==i.team){const a=K(o.pos,s);a<n&&(n=a,e=o)}return e}class ts{constructor(t,s,e){this.game=t,this.kicker=s,this.markPos=x(e),this.timer=0,this.finished=!1}update(t){this.timer+=t}enforce(t,s){return!1}cleanup(){}}class ot extends ts{constructor(t,s,e){super(t,s,e),this.defender=null,this.zone={center:v(),radius:1},this.game=t,this.setup()}setup(){const{game:t,kicker:s,markPos:e}=this,n=s.team==="home"?0:b,o=P(0,0,n),a=z(v(),e,o);a[1]=0,E(a,a);const r=x(e),h=x(e);w(s.pos,h),_(s.jogVel,a,s.jogSpeed),w(s.joltVel,[0,0,0]),t.ball.carrier!==s&&t.ball.pickup(s),s.team==="home"&&(this.game.player=s),s.stateTimer=10/s.jogSpeed,this.defender=Jt(s,t.players,e),this.defender&&(w(this.defender.pos,r),w(this.defender.vel,[0,0,0]),w(this.defender.jogVel,[0,0,0]),w(this.defender.joltVel,[0,0,0]),this.defender.actionState="standingMark",this.defender.stateTimer=10)}update(t){super.update(t);const{kicker:s,markPos:e,game:n}=this,o=!n.ball.carried,a=z(v(),s.pos,e);a[1]=0;const r=s.team==="home"?0:b,h=z(v(),[0,0,r],e);h[1]=0,E(h,h);const c=Y(a,h),u=P(-h[2],0,h[0]),d=Math.abs(Y(a,u)),f=c>.05||d>2;(o||f)&&(this.finished=!0)}enforce(t,s){const{kicker:e,defender:n,markPos:o}=this,a=e.pos,r=et(v(),o,a,.5),h=K(o,a)/2+5,c=K(t.pos,r);if(t===n)return w(t.pos,n.pos),W(t.vel,0,0,0),W(t.jogVel,0,0,0),W(t.joltVel,0,0,0),!1;if(c<h&&t!==e&&t!==n){const u=K(t.pos,r),d=h-u;if(d>0){const f=z(v(),t.pos,r);f[1]=0;const l=j(f);if(l<.001?(W(f,Math.random()-.5,0,Math.random()-.5),E(f,f)):_(f,f,1/l),d<2){const p=d*10;return H(t.joltVel,t.joltVel,f,p*s),H(t.pos,t.pos,t.joltVel,s),!0}else{const p=d*20;return H(t.joltVel,t.joltVel,f,p*s),H(t.pos,t.pos,t.joltVel,s),!0}}}return!1}}class k extends Float32Array{constructor(t=0,s=0,e=0){super(3),this[0]=t,this[1]=s,this[2]=e}static fromValues(t,s,e){return new k(t,s,e)}static fromArray(t){return new k(t[0],t[1],t[2])}clone(){return new k(this[0],this[1],this[2])}add(t){return new k(this[0]+t[0],this[1]+t[1],this[2]+t[2])}addMut(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}sub(t){return new k(this[0]-t[0],this[1]-t[1],this[2]-t[2])}subMut(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return new k(this[0]*t,this[1]*t,this[2]*t)}scaleMut(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}normalize(){const t=this.len();return t>1e-5?this.scale(1/t):new k(0,0,0)}normalizeMut(){const t=this.len();return t>1e-5?this.scaleMut(1/t):this.zero()}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}len(){return Math.hypot(this[0],this[1],this[2])}equals(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]}angleTo(t){const s=this.dot(t),e=this.len()*Math.hypot(t[0],t[1],t[2]);return e>1e-5?Math.acos(s/e):0}distanceTo(t){return Math.hypot(this[0]-t[0],this[1]-t[1],this[2]-t[2])}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get xz(){return new A(this[0],this[2])}get xy(){return new A(this[0],this[1])}get yz(){return new A(this[1],this[2])}zero(){return this[0]=0,this[1]=0,this[2]=0,this}negate(){return new k(-this[0],-this[1],-this[2])}negateMut(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this}inverse(){return new k(1/this[0],1/this[1],1/this[2])}inverseMut(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}ceil(){return new k(Math.ceil(this[0]),Math.ceil(this[1]),Math.ceil(this[2]))}ceilMut(){return this[0]=Math.ceil(this[0]),this[1]=Math.ceil(this[1]),this[2]=Math.ceil(this[2]),this}floor(){return new k(Math.floor(this[0]),Math.floor(this[1]),Math.floor(this[2]))}floorMut(){return this[0]=Math.floor(this[0]),this[1]=Math.floor(this[1]),this[2]=Math.floor(this[2]),this}round(){return new k(Math.round(this[0]),Math.round(this[1]),Math.round(this[2]))}roundMut(){return this[0]=Math.round(this[0]),this[1]=Math.round(this[1]),this[2]=Math.round(this[2]),this}max(t){return new k(Math.max(this[0],t[0]),Math.max(this[1],t[1]),Math.max(this[2],t[2]))}min(t){return new k(Math.min(this[0],t[0]),Math.min(this[1],t[1]),Math.min(this[2],t[2]))}clamp(t,s){return new k(Math.min(Math.max(this[0],t[0]),s[0]),Math.min(Math.max(this[1],t[1]),s[1]),Math.min(Math.max(this[2],t[2]),s[2]))}mix(t,s){return this.scale(1-s).add(new k(t[0],t[1],t[2]).scale(s))}static angle(t,s){const e=t[0]*s[0]+t[1]*s[1]+t[2]*s[2],n=Math.hypot(t[0],t[1],t[2])*Math.hypot(s[0],s[1],s[2]);return n>1e-5?Math.acos(e/n):0}static normalize(t){const s=Math.hypot(t[0],t[1],t[2]);return s>1e-5?new k(t[0]/s,t[1]/s,t[2]/s):new k(0,0,0)}static normalizeMut(t){const s=Math.hypot(t[0],t[1],t[2]);return s>1e-5?(this[0]=t[0]/s,this[1]=t[1]/s,this[2]=t[2]/s):(this[0]=t[0]/s,this[1]=t[1]/s,this[2]=t[2]/s),this}cross(t){const[s,e,n]=this,[o,a,r]=t;return new k(e*r-n*a,n*o-s*r,s*a-e*o)}static lerp(t,s,e){return new k(t[0]+(s[0]-t[0])*e,t[1]+(s[1]-t[1])*e,t[2]+(s[2]-t[2])*e)}transformMat4(t){const s=this[0],e=this[1],n=this[2];return new k(t[0]*s+t[4]*e+t[8]*n+t[12],t[1]*s+t[5]*e+t[9]*n+t[13],t[2]*s+t[6]*e+t[10]*n+t[14])}}class A extends Float32Array{constructor(t=0,s=0){super(2),this[0]=t,this[1]=s}static fromValues(t,s){return new A(t,s)}static fromArray(t){return new A(t[0],t[1])}clone(){return new A(this[0],this[1])}add(t){return new A(this[0]+t[0],this[1]+t[1])}addMut(t){return this[0]+=t[0],this[1]+=t[1],this}sub(t){return new A(this[0]-t[0],this[1]-t[1])}subMut(t){return this[0]-=t[0],this[1]-=t[1],this}scale(t){return new A(this[0]*t,this[1]*t)}scaleMut(t){return this[0]*=t,this[1]*=t,this}normalize(){const t=this.len();return t>1e-5?this.scale(1/t):new A(0,0)}normalizeMut(){const t=this.len();return t>1e-5?this.scaleMut(1/t):(this[0]=0,this[1]=0),this}dot(t){return this[0]*t[0]+this[1]*t[1]}len(){return Math.hypot(this[0],this[1])}equals(t){return this[0]===t[0]&&this[1]===t[1]}angleTo(t){const s=this.dot(t),e=this.len()*Math.hypot(t[0],t[1]);return e>1e-5?Math.acos(s/e):0}distanceTo(t){return Math.hypot(this[0]-t[0],this[1]-t[1])}toVec3XY(t=0){return new k(this[0],this[1],t)}toVec3XZ(t=0){return new k(this[0],t,this[1])}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}transformMat3(t){const s=this[0],e=this[1];return new A(t[0]*s+t[3]*e+t[6],t[1]*s+t[4]*e+t[7])}static lerp(t,s,e){return new A(t[0]+(s[0]-t[0])*e,t[1]+(s[1]-t[1])*e)}zero(){return this[0]=0,this[1]=1,this}negate(){return new A(-this[0],-this[1])}inverse(){return new A(1/this[0],1/this[1])}ceil(){return new A(Math.ceil(this[0]),Math.ceil(this[1]))}floor(){return new A(Math.floor(this[0]),Math.floor(this[1]))}round(){return new A(Math.round(this[0]),Math.round(this[1]))}max(t){return new A(Math.max(this[0],t[0]),Math.max(this[1],t[1]))}min(t){return new A(Math.min(this[0],t[0]),Math.min(this[1],t[1]))}clamp(t,s){return new A(Math.min(Math.max(this[0],t[0]),s[0]),Math.min(Math.max(this[1],t[1]),s[1]))}mix(t,s){return this.scale(1-s).add(new A(t[0],t[1]).scale(s))}static angle(t,s){const e=t[0]*s[0]+t[1]*s[1],n=Math.hypot(t[0],t[1])*Math.hypot(s[0],s[1]);return n>1e-5?Math.acos(e/n):0}static normalize(t){const s=Math.hypot(t[0],t[1]);return s>1e-5?new A(t[0]/s,t[1]/s):new A(0,0)}}function ss(i,t){const[s,e]=i.collideBounds(),[n,o]=t.collideBounds(),a=i.pos[0]-t.pos[0],r=i.pos[2]-t.pos[2],h=a*a+r*r,c=s/2,u=n/2,d=c+u,f=i.pos[1],l=i.pos[1]+e,p=t.pos[1],m=t.pos[1]+o,g=f<m&&l>p;return h<=d*d&&g}class ut{constructor(t){this.pos=t,this.vel=[0,0,0],this.width=1.6,this.height=2.4,this.usesGravity=!0,this.gravity=[0,-9.8,0],this.bounces=!1,this.restitution=.4,this.floorY=0}setupForBoundary(t,s){}update(t,s){this.usesGravity&&H(this.vel,this.vel,this.gravity,t),H(this.pos,this.pos,this.vel,t),this.pos[1]<this.floorY&&(this.pos[1]=this.floorY,this.bounces&&Math.abs(this.vel[1])>.5?this.vel[1]=-this.vel[1]*this.restitution:this.vel[1]=0)}render(t){t.renderSprite(this.pos,this.width,this.height,1,0)}collidesWith(t){return ss(this,t)}collideBounds(){return[.5,1.8]}}const St={home:Object.freeze({idle:[[0,0,0]],run:[[1,0,0],[2,0,0],[3,0,0],[4,0,0],[5,0,0],[6,0,0]],kickRightFoot:[[1,0,0],[2,0,0]],kickLeftFoot:[[4,0,0],[5,0,0]],handpassRightHand:[[1,0,0],[0,0,0]],handpassLeftHand:[[4,0,0],[0,0,0]],jumpMark:[[1,0,0],[2,0,0],[0,0,0]],jumpSpoil:[[1,0,0],[2,0,0],[0,0,0]]}),away:Object.freeze({idle:[[0,4,0]],run:[[1,4,0],[2,4,0],[3,4,0],[4,4,0],[5,4,0],[6,4,0]],kickRightFoot:[[1,4,0],[2,4,0]],kickLeftFoot:[[4,4,0],[5,4,0]],handpassRightHand:[[1,4,0],[0,4,0]],handpassLeftHand:[[4,4,0],[0,4,0]],jumpMark:[[1,4,0],[2,4,0],[0,4,0]],jumpSpoil:[[1,4,0],[2,4,0],[0,4,0]]})};class is extends ut{constructor(t,s,e,n=!1){super(e),this.positionPos=x(e),this.name=t,this.team=s,this.playing=n,this.width=1.6,this.height=2.4,this.aiming=!1,this.jogVel=P(0,0,0),this.joltVel=P(0,0,0),this.jogSpeed=5,this.joltSpeed=2,this.energy=10,this.energyRecovery=0,this.statsWeight=85+Math.random()*10,this.statsStrength=50+Math.random()*30,this.statsSpeed=10+Math.random()*5,this.statsJump=10,this.statsKickRange=45,this.statsHandpassRange=20,this.statsAgility=10,this.joltDecayRate=8,this.animations=St[s]??St.home,this.animState="idle",this.actionState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=8,this.stateTimer=0,this.animSprite=P(0,0,0)}updateAI(t,s){const n=s.ball;let o=null;if(n.carried&&n.carrier===this)if(this.stateTimer+=t,this.stateTimer<1)o="run";else{let r=!1;for(const l of s.players)if(!(l===this||l.team===this.team)&&D(l.pos,this.pos)<7){r=!0;break}const h=s.players.filter(l=>l.team===this.team&&l!==this);if(r){let l=null,p=-1/0;const m=P(0,0,this.team==="home"?-1:1);for(const g of h){if(g===this)continue;const T=D(this.pos,g.pos);if(T>40)continue;let y=!1;for(const I of s.players)if(I.team!==this.team&&D(I.pos,g.pos)<5){y=!0;break}if(y)continue;const M=v();$(M,g.pos,this.pos),E(M,M);const R=Y(m,M),S=x(g.vel);S[1]=0;const B=Y(m,S),F=Math.abs(T-15)*.2,V=15*R+2*B-F;V>p&&(p=V,l=g)}if(l){const g=z(v(),l.pos,this.pos),T=[g[0],g[2]];return this.tryDisposeBall(s,{kickReleased:!0,kickHeldTime:j(g)>20?.5:.1,aimTarget:T})??"run"}}const u=this.team==="home"?-5:b+5,d=0;if(Math.abs(this.pos[2]-u)<=this.statsKickRange){const l=P(d,0,u),p=(Math.random()-.5)*9;l[0]+=p;const m=z(v(),l,this.pos),g=[m[0],m[2]];return this.tryDisposeBall(s,{kickReleased:!0,kickHeldTime:.4,aimTarget:g})??"run"}if(r||this.stateTimer>5){let l=null,p=-1/0;for(const m of h){const g=D(this.pos,m.pos);if(g>this.statsKickRange)continue;const T=this.team==="home"?-1:1,y=(m.pos[2]-this.pos[2])*T,M=Math.abs(m.pos[0]-this.pos[0]),R=y-M-g;R>p&&(p=R,l=m)}if(l){const m=z(v(),l.pos,this.pos),g=[m[0],m[2]];return this.tryDisposeBall(s,{kickReleased:!0,kickHeldTime:.4,aimTarget:g})??"run"}}o="run"}let a=null;if(n.carried&&n.carrier===this){const r=this.team==="home"?-1:1,h=P(0,0,r);let c=v();for(const d of s.players){if(d===this||d.team===this.team)continue;const f=v();$(f,this.pos,d.pos),f[1]=0;const l=j(f);if(l<5&&l>.5){const p=1/l;E(f,f),H(c,c,f,p)}}const u=v();N(u,h,c),E(u,u),a=x(this.pos),H(a,a,u,10)}else if(n.carried)if(n.carrier&&n.carrier.team!==this.team&&s.chasers<3&&s.closestPlayers[this.team]===this||D(n.pos,this.pos)<=15&&this.energy>0)a=x(n.pos),s.chasers++;else if(n.carrier&&n.carrier.team===this.team&&n.pos[2]>20&&n.pos[2]<b-20&&D(n.pos,this.pos)<10&&this.energy>.3&&s.followers<3){s.followers++;const r=x(n.carrier.jogVel);j(r)<.01&&(r[2]=this.team==="home"?-1:1),E(r,r);const h=P(-r[2],0,r[0]);E(h,h);let c=0,u=12;switch(this.name){case"wing":c=12*(this.team==="home"?-1:1),u=15;break;case"forward":c=6,u=18;break;case"half-forward":case"half-back":c=4,u=10;break;case"center":case"mid":c=0,u=10;break;case"back":default:c=-6,u=8;break}const d=x(n.carrier.pos);H(d,d,r,u),H(d,d,h,c),a=d}else a=this.positionPos??this.pos;else if(n.pos[1]>.1||n.vel[1]>.1){const r=n.gravity[1]??-9.8,h=n.vel[1],c=n.pos[1],u=.5*r,d=h,f=c;let l=0;const p=d*d-4*u*f;if(p>=0&&Math.abs(u)>1e-5){const g=Math.sqrt(p),T=(-d+g)/(2*u),y=(-d-g)/(2*u);l=Math.max(T,y)}const m=v();H(m,n.pos,n.vel,l),m[1]=0,D(m,this.pos)<=35?a=m:a=this.positionPos??this.pos}else D(n.pos,this.pos)<=25?a=n.pos:a=this.positionPos??this.pos;if(a===this.positionPos&&D(this.positionPos,this.pos)<=1&&(o="idle",this.actionState!=="idle"&&(this.stateTimer=0),w(this.jogVel,[0,0,0]),w(this.joltVel,[0,0,0])),a&&o===null){const r=v();if($(r,a,this.pos),r[1]=0,Ft(r)>1e-4){E(r,r),_(this.joltVel,r,this.joltSpeed);const c=v();j(this.jogVel)>1e-4?(E(c,this.jogVel),et(c,c,r,.15),E(c,c),_(this.jogVel,c,this.jogSpeed)):_(this.jogVel,r,this.jogSpeed)}}if(this.energy>0?(N(this.vel,this.jogVel,this.joltVel),this.energy-=t):(H(this.vel,this.jogVel,this.joltVel,.5),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),_(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),this.checkPlayerCollisions(t,s),super.update(t,s),o===null&&(o=this.tryTackle(s)),!n.carried&&n.collidesWith(this)&&o===null){const r=n.lastTouchedType==="kick"&&!n.hasBounced&&n.lastTouchedBy!==this&&D(n.pos,n.origin)>=15;return n.pickup(this),r?(s.setPiece=new ot(s,this,x(this.pos)),o="freeKick"):o="pickup",this.team==="home"&&(s.player=this,this.aiming=!1),o}return o||(o=j(this.vel)>1e-4?"run":"idle"),o}collideBounds(){return[.5,1.8]}get stunned(){return this.actionState==="tackle"||this.actionState==="tackled"}tryTackle(t){const s=t.ball;for(const e of t.players){if(e===this||!s.carried||s.carrier!==e||e.team===this.team||!this.collidesWith(e)||e.actionState==="tackleDisposal"||e.actionState==="freeKick")continue;const n=z(v(),e.pos,this.pos);n[1]=0,E(n,n);const o=x(this.jogVel);if(o[1]=0,j(o)<1e-4||Y(E(o,o),n)>.1)return this.stateTimer=1,e.actionState="tackleDisposal",e.stateTimer=.5,t.player===this&&console.log("Tackle from",this.name,this.team,this,"on",e.name,e.team,e,Y(o,n)),"tackle"}return null}updateHuman(t,s){const e=s.controls,n=s.ball;let{kickPressed:o,kickReleased:a,kickHeldTime:r,moveX:h,moveZ:c,aimTarget:u}=e.state;const d=1e-4;let f=null;if((h!==0||c!==0)&&!this.aiming){const l=P(h,0,c);E(l,l);const p=P(h,0,c);if(Gt(p)>d){E(p,p),_(this.joltVel,p,this.joltSpeed);const m=v();j(this.jogVel)>d?(E(m,this.jogVel),et(m,m,l,.15),E(m,m),_(this.jogVel,m,this.jogSpeed)):_(this.jogVel,l,this.jogSpeed)}}if(this.energy>0?(N(this.vel,this.jogVel,this.joltVel),this.energy-=t):(N(this.vel,this.jogVel,_(this.joltVel,this.joltVel,.5)),this.energyRecovery+=t,this.energyRecovery>=10&&(this.energy=10,this.energyRecovery=0)),_(this.joltVel,this.joltVel,Math.exp(-this.joltDecayRate*t)),this.checkPlayerCollisions(t,s),super.update(t,s),n.carried&&n.carrier!==this&&o&&(f=this.tryTackle(s)),!n.carried&&n.collidesWith(this)&&f===null){const l=n.lastTouchedType==="kick"&&!n.hasBounced&&n.lastTouchedBy!==this&&D(n.pos,n.origin)>=15;return n.pickup(this),l?(s.setPiece=new ot(s,this,x(this.pos)),f="freeKick"):f="pickup",this.team==="home"&&(s.player=this,this.aiming=!1),f}if(n.carried&&n.carrier===this&&f===null){if(o){this.aiming=!0;const l=P(0,0,this.team==="home"?0:b);if(pt(this.jogVel)<1e-4){const p=v();z(p,l,this.pos),E(p,p),_(this.jogVel,p,this.jogSpeed)}}f=this.tryDisposeBall(s,{kickReleased:e.state.kickReleased,kickHeldTime:e.state.kickHeldTime,aimTarget:e.state.aimTarget,moveVec:h!==0||c!==0?P(h,0,c):x(this.jogVel)}),n.carried||(this.aiming=!1)}return this.updateAim(s),!f&&this.actionState!=="run"&&this.actionState!=="idle"&&(f=j(this.vel)>d?"run":"idle"),f}tryDisposeBall(t,s){const e=t.ball;if(!e.carried||e.carrier!==this)return null;const{kickReleased:n,kickHeldTime:o}=s;let{aimTarget:a}=s;if(!n)return null;const r=o<.25;if(r){const y=s.moveVec??x(this.jogVel);if(j(y)===0){const S=this.team==="home"?-1:1;W(y,0,0,S)}E(y,y);let M=null,R=-1/0;for(const S of t.players){if(S.team!==this.team||S===this||S.stunned)continue;const B=z(v(),S.pos,this.pos),F=j(B);if(F>30)continue;const V=E(v(),B),I=Y(y,V);if(I<=0)continue;let J=0;for(const q of t.players){if(q.team===this.team||q===S||q.stunned)continue;K(q.pos,S.pos)<=10&&J++}const rt=.5*J,tt=I*2-F/30-rt;tt>R&&(R=tt,M=S)}if(M){const S=z(v(),M.pos,this.pos);a=[S[0],S[2]]}else a=[y[0]*10,y[2]*10]}if(!a)return null;const h=gt(0,0);Tt(h,h,a);const c=Yt(h);if(c<.1)return null;const u=-this.gravity[1],d=(r?20:30)*Math.PI/180,f=Math.sin(2*d),l=Math.sqrt(c*u/f),p=P(h[0],0,h[1]);E(p,p);const m=P(p[0]*Math.cos(d),Math.sin(d),p[2]*Math.cos(d));return e.launch(m,l),e.lastTouchedType=r?"handpass":"kick",e.hasBounced=!1,this.stateTimer=.5,r?"handpass":"kick"}update(t,s){let e=!1;if(s.setPiece&&(e=s.setPiece.enforce(this,t)),s.ball.carried||(this.aiming=!1),!this.playing)return;if(this.actionState==="pickup"&&(this.actionState="run"),this.actionState==="freeKick"){this.stateTimer-=t,this.stateTimer<=0?(this.actionState="idle",this.stateTimer=0,this.jogVel[0]=0,this.jogVel[2]=0,s.setPiece):(s.setPiece===null||s.controls.state.moveX!==0||s.controls.state.moveZ!==0)&&(this.actionState="idle",this.stateTimer=0),w(this.vel,this.jogVel),super.update(t,s),this.updateAim(s),this.updateAnimation(t,null,s.ball);return}if(this.actionState==="standingMark"){this.stateTimer-=t,this.stateTimer<=0?(this.actionState="idle",this.stateTimer=0,this.jogVel[0]=0,this.jogVel[1]=0,s.setPiece):s.setPiece===null&&(this.actionState="idle",this.stateTimer=0),this.updateAim(s),this.updateAnimation(t,null,s.ball);return}if(this.actionState==="tackleDisposal"){if(this.stateTimer-=t,H(this.pos,this.pos,this.jogVel,t),s.player===this&&s.controls.state.kickReleased&&(this.tryDisposeBall(s,s.controls.state),this.actionState="handpass",this.stateTimer=.5),s.player!==this){const o=.5-this.stateTimer,a=.5+(this.statsStrength-50)*.01,r=o/a*(.5+(this.statsStrength-50)/100);Math.random()<r*t*2&&this.tryDisposeBall(s,{kickReleased:!0,kickHeldTime:.1,aimTarget:null,moveVec:v()})}if(this.stateTimer<=0){const o=s.ball;o.carried=!1,o.carrier=null,w(o.pos,this.pos),w(o.vel,pt(this.vel)>.5?this.vel:k.fromValues(Math.random()*2-1,0,Math.random()*2-1).normalizeMut().scale(this.jogSpeed+this.joltSpeed)),o.lastTouchedType="spill",o.hasBounced=!1,this.actionState="tackled",this.stateTimer=1}this.updateAim(s),this.updateAnimation(t,null,s.ball);return}if(this.actionState==="tackled"||this.actionState==="tackle"||this.actionState==="kick"||this.actionState==="handpass"){this.stateTimer-=t,this.stateTimer<=0&&(this.actionState="idle",this.stateTimer=0),this.aiming&&(this.aiming=!1),super.update(t,s),this.updateAim(s),this.updateAnimation(t,null,s.ball);return}let n=null;e||(s.player===this?n=this.updateHuman(t,s):n=this.updateAI(t,s)),this.updateAnimation(t,n,s.ball),n!==null&&(this.actionState=n)}updateAim(t){if(this===t.player){const e=t.controls.state.aimTarget;if(this.aiming){const n=gt(0,0);e&&Tt(n,n,e),t.aimTarget.setPosition([this.pos[0]+n[0],.002,this.pos[2]+n[1]])}else t.player===this&&t.aimTarget.setPosition(P(this.pos[0],.002,this.pos[2]+.8))}}updateAnimation(t,s,e){const n=this.animations[this.animState];if(n.length===0)return;this.animTimer+=t;const o=1/this.animFPS;this.animTimer>=o&&(this.animTimer-=o,this.animFrame=this.animFrame+1),s==="kick"&&(this.animState="kickRightFoot",this.animFrame=0,this.animTimer=0),this.animState==="run"&&D(this.vel,[0,0,0])===0&&(this.animState="idle",this.animFrame=0,this.animTimer=0),this.animState==="idle"&&D(this.vel,[0,0,0])!==0&&(this.animState="run",this.animFrame=0,this.animTimer=0);const a=this.animState==="run"||this.animState==="idle";this.animFrame>=n.length&&(this.animFrame=a?0:n.length-1,a||(this.animState="run",this.animFrame=0,this.animTimer=0));const r=this.animations[this.animState];this.animSprite=x(r[this.animFrame])??P(0,0,0),(this.vel[2]>0?"away":this.vel[2]<0?"home":this.pos[2]<e.pos[2]?"away":"home")==="away"&&(this.animSprite[0]+=7)}render(t){const[s,e,n]=this.animSprite;t.renderSprite(this.pos,this.width,this.height,s,e)}checkPlayerCollisions(t,s){if(this.actionState!=="freeKick"){for(const e of s.players)if(!(e===this||!e.playing||e.actionState==="freeKick")&&this.collidesWith(e)){const n=v();$(n,this.pos,e.pos),n[1]=0;const o=j(n);o<1e-4?(n[0]=Math.random()-.5,n[2]=Math.random()-.5,E(n,n)):_(n,n,1/o);const a=(this.collideBounds()[0]+e.collideBounds()[0])/2-o;if(a<=0)continue;const r=this.statsWeight,h=e.statsWeight,c=r+h,u=v();_(u,n,a);const d=v(),f=v();_(d,u,h/c),_(f,u,r/c),this.pos[0]+=d[0],this.pos[2]+=d[2],e.pos[0]-=f[0],e.pos[2]-=f[2]}}}setupForBoundary(t,s){t==="behindAway"&&this.team==="home"&&this.name==="FB"?(w(this.pos,[0,0,b-5]),w(this.jogVel,[0,0,0]),w(this.joltVel,[0,0,0]),this.actionState="idle",this.stateTimer=0):t==="behindAway"&&this.team==="away"&&this.name==="FF"?w(this.pos,[0,0,b-25]):t==="behindHome"&&this.team==="away"&&this.name==="FB"?(w(this.pos,[0,0,5]),w(this.jogVel,[0,0,0]),w(this.joltVel,[0,0,0]),this.actionState="idle",this.stateTimer=0):t==="behindHome"&&this.team==="home"&&this.name==="FF"?w(this.pos,[0,0,25]):w(this.pos,this.positionPos)}}class es extends ut{constructor(t){super(t),this.carried=!1,this.origin=v(),this.carrier=null,this.width=1.6,this.height=2.4,this.bounces=!0,this.animations=Object.freeze({idle:[[0,1,0]],backSpin:[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[5,1,0],[6,1,0],[7,1,0],[8,1,0]],forwardSpin:[[8,1,0],[7,1,0],[6,1,0],[5,1,0],[4,1,0],[3,1,0],[2,1,0],[1,1,0]],backSpinRight:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]],backSpinLeft:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinRight:[[19,1,0],[18,1,0],[17,1,0],[16,1,0],[15,1,0],[14,1,0],[13,1,0],[12,1,0]],forwardSpinLeft:[[12,1,0],[13,1,0],[14,1,0],[15,1,0],[16,1,0],[17,1,0],[18,1,0],[19,1,0]]}),this.animState="idle",this.animFrame=0,this.animTimer=0,this.animFPS=12,this.lastTouchedBy=null,this.lastTouchedType=null,this.hasBounced=!1}update(t,s){if(this.carried&&this.carrier){const e=this.carrier,n=e.vel[2]>0?1:e.vel[2]<0||e.team==="home"?-1:1,o=P(0,.5,.2*n),a=x(this.carrier.pos);N(this.pos,a,o),w(this.origin,this.pos)}else{const e=this.vel[1]<0;super.update(t,s),this.hasBounced=this.hasBounced||e&&this.vel[1]>0&&this.pos[1]<=this.floorY,this.pos[1]<=this.floorY&&(_(this.vel,this.vel,.97),w(this.origin,this.pos))}this.updateAnimation(t)}collideBounds(){return[.4,.5]}pickup(t){this.carried=!0,this.carrier=t,this.lastTouchedBy=t,this.lastTouchedType=null,this.hasBounced=!1,this.origin=x(this.pos);const s=t.vel[2]>0?1:t.vel[2]<0||t.team==="home"?-1:1;W(this.pos,t.pos[0],t.pos[1],t.pos[2]+s*.2),W(this.vel,0,0,0)}launch(t,s,e="kick"){this.carried=!1,this.carrier=null,_(this.vel,t,s),this.lastTouchedType=e,this.hasBounced=!1}updateAnimation(t){this.animTimer+=t;const s=1/this.animFPS;this.animTimer>=s&&(this.animTimer-=s,this.animFrame=this.animFrame+1);const e=this.animState;this.carried?this.animState="idle":this.lastTouchedType==="kick"&&!this.hasBounced?this.animState=this.vel[2]<0?"backSpin":"forwardSpin":this.lastTouchedType==="handpass"&&!this.hasBounced?this.animState=this.vel[2]<0?"backSpinRight":"forwardSpinLeft":this.hasBounced?Math.abs(this.vel[1])<.05&&this.pos[1]<=this.floorY+.01?this.animState="idle":this.animState=this.vel[2]<0?"forwardSpin":"backSpin":this.animState="idle",this.animState!==e&&(this.animFrame=0,this.animTimer=0);const n=this.animations[this.animState];n.length!==0&&this.animFrame>=n.length&&(this.animFrame=0)}render(t){var a;const s=(a=this.animations)==null?void 0:a[this.animState],[e,n,o]=(s==null?void 0:s[this.animFrame])??[0,1,void 0];t.renderSprite(this.pos,this.width,this.height,e,n);{const r=t.gl;r.useProgram(t.program),r.bindVertexArray(t.quadVao);const[h,c]=[2,3];t.setTileUV(h,c),r.uniform1i(t.uTiling,!1);const u=C();Z(u,u,[this.pos[0],.001,this.pos[2]]),bt(u,u,-Math.PI/2),it(u,u,[2,2,1]),r.uniformMatrix4fv(t.uModel,!1,u),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0)}}setupForBoundary(t,s){if(this.carried=!1,this.carrier=null,t==="goalAway"||t==="goalHome")w(this.pos,[0,0,b/2]),w(this.vel,[0,15,0]),this.lastTouchedType="tap",this.lastTouchedBy=null,this.origin=x(this.pos);else if(t==="behindAway")w(this.pos,[0,0,b-6]);else if(t==="behindHome")w(this.pos,[0,0,6]);else{this.pos[1]=0,w(this.pos,s);const e=v();H(e,[0,b/2,b/2],s,-1),E(e,e),this.launch(e,15,"tap")}}}class ns{constructor(t=[0,.001,0]){this.pos=x(t),this.size=2,this.spriteCoord=[0,3]}setPosition(t){this.pos[0]=t[0],this.pos[2]=t[2]}render(t){const s=t.gl;s.useProgram(t.program),s.bindVertexArray(t.quadVao);const[e,n]=this.spriteCoord;t.setTileUV(e,n),s.uniform1i(t.uTiling,!1);const o=C();Z(o,o,[this.pos[0],.002,this.pos[2]]),bt(o,o,-Math.PI/2),it(o,o,[this.size,this.size,1]),s.uniformMatrix4fv(t.uModel,!1,o),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0)}}function wt(i,t,s){const e=(r,h)=>{const c=i.createShader(h);if(!c)throw new Error("Failed to create shader");if(i.shaderSource(c,r),i.compileShader(c),!i.getShaderParameter(c,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(c));return c},n=e(t,i.VERTEX_SHADER),o=e(s,i.FRAGMENT_SHADER),a=i.createProgram();if(i.attachShader(a,n),i.attachShader(a,o),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))throw new Error(i.getProgramInfoLog(a));return a}async function os(i){const t=new Image;return t.src=i,await t.decode(),t}function rs(i,t,s,e=1){const a=i*2/1.6/e,r=t*2/2/e,h=[0,0,0,.5,.5],c=[];for(let u=0;u<=s;u++){const d=u/s*2*Math.PI,f=Math.cos(d)*i,l=Math.sin(d)*t,p=f/(i*2)*a+.5,m=l/(t*2)*r+.5;h.push(f,0,l,p,m),u>0&&c.push(0,u,u+1)}return{vertices:new Float32Array(h),indices:new Uint16Array(c)}}function as(i=160,t=170,s=50,e=50,n=.4){const o=[],a=[];let r=0;const h=(m,g,T,y,M)=>{const R=T-m,S=y-g,B=Math.hypot(R,S),F=-S/B,V=R/B,I=M/2,J=m+F*I,rt=g+V*I,tt=m-F*I,q=g-V*I,ft=T+F*I,Ht=y+V*I,jt=T-F*I,Vt=y-V*I;o.push(J,0,rt,ft,0,Ht,jt,0,Vt,tt,0,q),a.push(r,r+1,r+2,r,r+2,r+3),r+=4},c=i/2,u=t/2,d=64;for(let m=0;m<d;m++){const g=m/d*2*Math.PI,T=(m+1)/d*2*Math.PI,y=Math.cos(g)*c,M=Math.sin(g)*u,R=Math.cos(T)*c,S=Math.sin(T)*u;h(y,M,R,S,n)}const f=[[-e/2,-e/2],[e/2,-e/2],[e/2,e/2],[-e/2,e/2]];for(let m=0;m<4;m++){const[g,T]=f[m],[y,M]=f[(m+1)%4];h(g,T,y,M,n)}function l(m){const g=m>0?-1:1,T=[];for(let y=0;y<=1e3;y++){const M=-Math.PI+y/1e3*2*Math.PI,R=Math.sin(M)*s,S=m+g*Math.cos(M)*s,B=R/c,F=S/u;B*B+F*F<=1&&T.push(M)}return T.length===0?[-Math.PI/3,Math.PI/3]:[T[0],T[T.length-1]]}const p=40;for(let m of[-t/2,t/2]){const g=m>0?-1:1,[T,y]=l(m);for(let M=0;M<p;M++){const R=T+M/p*(y-T),S=T+(M+1)/p*(y-T),B=Math.sin(R)*s,F=m+g*Math.cos(R)*s,V=Math.sin(S)*s,I=m+g*Math.cos(S)*s;h(B,F,V,I,n)}}return{vertices:new Float32Array(o),indices:new Uint16Array(a)}}const Lt=16,_t=24,Pt=512,kt=768,lt=0,ct=0,At=Lt+lt,Rt=_t+ct,Q=170,hs=80,Et=Q/2;class ls{constructor(t,s,e){this.gl=t,this.canvas=s,this.spriteSheet=e,this.sheetCols=32,this.sheetRows=32,this.setupMainProgram(),this.setupLineProgram(),this.setupSpriteGeometry(),this.setupField(),this.setupGoalposts(),this.setupCamera(),this.setupSpritesheet(),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}setupSpritesheet(){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.spriteSheet),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture)}setupMainProgram(){const t=`#version 300 es
      in vec3 a_position;
      in vec2 a_texcoord;
      uniform mat4 u_projection, u_view, u_model;
      out vec2 v_texcoord;
      void main() {
        gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
        v_texcoord = a_texcoord;
      }`,s=`#version 300 es
precision mediump float;

uniform sampler2D u_texture;
uniform vec4 u_tileUV;
uniform bool u_tiling;

in vec2 v_texcoord;
out vec4 outColor;

void main() {
  vec2 texCoord;
  if (u_tiling) {
    vec2 tileUV = mod(v_texcoord, 1.0);
    texCoord = mix(u_tileUV.xy, u_tileUV.zw, tileUV);
  } else {
    texCoord = mix(u_tileUV.xy, u_tileUV.zw, v_texcoord);
  }
  vec2 texelSize = 1.0 / vec2(textureSize(u_texture, 0));
  vec2 epsilon = 0.5 * texelSize;
  texCoord = clamp(texCoord, u_tileUV.xy + epsilon, u_tileUV.zw - epsilon);
  vec4 texColor = texture(u_texture, texCoord);

  if (texColor.a < 0.01) discard; // Skip fully transparent fragments

  outColor = texColor;
}
`;this.program=wt(this.gl,t,s),this.uProjection=this.gl.getUniformLocation(this.program,"u_projection"),this.uView=this.gl.getUniformLocation(this.program,"u_view"),this.uModel=this.gl.getUniformLocation(this.program,"u_model"),this.uTileUV=this.gl.getUniformLocation(this.program,"u_tileUV"),this.uTiling=this.gl.getUniformLocation(this.program,"u_tiling"),this.uTexture=this.gl.getUniformLocation(this.program,"u_texture"),this.aPos=this.gl.getAttribLocation(this.program,"a_position"),this.aUV=this.gl.getAttribLocation(this.program,"a_texcoord")}setupLineProgram(){const t=`#version 300 es
    in vec3 a_position;
    uniform mat4 u_projection;
    uniform mat4 u_view;
    uniform mat4 u_model;
    void main() {
    gl_Position = u_projection * u_view * u_model * vec4(a_position, 1.0);
    }`,s=`#version 300 es
    precision mediump float;
    out vec4 outColor;
    void main() {
    outColor = vec4(1, 1, 1, 1);
    }`;this.lineProgram=wt(this.gl,t,s),this.lineProj=this.gl.getUniformLocation(this.lineProgram,"u_projection"),this.lineView=this.gl.getUniformLocation(this.lineProgram,"u_view"),this.lineModel=this.gl.getUniformLocation(this.lineProgram,"u_model"),this.linePos=this.gl.getAttribLocation(this.lineProgram,"a_position")}setupSpriteGeometry(){const t=this.gl;t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.depthMask(!0);const s=new Float32Array([-.5,0,0,1,.5,0,1,1,.5,1,1,0,-.5,1,0,0]),e=new Uint16Array([0,1,2,0,2,3]);this.quadVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.quadVao);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,16,8),this.gl.enableVertexAttribArray(this.aUV);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,this.gl.STATIC_DRAW)}setupField(){const t=this.gl,{vertices:s,indices:e}=rs(hs,Et,64,16);this.fieldVao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.fieldVao);const n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPos,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(this.aPos),this.gl.vertexAttribPointer(this.aUV,2,this.gl.FLOAT,!1,20,12),this.gl.enableVertexAttribArray(this.aUV);const o=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.fieldIndices=e.length,this.fieldLineMesh=as(),this.lineVao=t.createVertexArray(),t.bindVertexArray(this.lineVao);const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,this.fieldLineMesh.vertices,t.STATIC_DRAW);const r=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.fieldLineMesh.indices,t.STATIC_DRAW),t.vertexAttribPointer(this.linePos,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(this.linePos)}setupGoalposts(){this.goalPostPositions=[[-9,0,Q],[-3,0,Q],[3,0,Q],[9,0,Q],[-9,0,0],[-3,0,0],[3,0,0],[9,0,0]]}setupCamera(){this.projection=C(),Ot(this.projection,Math.PI/4,this.canvas.width/this.canvas.height,.1,1e3),this.view=C(),this.model=C()}renderSprite(t,s,e,n,o){const{gl:a,program:r,quadVao:h,uModel:c,uTileUV:u,sheetCols:d,sheetRows:f}=this;a.useProgram(r),a.bindVertexArray(h);const l=C();Z(l,l,t),it(l,l,[s,e,1]),a.uniformMatrix4fv(c,!1,l),this.setTileUV(n,o),a.uniform1i(this.uTiling,!1),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}setTileUV(t,s){const e=(t*At+lt/2)/Pt,n=(s*Rt+ct/2)/kt,o=(t*At+lt/2+Lt)/Pt,a=(s*Rt+ct/2+_t)/kt;this.gl.uniform4f(this.uTileUV,e,n,o,a)}renderScene(t,s){const e=this.gl;e.viewport(0,0,this.canvas.width,this.canvas.height),e.clearColor(.2,.6,.2,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const n=P(0,10,15),o=v();N(o,t.cameraTarget,n);const a=P(0,0,-20),r=v();N(r,t.cameraTarget,a),Ct(this.view,o,r,[0,1,0]),e.useProgram(this.program),e.uniformMatrix4fv(this.uProjection,!1,this.projection),e.uniformMatrix4fv(this.uView,!1,this.view),e.activeTexture(e.TEXTURE0),e.uniform1i(this.uTexture,0),e.bindVertexArray(this.fieldVao),xt(this.model),Z(this.model,this.model,[0,0,Et]),e.uniformMatrix4fv(this.uModel,!1,this.model),this.setTileUV(0,2),e.uniform1i(this.uTiling,!0),e.drawElements(e.TRIANGLES,this.fieldIndices,e.UNSIGNED_SHORT,0),e.useProgram(this.lineProgram),e.uniformMatrix4fv(this.lineProj,!1,this.projection),e.uniformMatrix4fv(this.lineView,!1,this.view);const u=C();Z(u,this.model,[0,.001,0]),e.uniformMatrix4fv(this.lineModel,!1,u),e.bindVertexArray(this.lineVao),e.drawElements(e.TRIANGLES,this.fieldLineMesh.indices.length,e.UNSIGNED_SHORT,0),e.useProgram(this.program),e.bindVertexArray(this.quadVao),this.setTileUV(1,2),e.uniform1i(this.uTiling,!0);for(let l=0;l<this.goalPostPositions.length;l++){const[p,m,g]=this.goalPostPositions[l],y=l%4===0||l%4===3?6:10,M=o[0]-p,R=o[2]-g,S=Math.sqrt(M*M+R*R),B=S>50?1.5:S>150?2:1,F=C();Z(F,F,[p,m,g]),it(F,F,[B,y,1]),e.uniformMatrix4fv(this.uModel,!1,F),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}e.bindVertexArray(this.quadVao);for(const l of s)l instanceof ut?l.render(this):this.renderSprite(l.pos,l.width,l.height,1,0);t.aimTarget.render(this)}}var X,Bt,It,Dt;class cs{constructor(t){mt(this,X);this.state={moveX:0,moveZ:0,kickPressed:!1,kickReleased:!1,kickHeldTime:0,aimTarget:null},this.keys={},this.lastKeys={},this.touchMove=null,this.touchAim=null,this.kPressTime=0,t.addEventListener("touchstart",st(this,X,Bt).bind(this),{passive:!1}),t.addEventListener("touchmove",st(this,X,It).bind(this),{passive:!1}),t.addEventListener("touchend",st(this,X,Dt).bind(this)),window.addEventListener("keydown",s=>this.keys[s.key.toLowerCase()]=!0),window.addEventListener("keyup",s=>this.keys[s.key.toLowerCase()]=!1)}endUpdate(){this.state.moveX=0,this.state.moveZ=0,this.state.kickPressed=!1,this.state.kickReleased=!1}update(t){var o;const s=!!this.keys.k,e=!!this.lastKeys.k;if(s&&!e&&(this.state.kickPressed=!0,this.kPressTime=0,this.state.aimTarget=[0,0]),s?(this.kPressTime+=t,this.state.aimTarget&&(this.keys.a&&(this.state.aimTarget[0]-=30*t),this.keys.d&&(this.state.aimTarget[0]+=30*t),this.keys.w&&(this.state.aimTarget[1]-=30*t),this.keys.s&&(this.state.aimTarget[1]+=30*t))):(this.keys.a&&(this.state.moveX-=1),this.keys.d&&(this.state.moveX+=1),this.keys.w&&(this.state.moveZ-=1),this.keys.s&&(this.state.moveZ+=1)),!s&&e&&(this.state.kickReleased=!0),this.state.kickHeldTime=this.kPressTime,this.touchMove&&!this.touchAim&&(this.state.moveX=this.touchMove.dx/50,this.state.moveZ=this.touchMove.dy/50),this.touchAim){this.kPressTime+=t;const a=this.touchAim.dx,r=this.touchAim.dy,h=10;this.state.aimTarget=[-a/h,-r/h],this.state.kickHeldTime=this.kPressTime}const n=(o=navigator.getGamepads)==null?void 0:o.call(navigator)[0];if(n){this.state.moveX+=n.axes[0]||0,this.state.moveZ+=-(n.axes[1]||0);const a=n.axes[2]||0,r=-(n.axes[3]||0),h=Math.hypot(a,r);h>.2&&(this.state.aimTarget=[a/h,r/h])}this.lastKeys={...this.keys}}getState(){return this.state}}X=new WeakSet,Bt=function(t){t.preventDefault();for(const s of t.changedTouches)s.clientX<window.innerWidth/2?this.touchMove={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0}:(this.touchAim={id:s.identifier,startX:s.clientX,startY:s.clientY,dx:0,dy:0},this.state.kickPressed=!0,this.kPressTime=0)},It=function(t){t.preventDefault();for(const s of t.changedTouches)this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove.dx=s.clientX-this.touchMove.startX,this.touchMove.dy=s.clientY-this.touchMove.startY),this.touchAim&&s.identifier===this.touchAim.id&&(this.touchAim.dx=s.clientX-this.touchAim.startX,this.touchAim.dy=s.clientY-this.touchAim.startY)},Dt=function(t){t.preventDefault();for(const s of t.changedTouches)this.touchAim&&s.identifier===this.touchAim.id&&(this.touchAim=null,this.state.kickReleased=!0),this.touchMove&&s.identifier===this.touchMove.id&&(this.touchMove=null)};class us{constructor(t,s){if(this.canvas=t,this.gl=t.getContext("webgl2"),!this.gl)throw new Error("WebGL2 not supported");this.renderer=new ls(this.gl,t,s),this.controls=new cs(t),this.setPiece=null,this.entities=[],this.aimTarget=new ns([5,.001,b/2]),this.ball=new es(P(0,0,b/2)),this.entities.push(this.ball),this.players=[],this.chasers=0,this.followers=0,this.homePositions=Mt(),this.awayPositions=Mt(!0);const e=[[this.homePositions,"home"],[this.awayPositions,"away"]];for(let[n,o]of e)for(const[a,r]of Object.entries(n)){const h=new is(a,o,r,!a.toLowerCase().startsWith("bench"));this.entities.push(h),this.players.push(h),a==="RR"&&o==="home"&&(this.player=h)}this.closestPlayers={home:null,away:null},this.cameraTarget=P(0,10,b/2),this.cameraPos=P(0,10,b/2+15),this.resize(),window.addEventListener("resize",()=>this.resize()),this.lastTime=performance.now()}start(){this.lastTime=performance.now(),requestAnimationFrame(this.loop.bind(this))}loop(t){var o,a;const s=(t-this.lastTime)/1e3,e=Math.min(s,1/30);this.lastTime=t,this.updateClosestPlayers(),this.controls.update(e),this.chasers=0,this.followers=0;const n=x(this.ball.pos);for(const r of this.entities)r.update(e,this);if(this.setPiece&&(this.setPiece.update(e),this.setPiece.finished&&(this.setPiece=null)),!this.setPiece){let r=Qt(n,this.ball.pos);if(r!==null){if(r==="goalAway"&&(this.ball.lastTouchedType!=="kick"||((o=this.ball.lastTouchedBy)==null?void 0:o.team)==="home")?r="behindAway":r==="goalHome"&&(this.ball.lastTouchedType!=="kick"||((a=this.ball.lastTouchedBy)==null?void 0:a.team)==="away")?r="behindHome":r==="innerLeftPostAway"||r==="innerRightPostAway"?r="behindAway":(r==="innerLeftPostHome"||r==="innerRightPostHome")&&(r="behindHome"),r==="behindAway"){const h=this.players.find(c=>c.name==="FB"&&c.team==="home");h&&(this.setPiece=new ot(this,h,P(0,0,b-10)))}if(r==="behindHome"){const h=this.players.find(c=>c.name==="FB"&&c.team==="away");h&&(this.setPiece=new ot(this,h,P(0,0,10)))}if(r==="goalAway"||r==="goalHome"||r==="outOfBounds")for(const h of this.entities)h.setupForBoundary(r,this.ball.pos)}}this.updateCameraTarget(),this.updatePlayerControl(),this.renderer.renderScene(this,this.entities),this.controls.endUpdate(),requestAnimationFrame(this.loop.bind(this))}updateClosestPlayers(){const t=this.ball,s={home:1/0,away:1/0},e={home:null,away:null};for(let n of this.players){const o=D(n.pos,t.pos);o<s[n.team]&&(s[n.team]=o,e[n.team]=n)}this.closestPlayers=e}updatePlayerControl(){const t=this.players.filter(o=>o.team==="home"),s=this.ball.carrier;if(!s||s&&s.team==="home")return;let e=null,n=1/0;for(const o of t){if(o.actionState==="tackle")continue;const a=Nt(o.pos,s.pos),r=(Math.abs(o.positionPos[0]-this.ball.pos[0])<10?-10:0)+(o.energy<.3?-5:0)+(o.pos[2]>s.pos[2]?-10:0);a+r<n&&(e=o,n=a+r)}e&&(this.player=e,this.player.aiming=!1)}updateCameraTarget(){const t=this.ball,s=t.carrier,e=s?(s.team==="home",x(s.pos)):x(t.pos);let n=s&&s.team==="home"?0:Math.max(40-e[2],15),o=-.2*e[0];N(e,e,[o,0,n]);const a=D(this.cameraTarget,e),r=Math.max(1/(1+3*a),.05);et(this.cameraTarget,this.cameraTarget,e,r)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.renderer.setupCamera()}}const fs="/footy/assets/spritesheet-erFZxRaO.png";function ds(i){const t=document.getElementById("glcanvas");if(!t)throw console.error("Canvas element not found"),new Error("Canvas element not found");new us(t,i).start()}os(fs).then(i=>{if(!i.complete)throw console.error("Failed to load sprite sheet"),new Error("Sprite sheet not loaded");ds(i)});
