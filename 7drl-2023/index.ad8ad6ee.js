function e(e,t,o,n){Object.defineProperty(e,t,{get:o,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},n={},r=t.parcelRequire550f;let i;var s;let a;var l;null==r&&((r=function(e){if(e in o)return o[e].exports;if(e in n){var t=n[e];delete n[e];var r={id:e,exports:{}};return o[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequire550f=r),r.register("27Lyk",(function(t,o){var n,r;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>r),(e=>r=e));var i={};n=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++)i[t[o]]=e[t[o]]},r=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r.register("cmoHh",(function(e,t){!function(e,t,o){function n(e){var t=this,o=function(){var e=4022871197,t=function(t){t=String(t);for(var o=0;o<t.length;o++){var n=.02519603282416938*(e+=t.charCodeAt(o));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=o(" "),t.s1=o(" "),t.s2=o(" "),t.s0-=o(e),t.s0<0&&(t.s0+=1),t.s1-=o(e),t.s1<0&&(t.s1+=1),t.s2-=o(e),t.s2<0&&(t.s2+=1),o=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var o=new n(e),i=t&&t.state,s=o.next;return s.int32=function(){return 4294967296*o.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.alea=i}(0,e,"function"==typeof define&&define)})),r.register("euRi5",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xor128=i}(0,e,"function"==typeof define&&define)})),r.register("hDsEw",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:o+=e;for(var n=0;n<o.length+64;n++)t.x^=0|o.charCodeAt(n),n==o.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xorwow=i}(0,e,"function"==typeof define&&define)})),r.register("3J2Zm",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.x,r=t.i;return e=n[r],o=(e^=e>>>7)^e<<24,o^=(e=n[r+1&7])^e>>>10,o^=(e=n[r+3&7])^e>>>3,o^=(e=n[r+4&7])^e<<7,e=n[r+7&7],o^=(e^=e<<13)^e<<9,n[r]=o,t.i=r+1&7,o},function(e,t){var o,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,o=0;o<t.length;++o)n[7&o]=n[7&o]<<15^t.charCodeAt(o)+n[o+1&7]<<13;for(;n.length<8;)n.push(0);for(o=0;o<8&&0===n[o];++o);for(8==o?n[7]=-1:n[o],e.x=n,e.i=0,o=256;o>0;--o)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&(i.x&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xorshift7=i}(0,e,"function"==typeof define&&define)})),r.register("6Px8M",(function(e,t){!function(e,t,o){function n(e){var t=this;t.next=function(){var e,o,n=t.w,r=t.X,i=t.i;return t.w=n=n+1640531527|0,o=r[i+34&127],e=r[i=i+1&127],o^=o<<13,e^=e<<17,o^=o>>>15,e^=e>>>12,o=r[i]=o^e,t.i=i,o+(n^n>>>16)|0},function(e,t){var o,n,r,i,s,a=[],l=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,l=Math.max(l,t.length)),r=0,i=-32;i<l;++i)t&&(n^=t.charCodeAt((i+32)%t.length)),0===i&&(s=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,i>=0&&(s=s+1640531527|0,r=0==(o=a[127&i]^=n+s)?r+1:0);for(r>=128&&(a[127&(t&&t.length||0)]=-1),r=127,i=512;i>0;--i)n=a[r+34&127],o=a[r=r+1&127],n^=n<<13,o^=o<<17,n^=n>>>15,o^=o>>>12,a[r]=n^o;e.w=s,e.X=a,e.i=r}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&(i.X&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.xor4096=i}(0,e,"function"==typeof define&&define)})),r.register("lDm0S",(function(e,t){!function(e,t,o){function n(e){var t=this,o="";t.next=function(){var e=t.b,o=t.c,n=t.d,r=t.a;return e=e<<25^e>>>7^o,o=o-n|0,n=n<<24^n>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^o,t.c=o=o-n|0,t.d=n<<16^o>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):o+=e;for(var n=0;n<o.length+20;n++)t.b^=0|o.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var o=new n(e),i=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/2097152}while(0===e);return e},s.int32=o.next,s.quick=s,i&&("object"==typeof i&&r(i,o),s.state=function(){return r(o,{})}),s}t&&t.exports?t.exports=i:o&&o.amd?o((function(){return i})):this.tychei=i}(0,e,"function"==typeof define&&define)})),r.register("kjyEk",(function(e,t){})),r.register("bgyNt",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9NYDb"),import.meta.url).toString()})),r.register("coakI",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hUD0w"),import.meta.url).toString()})),r.register("7XfMr",(function(e,t){e.exports=new URL(r("27Lyk").resolve("eV2HF"),import.meta.url).toString()})),r.register("5jIXu",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ihcZV"),import.meta.url).toString()})),r.register("h61MQ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("l7al6"),import.meta.url).toString()})),r.register("1OFiM",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4m20I"),import.meta.url).toString()})),r.register("hadbD",(function(e,t){e.exports=new URL(r("27Lyk").resolve("l8Gs4"),import.meta.url).toString()})),r.register("dH5ka",(function(e,t){e.exports=new URL(r("27Lyk").resolve("91j7m"),import.meta.url).toString()})),r.register("3twvr",(function(e,t){e.exports=new URL(r("27Lyk").resolve("dyBrj"),import.meta.url).toString()})),r.register("bBbdi",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kO5BQ"),import.meta.url).toString()})),r.register("kBrAM",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9stv3"),import.meta.url).toString()})),r.register("k6Tdk",(function(e,t){e.exports=new URL(r("27Lyk").resolve("iFwHo"),import.meta.url).toString()})),r.register("vDQ5G",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cUkcS"),import.meta.url).toString()})),r.register("7DVvx",(function(e,t){e.exports=new URL(r("27Lyk").resolve("3WoZq"),import.meta.url).toString()})),r.register("al4v1",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4CRTl"),import.meta.url).toString()})),r.register("fO2Fk",(function(e,t){e.exports=new URL(r("27Lyk").resolve("byhsW"),import.meta.url).toString()})),r.register("kaxMC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9W38z"),import.meta.url).toString()})),r.register("iCU64",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fWY3x"),import.meta.url).toString()})),r.register("a3sPN",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6j9tB"),import.meta.url).toString()})),r.register("9Y9d3",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1TSGW"),import.meta.url).toString()})),r.register("a8Yhh",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8v9j2"),import.meta.url).toString()})),r.register("9KHDZ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hOjVZ"),import.meta.url).toString()})),r.register("iwg1C",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jFGIJ"),import.meta.url).toString()})),r.register("1Pqyv",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5ai1g"),import.meta.url).toString()})),r.register("dbi61",(function(e,t){e.exports=new URL(r("27Lyk").resolve("b3C1o"),import.meta.url).toString()})),r.register("eqZ24",(function(e,t){e.exports=new URL(r("27Lyk").resolve("7FWcs"),import.meta.url).toString()})),r.register("hrr2C",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hOt44"),import.meta.url).toString()})),r.register("4rxiD",(function(e,t){e.exports=new URL(r("27Lyk").resolve("f45SA"),import.meta.url).toString()})),r.register("hDCXU",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1UvuD"),import.meta.url).toString()})),r.register("csjYK",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8tAju"),import.meta.url).toString()})),r.register("dd6E3",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kJVav"),import.meta.url).toString()})),r.register("6caUR",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gUmDt"),import.meta.url).toString()})),r.register("1EZIJ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ai0xS"),import.meta.url).toString()})),r.register("fUa8r",(function(e,t){e.exports=new URL(r("27Lyk").resolve("7vJ1a"),import.meta.url).toString()})),r.register("lJQp1",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fMNzP"),import.meta.url).toString()})),r.register("5GWta",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4nSoG"),import.meta.url).toString()})),r.register("7EXkE",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6IxTn"),import.meta.url).toString()})),r.register("1XbhS",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2SdXU"),import.meta.url).toString()})),r.register("8Ar5m",(function(e,t){e.exports=new URL(r("27Lyk").resolve("aAHiU"),import.meta.url).toString()})),r.register("dxxly",(function(e,t){e.exports=new URL(r("27Lyk").resolve("eotfB"),import.meta.url).toString()})),r.register("i5lIC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8DaNu"),import.meta.url).toString()})),r.register("03tgW",(function(e,t){e.exports=new URL(r("27Lyk").resolve("dWaUc"),import.meta.url).toString()})),r.register("1O5GN",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hkItR"),import.meta.url).toString()})),r.register("kflbA",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9gBvk"),import.meta.url).toString()})),r.register("kZcYE",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kEOFa"),import.meta.url).toString()})),r.register("coJ2V",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1hhKs"),import.meta.url).toString()})),r.register("j6GfU",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fkEIT"),import.meta.url).toString()})),r.register("6pCtM",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8EfVr"),import.meta.url).toString()})),r.register("3gtmZ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("iJeZh"),import.meta.url).toString()})),r.register("ieFNs",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cXI9T"),import.meta.url).toString()})),r.register("aSCaY",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ktzGI"),import.meta.url).toString()})),r.register("eiW2b",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fr6SK"),import.meta.url).toString()})),r.register("6x7Kh",(function(e,t){e.exports=new URL(r("27Lyk").resolve("dGACl"),import.meta.url).toString()})),r.register("bMjEO",(function(e,t){e.exports=new URL(r("27Lyk").resolve("13ZtD"),import.meta.url).toString()})),r.register("3mayG",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cIW1u"),import.meta.url).toString()})),r.register("blCN3",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8VThJ"),import.meta.url).toString()})),r.register("bGiLK",(function(e,t){e.exports=new URL(r("27Lyk").resolve("liehg"),import.meta.url).toString()})),r.register("bjubH",(function(e,t){e.exports=new URL(r("27Lyk").resolve("d1w1I"),import.meta.url).toString()})),r.register("4PUSb",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1szZs"),import.meta.url).toString()})),r.register("1N1FC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("3PKoN"),import.meta.url).toString()})),r.register("ktUCQ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("WdFUc"),import.meta.url).toString()})),r.register("9xpZV",(function(e,t){e.exports=new URL(r("27Lyk").resolve("sXil1"),import.meta.url).toString()})),r.register("8QCS3",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kkp8R"),import.meta.url).toString()})),r.register("a0v0l",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6TnnE"),import.meta.url).toString()})),r.register("1lD69",(function(e,t){e.exports=new URL(r("27Lyk").resolve("lCHyy"),import.meta.url).toString()})),r.register("jfcxP",(function(e,t){e.exports=new URL(r("27Lyk").resolve("f0fy8"),import.meta.url).toString()})),r.register("ilgo9",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9Xw0E"),import.meta.url).toString()})),r.register("92tfF",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4VuBW"),import.meta.url).toString()})),r.register("etshw",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5uHDb"),import.meta.url).toString()})),r.register("5mgz9",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fWL68"),import.meta.url).toString()})),r.register("61v8j",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6pqgc"),import.meta.url).toString()})),r.register("dKL59",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ghROA"),import.meta.url).toString()})),r.register("bnVxc",(function(e,t){e.exports=new URL(r("27Lyk").resolve("dc6kq"),import.meta.url).toString()})),r.register("8YZcm",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8KwSJ"),import.meta.url).toString()})),r.register("rmNTt",(function(e,t){e.exports=new URL(r("27Lyk").resolve("34VHX"),import.meta.url).toString()})),r.register("4xVWY",(function(e,t){e.exports=new URL(r("27Lyk").resolve("giL0r"),import.meta.url).toString()})),r.register("61Svf",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1BovV"),import.meta.url).toString()})),r.register("86i15",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kcwN9"),import.meta.url).toString()})),r.register("eCMLG",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hRKbg"),import.meta.url).toString()})),r.register("hkgAs",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bg5Qh"),import.meta.url).toString()})),r.register("eV2Mu",(function(e,t){e.exports=new URL(r("27Lyk").resolve("89MiG"),import.meta.url).toString()})),r.register("fzoRy",(function(e,t){e.exports=new URL(r("27Lyk").resolve("i8TkL"),import.meta.url).toString()})),r.register("bn9kD",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hzjPW"),import.meta.url).toString()})),r.register("dKFtp",(function(e,t){e.exports=new URL(r("27Lyk").resolve("g7HTD"),import.meta.url).toString()})),r.register("awcka",(function(e,t){e.exports=new URL(r("27Lyk").resolve("3Km1m"),import.meta.url).toString()})),r.register("52i2z",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jKVho"),import.meta.url).toString()})),r.register("iyeOS",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5czfn"),import.meta.url).toString()})),r.register("gb2R8",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9Z4ZM"),import.meta.url).toString()})),r.register("aGgZh",(function(e,t){e.exports=new URL(r("27Lyk").resolve("i3tjk"),import.meta.url).toString()})),r.register("b6tdD",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gMj9u"),import.meta.url).toString()})),r.register("UYsu8",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6eSV6"),import.meta.url).toString()})),r.register("e0y8E",(function(e,t){e.exports=new URL(r("27Lyk").resolve("55qK2"),import.meta.url).toString()})),r.register("6QVDF",(function(e,t){e.exports=new URL(r("27Lyk").resolve("euj2n"),import.meta.url).toString()})),r.register("4q9kg",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gzCTv"),import.meta.url).toString()})),r.register("2zxmO",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hwg1r"),import.meta.url).toString()})),r.register("7rF1E",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jmsQv"),import.meta.url).toString()})),r.register("kQvBC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("lElC3"),import.meta.url).toString()})),r.register("2hpzi",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jO7pQ"),import.meta.url).toString()})),r.register("9gwX6",(function(e,t){e.exports=new URL(r("27Lyk").resolve("h4sXf"),import.meta.url).toString()})),r.register("88Oom",(function(e,t){e.exports=new URL(r("27Lyk").resolve("j5EN0"),import.meta.url).toString()})),r.register("kc3NH",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fKuUC"),import.meta.url).toString()})),r.register("40CPy",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gQzzS"),import.meta.url).toString()})),r.register("lJn7Q",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9Pb6r"),import.meta.url).toString()})),r.register("eBHTR",(function(e,t){e.exports=new URL(r("27Lyk").resolve("34pTr"),import.meta.url).toString()})),r.register("g5A67",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4tfB8"),import.meta.url).toString()})),r.register("kyAEI",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ffewC"),import.meta.url).toString()})),r.register("g7feg",(function(e,t){e.exports=new URL(r("27Lyk").resolve("WoCmp"),import.meta.url).toString()})),r.register("a1Jxk",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cSZLW"),import.meta.url).toString()})),r.register("bKUzC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2mHF8"),import.meta.url).toString()})),r.register("9aXjz",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4csbh"),import.meta.url).toString()})),r.register("hfvuU",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bCRFo"),import.meta.url).toString()})),r.register("4gLkA",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2l7Et"),import.meta.url).toString()})),r.register("3HAUN",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hB3MQ"),import.meta.url).toString()})),r.register("la1r7",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bjYVv"),import.meta.url).toString()})),r.register("9fSJi",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5tGUj"),import.meta.url).toString()})),r.register("k1qbX",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8xtZJ"),import.meta.url).toString()})),r.register("1u6dV",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9CdXT"),import.meta.url).toString()})),r.register("dPu8f",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6DRtk"),import.meta.url).toString()})),r.register("bSHoC",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8UIiY"),import.meta.url).toString()})),r.register("betci",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8ePst"),import.meta.url).toString()})),r.register("7ExfT",(function(e,t){e.exports=new URL(r("27Lyk").resolve("48e5Q"),import.meta.url).toString()})),r.register("9v56M",(function(e,t){e.exports=new URL(r("27Lyk").resolve("7gqfi"),import.meta.url).toString()})),r.register("8pWsQ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("3U15P"),import.meta.url).toString()})),r.register("7bU35",(function(e,t){e.exports=new URL(r("27Lyk").resolve("chOaJ"),import.meta.url).toString()})),r.register("8V6Zl",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fzmcm"),import.meta.url).toString()})),r.register("9OuxM",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9zRXz"),import.meta.url).toString()})),r.register("5UMPc",(function(e,t){e.exports=new URL(r("27Lyk").resolve("7P7XB"),import.meta.url).toString()})),r.register("a1naR",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2eySC"),import.meta.url).toString()})),r.register("k25sm",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hqxOO"),import.meta.url).toString()})),r.register("6s45F",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8cvb7"),import.meta.url).toString()})),r.register("7F9SI",(function(e,t){e.exports=new URL(r("27Lyk").resolve("a79kT"),import.meta.url).toString()})),r.register("epmsQ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2enQg"),import.meta.url).toString()})),r.register("lVOrm",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5UMbD"),import.meta.url).toString()})),r.register("7n2bq",(function(e,t){e.exports=new URL(r("27Lyk").resolve("afhHD"),import.meta.url).toString()})),r.register("lJynn",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bxRQ3"),import.meta.url).toString()})),r.register("aIecx",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5SQZe"),import.meta.url).toString()})),r.register("fg20H",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1WMIZ"),import.meta.url).toString()})),r.register("03Ee8",(function(e,t){e.exports=new URL(r("27Lyk").resolve("eXsF5"),import.meta.url).toString()})),r.register("1kKRF",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4zDjY"),import.meta.url).toString()})),r.register("4czHp",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kB0ew"),import.meta.url).toString()})),r.register("cauwk",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ddrqy"),import.meta.url).toString()})),r.register("csGZP",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cZmgQ"),import.meta.url).toString()})),r.register("2tRKJ",(function(e,t){e.exports=new URL(r("27Lyk").resolve("5fEeM"),import.meta.url).toString()})),r.register("e5O0h",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kZHdL"),import.meta.url).toString()})),r.register("ivwRf",(function(e,t){e.exports=new URL(r("27Lyk").resolve("61M6l"),import.meta.url).toString()})),r.register("5Natg",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bigld"),import.meta.url).toString()})),r.register("iXIzY",(function(e,t){e.exports=new URL(r("27Lyk").resolve("hINbf"),import.meta.url).toString()})),r.register("ejeiL",(function(e,t){e.exports=new URL(r("27Lyk").resolve("fNm19"),import.meta.url).toString()})),r.register("hf2wD",(function(e,t){e.exports=new URL(r("27Lyk").resolve("ddLjp"),import.meta.url).toString()})),r.register("7BUuc",(function(e,t){e.exports=new URL(r("27Lyk").resolve("eTl1g"),import.meta.url).toString()})),r.register("oQK7X",(function(e,t){e.exports=new URL(r("27Lyk").resolve("kL55A"),import.meta.url).toString()})),r.register("l7rpd",(function(e,t){e.exports=new URL(r("27Lyk").resolve("j79x4"),import.meta.url).toString()})),r.register("hcAf3",(function(e,t){e.exports=new URL(r("27Lyk").resolve("iIyoY"),import.meta.url).toString()})),r.register("jbg5i",(function(e,t){e.exports=new URL(r("27Lyk").resolve("bZzGK"),import.meta.url).toString()})),r.register("2pk3Y",(function(e,t){e.exports=new URL(r("27Lyk").resolve("2ZnEG"),import.meta.url).toString()})),r.register("9pZ1x",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jyEhS"),import.meta.url).toString()})),r.register("j09Wg",(function(e,t){e.exports=new URL(r("27Lyk").resolve("aOW8M"),import.meta.url).toString()})),r.register("5jj80",(function(e,t){e.exports=new URL(r("27Lyk").resolve("chvcz"),import.meta.url).toString()})),r.register("5tRTq",(function(e,t){e.exports=new URL(r("27Lyk").resolve("3rxao"),import.meta.url).toString()})),r.register("1BHLT",(function(e,t){e.exports=new URL(r("27Lyk").resolve("4z70Y"),import.meta.url).toString()})),r.register("9QAiO",(function(e,t){e.exports=new URL(r("27Lyk").resolve("8EoUa"),import.meta.url).toString()})),r.register("frozH",(function(e,t){e.exports=new URL(r("27Lyk").resolve("iorHj"),import.meta.url).toString()})),r.register("5xAy0",(function(e,t){e.exports=new URL(r("27Lyk").resolve("c0kPk"),import.meta.url).toString()})),r.register("leoYP",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cbXrG"),import.meta.url).toString()})),r.register("4YbOi",(function(e,t){e.exports=new URL(r("27Lyk").resolve("1nodj"),import.meta.url).toString()})),r.register("YKAZv",(function(e,t){e.exports=new URL(r("27Lyk").resolve("jDUg7"),import.meta.url).toString()})),r.register("81dli",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gphqW"),import.meta.url).toString()})),r.register("gfMsn",(function(e,t){e.exports=new URL(r("27Lyk").resolve("47Pvr"),import.meta.url).toString()})),r.register("d0uyI",(function(e,t){e.exports=new URL(r("27Lyk").resolve("6cbLY"),import.meta.url).toString()})),r.register("63paY",(function(e,t){e.exports=new URL(r("27Lyk").resolve("cicW2"),import.meta.url).toString()})),r.register("c2ocL",(function(e,t){e.exports=new URL(r("27Lyk").resolve("60W0c"),import.meta.url).toString()})),r.register("it1tO",(function(e,t){e.exports=new URL(r("27Lyk").resolve("chz1H"),import.meta.url).toString()})),r.register("3bDSd",(function(e,t){e.exports=new URL(r("27Lyk").resolve("9p3gA"),import.meta.url).toString()})),r.register("F1F1Y",(function(e,t){e.exports=new URL(r("27Lyk").resolve("gHO7r"),import.meta.url).toString()})),r("27Lyk").register(JSON.parse('{"17fSe":"index.ad8ad6ee.js","k57aN":"tiles34.9ed4eaf2.png","dwPvt":"tiles31color.10371916.png","7FSnQ":"tiles-sincity.0e9634a5.png","8dSx0":"tiles.60aa3fc2.png","kDrfW":"font.84b63647.png","8Qic0":"Minstrel_Dance.84f0fe17.mp3","dci1D":"level-requirement-1.39784509.ogg","6wmQa":"level-requirement-2.b939d53b.ogg","8AE6h":"lose-game-over.b2ac6941.ogg","25Nym":"Minstrel Dance Easter Egg.4ef0b0e0.ogg","9HrbR":"footstep-wood.8da8b302.ogg","2fyQO":"footstep-tile.ed285432.ogg","4qSI0":"footstep-water.41ed0f5b.ogg","3kwMs":"footstep-gravel.2ecfc65f.ogg","3zakP":"footstep-grass.46fcb678.ogg","9NYDb":"creak.6ed6b7c0.ogg","hUD0w":"creak-2.51d77164.ogg","eV2HF":"creak-3.609207b9.ogg","ihcZV":"creak-4.e35a5bbd.ogg","l7al6":"creak-5.8517ccd2.ogg","4m20I":"creak-6.58298378.ogg","l8Gs4":"squeak1.463f9d1d.wav","91j7m":"squeak2.be5c76a8.wav","dyBrj":"squeak3.f084da55.wav","kO5BQ":"squeak4.f2ef2e0b.wav","9stv3":"hit16.mp3.12db2307.flac","iFwHo":"hit17.mp3.f1f9a130.flac","cUkcS":"hit18.mp3.9e7af88b.flac","3WoZq":"hit19.mp3.d775e463.flac","4CRTl":"hit20.mp3.3b3594b6.flac","byhsW":"hit26.mp3.ad2a87c8.flac","9W38z":"hit27.mp3.68a7736d.flac","fWY3x":"coin.170ad949.ogg","6j9tB":"coin-2.b467d436.ogg","1TSGW":"coin-3.58153793.ogg","8v9j2":"coin-4.886754a5.ogg","hOjVZ":"coin-5.375e9b45.ogg","jFGIJ":"grunt.440fd33a.ogg","5ai1g":"grunt-2.6fdc417c.ogg","b3C1o":"grunt-3.299a3c22.ogg","7FWcs":"grunt-4.020ded7b.ogg","hOt44":"grunt-5.c3fea198.ogg","f45SA":"grunt-6.7d726e95.ogg","1UvuD":"grunt-7.02fa8fe7.ogg","8tAju":"grunt-8.7d07bcdc.ogg","kJVav":"douse.a3117baa.ogg","gUmDt":"douse-2.2d25a8a8.ogg","ai0xS":"douse-3.1e4cd73e.ogg","7vJ1a":"douse-4.a6536fd1.ogg","fMNzP":"ignite.9818780f.ogg","4nSoG":"ignite-2.387c9bec.ogg","6IxTn":"hide.26176e09.ogg","2SdXU":"hide-2.f2c8ae68.ogg","aAHiU":"hide-3.8cf81bab.ogg","eotfB":"hide-4.3307df43.ogg","8DaNu":"hide-5.7194a497.ogg","dWaUc":"hide-6.49774ab8.ogg","hkItR":"gate.7e7f149d.ogg","9gBvk":"gate-2.b3a922fe.ogg","kEOFa":"gate-3.004873c2.ogg","1hhKs":"gate-4.5bd276fa.ogg","fkEIT":"gate-5.d2bcb9c0.ogg","8EfVr":"jump.34cb69b6.ogg","iJeZh":"jump-2.cef4eaf3.ogg","cXI9T":"too high.cc6083c4.ogg","ktzGI":"too high-2.99be3f88.ogg","fr6SK":"Hmm.a0e363c7.ogg","dGACl":"What.549fabf2.ogg","13ZtD":"hey.10b98cf2.ogg","cIW1u":"hey-2.a9ba6219.ogg","8VThJ":"hey-3.3365a423.ogg","liehg":"what was that.f3d81617.ogg","d1w1I":"what was that-2.5515a177.ogg","1szZs":"what was that-3.9e14b250.ogg","3PKoN":"what was that-4.678dc972.ogg","WdFUc":"what was that-5.e7b8266a.ogg","sXil1":"who goes there.ead61472.ogg","kkp8R":"huh.7a58fb7d.ogg","6TnnE":"wha.d4235147.ogg","lCHyy":"wait.f4e191a2.ogg","f0fy8":"who there.abd0dee5.ogg","9Xw0E":"what moved.3c40560d.ogg","4VuBW":"what in the shadows.40c735a3.ogg","5uHDb":"shadow move.a2c88b02.ogg","fWL68":"see something.677713e2.ogg","6pqgc":"hello.eae0a324.ogg","ghROA":"ugh.4874153e.ogg","dc6kq":"quiet out.fa80e9ae.ogg","8KwSJ":"jumpy.81de2330.ogg","34VHX":"jumpin shadows.ac194b09.ogg","giL0r":"ahh.dddfe597.ogg","1BovV":"aww.a6262cc6.ogg","kcwN9":"rest me bones.6274670b.ogg","hRKbg":"oh well.3085e1fe.ogg","bg5Qh":"case of the jitters.fe109193.ogg","89MiG":"must be seeing.78ec84d9.ogg","i8TkL":"what in my coffee.cf16ea27.ogg","hzjPW":"coffee too strong.f02d4f6c.ogg","g7HTD":"hmm nothing.3c124d8c.ogg","3Km1m":"well I though I saw.7cb198a1.ogg","jKVho":"nothing.b8e61268.ogg","5czfn":"hopefully nothing.77efcff0.ogg","9Z4ZM":"seeing things.19798c48.ogg","i3tjk":"what-2.fbc8ba78.ogg","gMj9u":"hark.5ec1a7bb.ogg","6eSV6":"noise.930a57f5.ogg","55qK2":"heard something.784922cf.ogg","euj2n":"cant hear now.48b15b04.ogg","gzCTv":"hearing things.cbc64512.ogg","hwg1r":"noise again.8c4664ac.ogg","jmsQv":"someone there.e3a76bb1.ogg","lElC3":"who could that be.131bf65c.ogg","jO7pQ":"there it is again.9303b090.ogg","h4sXf":"better check it out.cb052215.ogg","j5EN0":"what keeps making those noises.a26ac1c4.ogg","fKuUC":"better be rats.c9318ac2.ogg","gQzzS":"again.9ec4ebd1.ogg","9Pb6r":"who that.4ba81dd0.ogg","34pTr":"come out come out.cfe1d81f.ogg","4tfB8":"guess nothing.26a3c63a.ogg","ffewC":"wonder it was.897f60c6.ogg","WoCmp":"back to post.0e4777e5.ogg","cSZLW":"quiet now.cf928542.ogg","2mHF8":"sure I heard something.d2a04400.ogg","4csbh":"not there anymore.61604bd9.ogg","bCRFo":"probably nothing.c7b5432d.ogg","2l7Et":"i dont know why i work here.566fdc13.ogg","hB3MQ":"waste of my time.273c9664.ogg","bjYVv":"why do I even try.a1904d65.ogg","5tGUj":"at least Im not on cleaning duty.bac1d40d.ogg","8xtZJ":"at least my shift ends soon.8c9c8d6d.ogg","9CdXT":"what do you want me to do about it.24a7b892.ogg","6DRtk":"whistle.85b036cd.ogg","8UIiY":"whistle-2.9b52b81a.ogg","8ePst":"whistle-3.e678d724.ogg","48e5Q":"where.513303e2.ogg","7gqfi":"coming.0db6eacf.ogg","3U15P":"here I come.8e660313.ogg","chOaJ":"to arms.ba4bc057.ogg","fzmcm":"what is it.80257b01.ogg","9zRXz":"i dont know how to whistle.e9ec0115.ogg","7P7XB":"get em.edc2d976.ogg","2eySC":"intruder.a7aa4991.ogg","hqxOO":"oh no its a thief.0db31f45.ogg","8cvb7":"we coming for you.ea62e8ec.ogg","a79kT":"coming for you.e214e5a5.ogg","2enQg":"halt.7b57590f.ogg","5UMbD":"see you.ac65caac.ogg","afhHD":"ill get you.1a03a032.ogg","bxRQ3":"a goner.0793b8c7.ogg","5SQZe":"just you wait.bcde3f99.ogg","1WMIZ":"you wont get away.f541ecc2.ogg","eXsF5":"no you dont.1fbf4625.ogg","4zDjY":"thief.33e0e9ad.ogg","kB0ew":"thief-2.d71679cb.ogg","ddrqy":"thief-3.293bb3f5.ogg","cZmgQ":"after them.c229ff9e.ogg","5fEeM":"what is thy business.33cb8e3d.ogg","kZHdL":"no mercy for the wicked.81a4069a.ogg","61M6l":"lost em.62322dce.ogg","bigld":"must have run.3b25a46a.ogg","hINbf":"where they go.634f6c4f.ogg","fNm19":"his holiness.8b071d33.ogg","ddLjp":"the boss.e15618d8.ogg","eTl1g":"huff puff give up.8624d048.ogg","kL55A":"where did he go.0feeb619.ogg","j79x4":"drats lost him.631f0017.ogg","iIyoY":"gone.94ae2668.ogg","bZzGK":"come back here.3af41230.ogg","2ZnEG":"rotten scoundrel.8a8a8570.ogg","jyEhS":"aargh.3186d290.ogg","aOW8M":"not coming back.dc8d0bdc.ogg","chvcz":"blast.2bad5953.ogg","3rxao":"dont come back.c6c2c256.ogg","4z70Y":"wont get away next time.9e907e0d.ogg","8EoUa":"for his holiness.51e6a34a.ogg","iorHj":"lousy day at work.d57a4be4.ogg","c0kPk":"i give up.b4d10a67.ogg","cbXrG":"what do i do help me.93f094d3.ogg","1nodj":"oh no he got away.8670e4de.ogg","jDUg7":"guard rant.2cb497ab.ogg","gphqW":"take that.e3a4ad48.ogg","47Pvr":"oof.d3084404.ogg","6cbLY":"uh.4c760b2d.ogg","cicW2":"ah.e48c7264.ogg","60W0c":"ah-2.05b2b996.ogg","chz1H":"ha ya.fd752710.ogg","9p3gA":"ha ya-2.00281ec3.ogg","gHO7r":"ha ya-3.327cfb61.ogg"}')),(s=i||(i={})).create=function(){return[0,0]},s.clone=function(e){return[e[0],e[1]]},s.fromValues=function(e,t){return[e,t]},s.copy=function(e,t){e[0]=t[0],e[1]=t[1]},s.set=function(e,t,o){e[0]=t,e[1]=o},s.add=function(e,t,o){e[0]=t[0]+o[0],e[1]=t[1]+o[1]},s.subtract=function(e,t,o){e[0]=t[0]-o[0],e[1]=t[1]-o[1]},s.multiply=function(e,t,o){e[0]=t[0]*o[0],e[1]=t[1]*o[1]},s.scale=function(e,t,o){e[0]=t[0]*o,e[1]=t[1]*o},s.scaleAndAdd=function(e,t,o,n){e[0]=t[0]+o[0]*n,e[1]=t[1]+o[1]*n},s.distance=function(e,t){const o=e[0]-t[0],n=e[1]-t[1];return Math.hypot(o,n)},s.squaredDistance=function(e,t){const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n},s.length=function(e){return Math.hypot(e[0],e[1])},s.squaredLength=function(e){const t=e[0],o=e[1];return t*t+o*o},s.negate=function(e,t){e[0]=-t[0],e[1]=-t[1]},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.lerp=function(e,t,o,n){e[0]=t[0]+n*(o[0]-t[0]),e[1]=t[1]+n*(o[1]-t[1])},s.zero=function(e){e[0]=0,e[1]=0},(l=a||(a={})).create=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},l.copy=function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},l.ortho=function(e,t,o,n,r,i,s){const a=1/(t-o),l=1/(n-r),u=1/(i-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+o)*a,e[13]=(r+n)*l,e[14]=(s+i)*u,e[15]=1};var u={},c=r("cmoHh"),d=r("euRi5"),h=r("hDsEw"),p=r("3J2Zm"),f=r("6Px8M"),g=r("lDm0S"),m={};!function(e,t,o){var n,i=256,s=6,a="random",l=o.pow(i,s),u=o.pow(2,52),c=2*u,d=i-1;function h(r,d,h){var m=[],y=x(g((d=1==d?{entropy:!0}:d||{}).entropy?[r,_(t)]:null==r?function(){try{var o;return n&&(o=n.randomBytes)?o=o(i):(o=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(o)),_(o)}catch(o){var r=e.navigator,s=r&&r.plugins;return[+new Date,e,s,e.screen,_(t)]}}():r,3),m),v=new p(m),w=function(){for(var e=v.g(s),t=l,o=0;e<u;)e=(e+o)*i,t*=i,o=v.g(1);for(;e>=c;)e/=2,t/=2,o>>>=1;return(e+o)/t};return w.int32=function(){return 0|v.g(4)},w.quick=function(){return v.g(4)/4294967296},w.double=w,x(_(v.S),t),(d.pass||h||function(e,t,n,r){return r&&(r.S&&f(r,v),e.state=function(){return f(v,{})}),n?(o[a]=e,t):e})(w,y,"global"in d?d.global:this==o,d.state)}function p(e){var t,o=e.length,n=this,r=0,s=n.i=n.j=0,a=n.S=[];for(o||(e=[o++]);r<i;)a[r]=r++;for(r=0;r<i;r++)a[r]=a[s=d&s+e[r%o]+(t=a[r])],a[s]=t;(n.g=function(e){for(var t,o=0,r=n.i,s=n.j,a=n.S;e--;)t=a[r=d&r+1],o=o*i+a[d&(a[r]=a[s=d&s+t])+(a[s]=t)];return n.i=r,n.j=s,o})(i)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var o,n=[],r=typeof e;if(t&&"object"==r)for(o in e)try{n.push(g(e[o],t-1))}catch(e){}return n.length?n:"string"==r?e:e+"\0"}function x(e,t){for(var o,n=e+"",r=0;r<n.length;)t[d&r]=d&(o^=19*t[d&r])+n.charCodeAt(r++);return _(t)}function _(e){return String.fromCharCode.apply(0,e)}if(x(o.random(),t),m){m=h;try{n=r("kjyEk")}catch(e){}}else"function"==typeof define&&define.amd?define((function(){return h})):o["seed"+a]=h}("undefined"!=typeof self?self:m,[],Math),m.alea=c,m.xor128=d,m.xorwow=h,m.xorshift7=p,m.xor4096=f,m.tychei=g,u=m;class x{constructor(e=""){""!==e?(this.seed=e,this.rng=u(e)):(this.seed="",this.rng=u())}random(){return this.rng()}randomInRange(e){return Math.floor(this.rng()*e)}shuffleArray(e){for(let t=e.length-1;t>0;--t){let o=this.randomInRange(t+1),n=e[t];e[t]=e[o],e[o]=n}}}function _(e){return Math.floor(Math.random()*e)}function y(e){for(let t=e.length-1;t>0;--t){let o=_(t+1),n=e[t];e[t]=e[o],e[o]=n}}let v;var w;(w=v||(v={}))[w.Damage=0]="Damage",w[w.GuardChase=1]="GuardChase",w[w.GuardSeeThief=2]="GuardSeeThief",w[w.GuardHearThief=3]="GuardHearThief",w[w.GuardHearGuard=4]="GuardHearGuard",w[w.GuardInvestigate=5]="GuardInvestigate",w[w.GuardEndChase=6]="GuardEndChase",w[w.GuardFinishInvestigating=7]="GuardFinishInvestigating",w[w.GuardFinishLooking=8]="GuardFinishLooking",w[w.GuardFinishListening=9]="GuardFinishListening";class S{constructor(){this.popups=[]}add(e,t){this.popups.push({popupType:e,posWorld:t})}clear(){this.popups.length=0}endOfUpdate(e){if(0===this.popups.length)return"";this.popups.sort(((e,t)=>e.popupType-t.popupType));const t=function(e){switch(e){case v.Damage:return"guardDamage";case v.GuardChase:return"guardChase";case v.GuardSeeThief:return"guardSeeThief";case v.GuardHearThief:return"guardHearThief";case v.GuardHearGuard:return"guardHearGuard";case v.GuardInvestigate:return"guardInvestigate";case v.GuardEndChase:return"guardEndChase";case v.GuardFinishInvestigating:return"guardFinishInvestigating";case v.GuardFinishLooking:return"guardFinishLooking";case v.GuardFinishListening:return"guardFinishListening"}}(this.popups[0].popupType);if(void 0!==e[t]){const o=e[t].play(.6);return null!==o?o.subtitle:""}return console.log("Unknown sound",t),""}}let b;var A;let L;var T;(A=b||(b={}))[A.StoodStill=0]="StoodStill",A[A.Moved=1]="Moved",A[A.BumpedPlayer=2]="BumpedPlayer",(T=L||(L={}))[T.Patrol=0]="Patrol",T[T.Look=1]="Look",T[T.Listen=2]="Listen",T[T.ChaseVisibleTarget=3]="ChaseVisibleTarget",T[T.MoveToLastSighting=4]="MoveToLastSighting",T[T.MoveToLastSound=5]="MoveToLastSound",T[T.MoveToGuardShout=6]="MoveToGuardShout",T[T.RelightTorch=7]="RelightTorch",T[T.PostRelightTorch=8]="PostRelightTorch";class I{constructor(e,t,o){const n=e[t];this.pos=i.clone(n),this.dir=i.fromValues(1,0),this.mode=L.Patrol,this.hasTorch=!1,this.speaking=!1,this.hasMoved=!1,this.heardThief=!1,this.hearingGuard=!1,this.heardGuard=!1,this.heardGuardPos=i.clone(n),this.goal=i.clone(n),this.modeTimeout=0,this.patrolPath=e,this.patrolPathIndex=t,this.patrolReverse=!1,this.patrolLoops=function(e){const t=e[0][0]-e[e.length-1][0],o=e[0][1]-e[e.length-1][1];return(0!=t||0!=o)&&Math.abs(t)<2&&Math.abs(o)<2}(e),this.updateDirInitial()}overheadIcon(){return M(this.mode)?N.Relaxed:this.mode==L.ChaseVisibleTarget?N.Chasing:N.Alerted}act(e,t,o,n){const r=this.mode,s=i.clone(this.pos);switch(M(this.mode)||(this.seesThief(e,o)?(i.copy(this.goal,o.pos),this.mode=L.ChaseVisibleTarget):this.mode===L.ChaseVisibleTarget&&(i.copy(this.goal,o.pos),this.mode=L.MoveToLastSighting,this.modeTimeout=3)),this.mode!==L.ChaseVisibleTarget&&(this.heardGuard&&(this.mode=L.MoveToGuardShout,this.modeTimeout=2+_(4),i.copy(this.goal,this.heardGuardPos)),this.heardThief&&(this.adjacentTo(o.pos)?(this.mode=L.ChaseVisibleTarget,i.copy(this.goal,o.pos)):M(this.mode)?(this.mode=L.Listen,this.modeTimeout=2+_(4),C(this.dir,this.pos,o.pos)):(this.mode=L.MoveToLastSound,this.modeTimeout=2+_(4),i.copy(this.goal,o.pos)))),this.mode){case L.Patrol:this.patrolStep(e,o);break;case L.Look:case L.Listen:this.modeTimeout-=1,0==this.modeTimeout&&(this.mode=L.Patrol);break;case L.ChaseVisibleTarget:this.adjacentTo(o.pos)?(C(this.dir,this.pos,this.goal),r==L.ChaseVisibleTarget&&(o.damagedLastTurn||t.add(v.Damage,this.pos),o.applyDamage(1))):this.moveTowardPosition(this.goal,e,o);break;case L.MoveToLastSighting:case L.MoveToLastSound:case L.MoveToGuardShout:this.moveTowardPosition(this.goal,e,o)!==b.Moved&&(this.modeTimeout-=1),0==this.modeTimeout&&(this.mode=L.Patrol);break;case L.RelightTorch:this.cardinallyAdjacentTo(this.goal)?(C(this.dir,this.pos,this.goal),this.mode=L.PostRelightTorch,this.modeTimeout=3):this.moveTowardAdjacentToPosition(this.goal,e,o)!==b.Moved&&(this.modeTimeout-=1,0===this.modeTimeout&&(this.mode=L.Patrol));break;case L.PostRelightTorch:--this.modeTimeout,C(this.dir,this.pos,this.goal),this.modeTimeout<=0&&(!function(e,t){for(const o of e.items)o.type===X.TorchUnlit&&o.pos[0]===t[0]&&o.pos[1]===t[1]&&(o.type=X.TorchLit);e.computeLighting()}(e,this.goal),this.mode=L.Patrol)}if(!this.hasTorch||this.pos[0]==s[0]&&this.pos[1]==s[1]||e.computeLighting(),this.seesThief(e,o))M(this.mode)&&!this.adjacentTo(o.pos)?(this.mode=L.Look,this.modeTimeout=2+_(4)):(i.copy(this.goal,o.pos),C(this.dir,this.pos,this.goal),this.mode=L.ChaseVisibleTarget);else if(this.mode==L.ChaseVisibleTarget)i.copy(this.goal,o.pos),this.mode=L.MoveToLastSighting,this.modeTimeout=3;else if(this.mode===L.Patrol){const t=function(e,t){let o,n=1/0;for(const r of e.items)if(r.type===X.TorchUnlit){const s=i.squaredDistance(r.pos,t);if(s>=n)continue;if(!P(e,t,r.pos))continue;n=s,o=r}return o}(e,this.pos);if(void 0!==t)i.copy(this.goal,t.pos),this.mode=L.RelightTorch,this.modeTimeout=3;else if(s[0]===this.pos[0]&&s[1]===this.pos[1]){const t=this.tryGetPosLookAt(e);void 0!==t&&C(this.dir,this.pos,t)}}this.heardThief=!1;const a=function(e,t){if(t==e)return;switch(t){case L.Patrol:switch(e){case L.Look:return v.GuardFinishLooking;case L.Listen:return v.GuardFinishListening;case L.MoveToLastSound:case L.MoveToGuardShout:return v.GuardFinishInvestigating;case L.MoveToLastSighting:return v.GuardEndChase;default:return}case L.Look:return v.GuardSeeThief;case L.Listen:return v.GuardHearThief;case L.ChaseVisibleTarget:return e!=L.MoveToLastSighting?v.GuardChase:void 0;case L.MoveToLastSighting:return;case L.MoveToLastSound:return v.GuardInvestigate;case L.MoveToGuardShout:return v.GuardHearGuard}return}(r,this.mode);void 0!==a&&t.add(a,this.pos),this.mode==L.ChaseVisibleTarget&&r!=L.ChaseVisibleTarget&&n.push({pos_shouter:this.pos,pos_target:o.pos})}cardinallyAdjacentTo(e){const t=Math.abs(e[0]-this.pos[0]),o=Math.abs(e[1]-this.pos[1]);return 1==t&&0==o||0==t&&1==o}adjacentTo(e){const t=e[0]-this.pos[0],o=e[1]-this.pos[1];return Math.abs(t)<2&&Math.abs(o)<2}seesThief(e,t){const o=i.create();if(i.subtract(o,t.pos,this.pos),i.dot(this.dir,o)<0)return!1;let n=e.cells.at(t.pos[0],t.pos[1]).lit;return!(i.squaredLength(o)>=this.sightCutoff(n))&&(!(t.hidden(e)||!P(e,this.pos,t.pos))||!M(this.mode)&&Math.abs(o[0])<2&&Math.abs(o[1])<2)}cutoffLit(){return M(this.mode)?40:75}cutoffUnlit(){return M(this.mode)?3:33}sightCutoff(e){return e?this.cutoffLit():this.cutoffUnlit()}patrolStep(e,t){let o;this.patrolPath[this.patrolPathIndex][0]===this.pos[0]&&this.patrolPath[this.patrolPathIndex][1]===this.pos[1]?(this.patrolReverse?0===this.patrolPathIndex?this.patrolLoops?this.patrolPathIndex=this.patrolPath.length-1:(this.patrolReverse=!1,this.patrolPathIndex=1):--this.patrolPathIndex:this.patrolPathIndex>=this.patrolPath.length-1?this.patrolLoops?this.patrolPathIndex=0:(this.patrolReverse=!0,this.patrolPathIndex=this.patrolPath.length-2):++this.patrolPathIndex,o=this.moveTowardPosition(this.patrolPath[this.patrolPathIndex],e,t)):(o=this.moveTowardPatrolPath(e,t),this.findPatrolPathIndex()),o===b.BumpedPlayer&&(this.mode=L.ChaseVisibleTarget,i.copy(this.goal,t.pos),C(this.dir,this.pos,this.goal))}updateDirInitial(){let e;e=this.patrolReverse?0===this.patrolPathIndex?this.patrolLoops?this.patrolPath.length-1:1:this.patrolPathIndex-1:this.patrolPathIndex>=this.patrolPath.length-1?this.patrolLoops?0:this.patrolPath.length-2:this.patrolPathIndex+1,C(this.dir,this.pos,this.patrolPath[e])}moveTowardPosition(e,t,o){const n=t.computeDistancesToPosition(e),r=k(t,n,this.pos);return r[0]==this.pos[0]&&r[1]==this.pos[1]?b.StoodStill:(C(this.dir,this.pos,r),o.pos[0]==r[0]&&o.pos[1]==r[1]?b.BumpedPlayer:(i.copy(this.pos,r),this.onMove(t,o),b.Moved))}moveTowardAdjacentToPosition(e,t,o){const n=t.computeDistancesToAdjacentToPosition(e),r=k(t,n,this.pos);return r[0]==this.pos[0]&&r[1]==this.pos[1]?b.StoodStill:(C(this.dir,this.pos,r),o.pos[0]==r[0]&&o.pos[1]==r[1]?b.BumpedPlayer:(i.copy(this.pos,r),this.onMove(t,o),b.Moved))}moveTowardPatrolPath(e,t){const o=e.computeDistancesToPatrolPath(this.patrolPath),n=k(e,o,this.pos);return n[0]==this.pos[0]&&n[1]==this.pos[1]?b.StoodStill:(C(this.dir,this.pos,n),t.pos[0]==n[0]&&t.pos[1]==n[1]?b.BumpedPlayer:(i.copy(this.pos,n),this.onMove(e,t),b.Moved))}onMove(e,t){if(i.squaredDistance(t.pos,this.pos)<64){e.cells.at(this.pos[0],this.pos[1]).type==G.PortcullisNS||G.PortcullisEW}}findPatrolPathIndex(){for(let e=this.patrolPathIndex;e<this.patrolPath.length;++e){const t=this.patrolPath[e];if(t[0]===this.pos[0]&&t[1]===this.pos[1])return this.patrolPathIndex=e,!0}for(let e=this.patrolPathIndex-1;e>=0;--e){const t=this.patrolPath[e];if(t[0]===this.pos[0]&&t[1]===this.pos[1])return this.patrolPathIndex=e,!0}return!1}tryGetPosLookAt(e){const t=this.pos[0],o=this.pos[1];return t>0&&e.cells.at(t-1,o).type==G.OneWayWindowW?i.fromValues(t-1,o):t<e.cells.sizeX-1&&e.cells.at(t+1,o).type==G.OneWayWindowE?i.fromValues(t+1,o):o>0&&e.cells.at(t,o-1).type==G.OneWayWindowS?i.fromValues(t,o-1):o<e.cells.sizeY-1&&e.cells.at(t,o+1).type==G.OneWayWindowN?i.fromValues(t,o+1):void 0}}function M(e){return e===L.Patrol||e===L.RelightTorch||e===L.PostRelightTorch}function R(e,t,o){for(const t of e.guards)t.heardGuard=t.hearingGuard,t.hearingGuard=!1,t.speaking=!1,t.hasMoved=!1;const n=[];for(const r of e.guards)r.act(e,t,o,n),r.hasMoved=!0;for(const t of n)H(e,t)}function H(e,t){for(const o of e.guardsInEarshot(t.pos_shouter,25))o.pos[0]==t.pos_shouter[0]&&o.pos[1]==t.pos_shouter[1]||(o.hearingGuard=!0,i.copy(o.heardGuardPos,t.pos_shouter))}function k(e,t,o){let n=1/0,r=o;const s=i.fromValues(Math.max(0,o[0]-1),Math.max(0,o[1]-1)),a=i.fromValues(Math.min(e.cells.sizeX,o[0]+2),Math.min(e.cells.sizeY,o[1]+2));for(let l=s[0];l<a[0];++l)for(let u=s[1];u<a[1];++u){const s=t.get(l,u);if(s==1/0)continue;let a=i.fromValues(l,u);e.guardMoveCost(o,a)!=1/0&&(e.cells.at(a[0],a[1]).type!=G.GroundWater&&(e.isGuardAt(a[0],a[1])||s<n&&(n=s,r=a)))}return r}function C(e,t,o){const n=i.create();i.subtract(n,o,t);const r=i.fromValues(-e[1],e[0]);let s=i.dot(e,n),a=i.dot(r,n);Math.abs(s)>=Math.abs(a)?s>=0||i.negate(e,e):Math.abs(a)>Math.abs(s)?a>=0?i.copy(e,r):i.negate(e,r):s>0||(a>=0?i.copy(e,r):i.negate(e,r))}function P(e,t,o){let n=t[0],r=t[1];const i=o[0]-n,s=o[1]-r;let a=Math.abs(i),l=Math.abs(s);const u=i>0?1:-1,c=s>0?1:-1;let d=l-a,h=a+l-1;for(a*=2,l*=2;h>0;){if(d>0?(r+=c,d-=a):(n+=u,d+=l),e.cells.at(n,r).blocksSight)return!1;--h}return!0}const E=[i.fromValues(-1,0),i.fromValues(1,0),i.fromValues(0,-1),i.fromValues(0,1)];class W{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Uint8Array(e*t),this.fill(o)}fill(e){this.values.fill(e?1:0)}get(e,t){return 0!==this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o?1:0}}class U{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Int32Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}class F{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Float64Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}let G;var D;(D=G||(G={}))[D.GroundNormal=0]="GroundNormal",D[D.GroundGrass=1]="GroundGrass",D[D.GroundWater=2]="GroundWater",D[D.GroundMarble=3]="GroundMarble",D[D.GroundWood=4]="GroundWood",D[D.GroundWoodCreaky=5]="GroundWoodCreaky",D[D.Wall0000=6]="Wall0000",D[D.Wall0001=7]="Wall0001",D[D.Wall0010=8]="Wall0010",D[D.Wall0011=9]="Wall0011",D[D.Wall0100=10]="Wall0100",D[D.Wall0101=11]="Wall0101",D[D.Wall0110=12]="Wall0110",D[D.Wall0111=13]="Wall0111",D[D.Wall1000=14]="Wall1000",D[D.Wall1001=15]="Wall1001",D[D.Wall1010=16]="Wall1010",D[D.Wall1011=17]="Wall1011",D[D.Wall1100=18]="Wall1100",D[D.Wall1101=19]="Wall1101",D[D.Wall1110=20]="Wall1110",D[D.Wall1111=21]="Wall1111",D[D.OneWayWindowE=22]="OneWayWindowE",D[D.OneWayWindowW=23]="OneWayWindowW",D[D.OneWayWindowN=24]="OneWayWindowN",D[D.OneWayWindowS=25]="OneWayWindowS",D[D.PortcullisNS=26]="PortcullisNS",D[D.PortcullisEW=27]="PortcullisEW",D[D.DoorNS=28]="DoorNS",D[D.DoorEW=29]="DoorEW",D[D.GardenDoorNS=30]="GardenDoorNS",D[D.GardenDoorEW=31]="GardenDoorEW";class z{constructor(e,t){this.sizeX=e,this.sizeY=t;const o=e*t;this.values=new Array(o);for(let e=0;e<o;++e)this.values[e]={type:G.GroundNormal,moveCost:1/0,blocksPlayerMove:!1,blocksPlayerSight:!1,blocksSight:!1,blocksSound:!1,hidesPlayer:!1,lit:!1,seen:!1,identified:!1}}at(e,t){const o=this.sizeX*t+e;return console.assert(o>=0),console.assert(o<this.values.length),this.values[o]}index(e,t){return this.sizeX*t+e}}let N;var O;let X;var B;function Y(e){switch(e){case X.Chair:return 4;case X.Table:case X.Bush:return 10;case X.Coin:case X.DoorNS:case X.DoorEW:case X.PortcullisNS:case X.PortcullisEW:return 0;case X.TorchUnlit:case X.TorchLit:return 1/0;case X.TorchCarry:return 0}}(O=N||(N={}))[O.Relaxed=0]="Relaxed",O[O.Alerted=1]="Alerted",O[O.Chasing=2]="Chasing",(B=X||(X={}))[B.Chair=0]="Chair",B[B.Table=1]="Table",B[B.Bush=2]="Bush",B[B.Coin=3]="Coin",B[B.DoorNS=4]="DoorNS",B[B.DoorEW=5]="DoorEW",B[B.PortcullisNS=6]="PortcullisNS",B[B.PortcullisEW=7]="PortcullisEW",B[B.TorchUnlit=8]="TorchUnlit",B[B.TorchLit=9]="TorchLit",B[B.TorchCarry=10]="TorchCarry";const V=5;class j{constructor(e){this.pos=i.clone(e),this.dir=i.fromValues(0,-1),this.health=V,this.loot=0,this.noisy=!1,this.damagedLastTurn=!1,this.turnsRemainingUnderwater=0}applyDamage(e){this.health-=Math.min(e,this.health),this.damagedLastTurn=!0}hidden(e){if(void 0!==e.guards.find((e=>e.mode==L.ChaseVisibleTarget)))return!1;if(e.cells.at(this.pos[0],this.pos[1]).hidesPlayer)return!0;return e.cells.at(this.pos[0],this.pos[1]).type==G.GroundWater&&this.turnsRemainingUnderwater>0}}const $=[{lx:-1,ly:-1,rx:-1,ry:1,nx:-1,ny:0},{lx:-1,ly:1,rx:1,ry:1,nx:0,ny:1},{lx:1,ly:1,rx:1,ry:-1,nx:1,ny:0},{lx:1,ly:-1,rx:-1,ry:-1,nx:0,ny:-1}];function q(e,t,o,n){return e*n>t*o}const K=[{dx:1,dy:0,cost:2},{dx:-1,dy:0,cost:2},{dx:0,dy:1,cost:2},{dx:0,dy:-1,cost:2},{dx:-1,dy:-1,cost:3},{dx:1,dy:-1,cost:3},{dx:-1,dy:1,cost:3},{dx:1,dy:1,cost:3}];class Z{constructor(e){this.cells=e,this.patrolRegions=[],this.patrolRoutes=[],this.items=[],this.guards=[],this.playerStartPos=i.create()}collectLootAt(e,t){let o=0;return this.items=this.items.filter((n=>n.type!=X.Coin||n.pos[0]!=e||n.pos[1]!=t||(++o,!1))),o}collectAllLoot(){let e=0;return this.items=this.items.filter((t=>t.type!=X.Coin||(++e,!1))),e}allSeen(){for(const e of this.cells.values)if(!e.seen)return!1;return!0}percentSeen(){let e=0;for(const t of this.cells.values)t.seen&&++e;return Math.floor(100*e/this.cells.values.length)}markAllSeen(){for(const e of this.cells.values)e.seen=!0}markAllUnseen(){for(const e of this.cells.values)e.seen=!1}recomputeVisibility(e){this.recomputeVisibilityFromPos(e);const t=i.create();for(const o of E)this.playerCanSeeInDirection(e,o)&&(i.add(t,e,o),this.recomputeVisibilityFromPos(t))}recomputeVisibilityFromPos(e){for(const t of $)this.computeVisibility(e[0],e[1],e[0],e[1],t.lx,t.ly,t.rx,t.ry)}playerCanSeeInDirection(e,t){const o=i.create();return i.add(o,e,t),o[0]<0||o[1]<0||o[0]>=this.cells.sizeX||o[1]>=this.cells.sizeY||!this.cells.at(o[0],o[1]).blocksPlayerSight}computeVisibility(e,t,o,n,r,i,s,a){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;const l=2*(o-e),u=2*(n-t);if(!(l*l+u*u>1600||(this.cells.at(o,n).seen=!0,this.cells.at(o,n).blocksPlayerSight))){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let c=o+2*e-1,d=n+2*t-1,h=l+2*e-1,p=u+2*t-1;c>=0&&d>=0&&c<this.cells.sizeX&&d<this.cells.sizeY&&!q(r,i,h,p)&&!q(h,p,s,a)&&(this.cells.at(c,d).seen=!0)}for(const c of $){const d=l+c.lx,h=u+c.ly,p=l+c.rx,f=u+c.ry,[g,m]=q(r,i,d,h)?[r,i]:[d,h],[x,_]=q(s,a,p,f)?[p,f]:[s,a];q(x,_,g,m)&&this.computeVisibility(e,t,o+c.nx,n+c.ny,g,m,x,_)}}}computeLighting(){for(const e of this.cells.values)e.lit=!1;for(const e of this.items)e.type==X.TorchLit&&this.castLight(e.pos,180);for(const e of this.guards)e.hasTorch&&this.castLight(e.pos,60)}castLight(e,t){this.cells.at(e[0],e[1]).lit=!0;for(const o of $)this.castLightRecursive(e[0],e[1],e[0]+o.nx,e[1]+o.ny,o.lx,o.ly,o.rx,o.ry,t)}castLightRecursive(e,t,o,n,r,i,s,a,l){if(o<0||n<0||o>=this.cells.sizeX||n>=this.cells.sizeY)return;const u=2*(o-e),c=2*(n-t);if(u**2+c**2>l)return;const d=this.cells.at(o,n);if(d.lit=!0,!d.blocksSight){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let l=o+2*e-1,d=n+2*t-1,h=u+2*e-1,p=c+2*t-1;l>=0&&d>=0&&l<this.cells.sizeX&&d<this.cells.sizeY&&!q(r,i,h,p)&&!q(h,p,s,a)&&(this.cells.at(l,d).lit=!0)}for(const d of $){const h=u+d.lx,p=c+d.ly,f=u+d.rx,g=c+d.ry,[m,x]=q(r,i,h,p)?[r,i]:[h,p],[_,y]=q(s,a,f,g)?[f,g]:[s,a];q(_,y,m,x)&&this.castLightRecursive(e,t,o+d.nx,n+d.ny,m,x,_,y,l)}}}allLootCollected(){return void 0===this.items.find((e=>e.type==X.Coin))}isGuardAt(e,t){return null!=this.guards.find((o=>o.hasMoved&&o.pos[0]==e&&o.pos[1]==t))}guardMoveCost(e,t){const o=this.cells.at(t[0],t[1]).moveCost;return o===1/0||e[0]==t[0]||e[1]==t[1]||this.cells.at(e[0],t[1]).moveCost!==1/0&&this.cells.at(t[0],e[1]).moveCost!==1/0?o:1/0}computeDistancesToPatrolPath(e){const t=[];for(const o of e){const e=this.cells.at(o[0],o[1]).moveCost;t.push({priority:e,pos:o})}return this.computeDistanceField(t)}computeDistancesToPosition(e){return console.assert(e[0]>=0),console.assert(e[1]>=0),console.assert(e[0]<this.cells.sizeX),console.assert(e[1]<this.cells.sizeY),this.computeDistanceField([{priority:0,pos:e}])}computeDistancesToAdjacentToPosition(e){const t=[];for(const o of E){const n=i.create();if(i.add(n,e,o),n[0]<0||n[1]<0||n[0]>=this.cells.sizeX||n[1]>=this.cells.sizeY)continue;const r=this.cells.at(n[0],n[1]);r.moveCost!==1/0&&t.push({priority:r.moveCost,pos:n})}return this.computeDistanceField(t)}computeDistanceField(e){let t=this.cells.sizeX,o=this.cells.sizeY;const n=[],r=new F(t,o,1/0);for(const t of e)J(n,t);for(;n.length>0;){const e=Q(n);if(!(e.priority>=r.get(e.pos[0],e.pos[1]))){r.set(e.pos[0],e.pos[1],e.priority);for(const s of K){const a=i.fromValues(e.pos[0]+s.dx,e.pos[1]+s.dy);if(a[0]<0||a[1]<0||a[0]>=t||a[1]>=o)continue;const l=this.guardMoveCost(e.pos,a);if(l==1/0)continue;const u=e.priority+l+s.cost;u<r.get(a[0],a[1])&&J(n,{priority:u,pos:a})}}}return r}guardsInEarshot(e,t){const o=this.coordsInEarshot(e,t);return this.guards.filter((e=>o.has(this.cells.sizeX*e.pos[1]+e.pos[0])))}coordsInEarshot(e,t){let o=this.cells.sizeX,n=this.cells.sizeY;const r=[],s=new F(o,n,1/0),a=new Set;for(J(r,{priority:0,pos:e});r.length>0;){const e=Q(r);if(!(e.priority>=s.get(e.pos[0],e.pos[1]))){s.set(e.pos[0],e.pos[1],e.priority),a.add(o*e.pos[1]+e.pos[0]);for(const a of K){const l=i.fromValues(e.pos[0]+a.dx,e.pos[1]+a.dy);if(l[0]<0||l[1]<0||l[0]>=o||l[1]>=n)continue;const u=e.priority+a.cost;u>t||(this.cells.at(l[0],l[1]).blocksSound||u>=s.get(l[0],l[1])||J(r,{priority:u,pos:l}))}}}return a}}function Q(e){const t=e[0];e[0]=e[e.length-1],e.pop();let o=0;const n=e.length;for(;;){let t=o;const r=2*o+1;r<n&&e[r].priority<e[t].priority&&(t=r);const i=r+1;if(i<n&&e[i].priority<e[t].priority&&(t=i),t==o)break;[e[o],e[t]]=[e[t],e[o]],o=t}return t}function J(e,t){e.push(t);let o=e.length-1;for(;o>0;){const t=Math.floor((o-1)/2);if(e[o].priority>=e[t].priority)break;[e[o],e[t]]=[e[t],e[o]],o=t}}const ee=5,te=5,oe=3,ne=[[3,3,2,2,6,6],[3,5,2,5,6,12],[3,5,2,6,9,15],[3,5,2,6,12,18],[3,7,3,6,15,21],[3,7,3,6,18,24],[3,7,3,6,21,30],[5,7,4,6,24,36],[5,9,4,6,30,42],[7,9,4,6,36,48]];let re;var ie;function se(e,t,o){const n=[];for(let t=0;t<e;++t){const e=ae(t,o);n.push({numRoomsX:e[0],numRoomsY:e[1],totalLoot:0})}let r=0;for(const e of n){r+=e.numRoomsX*e.numRoomsY}let i=0;for(const e of n){const o=e.numRoomsX*e.numRoomsY,n=Math.floor(t*o/r);i+=n,e.totalLoot=n}return n[n.length-1].totalLoot+=t-i,n}function ae(e,t){let o,n,r,i,s,a;[o,n,r,i,s,a]=ne[e];const l=o+2*t.randomInRange(1+(n-o)/2);let u=r+t.randomInRange(1+i-r);return u=Math.min(Math.floor(a/l),u),u=Math.max(u,Math.ceil(s/l)),[l,u]}function le(e,t,o){const n=function(e,t,o){const n=new W(e,t,!0),r=Math.floor((e+1)/2);for(let e=Math.floor(t*r/4);e>0;--e){const e=o.randomInRange(r),i=o.randomInRange(t);n.set(e,i,!1)}for(let o=0;o<t;++o)for(let t=r;t<e;++t)n.set(t,o,n.get(e-1-t,o));return n}(t.numRoomsX,t.numRoomsY,o),[r,s]=function(e,t,o,n){const r=o.sizeX,i=o.sizeY,s=new U(r+1,i,0),a=new U(r,i+1,0);let l=n.randomInRange(3)-1;for(let e=0;e<i;++e)s.set(0,e,l);l=n.randomInRange(3)-1;for(let e=0;e<i;++e)s.set(r,e,l);l=n.randomInRange(3)-1;for(let e=0;e<r;++e)a.set(e,0,l);l=n.randomInRange(3)-1;for(let e=0;e<r;++e)a.set(e,i,l);for(let e=1;e<r;++e)for(let t=0;t<i;++t)s.set(e,t,n.randomInRange(3)-1);for(let e=0;e<r;++e)for(let t=1;t<i;++t)a.set(e,t,n.randomInRange(3)-1);for(let e=1;e<r;++e)for(let t=1;t<i;++t)0===n.randomInRange(2)?s.set(e,t,s.get(e,t-1)):a.set(e,t,a.get(e-1,t));if(e){if(0==(1&r)){const e=Math.floor(r/2);for(let t=0;t<i;++t)s.set(e,t,0)}for(let e=0;e<Math.floor((r+1)/2);++e)for(let t=0;t<i;++t)s.set(r-e,t,1-s.get(e,t));for(let e=0;e<Math.floor(r/2);++e)for(let t=0;t<i+1;++t)a.set(r-1-e,t,a.get(e,t))}if(t){if(0==(1&i)){const e=i/2;for(let t=0;t<r;++t)a.set(t,e,0)}for(let e=0;e<Math.floor((i+1)/2);++e)for(let t=0;t<r;++t)a.set(t,i-e,1-a.get(t,e));for(let e=0;e<Math.floor(i/2);++e)for(let t=0;t<r+1;++t)s.set(t,i-1-e,s.get(t,e))}let u=Number.MIN_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;for(let e=0;e<i;++e)u=Math.max(u,-s.get(0,e));for(let e=0;e<r;++e)c=Math.max(c,-a.get(e,0));u+=oe,c+=oe;for(let e=0;e<r+1;++e)for(let t=0;t<i;++t){const o=s.get(e,t)+u+e*ee;s.set(e,t,o)}for(let e=0;e<r;++e)for(let t=0;t<i+1;++t)a.set(e,t,a.get(e,t)+c+t*te);return[s,a]}(true,false,n,o),a=function(e,t,o){const n=e.sizeX,r=e.sizeY;let i=0,s=0;for(let e=0;e<r;++e)i=Math.max(i,t.get(n,e));for(let e=0;e<n;++e)s=Math.max(s,o.get(e,r));i+=oe+1,s+=oe+1;const a=new z(i,s);for(let e=0;e<n;++e)for(let n=0;n<r;++n){const r=t.get(e,n),i=t.get(e+1,n)+1,s=o.get(e,n),l=o.get(e,n+1)+1;for(let e=r;e<i;++e)for(let t=s;t<l;++t){a.at(e,t).type=G.GroundGrass}}for(let i=0;i<n;++i)for(let s=0;s<r;++s){const l=e.get(i,s),u=t.get(i,s),c=t.get(i+1,s),d=o.get(i,s),h=o.get(i,s+1);(0==i||l)&&ue(a,u,d,h),(i==n-1||l)&&ue(a,c,d,h),(0==s||l)&&ce(a,u,d,c),(s==r-1||l)&&ce(a,u,h,c)}return a}(n,r,s),l=new Z(a),[u,c,d]=function(e,t,o,n,r,s,a,l){const u=n.sizeX,c=n.sizeY,d=new U(u,c,0),h=[];h.push({roomType:re.Exterior,group:0,depth:0,posMin:i.fromValues(0,0),posMax:i.fromValues(0,0),edges:[]});for(let e=0;e<u;++e)for(let t=0;t<c;++t){let o=h.length;d.set(e,t,o),h.push({roomType:n.get(e,t)?re.PublicRoom:re.PublicCourtyard,group:o,depth:0,posMin:i.fromValues(r.get(e,t)+1,s.get(e,t)+1),posMax:i.fromValues(r.get(e+1,t),s.get(e,t+1)),edges:[]})}const p=function(e,t,o,n,r){let s=r.sizeX,a=r.sizeY;const l=[];{const u=[];{const e=[];let t=0;for(let a=0;a<s;++a){let s=o.get(a,t),u=o.get(a+1,t),c=n.get(a,t),d=l.length;e.push(d),l.push({origin:i.fromValues(s+1,c),dir:i.fromValues(1,0),length:u-(s+1),room_left:r.get(a,t),room_right:0,next_matching:d,door:!1,doorOffset:0})}u.push(e)}for(let e=1;e<a;++e){const t=[];for(let a=0;a<s;++a){let u=o.get(a,e),c=o.get(a,e-1),d=o.get(a+1,e),h=o.get(a+1,e-1),p=Math.max(c,u),f=Math.min(h,d),g=n.get(a,e);if(a>0&&c-u>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(u+1,g),dir:i.fromValues(1,0),length:c-(u+1),room_left:r.get(a,e),room_right:r.get(a-1,e-1),next_matching:o,door:!1,doorOffset:0})}if(f-p>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(p+1,g),dir:i.fromValues(1,0),length:f-(p+1),room_left:r.get(a,e),room_right:r.get(a,e-1),next_matching:o,door:!1,doorOffset:0})}if(a+1<s&&d-h>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(h+1,g),dir:i.fromValues(1,0),length:d-(h+1),room_left:r.get(a,e),room_right:r.get(a+1,e-1),next_matching:o,door:!1,doorOffset:0})}}u.push(t)}{const e=[];let t=a;for(let a=0;a<s;++a){let s=o.get(a,t-1),u=o.get(a+1,t-1),c=n.get(a,t),d=l.length;e.push(d),l.push({origin:i.fromValues(s+1,c),dir:i.fromValues(1,0),length:u-(s+1),room_left:0,room_right:r.get(a,t-1),next_matching:d,door:!1,doorOffset:0})}u.push(e)}if(e)for(let e=0;e<u.length;++e){let t=u[e],o=0,n=t.length-1;for(;o<n;){let e=t[o],r=t[n];l[e].next_matching=r,l[r].next_matching=e;{let e=l[r];i.scaleAndAdd(e.origin,e.origin,e.dir,e.length-1),i.negate(e.dir,e.dir),[e.room_left,e.room_right]=[e.room_right,e.room_left]}o+=1,n-=1}}if(t){let e=0,t=u.length-1;for(;e<t;){let o=u[e],n=u[t];console.assert(o.length==n.length);for(let e=0;e<o.length;++e){let t=o[e],r=n[e];l[t].next_matching=r,l[r].next_matching=t}e+=1,t-=1}}}{let u=[];{const e=[];let t=0;for(let s=0;s<a;++s){let a=n.get(t,s),u=n.get(t,s+1),c=o.get(t,s),d=l.length;e.push(d),l.push({origin:i.fromValues(c,a+1),dir:i.fromValues(0,1),length:u-(a+1),room_left:0,room_right:r.get(t,s),next_matching:d,door:!1,doorOffset:0})}u.push(e)}for(let e=1;e<s;++e){const t=[];for(let s=0;s<a;++s){let u=n.get(e-1,s),c=n.get(e,s),d=n.get(e-1,s+1),h=n.get(e,s+1),p=Math.max(u,c),f=Math.min(d,h),g=o.get(e,s);if(s>0&&u-c>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,c+1),dir:i.fromValues(0,1),length:u-(c+1),room_left:r.get(e-1,s-1),room_right:r.get(e,s),next_matching:o,door:!1,doorOffset:0})}if(f-p>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,p+1),dir:i.fromValues(0,1),length:f-(p+1),room_left:r.get(e-1,s),room_right:r.get(e,s),next_matching:o,door:!1,doorOffset:0})}if(s+1<a&&h-d>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,d+1),dir:i.fromValues(0,1),length:h-(d+1),room_left:r.get(e-1,s+1),room_right:r.get(e,s),next_matching:o,door:!1,doorOffset:0})}}u.push(t)}{const e=[];let t=s;for(let s=0;s<a;++s){let a=n.get(t-1,s),u=n.get(t-1,s+1),c=o.get(t,s),d=l.length;l.push({origin:i.fromValues(c,a+1),dir:i.fromValues(0,1),length:u-(a+1),room_left:r.get(t-1,s),room_right:0,next_matching:d,door:!1,doorOffset:0}),e.push(d)}u.push(e)}if(t)for(let e=0;e<u.length;++e){let t=u[e],o=Math.floor(t.length/2);for(let e=0;e<o;++e){let o=t[e],n=t[t.length-1-e];l[o].next_matching=n,l[n].next_matching=o;{let e=l[n];i.scaleAndAdd(e.origin,e.origin,e.dir,e.length-1),i.negate(e.dir,e.dir),[e.room_left,e.room_right]=[e.room_right,e.room_left]}}}if(e){let e=0,t=u.length-1;for(;e<t;){let o=u[e],n=u[t];for(let e=0;e<o.length;++e){let t=o[e],r=n[e];l[t].next_matching=r,l[r].next_matching=t}e+=1,t-=1}}}return l}(t,o,r,s,d);!function(e,t){for(let o=0;o<e.length;++o){const n=e[o];let r=n.room_left,i=n.room_right;t[r].edges.push(o),t[i].edges.push(o)}}(p,h);let f=function(e,t,o){let n=function(e,t){const o=[];for(let t=0;t<e.length;++t){let n=e[t].next_matching;n>=t&&(n>t?o.push([t,n]):o.push([t]))}return t.shuffleArray(o),o}(t,o);for(const o of t){let t=o.room_left,n=o.room_right;e[t].roomType==re.PublicCourtyard&&e[n].roomType==re.PublicCourtyard&&(o.door=!0,de(e,e[t].group,e[n].group))}for(const r of n){let n=!1;{let i=t[r[0]],s=i.room_left,a=i.room_right;if(e[s].roomType!=re.PublicRoom||e[a].roomType!=re.PublicRoom)continue;let l=e[s].group,u=e[a].group;(l!=u||o.random()<.4)&&(i.door=!0,n=!0,de(e,l,u))}if(n)for(let o=1;o<r.length;++o){let n=t[r[o]],i=n.room_left,s=n.room_right,a=e[i].group,l=e[s].group;n.door=!0,de(e,a,l)}}for(const r of n){let n=!1;{let i=t[r[0]],s=i.room_left,a=i.room_right,l=e[s].roomType,u=e[a].roomType;if(l==u)continue;if(l==re.Exterior||u==re.Exterior)continue;let c=e[s].group,d=e[a].group;(c!=d||o.random()<.4)&&(i.door=!0,n=!0,de(e,c,d))}if(n)for(let o=1;o<r.length;++o){let n=t[r[o]],i=n.room_left,s=n.room_right,a=e[i].group,l=e[s].group;n.door=!0,de(e,a,l)}}let r=i.fromValues(0,0);{let o=function(e,t,o){for(const n of o)for(const o of n){let n=t[o];if(0!=n.dir[0]&&!(n.next_matching>o)){if(n.next_matching==o){if(e[n.room_right].roomType!=re.Exterior)continue}else if(e[n.room_left].roomType!=re.Exterior)continue;return o}}return 0}(e,t,n);r[0]=t[o].origin[0]+t[o].dir[0]*Math.floor(t[o].length/2),r[1]=oe-1,t[o].door=!0;let i=t[o].next_matching;i!=o&&(t[i].next_matching=i,t[o].next_matching=o)}return r}(h,p,l);return function(e,t,o){let n=o.length;o[0].depth=0;for(let e=1;e<o.length;++e)o[e].depth=n;const r=[];for(let t=0;t<e.sizeX;++t){let n=e.get(t,0);o[n].depth=1,r.push(n)}let i=0;for(;i<r.length;){let e=r[i];for(const i of o[e].edges){let s=t[i];if(!s.door)continue;const a=s.room_left==e?s.room_right:s.room_left;o[a].depth==n&&(o[a].depth=o[e].depth+1,r.push(a))}i+=1}let s=0;for(const e of o)s=Math.max(s,e.depth);const a=Math.floor(e.sizeX*e.sizeY/4);let l=0,u=s;for(;u>0;){for(const e of o)e.roomType!=re.PublicRoom&&e.roomType!=re.PublicCourtyard||e.depth==u&&(e.roomType=e.roomType==re.PublicRoom?re.PrivateRoom:re.PrivateCourtyard,e.roomType==re.PrivateRoom&&(l+=1));if(l>=a)break;u-=1}for(;;){let e=!1;for(let n=0;n<o.length;++n)if(o[n].roomType==re.PublicCourtyard)for(const r of o[n].edges){const i=t[r];if(o[i.room_left!=n?i.room_left:i.room_right].roomType==re.PrivateCourtyard){o[n].roomType=re.PrivateCourtyard,e=!0;break}}if(!e)break}}(d,p,h),function(e,t,o,n){for(const n of t){const t=e[n.room_left].roomType,r=e[n.room_right].roomType;if(Ce(t)&&Ce(r))for(let e=0;e<n.length;++e){const t=i.create();i.scaleAndAdd(t,n.origin,n.dir,e),o.cells.at(t[0],t[1]).type=G.GroundGrass}}for(let r=0;r<t.length;++r){const s=t[r],a=e[s.room_left].roomType,l=e[s.room_right].roomType,u=s.next_matching;if(u<r)continue;let c;c=u==r?Math.floor(s.length/2):s.length>2?1+n.randomInRange(s.length-2):n.randomInRange(s.length);let d=[];if(d.push(s),u!=r&&d.push(t[u]),!s.door&&a!=l)if(a==re.Exterior||l==re.Exterior){if(0!=(1&s.length)){let t=Math.floor(s.length/2);for(const n of d){const r=i.create();i.scaleAndAdd(r,n.origin,n.dir,t);let s=i.clone(n.dir);e[n.room_right].roomType==re.Exterior&&i.negate(s,s),o.cells.at(r[0],r[1]).type=Te(s)}}}else if(Ce(a)||Ce(l)){let t=n.randomInRange(2);const r=Math.floor((s.length+1)/2);for(;t<r;){for(const n of d){let r=i.clone(n.dir);Ce(e[n.room_right].roomType)&&i.negate(r,r);let s=Te(r);const a=i.create();i.scaleAndAdd(a,n.origin,n.dir,t);const l=i.create();i.scaleAndAdd(l,n.origin,n.dir,n.length-(t+1)),o.cells.at(a[0],a[1]).type=s,o.cells.at(l[0],l[1]).type=s}t+=2}}let h=n.random()<.3333;for(const t of d){if(!t.door)continue;t.doorOffset=c;const n=i.create();i.scaleAndAdd(n,t.origin,t.dir,c);let r=0==t.dir[0],s=e[t.room_left].roomType,a=e[t.room_right].roomType;s==re.Exterior||a==re.Exterior?(o.cells.at(n[0],n[1]).type=r?G.PortcullisNS:G.PortcullisEW,Re(o,n[0],n[1],r?X.PortcullisNS:X.PortcullisEW)):Ce(s)&&Ce(a)?o.cells.at(n[0],n[1]).type=r?G.GardenDoorNS:G.GardenDoorEW:s!=re.PrivateRoom||a!=re.PrivateRoom||h?(o.cells.at(n[0],n[1]).type=r?G.DoorNS:G.DoorEW,Re(o,n[0],n[1],r?X.DoorNS:X.DoorEW)):o.cells.at(n[0],n[1]).type=r?G.DoorNS:G.DoorEW}}}(h,p,a,l),function(e,t,o,n){for(let r=1;r<t.length;++r){const i=t[r];let s;switch(i.roomType){case re.Exterior:s=G.GroundNormal;break;case re.PublicCourtyard:s=G.GroundGrass;break;case re.PublicRoom:s=G.GroundWood;break;case re.PrivateCourtyard:s=G.GroundGrass;break;case re.PrivateRoom:s=G.GroundMarble}for(let t=i.posMin[0];t<i.posMax[0];++t)for(let r=i.posMin[1];r<i.posMax[1];++r)s==G.GroundWood&&e>3&&n.random()<.02?o.cells.at(t,r).type=G.GroundWoodCreaky:o.cells.at(t,r).type=s;let a=i.posMax[0]-i.posMin[0],l=i.posMax[1]-i.posMin[1];if(Ce(i.roomType)){if(a>=5&&l>=5)for(let e=i.posMin[0]+1;e<i.posMax[0]-1;++e)for(let t=i.posMin[1]+1;t<i.posMax[1]-1;++t)o.cells.at(e,t).type=G.GroundWater;else if(a>=2&&l>=2){const t=[X.Bush,X.Bush,X.Bush,X.Bush];a>2&&l>2&&t.push(Ie(e,n)),n.shuffleArray(t);const r=[[i.posMin[0],i.posMin[1]],[i.posMax[0]-1,i.posMin[1]],[i.posMin[0],i.posMax[1]-1],[i.posMax[0]-1,i.posMax[1]-1]];for(let e=0;e<r.length;++e){const[n,i]=r[e];o.cells.at(n,i).type==G.GroundGrass&&Me(o,n,i,t[e])}}}else if(i.roomType==re.PublicRoom||i.roomType==re.PrivateRoom)if(a>=5&&l>=5){if(i.roomType==re.PrivateRoom)for(let e=2;e<a-2;++e)for(let t=2;t<l-2;++t)o.cells.at(i.posMin[0]+e,i.posMin[1]+t).type=G.GroundWater;o.cells.at(i.posMin[0]+1,i.posMin[1]+1).type=G.Wall0000,o.cells.at(i.posMax[0]-2,i.posMin[1]+1).type=G.Wall0000,o.cells.at(i.posMin[0]+1,i.posMax[1]-2).type=G.Wall0000,o.cells.at(i.posMax[0]-2,i.posMax[1]-2).type=G.Wall0000}else if(5==a&&l>=3&&(i.roomType==re.PublicRoom||n.random()<.33333)){const t=new Array(l-2).fill(X.Table);t.push(Ie(e,n)),n.shuffleArray(t);for(let e=1;e<l-1;++e)Re(o,i.posMin[0]+1,i.posMin[1]+e,X.Chair),Re(o,i.posMin[0]+2,i.posMin[1]+e,t[e-1]),Re(o,i.posMin[0]+3,i.posMin[1]+e,X.Chair)}else if(5==l&&a>=3&&(i.roomType==re.PublicRoom||n.random()<.33333)){const t=new Array(a-2).fill(X.Table);t.push(Ie(e,n)),n.shuffleArray(t);for(let e=1;e<a-1;++e)Re(o,i.posMin[0]+e,i.posMin[1]+1,X.Chair),Re(o,i.posMin[0]+e,i.posMin[1]+2,t[e-1]),Re(o,i.posMin[0]+e,i.posMin[1]+3,X.Chair)}else if(a>l&&1==(1&l)&&n.random()<.66667){let t=Math.floor(i.posMin[1]+l/2);const r=i.roomType==re.PublicRoom?X.Table:X.Chair,s=[Ie(e,n),r];n.shuffleArray(s),Me(o,i.posMin[0]+1,t,s[0]),Me(o,i.posMax[0]-2,t,s[1])}else if(l>a&&1==(1&a)&&n.random()<.66667){let t=Math.floor(i.posMin[0]+a/2);const r=i.roomType==re.PublicRoom?X.Table:X.Chair,s=[Ie(e,n),r];n.shuffleArray(s),Me(o,t,i.posMin[1]+1,s[0]),Me(o,t,i.posMax[1]-2,s[1])}else if(a>3&&l>3){const t=i.roomType==re.PublicRoom?X.Table:X.Chair,r=[Ie(e,n),t,t,t];n.shuffleArray(r),Me(o,i.posMin[0],i.posMin[1],r[0]),Me(o,i.posMax[0]-1,i.posMin[1],r[1]),Me(o,i.posMin[0],i.posMax[1]-1,r[2]),Me(o,i.posMax[0]-1,i.posMax[1]-1,r[3])}}}(e,h,a,l),[h,p,f]}(e,true,false,n,r,s,l,o);i.copy(l.playerStartPos,d),function(e,t){let o=e.cells.sizeX,n=e.cells.sizeY;for(let r=0;r<o;++r){for(let t=n-oe+1;t<n;++t){if(e.cells.at(r,t).type!=G.GroundNormal)continue;let o=e.cells.at(r,t);o.type=G.GroundGrass,o.seen=!0}0==(1&r)&&t.random()<.8&&Re(e,r,n-1,X.Bush)}for(let r=oe;r<n-oe+1;++r){for(let t=0;t<oe-1;++t){if(e.cells.at(t,r).type!=G.GroundNormal)continue;let o=e.cells.at(t,r);o.type=G.GroundGrass,o.seen=!0}for(let t=o-oe+1;t<o;++t){if(e.cells.at(t,r).type!=G.GroundNormal)continue;let o=e.cells.at(t,r);o.type=G.GroundGrass,o.seen=!0}0!=(n-r&1)&&(t.random()<.8&&Re(e,0,r,X.Bush),t.random()<.8&&Re(e,o-1,r,X.Bush))}}(l,o),function(e){let t=e.cells.sizeX-1,o=Math.floor(e.cells.sizeX/2);for(let n=oe;n<o;n+=5)e.cells.at(n,1).type=G.Wall0000,e.cells.at(t-n,1).type=G.Wall0000}(l),function(e,t,o,n,r){let s=0;for(const i of t){if(s>=e)break;if(i.roomType!=re.PublicRoom&&i.roomType!=re.PrivateRoom)continue;let t=0;for(const e of i.edges)o[e].door&&(t+=1);t<2&&He(i.posMin,i.posMax,n,r)&&++s}for(const o of t){if(s>=e)break;o.roomType==re.PrivateRoom&&(r.random()<.2||He(o.posMin,o.posMax,n,r)&&++s)}let a=i.fromValues(0,0),l=i.fromValues(n.cells.sizeX,n.cells.sizeY);for(let t=1e3;t>0&&s<e;--t)He(a,l,n,r)&&++s;console.assert(s===e)}(t.totalLoot,u,c,l,o),function(e){for(let t=0;t<e.sizeX;++t)for(let o=0;o<e.sizeY;++o){e.at(t,o).type==G.Wall0000&&(e.at(t,o).type=Pe(We(e,t,o)))}}(a),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let n=0;n<t;++n)for(let t=0;t<o;++t){const o=e.cells.at(n,t),r=o.type,i=r>=G.Wall0000&&r<=G.Wall1111,s=Se(r),a=r==G.GroundWater;o.moveCost=i||s?1/0:a?4096:0,o.blocksPlayerMove=i,o.blocksPlayerSight=i,o.blocksSight=i,o.blocksSound=i,o.hidesPlayer=!1}for(const t of e.items){let o=e.cells.at(t.pos[0],t.pos[1]),n=t.type;o.moveCost=Math.max(o.moveCost,Y(n)),n!=X.DoorNS&&n!=X.DoorEW||(o.blocksPlayerSight=!0),n!=X.DoorNS&&n!=X.DoorEW&&n!=X.PortcullisNS&&n!=X.PortcullisEW&&n!=X.Bush||(o.blocksSight=!0),n!=X.Table&&n!=X.Bush||(o.hidesPlayer=!0)}}(l);const h=function(e,t,o,n,r){const s=Array(o.length).fill(!1);for(let e=0;e<o.length;++e){o[e].roomType!==re.Exterior&&(s[e]=!0)}const a=[];for(let e=0;e<o.length;++e)a.push({roomIndex:e,nodeIndexNext:-1,nodeIndexPrev:-1,visited:!1});const l=[...n];r.shuffleArray(l);for(const e of l){if(!e.door)continue;const t=e.room_left,o=e.room_right;if(!s[t]||!s[o])continue;const n=a[t],r=a[o];-1==n.nodeIndexNext&&-1==r.nodeIndexPrev?(n.nodeIndexNext=o,r.nodeIndexPrev=t):-1==r.nodeIndexNext&&-1==n.nodeIndexPrev?(r.nodeIndexNext=t,n.nodeIndexPrev=o):-1==n.nodeIndexNext&&-1==r.nodeIndexNext?(he(a,o),n.nodeIndexNext=o,r.nodeIndexPrev=t):-1==n.nodeIndexPrev&&-1==r.nodeIndexPrev&&(pe(a,t),n.nodeIndexNext=o,r.nodeIndexPrev=t)}for(let t=0;t<a.length;++t){if(a[t].visited)continue;if(xe(a,t),ge(a,t))continue;_e(a,t,Math.max(3,10-e))}for(const e of l){if(!e.door)continue;if(!s[e.room_left]||!s[e.room_right])continue;const t=e.room_left,o=e.room_right,n=a[t],r=a[o];if(-1==n.nodeIndexNext&&-1==n.nodeIndexPrev&&-1!=r.nodeIndexNext&&-1!=r.nodeIndexPrev){const e=a.length,i=r.nodeIndexNext;a.push({roomIndex:r.roomIndex,nodeIndexNext:r.nodeIndexNext,nodeIndexPrev:t,visited:!1}),r.nodeIndexNext=t,n.nodeIndexPrev=o,n.nodeIndexNext=e,a[i].nodeIndexPrev=e}else if(-1!=n.nodeIndexNext&&-1!=n.nodeIndexPrev&&-1==r.nodeIndexNext&&-1==r.nodeIndexPrev){const e=a.length,i=n.nodeIndexNext;a.push({roomIndex:n.roomIndex,nodeIndexNext:n.nodeIndexNext,nodeIndexPrev:o,visited:!1}),n.nodeIndexNext=o,r.nodeIndexNext=e,r.nodeIndexPrev=t,a[i].nodeIndexPrev=e}}const u=Array(a.length).fill(!1),c=[];for(let e=0;e<a.length;++e){const s=a[e];if(u[e])continue;if(-1==s.nodeIndexNext&&-1==s.nodeIndexPrev){u[e]=!0;continue}const l=[];for(let s=fe(a,e);-1!=s&&!u[s];s=a[s].nodeIndexNext){u[s]=!0;const e=a[s],c=-1==e.nodeIndexNext?null:a[e.nodeIndexNext],d=-1==e.nodeIndexPrev?null:a[e.nodeIndexPrev],h=e.roomIndex,p=c?c.roomIndex:-1,f=d?d.roomIndex:-1,g=i.create(),m=i.create();if(-1===f){const e=we(t,o[h]);e.length>0?i.copy(g,e[r.randomInRange(e.length)]):ve(g,o,n,h,p,t),ye(m,o,n,h,p),l.push(i.clone(g)),l.push(i.clone(g))}else if(-1===p){ye(g,o,n,h,f);const e=we(t,o[h]);e.length>0?i.copy(m,e[r.randomInRange(e.length)]):ve(m,o,n,h,f,t)}else if(p===f){ye(g,o,n,h,f);const e=we(t,o[h]);e.length>0?i.copy(m,e[r.randomInRange(e.length)]):ve(m,o,n,h,f,t);for(const e of be(t,g,m))l.push(e);l.push(i.clone(m)),l.push(i.clone(m)),l.push(i.clone(m)),i.copy(g,m),ye(m,o,n,h,p)}else ye(g,o,n,h,f),ye(m,o,n,h,p);const x=be(t,g,m);for(const e of x)l.push(e);-1===p&&(l.push(i.clone(m)),l.push(i.clone(m)),l.push(i.clone(m)))}c.push(l)}if(e>5){const e=[],o=2,n=2,r=t.cells.sizeX-3,s=t.cells.sizeY-3;for(let t=o;t<r;++t)e.push(i.fromValues(t,n));for(let t=n;t<s;++t)e.push(i.fromValues(r,t));for(let t=r;t>o;--t)e.push(i.fromValues(t,s));for(let t=s;t>n;--t)e.push(i.fromValues(o,t));c.push(e),c.push(function(e,t){const o=[];for(let n=t;n<e.length;++n)o.push(e[n]);for(let n=0;n<t;++n)o.push(e[n]);return o}(e,Math.floor(e.length/2)))}return c}(e,l,u,c,o);return function(e,t,o,n){if(e<=0)return;for(const r of o){const o=new I(r,0,t);e>1&&n.randomInRange(5+e)<e&&(o.hasTorch=!0),t.guards.push(o)}}(e,l,h,o),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let n=0;n<t;++n)for(let r=0;r<o;++r)(e.cells.at(n,r).type==G.GroundNormal||n>0&&e.cells.at(n-1,r).type==G.GroundNormal||n>0&&r>0&&e.cells.at(n-1,r-1).type==G.GroundNormal||n>0&&r+1<o&&e.cells.at(n-1,r+1).type==G.GroundNormal||r>0&&e.cells.at(n,r-1).type==G.GroundNormal||r+1<o&&e.cells.at(n,r+1).type==G.GroundNormal||n+1<t&&e.cells.at(n+1,r).type==G.GroundNormal||n+1<t&&r>0&&e.cells.at(n+1,r-1).type==G.GroundNormal||n+1<t&&r+1<o&&e.cells.at(n+1,r+1).type==G.GroundNormal)&&(e.cells.at(n,r).seen=!0)}(l),l.computeLighting(),l.recomputeVisibility(l.playerStartPos),l}function ue(e,t,o,n){for(let r=o;r<=n;++r)e.at(t,r).type=G.Wall0000}function ce(e,t,o,n){for(let r=t;r<=n;++r)e.at(r,o).type=G.Wall0000}function de(e,t,o){if(t!=o)for(const n of e)n.group==t&&(n.group=o)}function he(e,t){let o=-1;for(;-1!=t;){const n=e[t].nodeIndexPrev;e[t].nodeIndexNext=n,e[t].nodeIndexPrev=o,o=t,t=n}}function pe(e,t){let o=-1;for(;-1!=t;){const n=e[t].nodeIndexNext;e[t].nodeIndexPrev=n,e[t].nodeIndexNext=o,o=t,t=n}}function fe(e,t){let o=t;for(;-1!=e[o].nodeIndexPrev&&(o=e[o].nodeIndexPrev,o!=t););return o}function ge(e,t){for(let o=e[t].nodeIndexNext;-1!=o;o=e[o].nodeIndexNext)if(o==t)return!0;return!1}function me(e,t){let o=0,n=fe(e,t);for(let t=n;-1!=t&&(++o,e[t].nodeIndexNext!=n);t=e[t].nodeIndexNext);return o}function xe(e,t){let o=fe(e,t);for(let t=o;-1!=t&&(e[t].visited=!0,e[t].nodeIndexNext!=o);t=e[t].nodeIndexNext);}function _e(e,t,o){const n=fe(e,t);let r=n,i=0;for(;;){const t=e[r].nodeIndexNext;if(-1==t)break;if(me(e,r)<2*o)break;if(++i,i>=o&&(i=0,e[r].nodeIndexNext=-1,e[t].nodeIndexPrev=-1),r=t,r==n)break}}function ye(e,t,o,n,r){for(const s of t[n].edges){const t=o[s];if(t.room_left===n&&t.room_right===r||t.room_left===r&&t.room_right===n)return void i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset)}i.zero(e)}function ve(e,t,o,n,r,s){for(const a of t[n].edges){const t=o[a];if(t.room_left===n&&t.room_right===r){i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset);const o=i.fromValues(-t.dir[1],t.dir[0]);return i.scaleAndAdd(e,e,o,2),void(0!=s.cells.at(e[0],e[1]).moveCost&&i.scaleAndAdd(e,e,o,-1))}if(t.room_left===r&&t.room_right===n){i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset);const o=i.fromValues(t.dir[1],-t.dir[0]);return i.scaleAndAdd(e,e,o,2),void(0!=s.cells.at(e[0],e[1]).moveCost&&i.scaleAndAdd(e,e,o,-1))}}i.zero(e)}function we(e,t){const o=[];for(let n=t.posMin[0];n<t.posMax[0];++n){if(t.posMin[1]>0){e.cells.at(n,t.posMin[1]-1).type==G.OneWayWindowS&&0===e.cells.at(n,t.posMin[1]).moveCost&&o.push(i.fromValues(n,t.posMin[1]))}if(t.posMax[1]<e.cells.sizeY){e.cells.at(n,t.posMax[1]).type==G.OneWayWindowN&&0===e.cells.at(n,t.posMax[1]-1).moveCost&&o.push(i.fromValues(n,t.posMax[1]-1))}}for(let n=t.posMin[1];n<t.posMax[1];++n){if(t.posMin[0]>0){e.cells.at(t.posMin[0]-1,n).type==G.OneWayWindowW&&0===e.cells.at(t.posMin[0],n).moveCost&&o.push(i.fromValues(t.posMin[0],n))}if(t.posMax[0]<e.cells.sizeX){e.cells.at(t.posMax[0],n).type==G.OneWayWindowE&&0===e.cells.at(t.posMax[0]-1,n).moveCost&&o.push(i.fromValues(t.posMax[0]-1,n))}}if(o.length>0)return o;for(const n of e.items)if(n.type==X.Coin&&n.pos[0]>=t.posMin[0]&&n.pos[1]>=t.posMin[1]&&n.pos[0]<t.posMax[0]&&n.pos[1]<t.posMax[1])for(const r of[[1,0],[-1,0],[0,1],[0,-1]]){const s=n.pos[0]+r[0],a=n.pos[1]+r[1];s<t.posMin[0]||a<t.posMin[1]||s>=t.posMax[0]||a>=t.posMax[1]||0==e.cells.at(s,a).moveCost&&o.push(i.fromValues(s,a))}if(o.length>0)return o;for(const n of e.items)n.type==X.Chair&&n.pos[0]>=t.posMin[0]&&n.pos[1]>=t.posMin[1]&&n.pos[0]<t.posMax[0]&&n.pos[1]<t.posMax[1]&&o.push(i.clone(n.pos));return o}function Se(e){return e>=G.OneWayWindowE&&e<=G.OneWayWindowS}function be(e,t,o){const n=e.computeDistancesToPosition(o),r=i.clone(t),s=[];for(;r[0]!==o[0]||r[1]!==o[1];){s.push(i.clone(r));const t=Ae(e,n,r);if(t[0]===r[0]&&t[1]===r[1])break;i.copy(r,t)}return s}function Ae(e,t,o){let n=1/0,r=i.clone(o);const s=i.fromValues(Math.max(0,o[0]-1),Math.max(0,o[1]-1)),a=i.fromValues(Math.min(e.cells.sizeX,o[0]+2),Math.min(e.cells.sizeY,o[1]+2));for(let l=s[0];l<a[0];++l)for(let u=s[1];u<a[1];++u){const s=t.get(l,u);if(s==1/0)continue;let a=i.fromValues(l,u);e.guardMoveCost(o,a)!=1/0&&(e.cells.at(a[0],a[1]).type!=G.GroundWater&&s<n&&(n=s,r=a))}if(r[0]===o[0]&&r[1]===o[1]){console.log("failed to proceed");for(let e=s[0];e<a[0];++e)for(let o=s[1];o<a[1];++o){const n=t.get(e,o);console.log(e,o,n)}}return r}(ie=re||(re={}))[ie.Exterior=0]="Exterior",ie[ie.PublicCourtyard=1]="PublicCourtyard",ie[ie.PublicRoom=2]="PublicRoom",ie[ie.PrivateCourtyard=3]="PrivateCourtyard",ie[ie.PrivateRoom=4]="PrivateRoom";const Le=[G.OneWayWindowS,G.OneWayWindowE,G.OneWayWindowN,G.OneWayWindowW];function Te(e){return Le[e[0]+2*Math.max(0,e[1])+1]}function Ie(e,t){return 0===e||t.random()<.5?X.TorchUnlit:X.TorchLit}function Me(e,t,o,n){(function(e,t,o){return e.at(t-1,o).type>=G.PortcullisNS||(e.at(t+1,o).type>=G.PortcullisNS||(e.at(t,o-1).type>=G.PortcullisNS||e.at(t,o+1).type>=G.PortcullisNS))})(e.cells,t,o)||(n!=X.TorchUnlit&&n!=X.TorchLit||!function(e,t,o){return!!Se(e.at(t-1,o).type)||(!!Se(e.at(t+1,o).type)||(!!Se(e.at(t,o-1).type)||!!Se(e.at(t,o+1).type)))}(e.cells,t,o))&&Re(e,t,o,n)}function Re(e,t,o,n){e.items.push({pos:i.fromValues(t,o),type:n})}function He(e,t,o,n){let r=t[0]-e[0],s=t[1]-e[1];for(let t=1e3;t>0;--t){let t=i.fromValues(e[0]+n.randomInRange(r),e[1]+n.randomInRange(s)),a=o.cells.at(t[0],t[1]).type;if((a==G.GroundWood||a==G.GroundMarble)&&!ke(o,t[0],t[1]))return Re(o,t[0],t[1],X.Coin),!0}return!1}function ke(e,t,o){for(const n of e.items)if(n.pos[0]==t&&n.pos[1]==o)return!0;for(const n of e.guards)if(n.pos[0]==t&&n.pos[1]==o)return!0;return!1}function Ce(e){switch(e){case re.Exterior:return!1;case re.PublicCourtyard:return!0;case re.PublicRoom:return!1;case re.PrivateCourtyard:return!0;case re.PrivateRoom:return!1}}function Pe(e){return G.Wall0000+e}function Ee(e){return e>=G.Wall0000&&e<=G.DoorEW}function We(e,t,o){const n=e.sizeX;let r=0;return o<e.sizeY-1&&Ee(e.at(t,o+1).type)&&(r|=8),o>0&&Ee(e.at(t,o-1).type)&&(r|=4),t<n-1&&Ee(e.at(t+1,o).type)&&(r|=2),t>0&&Ee(e.at(t-1,o).type)&&(r|=1),r}class Ue{getScreenSize(e){}beginFrame=e=>{};start(e,t){}addGlyph(e,t,o,n,r,i=!0){}flush(){}constructor(e,t,o){this.tileSet=t,this.fontTileSet=o;const n=e.getContext("webgl2",{alpha:!1,depth:!1}),r=[o.image,t.image].map((e=>function(e,t){const o=16,n=16,r=o*n,i=t.naturalWidth/o,s=t.naturalHeight/n,a=1,l=i*a,u=s*a,c=document.createElement("canvas");c.width=l,c.height=u*r;const d=c.getContext("2d");d.imageSmoothingEnabled=!1;for(let e=0;e<n;++e)for(let n=0;n<o;++n){const r=n*i,a=e*s,c=0,h=(o*e+n)*u;d.drawImage(t,r,a,i,s,c,h,l,u)}const h=d.getImageData(0,0,c.width,c.height),p=new Uint8Array(h.data.buffer),f=e.createTexture();return e.bindTexture(e.TEXTURE_2D_ARRAY,f),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,l,u,r,0,e.RGBA,e.UNSIGNED_BYTE,p),f}(n,e))),s={vPosition:0,vTexcoord:1,vColor:2},l=[t.tileSize[0]/t.cellSize[0],t.tileSize[1]/t.cellSize[1]],u=function(e,t,o,n){const r=Fe(e,e.VERTEX_SHADER,t),i=Fe(e,e.FRAGMENT_SHADER,o),s=e.createProgram();e.attachShader(s,r),e.attachShader(s,i);for(const t in n)e.bindAttribLocation(s,n[t],t);e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s));return s}(n,"#version 300 es\n            in vec2 vPosition;\n            in vec3 vTexcoord;\n            in vec4 vColor;\n\n            uniform mat4 uMatScreenFromWorld;\n\n            out highp vec3 fTexcoord;\n            out highp vec4 fColor;\n\n            void main() {\n                fTexcoord = vTexcoord;\n                fColor = vColor;\n                gl_Position = uMatScreenFromWorld * vec4(vPosition, 0, 1);\n            }\n        ","#version 300 es\n            in highp vec3 fTexcoord;\n            in highp vec4 fColor;\n\n            uniform highp sampler2DArray uOpacity;\n\n            out lowp vec4 fragColor;\n\n            void main() {\n                fragColor = fColor * texture(uOpacity, fTexcoord);\n            }\n        ",s),c=n.getUniformLocation(u,"uMatScreenFromWorld"),d=n.getUniformLocation(u,"uOpacity"),h=2*Float32Array.BYTES_PER_ELEMENT+2*Uint32Array.BYTES_PER_ELEMENT,p=h,f=new ArrayBuffer(256*h),g=new Float32Array(f),m=new Uint32Array(f),x=n.createBuffer();let _=0;const y=a.create(),v=n.createVertexArray();n.bindVertexArray(v),n.enableVertexAttribArray(s.vPosition),n.enableVertexAttribArray(s.vTexcoord),n.enableVertexAttribArray(s.vColor),n.bindBuffer(n.ARRAY_BUFFER,x),n.vertexAttribPointer(s.vPosition,2,n.FLOAT,!1,h,0),n.vertexAttribPointer(s.vTexcoord,3,n.UNSIGNED_BYTE,!1,h,8),n.vertexAttribPointer(s.vColor,4,n.UNSIGNED_BYTE,!0,h,12),n.bufferData(n.ARRAY_BUFFER,f,n.DYNAMIC_DRAW);!function(e,t){const o=new Uint16Array(6*t);for(let e=0;e<t;++e){let t=6*e,n=4*e;o[t+0]=n+0,o[t+1]=n+1,o[t+2]=n+2,o[t+3]=n+2,o[t+4]=n+1,o[t+5]=n+3}const n=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW)}(n,64);n.bindVertexArray(null),this.getScreenSize=e=>{const t=n.canvas;Ge(t);const o=t.clientWidth,r=t.clientHeight;i.set(e,o,r)},this.start=(e,t)=>{a.copy(y,e),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D_ARRAY,r[t])},this.addGlyph=(e,t,o,n,r,i=!0)=>{if(void 0===r.textureIndex)return;_>=64&&this.flush(),o=e+(o-e)*l[0],n=t+(n-t)*l[1];const s=i?r.color?r.color:4294967295:r.unlitColor?r.unlitColor:4294967295,a=_*p,u=r.textureIndex<<16;g[a+0]=e,g[a+1]=t,m[a+2]=u+256,m[a+3]=s,g[a+4]=o,g[a+5]=t,m[a+6]=u+257,m[a+7]=s,g[a+8]=e,g[a+9]=n,m[a+10]=u,m[a+11]=s,g[a+12]=o,g[a+13]=n,m[a+14]=u+1,m[a+15]=s,++_},this.flush=()=>{_<=0||(n.useProgram(u),n.bindVertexArray(v),n.uniform1i(d,0),n.uniformMatrix4fv(c,!1,y),n.bindBuffer(n.ARRAY_BUFFER,x),n.bufferSubData(n.ARRAY_BUFFER,0,g,0),n.drawElements(n.TRIANGLES,6*_,n.UNSIGNED_SHORT,0),n.bindVertexArray(null),_=0)},this.beginFrame=e=>{const t=n.canvas;Ge(t);const o=t.clientWidth,r=t.clientHeight;n.viewport(0,0,o,r),n.clear(n.COLOR_BUFFER_BIT)},n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.clearColor(0,0,0,1)}}function Fe(e,t,o){const n=e.createShader(t);return e.shaderSource(n,o),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n)),n}function Ge(e){e.width===window.innerWidth&&e.height===window.innerHeight||(e.width=window.innerWidth,e.height=window.innerHeight)}const De=4278190080,ze=4289200128,Ne=4278233088,Oe=4289243136,Xe=4278190248,Be=4278211752,Ye=4289243304,Ve=4283716692,je=4294857812,$e=4283760212,qe=4294901332,Ke=4294857982,Ze=4283760382,Qe=4294967295;var Je;Je=new URL(r("27Lyk").resolve("k57aN"),import.meta.url).toString();var et;et=new URL(r("27Lyk").resolve("dwPvt"),import.meta.url).toString();var tt;tt=new URL(r("27Lyk").resolve("7FSnQ"),import.meta.url).toString();var ot;ot=new URL(r("27Lyk").resolve("8dSx0"),import.meta.url).toString();function nt(e){return 16*e[1]+e[0]}const rt={name:"Basic Font",imageSrc:new URL(r("27Lyk").resolve("kDrfW"),import.meta.url).toString(),image:new Image,tileSize:[16,16],offset:[0,0],letterMap:[]},it={name:"Sin City Tileset",imageSrc:tt,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:nt([0,0])},terrainTiles:[{textureIndex:nt([5,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([2,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([4,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([0,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([1,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([1,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([0,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([2,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([4,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([6,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([1,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([9,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([8,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([12,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([3,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([10,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([7,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([14,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([5,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([13,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([11,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([15,1]),color:Ve,unlitColor:4287643712},{textureIndex:nt([0,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([2,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([3,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([1,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([10,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([10,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([6,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([4,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([2,4]),color:Ve,unlitColor:4287643712},{textureIndex:nt([2,4]),color:Ve,unlitColor:4287643712}],itemTiles:[{textureIndex:nt([3,3]),unlitColor:Ye},{textureIndex:nt([4,3]),unlitColor:Ye},{textureIndex:nt([2,3]),color:Ve,unlitColor:4287643712},{textureIndex:nt([5,3]),unlitColor:Ye},{textureIndex:nt([6,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([4,2]),color:Ve,unlitColor:4287643712},{textureIndex:nt([10,3]),color:Ve,unlitColor:4287643712},{textureIndex:nt([10,3]),color:Ve,unlitColor:4287643712},{textureIndex:nt([0,3]),unlitColor:Ye},{textureIndex:nt([1,3]),unlitColor:Ye},{textureIndex:nt([6,3]),unlitColor:Ye}],npcTiles:[{textureIndex:nt([3,5])},{textureIndex:nt([2,5])},{textureIndex:nt([4,5])},{textureIndex:nt([1,5])},{textureIndex:nt([3,5]),color:Ve},{textureIndex:nt([2,5]),color:Ve},{textureIndex:nt([4,5]),color:Ve},{textureIndex:nt([1,5]),color:Ve},{textureIndex:nt([3,5])},{textureIndex:nt([2,5])},{textureIndex:nt([4,5])},{textureIndex:nt([1,5])}],playerTiles:[{textureIndex:nt([0,5])},{textureIndex:nt([0,5]),color:Xe},{textureIndex:nt([0,5]),color:Ve},{textureIndex:nt([0,5]),color:4283716862},{textureIndex:nt([0,5]),color:Ye}],guardStateTiles:[{textureIndex:nt([4,0])},{textureIndex:nt([5,5])},{textureIndex:nt([6,5])}],ledgeTiles:[{textureIndex:nt([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([15,4]),color:4285753415,unlitColor:4282922024}]},st={name:"31 Color Tileset",imageSrc:et,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:nt([0,0])},touchButtons:{menu:{textureIndex:nt([15,0]),color:2701131775,unlitColor:2164260863},up:{textureIndex:nt([6,0]),color:2701131775,unlitColor:2164260863},down:{textureIndex:nt([7,0]),color:2701131775,unlitColor:2164260863},left:{textureIndex:nt([4,0]),color:2701131775,unlitColor:2164260863},right:{textureIndex:nt([5,0]),color:2701131775,unlitColor:2164260863},wait:{textureIndex:nt([8,0]),color:2701131775,unlitColor:2164260863},exitLevel:{textureIndex:nt([13,0]),color:4278255615,unlitColor:4278255615},jump:{textureIndex:nt([9,0]),color:2701131775,unlitColor:2164260863},zoomIn:{textureIndex:nt([10,0]),color:2701131775,unlitColor:2164260863},zoomOut:{textureIndex:nt([11,0]),color:2701131775,unlitColor:2164260863},heal:{textureIndex:nt([12,0]),color:2701131775,unlitColor:2164260863},startLevel:{textureIndex:nt([13,0]),color:2701131775,unlitColor:2164260863},nextLevel:{textureIndex:nt([13,0]),color:2701131775,unlitColor:2164260863},restart:{textureIndex:nt([14,0]),color:2701131775,unlitColor:2164260863},forceRestart:{textureIndex:nt([14,0]),color:2701131775,unlitColor:2164260863},gamepadTouchOn:{textureIndex:nt([13,2]),color:2701131775,unlitColor:4294967295},gamepadTouchOff:{textureIndex:nt([13,2]),color:2701131775,unlitColor:2164260863},picker:{textureIndex:nt([14,2]),color:4278255615,unlitColor:4278255615},fullscreen:{textureIndex:nt([15,2]),color:2701131775,unlitColor:2164260863}},terrainTiles:[{textureIndex:nt([11,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([8,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([10,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([0,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([7,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([11,5]),color:Qe,unlitColor:4288704624},{textureIndex:nt([0,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([2,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([4,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([6,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([1,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([9,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([8,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([12,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([3,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([10,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([7,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([14,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([5,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([13,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([11,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([15,11]),color:Qe,unlitColor:4288704624},{textureIndex:nt([0,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([2,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([3,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([1,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([14,12]),color:Qe,unlitColor:4288704624},{textureIndex:nt([13,12]),color:Qe,unlitColor:4288704624},{textureIndex:nt([7,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([5,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([8,4]),color:Qe,unlitColor:4288704624},{textureIndex:nt([8,4]),color:Qe,unlitColor:4288704624}],itemTiles:[{textureIndex:nt([3,3]),unlitColor:4291866800},{textureIndex:nt([4,3]),unlitColor:4291866800},{textureIndex:nt([2,3]),color:Qe,unlitColor:4291858576},{textureIndex:nt([5,3]),unlitColor:4294967295},{textureIndex:nt([6,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([4,14]),color:Qe,unlitColor:4288704624},{textureIndex:nt([14,12]),color:Qe,unlitColor:4288704624},{textureIndex:nt([13,12]),color:Qe,unlitColor:4288704624},{textureIndex:nt([0,3]),unlitColor:4294967295},{textureIndex:nt([1,3]),unlitColor:4294967295},{textureIndex:nt([12,3]),unlitColor:4288704624}],npcTiles:[{textureIndex:nt([3,5])},{textureIndex:nt([2,5])},{textureIndex:nt([4,5])},{textureIndex:nt([1,5])},{textureIndex:nt([3,5]),color:Ve},{textureIndex:nt([2,5]),color:Ve},{textureIndex:nt([4,5]),color:Ve},{textureIndex:nt([1,5]),color:Ve},{textureIndex:nt([3,5])},{textureIndex:nt([2,5])},{textureIndex:nt([4,5])},{textureIndex:nt([1,5])}],playerTiles:[{textureIndex:nt([2,7])},{textureIndex:nt([2,7]),color:Xe},{textureIndex:nt([2,8]),color:Ve},{textureIndex:nt([2,7]),color:Qe},{textureIndex:nt([2,7]),color:Qe}],guardStateTiles:[{textureIndex:nt([4,0])},{textureIndex:nt([5,5])},{textureIndex:nt([6,5])}],ledgeTiles:[{textureIndex:nt([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([15,4]),color:4285753415,unlitColor:4282922024}]},at={name:"3/4 View Tileset",imageSrc:Je,image:new Image,tileSize:[24,36],cellSize:[24,24],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:nt([8,0])},terrainTiles:[{textureIndex:nt([8,3]),unlitColor:4288696400},{textureIndex:nt([6,3]),unlitColor:4288696400},{textureIndex:nt([10,3]),unlitColor:4288696400},{textureIndex:nt([4,1]),unlitColor:4288696400},{textureIndex:nt([9,3]),unlitColor:4288696400},{textureIndex:nt([9,3]),unlitColor:4288696400},{textureIndex:nt([0,0]),unlitColor:4288696400},{textureIndex:nt([8,2]),unlitColor:4288696400},{textureIndex:nt([7,2]),unlitColor:4288696400},{textureIndex:nt([4,3]),unlitColor:4288696400},{textureIndex:nt([4,2]),unlitColor:4288696400},{textureIndex:nt([1,2]),unlitColor:4288696400},{textureIndex:nt([0,2]),unlitColor:4288696400},{textureIndex:nt([5,2]),unlitColor:4288696400},{textureIndex:nt([0,3]),unlitColor:4288696400},{textureIndex:nt([2,2]),unlitColor:4288696400},{textureIndex:nt([3,2]),unlitColor:4288696400},{textureIndex:nt([4,2]),unlitColor:4288696400},{textureIndex:nt([5,3]),unlitColor:4288696400},{textureIndex:nt([7,2]),unlitColor:4288696400},{textureIndex:nt([6,2]),unlitColor:4288696400},{textureIndex:nt([1,0]),unlitColor:4288696400},{textureIndex:nt([4,0]),unlitColor:4288696400},{textureIndex:nt([3,0]),unlitColor:4288696400},{textureIndex:nt([2,0]),unlitColor:4288696400},{textureIndex:nt([2,1]),unlitColor:4288696400},{textureIndex:nt([0,1]),unlitColor:4288696400},{textureIndex:nt([1,1]),unlitColor:4288696400},{textureIndex:nt([6,0]),unlitColor:4288696400},{textureIndex:nt([5,0]),unlitColor:4288696400},{textureIndex:nt([6,3]),unlitColor:4288696400},{textureIndex:nt([6,3]),unlitColor:4288696400}],itemTiles:[{textureIndex:nt([5,5]),color:Be,unlitColor:Ve},{textureIndex:nt([3,5]),color:Be,unlitColor:Ve},{textureIndex:nt([0,6]),unlitColor:Ve},{textureIndex:nt([14,5]),color:Ze,unlitColor:Ve},{textureIndex:nt([6,0]),unlitColor:Ve},{textureIndex:nt([5,0]),unlitColor:Ve},{textureIndex:nt([0,1]),unlitColor:Ve},{textureIndex:nt([1,1]),unlitColor:Ve},{textureIndex:nt([15,4]),unlitColor:Ye},{textureIndex:nt([14,4]),unlitColor:Ye},{textureIndex:nt([13,4]),unlitColor:Ye}],npcTiles:[{textureIndex:nt([9,4])},{textureIndex:nt([10,4])},{textureIndex:nt([11,4])},{textureIndex:nt([12,4])},{textureIndex:nt([9,4]),color:Ve},{textureIndex:nt([10,4]),color:Ve},{textureIndex:nt([11,4]),color:Ve},{textureIndex:nt([12,4]),color:Ve},{textureIndex:nt([9,4])},{textureIndex:nt([10,4])},{textureIndex:nt([11,4])},{textureIndex:nt([12,4])}],playerTiles:[{textureIndex:nt([0,4]),color:Ve},{textureIndex:nt([0,4]),color:Xe},{textureIndex:nt([0,4]),color:3490713616},{textureIndex:nt([0,4]),color:qe},{textureIndex:nt([0,4]),color:je}],guardStateTiles:[{textureIndex:nt([0,4]),color:Ve},{textureIndex:nt([0,4]),color:Xe},{textureIndex:nt([0,4]),color:3490713616}],ledgeTiles:[{textureIndex:nt([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([15,4]),color:4285753415,unlitColor:4282922024}]};var lt,ut,ct={name:"Basic Tiles",imageSrc:ot,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:0,color:je},terrainTiles:[{textureIndex:112,color:Ye,unlitColor:ze},{textureIndex:116,color:Ne,unlitColor:ze},{textureIndex:118,color:je,unlitColor:ze},{textureIndex:120,color:Oe,unlitColor:ze},{textureIndex:122,color:Be,unlitColor:ze},{textureIndex:122,color:4278206576,unlitColor:ze},{textureIndex:64,color:Ye,unlitColor:ze},{textureIndex:65,color:Ye,unlitColor:ze},{textureIndex:65,color:Ye,unlitColor:ze},{textureIndex:65,color:Ye,unlitColor:ze},{textureIndex:66,color:Ye,unlitColor:ze},{textureIndex:67,color:Ye,unlitColor:ze},{textureIndex:70,color:Ye,unlitColor:ze},{textureIndex:73,color:Ye,unlitColor:ze},{textureIndex:66,color:Ye,unlitColor:ze},{textureIndex:68,color:Ye,unlitColor:ze},{textureIndex:69,color:Ye,unlitColor:ze},{textureIndex:72,color:Ye,unlitColor:ze},{textureIndex:66,color:Ye,unlitColor:ze},{textureIndex:74,color:Ye,unlitColor:ze},{textureIndex:71,color:Ye,unlitColor:ze},{textureIndex:75,color:Ye,unlitColor:ze},{textureIndex:52,color:Ye,unlitColor:ze},{textureIndex:53,color:Ye,unlitColor:ze},{textureIndex:54,color:Ye,unlitColor:ze},{textureIndex:55,color:Ye,unlitColor:ze},{textureIndex:50,color:Ye,unlitColor:ze},{textureIndex:50,color:Ye,unlitColor:ze},{textureIndex:77,color:Ye,unlitColor:ze},{textureIndex:76,color:Ye,unlitColor:ze},{textureIndex:116,color:Ne,unlitColor:ze},{textureIndex:116,color:Ne,unlitColor:ze}],itemTiles:[{textureIndex:100,color:Be,unlitColor:Ve},{textureIndex:98,color:Be,unlitColor:Ve},{textureIndex:96,color:Ne,unlitColor:Ve},{textureIndex:110,color:Ze,unlitColor:Ve},{textureIndex:89,color:Be,unlitColor:Ve},{textureIndex:87,color:Be,unlitColor:Ve},{textureIndex:50,color:Ye,unlitColor:Ve},{textureIndex:50,color:Ye,unlitColor:Ve},{textureIndex:80,color:Ve,unlitColor:Ve},{textureIndex:80,color:Ze,unlitColor:Ve},{textureIndex:80,color:Ze,unlitColor:Ve}],playerTiles:[{textureIndex:32,color:Ve},{textureIndex:32,color:Xe},{textureIndex:32,color:3490713616},{textureIndex:32,color:qe},{textureIndex:32,color:je}],guardStateTiles:[{textureIndex:0},{textureIndex:39},{textureIndex:40}],npcTiles:[{textureIndex:33},{textureIndex:34},{textureIndex:35},{textureIndex:36},{textureIndex:33,color:Ve},{textureIndex:34,color:Ve},{textureIndex:35,color:Ve},{textureIndex:36,color:Ve},{textureIndex:33,color:Ke},{textureIndex:34,color:Ke},{textureIndex:35,color:Ke},{textureIndex:36,color:Ke}],ledgeTiles:[{textureIndex:nt([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:nt([15,4]),color:4285753415,unlitColor:4282922024}]};
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||o;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||o;if(e=parseFloat(e),t.ctx||c(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=t._howls[n]._soundById(r[i]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||o;t.ctx||c(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,o.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var s=t._howls[n]._soundById(r[i]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||o,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||o,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||o)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||o;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||o,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",i=r.match(/OPR\/([0-6].)/g),s=i&&parseInt(i[0].split("/")[1],10)<33,a=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),l=r.match(/Version\/(.*?) /),u=a&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(s||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||o;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(o){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(o){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var i=e._howls[r]._getSoundIds(),s=0;s<i.length;s++){var a=e._howls[r]._soundById(i[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var o=0;o<e._howls.length;o++)e._howls[o]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||o;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||o;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&o.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&o.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var o=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var t=this;return o.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=o.usingWebAudio&&!t._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(o.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var i,a;if(e._format&&e._format[n])i=e._format[n];else{if("string"!=typeof(a=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(a))||(i=/\.([^.]+)$/.exec(a.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&o.codecs(i)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&s(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(i++,r=n._sounds[s]._id);1===i?e=null:r=null}}var a=r?n._soundById(r):n._inactiveSound();if(!a)return null;if(r&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var l=a._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(r&&!a._paused)return t||n._loadQueue("play"),a._id;n._webAudio&&o._autoResume();var u=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(a._rate),h=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var f=function(){a._paused=!1,a._seek=u,a._start=h,a._stop=p,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(u>=p)){var g=a._node;if(n._webAudio){var m=function(){n._playLock=!1,f(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;g.gain.setValueAtTime(e,o.ctx.currentTime),a._playStart=o.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,u,86400):g.bufferSource.noteGrainOn(0,u,c):a._loop?g.bufferSource.start(0,u,86400):g.bufferSource.start(0,u,c),d!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d)),t||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(a._id))}else{var x=function(){g.currentTime=u,g.muted=a._muted||n._muted||o._muted||g.muted,g.volume=a._volume*o.volume(),g.playbackRate=a._rate;try{var r=g.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,f(),r.then((function(){n._playLock=!1,g._unlocked=!0,t?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(n._playLock=!1,f(),n._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d):(n._endTimers[a._id]=function(){n._ended(a),g.removeEventListener("ended",n._endTimers[a._id],!1)},g.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=n._src,g.load());var _=window&&window.ejecta||!g.readyState&&o._navigator.isCocoonJS;if(g.readyState>=3||_)x();else{n._playLock=!0,n._state="loading";var y=function(){n._state="loaded",x(),g.removeEventListener(o._canPlayEvent,y,!1)};g.addEventListener(o._canPlayEvent,y,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),n=0;n<o.length;n++){t._clearTimer(o[n]);var r=t._soundById(o[n]);if(r&&!r._paused&&(r._seek=t.seek(o[n]),r._rateSeek=0,r._paused=!0,t._stopFade(o[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var n=o._getSoundIds(e),r=0;r<n.length;r++){o._clearTimer(n[r]);var i=o._soundById(n[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,o._stopFade(n[r]),i._node&&(o._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),o._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&o._clearSound(i._node))),t||o._emit("stop",i._id))}return o},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var s=n._soundById(r[i]);s&&(s._muted=e,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,o.ctx.currentTime):s._node&&(s._node.muted=!!o._muted||e),n._emit("mute",s._id))}return n},volume:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]?r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var s=0;s<t.length;s++)(n=r._soundById(t[s]))&&(n._volume=e,i[2]||r._stopFade(t[s]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,o.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*o.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,r)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,r);for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(r||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=o.ctx.currentTime,c=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,n,s[a],void 0===r)}}return i},_startFadeInterval:function(e,t,o,n,r,i){var s=this,a=t,l=o-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),d=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var r=(Date.now()-d)/n;d=Date.now(),a+=l*r,a=Math.round(100*a)/100,a=l<0?Math.max(o,a):Math.min(o,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),i&&(s._volume=a),(o<t&&a<=o||o>t&&a>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(o,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,o,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(o=n._soundById(parseInt(r[0],10)))&&o._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var i=n._getSoundIds(t),s=0;s<i.length;s++)(o=n._soundById(i[s]))&&(o._loop=e,n._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,n.playing(i[s])&&(n.pause(i[s],!0),n.play(i[s],!0)))));return n},rate:function(){var e,t,n,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var s=0;s<t.length;s++)if(n=r._soundById(t[s])){r.playing(t[s])&&(n._rateSeek=r.seek(t[s]),n._playStart=r._webAudio?o.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,o.ctx.currentTime):n._node&&(n._node.playbackRate=e);var a=r.seek(t[s]),l=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-a)/Math.abs(n._rate);!r._endTimers[t[s]]&&n._paused||(r._clearTimer(t[s]),r._endTimers[t[s]]=setTimeout(r._ended.bind(r,n),l)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var i=n._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var s=n.playing(t)?o.ctx.currentTime-i._playStart:0,a=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(a+s*Math.abs(i._rate))}return i._node.currentTime}var l=n.playing(t);l&&n.pause(t,!0),i._seek=e,i._ended=!1,n._clearTimer(t),n._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var u=function(){l&&n.play(t,!0),n._emit("seek",t)};if(l&&!n._webAudio){var c=function(){n._playLock?setTimeout(c,0):u()};setTimeout(c,0)}else u()}return n},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,n=t._soundById(e);return n&&(o=t._sprite[n._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(o._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),o._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var r=o._howls.indexOf(e);r>=0&&o._howls.splice(r,1);var s=!0;for(n=0;n<o._howls.length;n++)if(o._howls[n]._src===e._src||e._src.indexOf(o._howls[n]._src)>=0){s=!1;break}return i&&s&&delete i[e._src],o.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,n){var r=this["_on"+e];return"function"==typeof t&&r.push(n?{id:o,fn:t,once:n}:{id:o,fn:t}),this},off:function(e,t,o){var n=this,r=n["_on"+e],i=0;if("number"==typeof t&&(o=t,t=null),t||o)for(i=0;i<r.length;i++){var s=o===r[i].id;if(t===r[i].fn&&s||!t&&s){r.splice(i,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(n[a[i]])&&(n[a[i]]=[])}return n},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var n=this,r=n["_on"+e],i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(n,r[i].fn),0),r[i].once&&n.off(e,r[i].fn,r[i].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var r=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=o.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),o._autoSuspend()),t._webAudio||r||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,o=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&o++;for(n=e._sounds.length-1;n>=0;n--){if(o<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=o.ctx.createBufferSource(),e._node.bufferSource.buffer=i[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,o.ctx.currentTime),this},_cleanBuffer:function(e){var t=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=o._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++o._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=o._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),e._node.gain.setValueAtTime(n,o.ctx.currentTime),e._node.paused=!0,e._node.connect(o.masterGain)):o.noAudio||(e._node=o._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(o._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*o.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++o._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(o._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var i={},s=function(e){var t=e._src;if(i[t])return e._duration=i[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),r=0;r<o.length;++r)n[r]=o.charCodeAt(r);l(n.buffer,e)}else{var s=new XMLHttpRequest;s.open(e._xhr.method,t,!0),s.withCredentials=e._xhr.withCredentials,s.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){s.setRequestHeader(t,e._xhr.headers[t])})),s.onload=function(){var t=(s.status+"")[0];"0"===t||"2"===t||"3"===t?l(s.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete i[t],e.load())},a(s)}},a=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&t._sounds.length>0?(i[t._src]=e,u(t,e)):n()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(e).then(r).catch(n):o.ctx.decodeAudioData(e,r,n)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(e){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),t=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!r&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:o,Howl:n}})),lt=o,ut=n,void 0!==t?(t.HowlerGlobal=e,t.Howler=o,t.Howl=n,t.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=o,window.Howl=n,window.Sound=r)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var o=t._howls.length-1;o>=0;o--)t._howls[o].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,o){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,o="number"!=typeof o?n._pos[2]:o,"number"!=typeof e?n._pos:(n._pos=[e,t,o],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,o,n,r,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,o="number"!=typeof o?a[2]:o,n="number"!=typeof n?a[3]:n,r="number"!=typeof r?a[4]:r,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(s._orientation=[e,t,o,n,r,i],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,o,n,r,i),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var o=this;return o._orientation=t.orientation||[1,0,0],o._stereo=t.stereo||null,o._pos=t.pos||null,o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},o._onstereo=t.onstereo?[{fn:t.onstereo}]:[],o._onpos=t.onpos?[{fn:t.onpos}]:[],o._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,o){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,o)}}),n;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===o){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var i=n._getSoundIds(o),s=0;s<i.length;s++){var a=n._soundById(i[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,r),"spatial"===r?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(e,o,n,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,o,n,r)}}),i;if(o="number"!=typeof o?0:o,n="number"!=typeof n?-.5:n,void 0===r){if("number"!=typeof e)return i._pos;i._pos=[e,o,n]}for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,o,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,o,n)),i._emit("pos",l._id)}}return i},Howl.prototype.orientation=function(e,o,n,r){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,o,n,r)}}),i;if(o="number"!=typeof o?i._orientation[1]:o,n="number"!=typeof n?i._orientation[2]:n,void 0===r){if("number"!=typeof e)return i._orientation;i._orientation=[e,o,n]}for(var s=i._getSoundIds(r),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,o,n],l._node&&(l._panner||(l._pos||(l._pos=i._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,o,n)),i._emit("orientation",l._id)}}return i},Howl.prototype.pannerAttr=function(){var e,o,n,r=this,i=arguments;if(!r._webAudio)return r;if(0===i.length)return r._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return(n=r._soundById(parseInt(i[0],10)))?n._pannerAttr:r._pannerAttr;e=i[0],void 0===o&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===i.length&&(e=i[0],o=parseInt(i[1],10));for(var s=r._getSoundIds(o),a=0;a<s.length;a++)if(n=r._soundById(s[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=r._pos||[0,0,-.5]),t(n,"spatial"))}return r},Sound.prototype.init=function(e){return function(){var t=this,o=t._parent;t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,e.call(this),t._stereo?o.stereo(t._stereo):t._pos&&o.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,o=t._parent;return t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,t._stereo?o.stereo(t._stereo):t._pos?o.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,o._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var dt={};dt=new URL(r("27Lyk").resolve("8Qic0"),import.meta.url).toString();var ht={};ht=new URL(r("27Lyk").resolve("dci1D"),import.meta.url).toString();var pt={};pt=new URL(r("27Lyk").resolve("6wmQa"),import.meta.url).toString();var ft={};ft=new URL(r("27Lyk").resolve("8AE6h"),import.meta.url).toString();var gt={};gt=new URL(r("27Lyk").resolve("25Nym"),import.meta.url).toString();var mt={};mt=new URL(r("27Lyk").resolve("9HrbR"),import.meta.url).toString();var xt={};xt=new URL(r("27Lyk").resolve("2fyQO"),import.meta.url).toString();var _t={};_t=new URL(r("27Lyk").resolve("4qSI0"),import.meta.url).toString();var yt={};yt=new URL(r("27Lyk").resolve("3kwMs"),import.meta.url).toString();var vt={};vt=new URL(r("27Lyk").resolve("3zakP"),import.meta.url).toString();const wt=[r("bgyNt"),r("coakI"),r("7XfMr"),r("5jIXu"),r("h61MQ"),r("1OFiM"),r("hadbD"),r("dH5ka"),r("3twvr"),r("bBbdi")],St=[r("kBrAM"),r("k6Tdk"),r("vDQ5G"),r("7DVvx"),r("al4v1"),r("fO2Fk"),r("kaxMC")],bt=[r("iCU64"),r("a3sPN"),r("9Y9d3"),r("a8Yhh"),r("9KHDZ")],At=[r("iwg1C"),r("1Pqyv"),r("dbi61"),r("eqZ24"),r("hrr2C"),r("4rxiD"),r("hDCXU"),r("csjYK")],Lt=[r("dd6E3"),r("6caUR"),r("1EZIJ"),r("fUa8r")],Tt=[r("lJQp1"),r("5GWta")],It=[r("7EXkE"),r("1XbhS"),r("8Ar5m"),r("dxxly"),r("i5lIC"),r("03tgW")],Mt=[r("1O5GN"),r("kflbA"),r("kZcYE"),r("coJ2V"),r("j6GfU")],Rt=[r("6pCtM"),r("3gtmZ")],Ht=[r("ieFNs"),r("aSCaY")],kt=[[r("eiW2b"),"Hmm..."],[r("6x7Kh"),"What?"],[r("bMjEO"),"Hey!"],[r("3mayG"),"Hey!"],[r("blCN3"),"Hey!"],[r("bGiLK"),"What was that?"],[r("bjubH"),"What was that?"],[r("4PUSb"),"What was that?"],[r("1N1FC"),"What was that?"],[r("ktUCQ"),"What was that?"],[r("9xpZV"),"Who goes there?"],[r("8QCS3"),"Huh?"],[r("6x7Kh"),"What?"],[r("a0v0l"),"Wha..."],[r("1lD69"),"Wait!"],[r("jfcxP"),"Who's out there?"],[r("ilgo9"),"What moved?"],[r("92tfF"),"What' in the shadows?"],[r("etshw"),"Did the shadows move?"],[r("5mgz9"),"Did I see something?"],[r("61v8j"),"Hello?"],[r("dKL59"),"Ugh..."]],Ct=[[r("eiW2b"),"Hmm..."],[r("6x7Kh"),"What?"],[r("bGiLK"),"What was that?"],[r("bnVxc"),"Quiet out..."],[r("8YZcm"),"Jumpy tonight..."],[r("rmNTt"),"I'm jumpin' at shadows..."],[r("4xVWY"),"Ahh..."],[r("4xVWY"),"Ahh..."],[r("eiW2b"),"Hmm..."],[r("61Svf"),"Aww..."],[r("86i15"),"Rest me bones..."],[r("eCMLG"),"Oh well..."],[r("hkgAs"),"Case of the jitters..."],[r("eV2Mu"),"Must be seeing..."],[r("fzoRy"),"What's in my coffee today?"],[r("bn9kD"),"Coffee must be too strong!"],[r("dKFtp"),"Hmm nothing..."],[r("awcka"),"Well I though I saw something."],[r("52i2z"),"Nothing..."],[r("iyeOS"),"Hopefully nothing."],[r("gb2R8"),"Must be seeing things..."],[r("gb2R8"),"I must be seeing things."]],Pt=[[r("eiW2b"),"Hmm..."],[r("6x7Kh"),"What?"],[r("aGgZh"),"What?"],[r("bMjEO"),"Hey!"],[r("3mayG"),"Hey!"],[r("blCN3"),"Hey!"],[r("bGiLK"),"What was that?"],[r("bjubH"),"What was that?"],[r("4PUSb"),"What was that?"],[r("1N1FC"),"What was that?"],[r("ktUCQ"),"What was that?"],[r("8QCS3"),"Huh?"],[r("6x7Kh"),"What?"],[r("a0v0l"),"Wha..."],[r("1lD69"),"Wait!"],[r("jfcxP"),"Who's out there?"],[r("61v8j"),"Hello?"],[r("dKL59"),"Ugh..."],[r("b6tdD"),"Hark?"],[r("UYsu8"),"What was that noise?"],[r("e0y8E"),"I heard something..."]],Et=[[r("eiW2b"),"Hmm..."],[r("bGiLK"),"What was that?"],[r("bnVxc"),"Quiet out..."],[r("8YZcm"),"Jumpy tonight..."],[r("4xVWY"),"Ahh..."],[r("4xVWY"),"Ahh..."],[r("eiW2b"),"Hmm..."],[r("61Svf"),"Aww..."],[r("86i15"),"Rest me bones..."],[r("eCMLG"),"Oh well..."],[r("hkgAs"),"Case of the jitters..."],[r("fzoRy"),"What's in my coffee today?"],[r("bn9kD"),"Coffee must be too strong!"],[r("dKFtp"),"Hmm nothing..."],[r("6QVDF"),"Can't hear it now."],[r("52i2z"),"Nothing..."],[r("iyeOS"),"Hopefully nothing."],[r("4q9kg"),"I must be hearing things."]],Wt=[[r("eiW2b"),"Hmm..."],[r("bMjEO"),"Hey!"],[r("3mayG"),"Hey!"],[r("blCN3"),"Hey!"],[r("6x7Kh"),"What?"],[r("2zxmO"),"That noise again?"],[r("7rF1E"),"Someone there?"],[r("kQvBC"),"Who could that be?"],[r("2hpzi"),"There it is again."],[r("9gwX6"),"Better check it out."],[r("88Oom"),"What keeps making those noises?"],[r("kc3NH"),"Better be rats!"],[r("40CPy"),"Again!?"],[r("lJn7Q"),"Who is that?"],[r("eBHTR"),"Come out, Come out!"]],Ut=[[r("eiW2b"),"Hmm..."],[r("rmNTt"),"Jumpin' at shadows!"],[r("8YZcm"),"Jumpy!"],[r("eCMLG"),"Oh, well."],[r("g5A67"),"Guess it was nothing."],[r("kyAEI"),"Wonder what it was."],[r("g7feg"),"Back to my post."],[r("a1Jxk"),"All quiet now."],[r("bKUzC"),"I'm sure I heard something."],[r("9aXjz"),"Not there anymore."],[r("hfvuU"),"Probably nothing."],[r("dKFtp"),"Hmm, nothing."],[r("4gLkA"),"I dont know why I work here."],[r("3HAUN"),"Waste of my time."],[r("la1r7"),"Why do I even try."],[r("9fSJi"),"At least I'm not on cleaning duty."],[r("k1qbX"),"At least my shift ends soon."],[r("1u6dV"),"What do you want me to do about it?"]],Ft=[[r("dPu8f"),"(Whistles to other guard)"],[r("bSHoC"),"(Whistles to other guard)"],[r("betci"),"(Whistles to other guard)"],[r("blCN3"),"(To other guard) Hey!"],[r("6x7Kh"),"(To other guard) What?"],[r("7ExfT"),"(To other guard) Where!?"],[r("9v56M"),"(To other guard) Coming!"],[r("8pWsQ"),"(To other guard) Here I come!"],[r("7bU35"),"(To other guard) To arms!"],[r("8V6Zl"),"(To other guard) What is it!?"],[r("9OuxM"),"(To other guard) I dont know how to whistle."]],Gt=[[r("5UMPc"),"Get 'em!"],[r("a1naR"),"Intruder!"],[r("k25sm"),"Oh no... it's a thief."],[r("6s45F"),"We're coming for you!"],[r("7F9SI"),"Coming for you!"],[r("epmsQ"),"Halt!"],[r("lVOrm"),"We see you!"],[r("7n2bq"),"I'll get you!"],[r("lJynn"),"You're a goner!"],[r("aIecx"),"Just you wait!"],[r("fg20H"),"You won't get away!"],[r("03Ee8"),"No you dont!"],[r("1kKRF"),"Thief!"],[r("4czHp"),"Thief!"],[r("cauwk"),"Thief!"],[r("csGZP"),"After them!"],[r("2tRKJ"),"What is thy business with this gold?"],[r("e5O0h"),"No mercy for the wicked!"]],Dt=[[r("ivwRf"),"Lost 'em!"],[r("5Natg"),"Must have run off..."],[r("eCMLG"),"Oh, well..."],[r("iXIzY"),"Where did they go?"],[r("ejeiL"),"His Holiness would not be pleased!"],[r("hf2wD"),"The boss will not be pleased!"],[r("7BUuc"),"(huffing) I give up!"],[r("oQK7X"),"Where did he go!?"],[r("l7rpd"),"Drats lost him!"],[r("hcAf3"),"Gone!"],[r("jbg5i"),"Come back here!"],[r("2pk3Y"),"Rotten scoundrel!"],[r("9pZ1x"),"Aargh!!"],[r("j09Wg"),"He's not coming back!"],[r("5jj80"),"Blast!"],[r("5tRTq"),"Don't come back!"],[r("1BHLT"),"You won't get away next time!"],[r("9QAiO"),"His Holiness is a lord of mercy!"],[r("frozH"),"What a lousy day at work!"],[r("5xAy0"),"I give up..."],[r("leoYP"),"What do I do help me, help me..."],[r("4YbOi"),"Oh no, he got away!"],[r("YKAZv"),"(guard rant)"]],zt=[[r("81dli"),"Take that!!"],[r("gfMsn"),"Oof!!"],[r("d0uyI"),"Ugg!!"],[r("63paY"),"Ahh!!"],[r("c2ocL"),"Ahh!!"],[r("it1tO"),"Hi-yah!"],[r("3bDSd"),"Hi-yah!"],[r("F1F1Y"),"Hi-yah!"]];class Nt{constructor(){this.activeHowls=[],this.activeLimit=2,this.fadeTime=1e3}setFadetime(e=1e3){return this.fadeTime=e,this}fade(e,t){return this.fadeTime>0?(e.fade(1,0,this.fadeTime,t),setTimeout((()=>e.stop(t)),this.fadeTime)):e.stop(t),this}empty(){for(let e of this.activeHowls)this.fade(...e);return this.activeHowls=[],this}queue(e,t){if(this.activeHowls.unshift([e,t]),this.activeHowls.length>this.activeLimit){const e=this.activeHowls.pop();this.fade(...e)}return this.activeHowls=this.activeHowls.slice(0,this.activeLimit),this}}class Ot{constructor(e,t=null){this.howls=e.map((e=>new ut({src:[e]}))),this.howlNum=0,this.soundPool=t,y(this.howls)}play(e){const t=this.next();t.volume(e);try{const e=t.play();return null!==this.soundPool&&this.soundPool.queue(t,e),e}catch(e){console.log(`Audio playback error ${t}`,e)}return-1}next(){return this.howlNum++,this.howlNum==this.howls.length&&(this.howlNum=0,y(this.howls)),this.howls[this.howlNum]}}class Xt{constructor(e,t=null){this.sounds=e.map(Bt),this.soundNum=0,this.soundPool=t,this.mute=!1,y(this.sounds)}play(e){if(this.mute)return null;const t=this.next();t.sound.volume(e);try{const e=t.sound.play();return null!==this.soundPool&&this.soundPool.queue(t.sound,e),t}catch(e){console.log("Audio playback error",e)}return null}next(){const e=this.sounds[this.soundNum];return++this.soundNum,this.soundNum==this.sounds.length&&(this.soundNum=0,y(this.sounds)),e}}function Bt(e){return{sound:new ut({src:[e[0]]}),subtitle:e[1]}}function Yt(e,t,o){e.footstepWood=new Ot([mt]),e.footstepTile=new Ot([xt]),e.footstepWater=new Ot([_t]),e.footstepGravel=new Ot([yt]),e.footstepGrass=new Ot([vt]),e.footstepCreaky=new Ot(wt),e.victorySong=new Ot([dt]),e.levelRequirementJingle=new Ot([ht],o),e.levelCompleteJingle=new Ot([pt],o),e.gameOverJingle=new Ot([ft],o),e.easterEgg=new Ot([gt],o),e.hitPlayer=new Ot(St),e.coin=new Ot(bt),e.grunt=new Ot(At),e.douse=new Ot(Lt),e.ignite=new Ot(Tt),e.hide=new Ot(It),e.gate=new Ot(Mt),e.jump=new Ot(Rt),e.tooHigh=new Ot(Ht),t.guardInvestigate=new Xt(Wt,o),t.guardFinishInvestigating=new Xt(Ut,o),t.guardSeeThief=new Xt(kt),t.guardFinishLookingSet=new Xt(Ct,o),t.guardChase=new Xt(Gt,o),t.guardEndChase=new Xt(Dt,o),t.guardHearGuard=new Xt(Ft,o),t.guardHearThief=new Xt(Pt,o),t.guardFinishListening=new Xt(Et,o),t.guardDamage=new Xt(zt,o)}const Vt={left:!1,right:!1,up:!1,down:!1,jumpLeft:!1,jumpRight:!1,jumpUp:!1,jumpDown:!1,los:!1,wait:!1,jump:!1,zoomIn:!1,zoomOut:!1,snapToPlayer:!1,panUp:!1,panDown:!1,panLeft:!1,panRight:!1,menu:!1,menuNext:!1,menuPrev:!1,menuClose:!1,home:!1,homePlay:!1,homeDaily:!1,homeStats:!1,homeOptions:!1,jumpToggle:!1,restart:!1,heal:!1,startLevel:!1,exitLevel:!1,guardMute:!1,volumeMute:!1,volumeDown:!1,volumeUp:!1,forceRestart:!1,resetState:!1,seeAll:!1,collectLoot:!1,markSeen:!1,guardSight:!1,guardPatrols:!1,nextLevel:!1,prevLevel:!1,gamepadStyleTouch:!1,fullscreen:!1},jt={...Vt};var $t=null;const qt={BracketLeft:["zoomOut"],BracketRight:["zoomIn"],ArrowLeft:["left","menuPrev"],KeyA:["left","menuPrev"],Numpad4:["left","menuPrev"],ArrowRight:["right","menuNext"],KeyX:["home"],KeyP:["homePlay"],KeyO:["homeOptions"],KeyD:["right","homeDaily","menuNext"],Numpad6:["right","menuNext"],KeyL:["right","menuNext"],ArrowUp:["up"],KeyW:["up"],Numpad8:["up"],KeyK:["up"],ArrowDown:["down"],KeyS:["down","homeStats"],Numpad2:["down"],KeyJ:["down"],Period:["wait"],Space:["wait"],Shift:["jump"],KeyF:["jumpToggle"],NumpadAdd:["jumpToggle"],Escape:["menu","menuClose"],Slash:["menu","menuClose"],KeyR:["restart"],KeyH:["heal"],KeyN:["startLevel"],Digit9:["guardMute"],"Digit0:":["volumeMute"],Minus:["volumeDown"],Equal:["volumeUp"],"Control+Space":["snapToPlayer"],"Control+Period":["snapToPlayer"],"Control+ArrowUp":["panUp"],"Control+KeyW":["panUp"],"Control+KeyJ":["panUp"],"Control+Numpad8":["panUp"],"Control+ArrowDown":["panDown"],"Control+KeyS":["panDown"],"Control+KeyK":["panDown"],"Control+Numpad2":["panDown"],"Control+ArrowLeft":["panLeft"],"Control+KeyA":["panLeft"],"Control+KeyH":["panLeft"],"Control+Numpad4":["panLeft"],"Control+ArrowRight":["panRight"],"Control+KeyD":["panRight"],"Control+KeyL":["panRight"],"Control+Numpad6":["panRight"],"Control+KeyR":["forceRestart"],"Alt+KeyR":["resetState"],"Alt+KeyA":["seeAll"],"Alt+KevC":["collectLoot"],"Alt+KeyS":["markSeen"],"Alt+KeyV":["guardSight"],"Alt+KeyP":["guardPatrols"],"Alt+Comma":["prevLevel"],"Alt+Period":["nextLevel"]};class Kt extends Array{constructor(e=0,t=0,o=0,n=0){super(e,t,o,n)}collide(e,t,o=0,n=0){return this[0]<e+o&&this[0]+this[2]>e&&this[1]<t+n&&this[1]+this[3]>t}}class Zt{constructor(){this.controlStates={...jt},this.controlTimes={},this.controlActivated={...jt};for(const e in this.controlStates)this.controlTimes[e]=Date.now()}set(e,t=!0){this.controlActivated[e]=!this.controlStates[e]&&t||this.controlStates[e]&&!t,this.controlStates[e]=t,Vt[e]=t,this.controlTimes[e]=Date.now(),$t=this}resetActivation(){this.controlActivated={...jt}}vibrate(e,t,o){}}class Qt extends Zt{constructor(e=null){super(),null==e&&(e=qt),this.keyMap=e;let t=this;const o=document.querySelector("html");o&&(o.onkeydown=function(e){t.keyDownHandler(e)},o.onkeyup=function(e){t.keyUpHandler(e)})}getCode(e,t=!1){let o=e.code;return e.altKey&&"AltLeft"!==e.code&&"AltRight"!==e.code&&(o="Alt+"+o),e.shiftKey&&t&&"ShiftLeft"!==e.code&&"ShiftRight"!==e.code&&(o="Shift+"+o),e.ctrlKey&&"ControlLeft"!==e.code&&"ControlRight"!==e.code&&(o="Control+"+o),"AltLeft"!=e.code&&"AltRight"!=e.code||(o="Alt"),"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(o="Shift"),"ControlLeft"!=e.code&&"ControlRight"!=e.code||(o="Control"),o}updateModifierDown(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)!t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}updateModifierUp(e){for(let t in this.keyMap){const o=this.keyMap[t];for(let n of o)t.includes(e)&&this.controlStates[n]&&(this.controlStates[n]=!1)}}keyDownHandler(e){$t=this,console.log("Key down",e,this.controlStates.homePlay,Date.now()/1e3);const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierDown(t),t in this.keyMap){e.preventDefault();const o=this.keyMap[t];for(let e of o)this.controlStates[e]||this.set(e,!0)}console.log("Key down 2",e,this.controlStates.homePlay,Date.now()/1e3)}keyUpHandler(e){console.log("Key up",e,this.controlStates.homePlay,Date.now()/1e3);const t=this.getCode(e);if(["Alt","Control"].includes(t)&&this.updateModifierUp(t),t in this.keyMap){e.preventDefault();const o=this.keyMap[t];for(let e of o)this.set(e,!1)}console.log("Key up 2",e,this.controlStates.homePlay)}}class Jt extends Zt{constructor(e){super(),this.gamepad=e,this.thresh=.4,this.internalStates={...this.controlStates}}set(e,t=!0){this.internalStates[e]!=t&&(this.internalStates[e]=t,super.set(e,t))}vibrate(e,t,o){}}class eo{constructor(){let e=this;window.addEventListener("gamepadconnected",(function(t){e.connected(t)})),window.addEventListener("gamepaddisconnected",(function(t){e.disconnected(t)})),this.gamepads={}}connected(e){this.gamepads[e.gamepad.index]=new Jt(e.gamepad)}disconnected(e){this.gamepads[e.gamepad.index];delete this.gamepads[e.gamepad.index]}updateGamepadStates(){let e=navigator.getGamepads();if(null!=e)for(let t of e){if(null==t)continue;let e=this.gamepads[t.index];e.gamepad=t,e.set("jump",this.buttonPressed(t.buttons[0])),e.set("wait",this.buttonPressed(t.buttons[2])),e.set("zoomIn",this.buttonPressed(t.buttons[6])),e.set("zoomOut",this.buttonPressed(t.buttons[7])),e.set("fullscreen",this.buttonPressed(t.buttons[8])),e.set("restart",this.buttonPressed(t.buttons[5])),e.set("menu",this.buttonPressed(t.buttons[9])),e.set("left",this.buttonPressed(t.buttons[14])||t.axes[0]<-e.thresh&&t.axes[0]<-.5*Math.abs(t.axes[1])),e.set("right",this.buttonPressed(t.buttons[15])||t.axes[0]>e.thresh&&t.axes[0]>.5*Math.abs(t.axes[1])),e.set("up",this.buttonPressed(t.buttons[12])||t.axes[1]<-e.thresh&&t.axes[1]<-.5*Math.abs(t.axes[0])),e.set("down",this.buttonPressed(t.buttons[13])||t.axes[1]>e.thresh&&t.axes[1]>-.5*Math.abs(t.axes[0])),e.set("panLeft",t.axes[2]<-e.thresh&&t.axes[2]<-.5*Math.abs(t.axes[3])),e.set("panRight",t.axes[2]>e.thresh&&t.axes[2]>.5*Math.abs(t.axes[3])),e.set("panUp",t.axes[3]<-e.thresh&&t.axes[3]<-.5*Math.abs(t.axes[2])),e.set("panDown",t.axes[3]>e.thresh&&t.axes[3]>-.5*Math.abs(t.axes[2]))}}buttonPressed(e){return e.pressed}}class to extends Zt{mouseActive=!1;constructor(e,t){super(),this.canvas=e;let o=this;e.addEventListener("touchstart",(function(e){o.process_touchstart(e)}),!0),e.addEventListener("touchmove",(function(e){o.process_touchmove(e)}),!0),e.addEventListener("touchcancel",(function(e){o.process_touchend(e)}),!0),e.addEventListener("touchend",(function(e){o.process_touchend(e)}),!0),e.addEventListener("mousedown",(function(e){o.process_mousedown(e)}),!0),e.addEventListener("mouseup",(function(e){o.process_mouseup(e)}),!0),e.addEventListener("mousemove",(function(e){o.process_mousemove(e)}),!0);this.screenDimensions=[0,0],this.lastMotion={id:-1,active:!1,x0:0,y0:0,x:0,y:0},this.coreTouchTargets={up:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},down:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},left:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},right:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpUp:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpDown:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpLeft:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jumpRight:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},wait:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},exitLevel:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},jump:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},pan:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"press",tileInfo:null},zoomIn:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},zoomOut:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},restart:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},forceRestart:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},menu:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null},fullscreen:{id:-1,active:!0,view:new Kt,game:new Kt,touchXY:[0,0],trigger:"release",show:"always",tileInfo:null}},this.touchTargets=this.coreTouchTargets,this.setTouchConfig(t)}setTouchConfig(e){if(e){for(let e of["up","down","left","right","wait","jump","pan"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="always";for(let e of["jumpUp","jumpDown","jumpLeft","jumpRight"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="press"}else{for(let e of["exitLevel"])this.coreTouchTargets[e].trigger="press",this.coreTouchTargets[e].show="always";for(let e of["up","down","left","right","pan","jumpUp","jumpDown","jumpLeft","jumpRight","wait","jump"])this.coreTouchTargets[e].trigger="release",this.coreTouchTargets[e].show="press"}}clearMotion(){this.lastMotion.active=!1,this.lastMotion.id=-1,this.lastMotion.x0=0,this.lastMotion.y0=0,this.lastMotion.x=0,this.lastMotion.y=0}set(e,t=!0,o=!0){t&&this.clearMotion(),o&&(this.controlActivated[e]=!this.controlStates[e]&&t||this.controlStates[e]&&!t),this.controlStates[e]=t,Vt[e]=t,this.controlTimes[e]=Date.now(),$t=this}updateCoreTouchTarget(e,t,o,n){const r=this.coreTouchTargets[e];r.view=o,r.game=t,r.tileInfo=n,r.view.collide(r.touchXY[0],this.canvas.clientHeight-r.touchXY[1])||this.controlStates[e]&&-1!=r.id&&(this.set(e,!1,"press"==r.trigger),r.id=-1)}activateTouchTargets(e){this.touchTargets=void 0===e?this.coreTouchTargets:{...this.coreTouchTargets,...e}}process_mousedown(e){$t=this,this.mouseActive=!0,this.lastMotion.id=-2,this.lastMotion.active=!1,this.lastMotion.x0=e.clientX,this.lastMotion.y0=this.canvas.clientHeight-e.clientY,this.lastMotion.x=e.clientX,this.lastMotion.y=this.canvas.clientHeight-e.clientY;for(let t in this.touchTargets){let o=this.touchTargets[t];o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY)&&(o.touchXY=[e.clientX,e.clientY],o.id=-2,this.set(t))}e.preventDefault()}process_mousemove(e){$t=this,this.mouseActive=!0,-2==this.lastMotion.id&&(this.lastMotion.active=!0,this.lastMotion.x=e.clientX,this.lastMotion.y=this.canvas.clientHeight-e.clientY);for(let t in this.touchTargets){let o=this.touchTargets[t];if(-2==o.id){const n=o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY);this.controlStates[t]&&(n?(o.touchXY=[e.clientX,e.clientY],this.set(t,!0,!1)):(this.set(t,!1,!1),o.id=-1))}else if("release"==o.trigger){o.view.collide(e.clientX,this.canvas.clientHeight-e.clientY)&&(o.touchXY=[e.clientX,e.clientY],this.set(t,!0,-2==o.id),o.id=-2)}}e.preventDefault()}process_mouseup(e){this.clearMotion();for(const e in this.touchTargets){this.touchTargets[e].id=-1,this.set(e,!1),this.controlTimes[e]=0}e.preventDefault()}process_touchstart(e){$t=this,this.mouseActive=!1;for(let t of e.changedTouches){this.lastMotion.id=t.identifier,this.lastMotion.active=!1,this.lastMotion.x0=t.clientX,this.lastMotion.y0=this.canvas.clientHeight-t.clientY,this.lastMotion.x=t.clientX,this.lastMotion.y=this.canvas.clientHeight-t.clientY;for(let e in this.touchTargets){let o=this.touchTargets[e];o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)&&(o.touchXY=[t.clientX,t.clientY],o.id=t.identifier,this.set(e))}}e.preventDefault()}process_touchmove(e){this.mouseActive=!1;for(let t of e.changedTouches){this.lastMotion.id==t.identifier&&(this.lastMotion.active=!0,this.lastMotion.x=t.clientX,this.lastMotion.y=this.canvas.clientHeight-t.clientY);for(let e in this.touchTargets){let o=this.touchTargets[e];if(o.id==t.identifier){o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)?(o.touchXY=[t.clientX,t.clientY],this.set(e,!0,!1)):(o.id=-1,this.set(e,!1,!1))}else if(-1==o.id&&"release"==o.trigger){o.view.collide(t.clientX,this.canvas.clientHeight-t.clientY)&&(o.touchXY=[t.clientX,t.clientY],o.id=t.identifier,this.set(e,!0))}}}e.preventDefault()}process_touchend(e){this.mouseActive=!1;for(let t of e.changedTouches){this.lastMotion.id==t.identifier&&this.clearMotion();for(const e in this.touchTargets){const o=this.touchTargets[e];o.id==t.identifier&&(o.id=-1,this.set(e,!1),this.controlTimes[e]=0)}}e.preventDefault()}vibrate(e,t,o){window.navigator.vibrate(o)}}let oo;var no;(no=oo||(oo={}))[no.HomeScreen=0]="HomeScreen",no[no.StatsScreen=1]="StatsScreen",no[no.OptionsScreen=2]="OptionsScreen",no[no.Mansion=3]="Mansion",no[no.BetweenMansions=4]="BetweenMansions",no[no.Dead=5]="Dead",no[no.Win=6]="Win";class ro{pages=[];activePage=0;activePageData=[];highlightedAction=-1;actionSequence=[];state={};glyphs=[];maxLineLength=0;scaleLargestX=0;scaleLargestY=0;scaleFactor=0;pixelsPerCharX=0;pixelsPerCharY=0;linesPixelSizeX=0;linesPixelSizeY=0;numCharsX=0;numCharsY=0;offsetX=0;offsetY=0;textW=8;textH=16;constructor(){this.mat=a.create(),this.screenSize=i.create(),this.touchTargets={}}initAction(e){this.touchTargets[e]={id:-1,active:!0,game:new Kt(0,0,0,0),view:new Kt(0,0,0,0),trigger:"release",tileInfo:{},show:"always",touchXY:[-1,-1]}}nextPage(){this.activePage=Math.min(this.pages.length-1,this.activePage+1)}prevPage(){this.activePage=Math.max(0,this.activePage-1)}parseImage(e,t,o,n){const r=e.slice(t+2).indexOf("#");if(r<0)return[e,t];const i=Number(e.slice(t+1,t+2+r));return Number.isNaN(i)?[e,t]:(this.glyphs.push([i,new Kt(t,n-o-.875,2,1)]),[e=e.slice(0,t)+"  "+e.slice(t+3+r),t+1])}parseButton(e,t,o,n){const r=t;let i,s;for(;;){if(i=e.slice(t).indexOf("|"),i<0)return[e,t];if(i+=t,s=e.slice(i+1).indexOf("]"),s<0)return[e,t];if(s+=i+1,t===i)break;"#"===e[t]&&([e,t]=this.parseImage(e,t,o,n)),t+=1}const a=e.slice(i+1,s);if(void 0!==a&&""!==a){a in this.touchTargets||this.initAction(a);const e=[r,t+1,o],[i,s]=[e[0],e[2]-1/8],[l,u]=[e[1],e[2]+1];this.touchTargets[a].game=new Kt(i,n-u,l-i,u-s),this.actionSequence.push(a)}return[e=e.slice(0,i)+e.slice(s),t=i]}parseUI(){var e=this.pages[this.activePage];const t=this.state;for(const o in t)e=e.replace("$"+o+"$",String(t[o]));this.activePageData=e.split("\n");const o=this.activePageData;this.glyphs.length=0,this.actionSequence=[];for(let e=0;e<o.length;++e){let t=o[e],n=0;for(;n<t.length;){switch(t[n]){case"#":[t,n]=this.parseImage(t,n,e,o.length);break;case"[":[t,n]=this.parseButton(t,n,e,o.length)}n+=1}o[e]=t}}updateScreenSize(e){this.screenSize=e,this.maxLineLength=0;for(const e of this.activePageData)this.maxLineLength=Math.max(this.maxLineLength,e.length);this.scaleLargestX=Math.max(1,Math.floor(e[0]/(65*this.textW))),this.scaleLargestY=Math.max(1,Math.floor(e[1]/(22*this.textH))),this.scaleFactor=Math.min(this.scaleLargestX,this.scaleLargestY),this.pixelsPerCharX=8*this.scaleFactor,this.pixelsPerCharY=16*this.scaleFactor,this.linesPixelSizeX=this.maxLineLength*this.pixelsPerCharX,this.linesPixelSizeY=this.activePageData.length*this.pixelsPerCharY,this.numCharsX=e[0]/this.pixelsPerCharX,this.numCharsY=e[1]/this.pixelsPerCharY,this.offsetX=Math.floor((e[0]-this.linesPixelSizeX)/-2)/this.pixelsPerCharX,this.offsetY=Math.floor((e[1]-this.linesPixelSizeY)/-2)/this.pixelsPerCharY,this.mat=a.create(),a.ortho(this.mat,this.offsetX,this.offsetX+this.numCharsX,this.offsetY,this.offsetY+this.numCharsY,1,-1)}pixelCoords(e){return[(e[0]-this.offsetX)*this.pixelsPerCharX,(e[1]-this.offsetY)*this.pixelsPerCharY]}textCoords(e){return[e[0]/this.pixelsPerCharX+this.offsetX,e[1]/this.pixelsPerCharY+this.offsetY]}getTouchData(){for(let e in this.touchTargets){const t=this.touchTargets[e],o=t.game,[n,r]=this.pixelCoords([o[0],o[1]]),[i,s]=this.pixelCoords([o[2]+o[0],o[3]+o[1]]);t.view=new Kt(n,r,i-n,s-r)}return this.touchTargets}render(e){const t=this.activePageData,o=this.mat,n=this.maxLineLength;e.start(o,0),e.addGlyph(-2,-1,n+2,t.length+1,{textureIndex:219,color:4027584528}),e.flush(),e.start(o,0);for(let t in this.touchTargets){const o=this.touchTargets[t].game;if($t?.controlStates[t]&&(this.highlightedAction=this.actionSequence.indexOf(t)),this.touchTargets[t].active){const n=this.actionSequence[this.highlightedAction]===t?4291829936:4288684160;e.addGlyph(o[0],o[1],o[0]+o[2],o[1]+o[3],{textureIndex:219,color:n})}else this.actionSequence[this.highlightedAction]===t&&e.addGlyph(o[0],o[1],o[0]+o[2],o[1]+o[3],{textureIndex:219,color:4285558896})}e.flush(),e.start(o,1);for(const t of this.glyphs){const o=t[1];e.addGlyph(o[0],o[1],o[2]+o[0],o[3]+o[1],{textureIndex:t[0],color:Qe})}e.flush(),e.start(o,0);for(let o=0;o<t.length;++o){const n=t.length-(1+o);for(let r=0;r<t[o].length;++r){const i=r;if(" "===t[o])continue;const s=t[o].charCodeAt(r);e.addGlyph(i,n,i+1,n+1,{textureIndex:s,color:4293849343})}}e.flush()}updateData(e){}update(e){}navigateUI(e){let t="";return e("up")?(this.highlightedAction--,this.highlightedAction<0&&(this.highlightedAction=this.actionSequence.length-1)):e("down")?(this.highlightedAction++,this.highlightedAction>=this.actionSequence.length&&(this.highlightedAction=0)):this.highlightedAction>=0&&this.touchTargets[this.actionSequence[this.highlightedAction]]?.active&&e("wait")&&(t=this.actionSequence[this.highlightedAction]),t}onControls(e,t){}}class io extends ro{pages=["             Lurk Leap Loot\n     James McNeill and Damien Moore       \n\n            [P|homePlay]:  Play game\n            [D|homeDaily]:  Daily run\n            [S|homeStats]: Statistics\n            [O|homeOptions]:    Options"];constructor(){super()}update(e){if("homeDaily"in this.touchTargets){const e=window.localStorage.getItem("lastDaily");null!==e&&e===jo()?this.touchTargets.homeDaily.active=!1:this.touchTargets.homeDaily.active=!0}}onControls(e,t){const o=this.navigateUI(t);if(t("homePlay")||"homePlay"==o)e.rng=new x,e.dailyRun=!1,Do(e);else if(this.touchTargets.homeDaily.active&&(t("homeDaily")||"homeDaily"==o)){window.localStorage.setItem("lastDaily",jo()),e.rng=new x("Daily "+jo()),e.dailyRun=!0,Do(e)}else t("homeStats")||"homeStats"==o?e.gameMode=oo.StatsScreen:(t("homeOptions")||"homeOptions"==o)&&(e.gameMode=oo.OptionsScreen)}}class so extends ro{pages=["                  Options\n\n[F|fullscreen]      $fullscreenMode$\n[T|gamepadStyleTouch]      Touch controls as $touchMode$\n[Ctrl+R|forceRestart] Reset data\n\n[Esc|menu]    Back to menu"];update(e){let t=window.localStorage.getItem("touchMode");null===t&&(t=e.touchAsGamepad?"Gamepad":"Mouse",window.localStorage.setItem(t,t)),this.state.fullscreenMode=document.fullscreenElement?"Fullscreen":"Windowed",this.state.touchMode=t}onControls(e,t){const o=this.navigateUI(t);if(t("menu")||"menu"==o)e.gameMode=oo.HomeScreen;else if(t("fullscreen")||"fullscreen"==o)"Windowed"==this.state.fullscreenMode?document.documentElement.requestFullscreen():document.exitFullscreen();else if(t("gamepadStyleTouch")||"gamepadStyleTouch"==o){"Gamepad"==window.localStorage.getItem("touchMode")?(e.touchAsGamepad=!1,e.touchController.setTouchConfig(!1),window.localStorage.setItem("touchMode","Mouse")):(e.touchAsGamepad=!0,e.touchController.setTouchConfig(!0),window.localStorage.setItem("touchMode","Gamepad"))}else(t("forceRestart")||"forceRestart"==o)&&window.localStorage.clear()}}class ao extends ro{pages=["                   Play Statistics\n\n            Total plays:             $totalPlays$ games\n            Total wins:              $totalWins$ games\n            Total loot:              $totalGold$ gold\n            Total mansions ghosted:  $totalGhosts$\n            Total mansions looted:   $totalLootSweeps$\n            Best score:              $bestScore$ gold\n\n1/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Back to menu","                        High Scores\n\nScore                        Date\n\n$scoreTable$\n\n2/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Back to menu","                       Daily Runs\n\n            Last played:        $lastPlayed$\n            Last score:         $lastScore$ gold\n            Best score:         $bestScore$ gold\n\n            Total daily runs:   $dailyPlays$ games\n            Total daily wins:   $dailyWins$ games\n            Perfect runs:       $dailyPerfect$ games\n            Win streak:         $dailyWinStreak$ days\n\n\n3/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Back to menu","                     Achievements\n\n$achievements$\n\n4/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Back to menu"];update(e){0==this.activePage?(this.state.totalPlays=e.stats.totalPlays,this.state.totalWins=e.stats.totalWins,this.state.totalGold=e.stats.totalGold,this.state.totalGhosts=e.stats.totalGhosts,this.state.totalLootSweeps=e.stats.totalLootSweeps,this.state.bestScore=e.stats.bestScore):1==this.activePage?this.state.scoreTable="":2==this.activePage?(this.state.lastPlayed=e.stats.lastDaily.date,this.state.lastScore=e.stats.lastDaily.score,this.state.bestScore=e.stats.bestScore,this.state.dailyPlays=e.stats.dailyPlays,this.state.dailyWins=e.stats.dailyWins,this.state.dailyPerfect=e.stats.dailyPerfect,this.state.dailyWinStreak=e.stats.dailyWinStreak):3==this.activePage&&(this.state.achievements="")}onControls(e,t){const o=this.navigateUI(t);t("menu")||"menu"==o||t("menuClose")||"menuClose"==o?e.gameMode=oo.HomeScreen:t("left")||"left"==o||t("menuPrev")||"menuPrev"==o?this.prevPage():(t("right")||"right"==o||t("menuNext")||"menuNext"==o)&&this.nextPage()}}class lo extends ro{pages=["   Mansion $level$ Complete!\n\nMansion Statistics\nLoot stolen:     $lootStolen$ / $lootAvailable$\nGhost bonus:     $ghostBonus$\nTimely delivery: $timeBonus$\nMansion total:   $totalScore$\n\nCurrent loot:    $loot$\n[H|heal]: Heal one heart for $$healCost$\n[N|startLevel]: Next mansion"];update(e){this.state.level=e.level+1,this.state.lootStolen=e.lootStolen,this.state.lootAvailable=e.lootAvailable,this.state.ghostBonus=e.ghostBonus,this.state.timeBonus=bo(e),this.state.totalScore=this.state.lootStolen+this.state.timeBonus+this.state.ghostBonus,this.state.loot=e.player.loot,this.state.healCost=e.healCost}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new x,e.dailyRun=!1,Do(e)):t("heal")||"heal"==o?function(e){if(e.player.health>=V)return;if(e.player.loot<e.healCost)return;e.player.loot-=e.healCost,e.gameStats.lootSpent+=e.healCost,e.player.health+=1,e.healCost*=2}(e):t("startLevel")||"startLevel"==o?function(e){if(e.level+=1,e.level>=po.numGameMaps)return void Do(e);e.activeSoundPool.empty(),e.gameMap=le(e.level,e.gameMapRoughPlans[e.level],e.rng),e.topStatusMessage=wo,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.healCost+=1;const t=e.gameStats;t.lootStolen+=e.lootStolen,t.maxLootStolen+=e.lootAvailable,t.ghostBonuses+=e.ghostBonus,t.maxGhostBonuses+=5,t.timeBonuses+=bo(e),t.maxTimeBonuses+=e.maxTimeBonus,t.lootSpent+=e.lootSpent,e.turns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.player.pos=e.gameMap.playerStartPos,e.player.dir=i.fromValues(0,-1),e.player.noisy=!1,e.player.damagedLastTurn=!1,e.player.turnsRemainingUnderwater=0,e.popups.clear(),e.camera=Wo(e.gameMap.playerStartPos),e.gameMode=oo.Mansion}(e):(t("menu")||"menu"==o)&&(e.helpActive=!0)}}class uo extends ro{pages=["         You are dead!\n\nStatistics\nLoot stolen:   $lootStolen$ / $maxLootStolen$\nGhost bonuses: $ghostBonuses$ / $maxGhostBonuses$\nTime bonuses:  $timeBonuses$ / $maxTimeBonuses$\nLoot spent:    $lootSpent$\n\nFinal loot:    $loot$\n\n[R|restartGame]: Start new game\n[Esc|menu]: Exit to home screen"];update(e){this.state.lootStolen=e.gameStats.lootStolen,this.state.maxLootStolen=e.gameStats.maxLootStolen,this.state.ghostBonuses=e.gameStats.ghostBonuses,this.state.maxGhostBonuses=e.gameStats.maxGhostBonuses,this.state.timeBonuses=e.gameStats.timeBonuses,this.state.maxTimeBonuses=e.gameStats.maxTimeBonuses,this.state.lootSpent=e.gameStats.lootSpent,this.state.loot=e.player.loot}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new x,e.dailyRun=!1,Do(e)):(t("menu")||"menu"==o)&&(e.gameMode=oo.HomeScreen)}}class co extends ro{pages=["   Mission Complete!\n\nStatistics\nLoot stolen:   $lootStolen$ / $maxLootStolen$\nGhost bonuses: $ghostBonuses$ / $maxGhostBonuses$\nTime bonuses:  $timeBonuses$ / $maxTimeBonuses$\nLoot spent:    $lootSpent$\n\nScore:         $loot$\n\n[R|restartGame]: Start new game\n[Esc|menu]: Exit to home screen"];update(e){this.state.lootStolen=e.gameStats.lootStolen,this.state.maxLootStolen=e.gameStats.maxLootStolen,this.state.ghostBonuses=e.gameStats.ghostBonuses,this.state.maxGhostBonuses=e.gameStats.maxGhostBonuses,this.state.timeBonuses=e.gameStats.timeBonuses,this.state.maxTimeBonuses=e.gameStats.maxTimeBonuses,this.state.lootSpent=e.gameStats.lootSpent,this.state.loot=e.player.loot}onControls(e,t){const o=this.navigateUI(t);t("zoomIn")||"zoomIn"==o?(e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1):t("zoomOut")||"zoomOut"==o?(e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1):t("restart")||"restart"==o?(e.rng=new x,e.dailyRun=!1,Do(e)):(t("menu")||"menu"==o)&&(e.gameMode=oo.HomeScreen)}}class ho extends ro{pages=["Lurk Leap Loot\n\nYour mission from the thieves' guild is to\nmap $numGameMaps$ mansions. You can keep any loot you\nfind ($totalGameLoot$ total).\n\nMansion bonuses:\n- Up to 5 gold for a timely map delivery.\n- 5 gold if you avoid alerting guards.\n\n\n[X|home] Exit (abort game)\n\n1/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Close","Keyboard controls\n\n  Move: Arrows / WASD / HJKL\n  Wait: Space / Z / Period / Numpad5\n  Leap: Shift + move\n  Leap (Toggle): F / Numpad+\n  Zoom View: [ / ]\n  Volume: (Mute/Down/Up) 0 / - / =\n  Guard Mute (Toggle): 9\n\nDisable NumLock if using numpad\nMouse, touch and gamepad also supported\n\n2/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Close","Key \n\n#114# Thief: You!\n#081# Guard: Avoid them!\n#053# Loot: Collect for score, or to spend on healing\n#050# Tree: Hiding place\n#052# Table: Hiding place\n#051# Stool: Not a hiding place\n#049# Torch: Guards want them lit\n#160# Window: One-way escape route\n\n\n\n3/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Close","Made for 2023 Seven-Day Roguelike Challenge\n\nby James McNeill and Damien Moore\n\nAdditional voices by Evan Moore\nAdditional assistance by Mike Gaffney\nTesting by Tom Elmer\nSpecial thanks to Mendi Carroll\n\n\n\n\n\n4/4    [#04#|menuPrev] Prev     [#05#|menuNext] Next     [Esc|menuClose] Close"];update(e){this.state.numGameMaps=po.numGameMaps,this.state.totalGameLoot=po.totalGameLoot}onControls(e,t){const o=this.navigateUI(t);if((t("home")||"home"==o)&&(this.activePage=0,e.helpActive=!1,e.gameMode=oo.HomeScreen),t("menu")||"menu"==o||t("menuClose")||"menuClose"==o)this.activePage=0,e.helpActive=!1;else if(t("zoomIn")||"zoomIn"==o)e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1;else if(t("zoomOut")||"zoomOut"==o)e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1;else if(t("fullscreen")||"fullscreen"==o){document.querySelector("#canvas").requestFullscreen({navigationUI:"hide"})}else t("forceRestart")||"forceRestart"==o?(e.rng=new x,e.dailyRun=!1,Do(e)):t("gamepadStyleTouch")||"gamepadStyleTouch"==o?(e.touchAsGamepad=!e.touchAsGamepad,e.touchController.setTouchConfig(e.touchAsGamepad),e.topStatusMessage=e.touchAsGamepad?"Touch gamepad enabled":"Touch gamepad disabled (touch map to move)"):t("left")||"left"==o||t("menuPrev")||"menuPrev"==o?this.prevPage():(t("right")||"right"==o||t("menuNext")||"menuNext"==o)&&this.nextPage()}}const po={numGameMaps:10,totalGameLoot:100},fo=function(e){if("34view"==e)return at;if("basic"==e)return ct;if("sincity"==e)return it;if("31color"==e)return st;throw new Error(`Unsupported tileset ${e}`)}("31color"),go=function(e){if("font"==e)return rt;throw new Error(`Unsupported tileset ${e}`)}("font");window.onload=function(){Promise.all([Co(go.imageSrc,go.image),Co(fo.imageSrc,fo.image)]).then(So)};const mo=65,xo=8,_o=16,yo=16,vo=16,wo="Esc or / for help";function So(e){const t=document.querySelector("#canvas");document.body.addEventListener("keydown",(function(e){0==Object.keys(n.sounds).length&&(Yt(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())})),t.addEventListener("mousedown",(function(e){0==Object.keys(n.sounds).length&&(Yt(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())})),t.addEventListener("touchstart",(function(e){0==Object.keys(n.sounds).length&&(Yt(n.sounds,n.subtitledSounds,n.activeSoundPool),e.preventDefault())}));const o=new Ue(t,fo,go),n=function(e,t,o,n){const r=new x,i=0,s=se(po.numGameMaps,po.totalGameLoot,r),a=le(i,s[i],r);return{gameStats:{lootStolen:0,lootSpent:0,ghostBonuses:0,timeBonuses:0,maxGhostBonuses:0,maxTimeBonuses:0,maxLootStolen:0},stats:Go(),tLast:void 0,dt:0,rng:r,dailyRun:!1,leapToggleActive:!1,gameMode:oo.HomeScreen,helpScreen:new ho,textWindows:{[oo.HomeScreen]:new io,[oo.OptionsScreen]:new so,[oo.StatsScreen]:new ao,[oo.BetweenMansions]:new lo,[oo.Dead]:new uo,[oo.Win]:new co},helpActive:!1,player:new j(a.playerStartPos),topStatusMessage:wo,topStatusMessageSticky:!0,finishedLevel:!1,healCost:1,zoomLevel:3,seeAll:!1,seeGuardSight:!1,seeGuardPatrols:!1,camera:Wo(a.playerStartPos),level:i,turns:0,lootStolen:0,lootSpent:0,lootAvailable:s[i].totalLoot,ghostBonus:5,maxTimeBonus:5,gameMapRoughPlans:s,gameMap:a,sounds:e,subtitledSounds:t,activeSoundPool:o,guardMute:!1,volumeMute:!1,touchAsGamepad:!0,touchController:n,gamepadManager:new eo,keyboardController:new Qt,popups:new S}}({},{},new Nt,new to(t,!0));function r(){requestAnimationFrame((e=>No(e,o,n)))}window.addEventListener("resize",(function(){r()})),r()}function bo(e){const t=e.gameMap.cells,o=Math.ceil(t.sizeX*t.sizeY/10);return Math.max(e.maxTimeBonus-Math.floor(e.turns/o),0)}function Ao(e){const t=bo(e);e.player.loot+=t+e.ghostBonus,e.activeSoundPool.empty(),e.sounds.levelCompleteJingle.play(.35),e.gameMode=oo.BetweenMansions,e.lootStolen===e.lootAvailable&&(e.stats.totalLootSweeps++,Fo("totalLootSweeps",e.stats.totalLootSweeps)),e.ghostBonus>0&&(e.stats.totalGhosts++,Fo("totalGhosts",e.stats.totalGhosts)),e.topStatusMessage="",e.topStatusMessageSticky=!1}function Lo(e){e.activeSoundPool.empty(),e.player.loot>95&&Math.random()>.9?e.sounds.easterEgg.play(.5):e.sounds.victorySong.play(.5),e.stats.totalWins++,Fo("totalWins",e.stats.totalWins),e.stats.bestScore=Math.max(e.stats.bestScore,e.player.loot),Fo("bestScore",e.stats.bestScore),e.stats.totalGold+=e.player.loot,Fo("totalGold",e.stats.totalGold);const t={score:e.player.loot,date:jo()};e.stats.highScores.push(t),e.dailyRun&&(e.stats.bestDailyScore=Math.max(e.stats.bestDailyScore,e.player.loot),Fo("bestDailyScore",e.stats.bestDailyScore),e.stats.dailyWins++,Fo("dailyWins",e.stats.dailyWins),e.stats.dailyWinStreak++,Fo("dailyWinStreak",e.stats.dailyWinStreak),150==e.player.loot&&(e.stats.dailyPerfect++,Fo("dailyPerfect",e.stats.dailyPerfect)),e.stats.lastDaily=t,e.stats.dailyScores.push(e.stats.lastDaily),Fo("lastDaily",e.stats.lastDaily)),e.gameMode=oo.Win,e.topStatusMessage="",e.topStatusMessageSticky=!1}function To(e,t,o,n){const r=e.player,s=e.gameMap.items.find((e=>[X.PortcullisEW,X.PortcullisNS].includes(e.type))),a=void 0!==s?e.gameMap.guards.find((e=>e.pos[0]==s.pos[0]&&e.pos[1]==s.pos[1])):void 0;if(r.health<=0)return;if(e.camera.panning=!1,e.touchController.clearMotion(),0===t&&0===o||n<=0){const t=r.pos[0],o=r.pos[1];for(let n=Math.max(t-1,0);n<=Math.min(t+1,e.gameMap.cells.sizeX-1);++n)for(let t=Math.max(o-1,0);t<=Math.min(o+1,e.gameMap.cells.sizeY-1);++t)e.gameMap.cells.at(n,t).identified=!0;return Mo(e),void Ro(e)}let l=function(e,t,o,n){const r=e.player;let s=i.clone(r.pos),a=0;for(let l=1;l<=n;++l){const u=i.fromValues(r.pos[0]+t*l,r.pos[1]+o*l);if(u[0]<0||u[0]>=e.gameMap.cells.sizeX||u[1]<0||u[1]>=e.gameMap.cells.sizeY){e.finishedLevel&&(a=l);break}if(ko(e.gameMap,s,u,n)){Io(e.gameMap.cells.at(...u).type)&&(e.topStatusMessage="Window cannot be accessed from outside",e.topStatusMessageSticky=!1,0===e.level?e.sounds.tooHigh.play(.3):e.sounds.footstepTile.play(.1)),1==l&&[G.DoorEW,G.DoorNS].includes(e.gameMap.cells.at(...u).type)&&(a=l);break}a=l,s=u}if(a>0){const n=i.fromValues(r.pos[0]+t*a,r.pos[1]+o*a);void 0!==e.gameMap.guards.find((e=>e.pos[0]==n[0]&&e.pos[1]==n[1]))&&(a=0)}if(a>0){const n=r.pos[0]+t*a,i=r.pos[1]+o*a;n>=0&&n<e.gameMap.cells.sizeX&&i>=0&&i<e.gameMap.cells.sizeY&&(void 0!==e.gameMap.items.find((e=>e.pos[0]===n&&e.pos[1]===i&&function(e){switch(e){case X.TorchUnlit:case X.TorchLit:return!0;default:return!1}}(e.type)))||function(e){switch(e){case G.OneWayWindowE:case G.OneWayWindowW:case G.OneWayWindowN:case G.OneWayWindowS:case G.PortcullisNS:case G.PortcullisEW:return!0;default:return!1}}(e.gameMap.cells.at(n,i).type))&&(--a,e.topStatusMessage="Shift+move to leap",e.topStatusMessageSticky=!1,0===e.level?[G.PortcullisEW,G.PortcullisNS].includes(e.gameMap.cells.at(n,i).type)?setTimeout((()=>e.sounds.jump.play(.3)),1e3):e.sounds.jump.play(.3):e.sounds.footstepTile.play(.1))}return a}(e,t,o,n);if(l<=0){const n=i.fromValues(r.pos[0]+t*(l+1),r.pos[1]+o*(l+1)),s=e.gameMap.items.find((e=>e.pos[0]===n[0]&&e.pos[1]===n[1]));void 0===s||s.type!==X.TorchUnlit&&s.type!==X.TorchLit||(Mo(e),s.type===X.TorchUnlit?e.sounds.ignite.play(.08):e.sounds.douse.play(.05),s.type=s.type===X.TorchUnlit?X.TorchLit:X.TorchUnlit,Ro(e));const a=e.gameMap.cells.at(...n);if(a){const t=a.type;e.gameMap.cells.at(...r.pos).type;t>=G.PortcullisNS&&t<=G.PortcullisEW&&e.sounds.gate.play(.3)}return}Mo(e);const u=e.gameMap.cells.at(...r.pos).type,c=l;for(;l>0;--l){const n=r.pos[0]+t,i=r.pos[1]+o;if(1==c&&1==l)for(let t=Math.max(n-1,0);t<=Math.min(n+1,e.gameMap.cells.sizeX-1);++t)for(let o=Math.max(i-1,0);o<=Math.min(i+1,e.gameMap.cells.sizeY-1);++o)e.gameMap.cells.at(t,o).identified=!0;if(n<0||n>=e.gameMap.cells.sizeX||i<0||i>=e.gameMap.cells.sizeY)return void(e.level>=po.numGameMaps-1?Lo(e):Ao(e));r.pos[0]=n,r.pos[1]=i;const s=e.gameMap.collectLootAt(r.pos[0],r.pos[1]);s>0&&(r.loot+=s,e.lootStolen+=s,e.sounds.coin.play(1))}e.gameMap.cells.at(r.pos[0],r.pos[1]).type==G.GroundWoodCreaky&&function(e,t,o,n,r){t.noisy=!0,r.footstepCreaky.play(.6);let i=o*o,s=null;for(const n of e.guardsInEarshot(t.pos,o)){(t.pos[0]-n.pos[0])**2+(t.pos[1]-n.pos[1])**2<=i&&M(n.mode)&&(s=n),n.heardThief=!0}null!=s&&(s.mode=L.MoveToLastSound)}(e.gameMap,r,17,e.popups,e.sounds),Ro(e);const d=.5+Math.random()/2,h=e.gameMap.cells.at(...r.pos),p=u!==h.type;if(h.hidesPlayer)e.sounds.hide.play(.2);else{switch(h.type){case G.GroundWoodCreaky:e.sounds.footstepCreaky.play(.15*d);break;case G.GroundWood:(p||Math.random()>.9)&&e.sounds.footstepWood.play(.15*d);break;case G.GroundNormal:(p||Math.random()>.5)&&e.sounds.footstepGravel.play(.03*d);break;case G.GroundGrass:(p||Math.random()>.75)&&e.sounds.footstepGrass.play(.05*d);break;case G.GroundWater:(p||Math.random()>.6)&&e.sounds.footstepWater.play(.02*d);break;case G.GroundMarble:(p||Math.random()>.8)&&e.sounds.footstepTile.play(.05*d);break;default:(p||Math.random()>.8)&&e.sounds.footstepTile.play(.02*d)}if(void 0!==s&&void 0===a){const t=e.gameMap.guards.find((e=>e.pos[0]==s.pos[0]&&e.pos[1]==s.pos[1]));void 0!==t&&i.squaredDistance(e.player.pos,t.pos)<=100&&e.sounds.gate.play(.2)}}}function Io(e){switch(e){case G.OneWayWindowE:case G.OneWayWindowW:case G.OneWayWindowN:case G.OneWayWindowS:return!0;default:return!1}}function Mo(e){e.topStatusMessageSticky||(e.topStatusMessage=""),e.popups.clear(),e.player.noisy=!1,e.player.damagedLastTurn=!1}function Ro(e){let t=e.player.health;e.turns++,e.gameMap.cells.at(e.player.pos[0],e.player.pos[1]).type==G.GroundWater?e.player.turnsRemainingUnderwater>0&&--e.player.turnsRemainingUnderwater:e.player.turnsRemainingUnderwater=7,R(e.gameMap,e.popups,e.player),void 0!==e.gameMap.guards.find((e=>e.mode==L.ChaseVisibleTarget))&&(e.ghostBonus=0),e.gameMap.computeLighting(),e.gameMap.recomputeVisibility(e.player.pos),Ho(e),t>e.player.health&&(e.sounds.hitPlayer.play(.5),e.player.health<=0&&(setTimeout((()=>e.sounds.gameOverJingle.play(.5)),1e3),e.dailyRun&&(e.stats.dailyWinStreak=0,Fo("dailyWinStreak",e.stats.dailyWinStreak),e.stats.lastDaily={score:e.player.loot,date:jo()},Fo("lastDaily",e.stats.lastDaily)),e.gameMode=oo.Dead))}function Ho(e){e.gameMap.allSeen()&&(e.finishedLevel||e.sounds.levelRequirementJingle.play(.5),e.finishedLevel=!0);const t=e.popups.endOfUpdate(e.subtitledSounds);""!==t?(e.topStatusMessage=t,e.topStatusMessageSticky=!0):e.finishedLevel&&(e.topStatusMessage="Mansion fully mapped! Exit any side.",e.topStatusMessageSticky=!0)}function ko(e,t,o,n){if(o[0]<0||o[1]<0||o[0]>=e.cells.sizeX||o[1]>=e.cells.sizeY)return!0;if(t[0]==o[0]&&t[1]==o[1])return!1;const r=e.cells.at(o[0],o[1]),i=r.type;if(r.blocksPlayerMove)return!0;if(n>1){if(o[0]==t[0]&&(i==G.DoorNS||i==G.DoorEW)&&1==Math.abs(o[1]-t[1])&&e.items.find((e=>e.pos[0]==o[0]&&e.pos[1]==o[1]&&(e.type==X.DoorNS||e.type==X.DoorEW))))return!0;if(o[1]==t[1]&&(i==G.DoorNS||i==G.DoorEW)&&1==Math.abs(o[0]-t[0])&&e.items.find((e=>e.pos[0]==o[0]&&e.pos[1]==o[1]&&(e.type==X.DoorNS||e.type==X.DoorEW))))return!0}return i==G.OneWayWindowE&&o[0]<=t[0]||(i==G.OneWayWindowW&&o[0]>=t[0]||(i==G.OneWayWindowN&&o[1]<=t[1]||i==G.OneWayWindowS&&o[1]>=t[1]))}function Co(e,t){return new Promise(((o,n)=>{t.onload=()=>o(t),t.onerror=n,t.src=e}))}function Po(e,t){const o=e.player,n=o.pos[0],r=o.pos[1],i=e.gameMap.cells.at(n,r).lit,s=o.hidden(e.gameMap),a=t.tileSet.playerTiles;let l=t.tileSet.unlitTile;l=o.damagedLastTurn?a[1]:o.noisy?a[3]:s?a[2]:i?a[0]:a[4],t.addGlyph(n,r,n+1,r+1,l)}function Eo(e){return e[1]>0?1:e[1]<0?3:e[0]>0?0:e[0]<0?2:3}function Wo(e){const t={position:i.create(),velocity:i.create(),anchor:i.create(),snapped:!1,panning:!1};return i.copy(t.position,e),i.zero(t.velocity),t}function Uo(e){return JSON.parse(String(window.localStorage.getItem("stat."+e)))}function Fo(e,t){window.localStorage.setItem("stat."+e,JSON.stringify(t))}function Go(){return{highScores:Uo("highScores")??[],dailyScores:Uo("dailyScores")??[],bestScore:Uo("bestScore")??0,bestDailyScore:Uo("bestDailyScores")??0,lastDaily:Uo("lastDaily")??{score:0,date:""},dailyWinStreak:Uo("dailyWinStreak")??0,dailyPlays:Uo("dailyPlays")??0,dailyWins:Uo("dailyWins")??0,dailyPerfect:Uo("dailyPerfect")??0,totalGold:Uo("totalGold")??0,totalPlays:Uo("totalPlays")??0,totalWins:Uo("totalWins")??0,totalPerfect:Uo("totalPerfect")??0,totalGhosts:Uo("totalGhosts")??0,totalLootSweeps:Uo("totalLootSweeps")??0,achievements:Uo("achievements")??new Set}}function Do(e){e.gameMapRoughPlans=se(po.numGameMaps,po.totalGameLoot,e.rng),e.level=0,e.stats.totalPlays++,Fo("totalPlays",e.stats.totalPlays),e.dailyRun&&(e.stats.dailyPlays++,Fo("dailyPlays",e.stats.dailyPlays)),e.gameStats={lootStolen:0,lootSpent:0,ghostBonuses:0,timeBonuses:0,maxGhostBonuses:0,maxTimeBonuses:0,maxLootStolen:0};const t=le(e.level,e.gameMapRoughPlans[e.level],e.rng);e.gameMode=oo.Mansion,e.topStatusMessage=wo,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.healCost=1,e.turns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.player=new j(t.playerStartPos),e.camera=Wo(t.playerStartPos),e.gameMap=t,e.activeSoundPool.empty(),e.popups.clear()}function zo(e){const t=le(e.level,e.gameMapRoughPlans[e.level],e.rng);e.turns=0,e.lootStolen=0,e.lootSpent=0,e.lootAvailable=e.gameMapRoughPlans[e.level].totalLoot,e.ghostBonus=5,e.maxTimeBonus=5,e.topStatusMessage=wo,e.topStatusMessageSticky=!0,e.finishedLevel=!1,e.player=new j(t.playerStartPos),e.camera=Wo(t.playerStartPos),e.gameMap=t,e.popups.clear(),e.activeSoundPool.empty()}function No(e,t,o){const n=e/1e3,r=void 0===o.tLast?0:Math.min(1/30,n-o.tLast);o.dt=r,o.tLast=n;const s=i.create();if(t.getScreenSize(s),o.camera.snapped||(o.camera.panning=!1,o.camera.snapped=!0,function(e,t){Oo(e.camera.position,i.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos),i.zero(e.camera.velocity)}(o,s)),function(e){if(e.gamepadManager.updateGamepadStates(),null!==$t){e.helpActive?e.helpScreen.onControls(e,t):e.gameMode==oo.Mansion?function(o){if(e.camera.panning&&(e.camera.velocity[0]=0,e.camera.velocity[1]=0),o.controlStates.panLeft&&(e.camera.panning=!0,e.camera.velocity[0]=-1e3*e.dt),o.controlStates.panRight&&(e.camera.panning=!0,e.camera.velocity[0]=1e3*e.dt),o.controlStates.panUp&&(e.camera.panning=!0,e.camera.velocity[1]=1e3*e.dt),o.controlStates.panDown&&(e.camera.panning=!0,e.camera.velocity[1]=-1e3*e.dt),o.controlStates.snapToPlayer&&(e.camera.panning=!1,e.camera.snapped=!1),t("left")||t("heal")){const t=e.leapToggleActive||o.controlStates.jump?2:1;To(e,-1,0,t)}else if(t("right")){const t=e.leapToggleActive||o.controlStates.jump?2:1;To(e,1,0,t)}else if(t("down")){const t=e.leapToggleActive||o.controlStates.jump?2:1;To(e,0,-1,t)}else if(t("up")){const t=e.leapToggleActive||o.controlStates.jump?2:1;To(e,0,1,t)}else if(t("jumpLeft"))To(e,-1,0,2);else if(t("jumpRight"))To(e,1,0,2);else if(t("jumpDown"))To(e,0,-1,2);else if(t("jumpUp"))To(e,0,1,2);else if(t("wait"))To(e,0,0,0);else if(t("exitLevel"))e.level>=po.numGameMaps-1?Lo(e):Ao(e);else if(t("menu"))e.helpActive=!0;else if(t("jumpToggle"))e.leapToggleActive=!e.leapToggleActive;else if(t("seeAll"))e.seeAll=!e.seeAll;else if(t("collectLoot")){const t=e.gameMap.collectAllLoot();e.player.loot+=t,e.lootStolen+=t,Ho(e)}else if(t("forceRestart"))e.rng=new x,e.dailyRun=!1,Do(e);else if(t("nextLevel"))e.level<e.gameMapRoughPlans.length-1&&(++e.level,zo(e));else if(t("resetLevel"))zo(e);else if(t("prevLevel"))e.level>0&&(--e.level,zo(e));else if(t("guardSight"))e.seeGuardSight=!e.seeGuardSight;else if(t("guardPatrols"))e.seeGuardPatrols=!e.seeGuardPatrols;else if(t("markSeen"))e.gameMap.markAllSeen(),Ho(e);else if(t("zoomIn"))e.zoomLevel=Math.max(1,e.zoomLevel-1),e.camera.snapped=!1;else if(t("zoomOut"))e.zoomLevel=Math.min(10,e.zoomLevel+1),e.camera.snapped=!1;else if(t("seeAll"))e.seeAll=!e.seeAll;else if(t("guardMute")){e.guardMute=!e.guardMute;for(const t in e.subtitledSounds)e.subtitledSounds[t].mute=e.guardMute}else if(t("volumeMute"))e.volumeMute=!e.volumeMute,lt.mute(e.volumeMute);else if(t("volumeDown")){const e=lt.volume();lt.volume(Math.max(e-.1,.1))}else if(t("volumeUp")){const e=lt.volume();lt.volume(Math.max(e+.1,1))}}($t):e.textWindows[e.gameMode]?.onControls(e,t),e.touchController.resetActivation(),e.keyboardController.resetActivation();for(const t in e.gamepadManager.gamepads)e.gamepadManager.gamepads[t].resetActivation()}function t(t){let o=!1;if(null===$t)return!1;const n=$t.controlStates;if(!(t in n))return!1;if($t===e.touchController){const r=e.touchController;if(t in r.touchTargets&&"release"==r.touchTargets[t].trigger)return o=!n[t]&&$t.controlActivated[t],o&&($t.controlTimes[t]=Date.now()),o&&console.log(t,o),o}return o=n[t]&&($t.controlActivated[t]||Date.now()-$t.controlTimes[t]>250),o&&($t.controlTimes[t]=Date.now()),o&&console.log(t,o),o}}(o),r>0&&function(e,t,o){!function(e,t,o){const n=i.create();if(!e.camera.panning){const r=i.create();Oo(r,i.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos);const s=i.create();i.subtract(s,r,e.camera.position);const a=i.create();i.negate(a,e.camera.velocity);const l=8,u=i.create();i.scale(u,s,l**2),i.scaleAndAdd(u,u,a,2*l),i.scaleAndAdd(n,e.camera.velocity,u,o)}i.scaleAndAdd(e.camera.position,e.camera.position,e.camera.velocity,.5*o),i.scaleAndAdd(e.camera.position,e.camera.position,n,.5*o),i.copy(e.camera.velocity,n)}(e,t,o)}(o,s,r),o.helpActive){const e=o.helpScreen;e.update(o),e.parseUI(),e.updateScreenSize(s)}else{const e=o.textWindows[o.gameMode];void 0!==e&&(e.update(o),e.parseUI(),e.updateScreenSize(s))}!function(e,t,o,n){if($t!==e)return;const r=i.fromValues(n.gameMap.cells.sizeX,n.gameMap.cells.sizeY),s=(Bo(o[0]),o[0]),a=o[1]-2*_o,l=function(e,t,o,n){const r=t[0],s=t[1],a=_o*Bo(e[0]),l=i.fromValues(e[0],e[1]-2*a),u=l[0],c=l[1],d=Xo(l,r,s,n),h=d[0],p=d[1],f=o[0],g=o[1];return{screenToWorld:e=>i.fromValues((e[0]-u/2)*h/u+f,(e[1]-c/2-2*_o)*p/c+g),worldToScreen:e=>i.fromValues((e[0]-f)*u/h+u/2,(e[1]-g)*c/p+c/2+2*_o)}}(o,r,n.camera.position,n.zoomLevel);if(-1!=e.lastMotion.id&&e.lastMotion.active){const t=l.screenToWorld(i.fromValues(e.lastMotion.x0,e.lastMotion.y0)),o=l.screenToWorld(i.fromValues(e.lastMotion.x,e.lastMotion.y));var u=i.fromValues(o[0]-t[0],o[1]-t[1]);n.camera.panning=!0,i.subtract(u,o,t),n.camera.position[0]-=u[0]-n.camera.anchor[0],n.camera.position[1]-=u[1]-n.camera.anchor[1],n.camera.anchor[0]=u[0],n.camera.anchor[1]=u[1]}else n.camera.anchor[0]=0,n.camera.anchor[1]=0;const c=Math.floor(Math.min(a,s)/6),d=l.screenToWorld(i.fromValues(0,0)),h=l.screenToWorld(i.fromValues(c,c)),p=l.screenToWorld(i.fromValues(s,a)),f=d[0],g=d[1],m=p[0]-f,x=p[1]-g,_=h[0]-f,y=h[1]-g,v=n.helpActive||n.gameMode!=oo.Mansion?100:0,w=(n.helpActive||(n.gameMode,oo.BetweenMansions),!n.helpActive&&[oo.Dead,oo.Win].includes(n.gameMode)?0:100),S=n.helpActive?0:100;let b=t.tileSet.touchButtons;void 0===b&&(b={});const A=n.touchAsGamepad&&!($t===n.touchController&&n.touchController.mouseActive);if(n.touchController.setTouchConfig(A),A)var L={menu:{game:new Kt(f,g+x-y,_,y),view:new Kt,tileInfo:b.menu},zoomIn:{game:new Kt(f+m-_+v,g+x-2*y,_,y),view:new Kt,tileInfo:b.zoomIn},zoomOut:{game:new Kt(f+m-_+v,g+x-y,_,y),view:new Kt,tileInfo:b.zoomOut},fullscreen:{game:new Kt(f+m-_+S,g+x-y,_,y),view:new Kt,tileInfo:b.fullscreen},restart:{game:new Kt(f+m-_+w,g+x-y,_,y),view:new Kt,tileInfo:b.restart},forceRestart:{game:new Kt(f+m-_+S,g+x-2*y,_,y),view:new Kt,tileInfo:b.restart},left:{game:new Kt(f,g+y,_,y),view:new Kt,tileInfo:b.left},right:{game:new Kt(f+2*_,g+y,_,y),view:new Kt,tileInfo:b.right},up:{game:new Kt(f+_,g+2*y,_,y),view:new Kt,tileInfo:b.up},down:{game:new Kt(f+_,g,_,y),view:new Kt,tileInfo:b.down},wait:{game:new Kt(f+_,g+y,_,y),view:new Kt,tileInfo:b.wait},jump:{game:new Kt(f+m-_,g+_,_,y),view:new Kt,tileInfo:b.jump}};else{const e=4/n.zoomLevel;L={menu:{game:new Kt(f,g+x-1.5*e,e,e),view:new Kt,tileInfo:b.menu},zoomIn:{game:new Kt(f,g+x-2.5*e,e,e),view:new Kt,tileInfo:b.zoomIn},zoomOut:{game:new Kt(f,g+x-3.5*e,e,e),view:new Kt,tileInfo:b.zoomOut},fullscreen:{game:new Kt(f+S,g+x-4.5*e,e,e),view:new Kt,tileInfo:b.fullscreen},restart:{game:new Kt(f+w,g+x-5.5*e,e,e),view:new Kt,tileInfo:b.restart},forceRestart:{game:new Kt(f+S,g+x-6.5*e,e,e),view:new Kt,tileInfo:b.restart}};const t=n.player.pos;L.wait={game:new Kt(...t,1,1),view:new Kt,tileInfo:b.wait},!n.finishedLevel||n.gameMode!=oo.Mansion||n.helpActive||0!=t[0]&&0!=t[1]&&t[0]!=r[0]-1&&t[1]!=r[1]-1?L.exitLevel={game:new Kt(-1,-1,0,0),view:new Kt,tileInfo:b.exitLevel}:L.exitLevel={game:new Kt(f,g+x-4.5*e,e,e),view:new Kt,tileInfo:b.exitLevel};for(const e of[["left",[-1,0]],["right",[1,0]],["up",[0,1]],["down",[0,-1]]]){const o=e[0],s=e[1],a=i.fromValues(t[0]+s[0],t[1]+s[1]);a[0]<0||a[1]<0||a[0]>=r[0]||a[1]>=r[1]||(n.gameMap.cells.at(...a).blocksPlayerMove||n.gameMap.cells.at(...a).type==G.OneWayWindowE||n.gameMap.cells.at(...a).type==G.OneWayWindowW||n.gameMap.cells.at(...a).type==G.OneWayWindowN||n.gameMap.cells.at(...a).type==G.OneWayWindowS||n.gameMap.items.find((e=>e.pos[0]==a[0]&&e.pos[1]==a[1]&&[X.PortcullisEW,X.PortcullisNS].includes(e.type)))||n.gameMap.guards.find((e=>e.pos[0]==a[0]&&e.pos[1]==a[1]))?L[o]={game:new Kt(-1,-1,0,0),view:new Kt,tileInfo:b.picker}:L[o]={game:new Kt(...a,1,1),view:new Kt,tileInfo:b.picker})}for(const e of[["jumpLeft",[-1,0]],["jumpRight",[1,0]],["jumpUp",[0,1]],["jumpDown",[0,-1]]]){const o=e[0],s=e[1],a=i.fromValues(t[0]+s[0],t[1]+s[1]),l=i.fromValues(t[0]+2*s[0],t[1]+2*s[1]);a[0]<0||a[1]<0||a[0]>=r[0]||a[1]>=r[1]||l[0]<0||l[1]<0||l[0]>=r[0]||l[1]>=r[1]||n.gameMap.cells.at(...a).blocksPlayerMove||n.gameMap.cells.at(...l).blocksPlayerMove||n.gameMap.cells.at(...a).type==G.OneWayWindowE&&"jumpLeft"==o||n.gameMap.cells.at(...a).type==G.OneWayWindowW&&"jumpRight"==o||n.gameMap.cells.at(...a).type==G.OneWayWindowN&&"jumpDown"==o||n.gameMap.cells.at(...a).type==G.OneWayWindowS&&"jumpUp"==o||n.gameMap.items.find((e=>e.pos[0]==l[0]&&e.pos[1]==l[1]&&[X.PortcullisEW,X.PortcullisNS].includes(e.type)))||n.gameMap.guards.find((e=>e.pos[0]==l[0]&&e.pos[1]==l[1]))?L[o]={game:new Kt(-1,-1,0,0),view:new Kt,tileInfo:b.picker}:L[o]={game:new Kt(...l,1,1),view:new Kt,tileInfo:b.picker}}}for(const t in L){const o=L[t],n=o.game,r=l.worldToScreen(i.fromValues(n[0],n[1])),s=l.worldToScreen(i.fromValues(n[0]+n[2],n[1]+n[3]));e.updateCoreTouchTarget(t,n,new Kt(r[0],r[1],s[0]-r[0],s[1]-r[1]),o.tileInfo)}if(n.helpActive){const t=n.helpScreen;e.activateTouchTargets(t.getTouchData())}else{const t=n.textWindows[n.gameMode];e.activateTouchTargets(t?.getTouchData())}}(o.touchController,t,s,o),function(e,t,o){e.beginFrame(t);const n=a.create();(function(e,t,o){const n=e.gameMap.cells.sizeX,r=e.gameMap.cells.sizeY,s=_o*Bo(t[0]),l=i.fromValues(t[0],t[1]-2*s),[u,c]=Xo(l,n,r,e.zoomLevel),d=e.camera.position[0],h=e.camera.position[1],p=e.zoomLevel,f=s/(vo*p),g=Math.floor(yo*(d-u/2))/yo,m=Math.floor(vo*(h-c/2))/vo;a.ortho(o,g,g+u,m-f,m+c+f,1,-1)})(o,t,n),e.start(n,1),function(e,t){const o={};for(let t of e.gameMap.items){const n=e.gameMap.cells.index(...t.pos);n in o?o[n].push(t):o[n]=[t]}for(let n=0;n<e.gameMap.cells.sizeX;++n)for(let r=e.gameMap.cells.sizeY-1;r>=0;--r){const i=e.gameMap.cells.at(n,r);if(!i.seen&&!e.seeAll)continue;let s=i.type;s!=G.GroundWoodCreaky||i.lit||i.identified||(s=G.GroundWood);const a=s>=G.Wall0000&&s<=G.DoorEW||i.lit;if([G.PortcullisEW].includes(s)&&e.gameMap.guards.find((e=>e.pos[0]==n&&e.pos[1]==r))?t.addGlyph(n,r,n+1,r+1,t.tileSet.terrainTiles[G.PortcullisNS],a):t.addGlyph(n,r,n+1,r+1,t.tileSet.terrainTiles[s],a),s===G.GroundWater){const o=t.tileSet.ledgeTiles;let i=0;for(let s of[[0,1],[0,-1],[-1,0],[1,0]])e.gameMap.cells.at(n+s[0],r+s[1]).type!==G.GroundWater&&t.addGlyph(n,r,n+1,r+1,o[i],a),i++}const l=e.gameMap.cells.index(n,r);if(l in o)for(let a of o[l]){const o=a.type>=X.DoorNS&&a.type<=X.PortcullisEW||a.type==X.Coin||i.lit;[G.PortcullisEW].includes(s)&&e.gameMap.guards.find((e=>e.pos[0]==n&&e.pos[1]==r))?t.addGlyph(n,r,n+1,r+1,t.tileSet.itemTiles[X.PortcullisNS],o):t.addGlyph(n,r,n+1,r+1,t.tileSet.itemTiles[a.type],o)}}}(o,e),o.gameMode===oo.Mansion&&(!function(e,t){if(!e.seeGuardSight)return;const o=e.gameMap.cells.sizeX,n=e.gameMap.cells.sizeY,r=new W(o,n,!1),s=i.create(),a=i.create();for(const t of e.gameMap.guards){const l=3,u=Math.max(0,Math.floor(t.pos[0]-l)),c=Math.min(o,Math.floor(t.pos[0]+l)+1),d=Math.max(0,Math.floor(t.pos[1]-l)),h=Math.min(n,Math.floor(t.pos[1]+l)+1);for(let o=d;o<h;++o)for(let n=u;n<c;++n){i.set(s,n,o),i.subtract(a,s,t.pos);const l=e.gameMap.cells.at(n,o);r.get(n,o)||l.blocksPlayerMove||(e.seeAll||l.seen)&&(i.dot(t.dir,a)<0||i.squaredLength(a)>=t.sightCutoff(l.lit)||P(e.gameMap,t.pos,s)&&r.set(n,o,!0))}}for(let o=0;o<e.gameMap.cells.sizeY;++o)for(let n=0;n<e.gameMap.cells.sizeX;++n)r.get(n,o)&&t.addGlyph(n,o,n+1,o+1,{textureIndex:3,color:4294967295},!0)}(o,e),function(e,t){if(e.seeGuardPatrols)for(const o of e.gameMap.guards)for(const e of o.patrolPath)t.addGlyph(e[0],e[1],e[0]+1,e[1]+1,{textureIndex:92,color:4286644096},!0)}(o,e),Po(o,e));o.gameMode===oo.Dead&&Po(o,e);(function(e,t){for(const o of e.gameMap.guards){let n=0+Eo(o.dir);const r=e.gameMap.cells.at(o.pos[0],o.pos[1]),s=e.seeAll||r.seen||o.speaking;if(!s&&i.squaredDistance(e.player.pos,o.pos)>36)continue;let a=!0;s?o.mode!=L.Patrol||o.speaking||r.lit?n+=8:a=!1:n+=4;const l=t.tileSet.npcTiles[n],u=e.gameMap.items.find((e=>[X.PortcullisEW,X.PortcullisNS].includes(e.type))),c=void 0!==u&&u.pos[0]==o.pos[0]&&u.pos[1]==o.pos[1]?.25:0,d=o.pos[0]+c,h=o.pos[1];if(o.hasTorch){let e=d+.375*o.dir[0]+.375*o.dir[1],n=h;o.dir[1]>0?(t.addGlyph(e,n,e+1,n+1,t.tileSet.itemTiles[X.TorchCarry],!0),t.addGlyph(d,h,d+1,h+1,l,!0)):(t.addGlyph(d,h,d+1,h+1,l,!0),t.addGlyph(e,n,e+1,n+1,t.tileSet.itemTiles[X.TorchCarry],!0))}else t.addGlyph(o.pos[0],o.pos[1],o.pos[0]+1,o.pos[1]+1,l,a)}})(o,e),o.gameMode===oo.Mansion&&function(e,t){for(const o of e.gameMap.guards){const n=e.gameMap.cells.at(o.pos[0],o.pos[1]);if(!(e.seeAll||n.seen||o.speaking)&&i.squaredDistance(e.player.pos,o.pos)>36)continue;const r=o.overheadIcon();if(r===N.Relaxed)continue;const s=o.pos[0],a=o.pos[1]+.625;t.addGlyph(s,a,s+1,a+1,t.tileSet.guardStateTiles[r],!0)}if(e.player.noisy){const o=e.player.pos[0],n=e.player.pos[1]-.5;t.addGlyph(o,n,o+1,n+1,{textureIndex:104,color:2164260863},!0)}}(o,e);e.flush();const r=o.textWindows[o.gameMode];void 0!==r&&r.render(e);o.gameMode!==oo.Mansion&&o.gameMode!==oo.BetweenMansions||(o.helpActive?(o.helpScreen.render(e),Vo(e,t,o)):(!function(e,t,o){const n=Bo(t[0]),r=n*_o,i=t[0]/(n*xo),s=t[1]/r,l=1-s,u=a.create();a.ortho(u,0,i,l,s+l,1,-1),e.start(u,0);const c=Math.ceil(i),d=4279242768;e.addGlyph(0,0,c,1,{textureIndex:219,color:d});const h=Math.floor((c-o.length)/2+.5);Yo(e,h,o,Ye),e.flush()}(e,t,o.topStatusMessage),Vo(e,t,o)));$t===o.touchController&&(e.start(n,1),function(e,t,o){for(const t in o.coreTouchTargets){if(!(t in o.controlStates))continue;const n=o.coreTouchTargets[t],r=o.controlStates[t];null!==n.tileInfo&&("always"==n.show||"press"==n.show&&-1!=n.id)&&e.addGlyph(n.game[0],n.game[1],n.game[0]+n.game[2],n.game[1]+n.game[3],n.tileInfo,r)}e.flush()}(e,0,o.touchController),e.flush())}(t,s,o),requestAnimationFrame((e=>No(e,t,o)))}function Oo(e,t,o,n,r){const s=i.create(),a=i.create();!function(e,t,o,n,r){const s=e[0],a=e[1],l=_o*Bo(t[0]),u=i.fromValues(t[0],t[1]-2*l),[c,d]=Xo(u,s,a,o);let h=c/2,p=e[0]-c/2;h>p&&(h=p=e[0]/2);let f=d/2,g=e[1]-d/2;f>g&&(f=g=e[1]/2);n[0]=h,n[1]=f,r[0]=p,r[1]=g}(t,n,o,s,a),e[0]=Math.max(s[0],Math.min(a[0],r[0]+.5)),e[1]=Math.max(s[1],Math.min(a[1],r[1]+.5))}function Xo(e,t,o,n){const r=yo*n,i=vo*n;return[e[0]/r,e[1]/i]}function Bo(e){return Math.min(2,Math.max(1,Math.floor(e/(mo*xo))))}function Yo(e,t,o,n){for(let r=0;r<o.length;++r){const i=o.charCodeAt(r);e.addGlyph(t+r,0,t+r+1,1,{textureIndex:i,color:n})}}function Vo(e,t,o){const n=Bo(t[0]),r=t[0]/(n*xo),i=t[1]/(n*_o),s=a.create();a.ortho(s,0,r,0,i,1,-1),e.start(s,0);const l=Math.ceil(r);e.addGlyph(0,0,l,1,{textureIndex:219,color:4279242768});Yo(e,1,"Health",Xe);for(let t=0;t<V;++t){const n=t<o.player.health?Xe:De,r=3;e.addGlyph(t+1+7,0,t+1+8,1,{textureIndex:r,color:n})}if(o.gameMap.cells.at(o.player.pos[0],o.player.pos[1]).type==G.GroundWater&&o.player.turnsRemainingUnderwater>0){const t=1+V+10;Yo(e,t,"Air",qe);for(let n=0;n<o.player.turnsRemainingUnderwater;++n){const o=9;e.addGlyph(t+4+n,0,t+5+n,1,{textureIndex:o,color:qe})}}const u=o.gameMap.percentSeen(),c=bo(o),d=o.gameMap.cells,h=Math.ceil(d.sizeX*d.sizeY/10);let p=h*Math.ceil((o.turns+1)/h)-o.turns;const f=c>0?" Timer "+p+" (+"+c+")":" Turns "+o.turns+" (--)",g="Mansion "+(o.level+1)+" - "+u+"% Mapped - "+f;Yo(e,Math.floor((l-g.length)/2+.5),g,Ye);let m="Loot "+o.player.loot;const x=l-(m.length+1);if(Yo(e,x,m,Ze),o.leapToggleActive){const t="Leap";Yo(e,x-(t.length+2),t,$e)}e.flush()}function jo(){const e=new Date,t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();return`${String(t)}/${String(o).padStart(2,"0")}/${String(n).padStart(2,"0")}`}
//# sourceMappingURL=index.ad8ad6ee.js.map
