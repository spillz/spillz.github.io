function e(e,t,o,r){Object.defineProperty(e,t,{get:o,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},n=t.parcelRequire550f;let i;var s;let a;var l;function u(e){return Math.floor(Math.random()*e)}function c(e){for(let t=e.length-1;t>0;--t){let o=u(t+1),r=e[t];e[t]=e[o],e[o]=r}}let d;var p;null==n&&((n=function(e){if(e in o)return o[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return o[e]=n,t.call(n.exports,n,n.exports),n.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},t.parcelRequire550f=n),n.register("27Lyk",(function(t,o){var r,n;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>n),(e=>n=e));var i={};r=function(e){for(var t=Object.keys(e),o=0;o<t.length;o++)i[t[o]]=e[t[o]]},n=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),n.register("bgyNt",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9NYDb"),import.meta.url).toString()})),n.register("coakI",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hUD0w"),import.meta.url).toString()})),n.register("7XfMr",(function(e,t){e.exports=new URL(n("27Lyk").resolve("eV2HF"),import.meta.url).toString()})),n.register("5jIXu",(function(e,t){e.exports=new URL(n("27Lyk").resolve("ihcZV"),import.meta.url).toString()})),n.register("h61MQ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("l7al6"),import.meta.url).toString()})),n.register("1OFiM",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4m20I"),import.meta.url).toString()})),n.register("hadbD",(function(e,t){e.exports=new URL(n("27Lyk").resolve("l8Gs4"),import.meta.url).toString()})),n.register("dH5ka",(function(e,t){e.exports=new URL(n("27Lyk").resolve("91j7m"),import.meta.url).toString()})),n.register("3twvr",(function(e,t){e.exports=new URL(n("27Lyk").resolve("dyBrj"),import.meta.url).toString()})),n.register("bBbdi",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kO5BQ"),import.meta.url).toString()})),n.register("kBrAM",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9stv3"),import.meta.url).toString()})),n.register("k6Tdk",(function(e,t){e.exports=new URL(n("27Lyk").resolve("iFwHo"),import.meta.url).toString()})),n.register("vDQ5G",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cUkcS"),import.meta.url).toString()})),n.register("7DVvx",(function(e,t){e.exports=new URL(n("27Lyk").resolve("3WoZq"),import.meta.url).toString()})),n.register("al4v1",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4CRTl"),import.meta.url).toString()})),n.register("fO2Fk",(function(e,t){e.exports=new URL(n("27Lyk").resolve("byhsW"),import.meta.url).toString()})),n.register("kaxMC",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9W38z"),import.meta.url).toString()})),n.register("iCU64",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fWY3x"),import.meta.url).toString()})),n.register("a3sPN",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6j9tB"),import.meta.url).toString()})),n.register("9Y9d3",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1TSGW"),import.meta.url).toString()})),n.register("a8Yhh",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8v9j2"),import.meta.url).toString()})),n.register("9KHDZ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hOjVZ"),import.meta.url).toString()})),n.register("eiW2b",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fr6SK"),import.meta.url).toString()})),n.register("6x7Kh",(function(e,t){e.exports=new URL(n("27Lyk").resolve("dGACl"),import.meta.url).toString()})),n.register("bMjEO",(function(e,t){e.exports=new URL(n("27Lyk").resolve("13ZtD"),import.meta.url).toString()})),n.register("3mayG",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cIW1u"),import.meta.url).toString()})),n.register("blCN3",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8VThJ"),import.meta.url).toString()})),n.register("bGiLK",(function(e,t){e.exports=new URL(n("27Lyk").resolve("liehg"),import.meta.url).toString()})),n.register("bjubH",(function(e,t){e.exports=new URL(n("27Lyk").resolve("d1w1I"),import.meta.url).toString()})),n.register("4PUSb",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1szZs"),import.meta.url).toString()})),n.register("1N1FC",(function(e,t){e.exports=new URL(n("27Lyk").resolve("3PKoN"),import.meta.url).toString()})),n.register("ktUCQ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("WdFUc"),import.meta.url).toString()})),n.register("9xpZV",(function(e,t){e.exports=new URL(n("27Lyk").resolve("sXil1"),import.meta.url).toString()})),n.register("8QCS3",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kkp8R"),import.meta.url).toString()})),n.register("5drqJ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1rJw8"),import.meta.url).toString()})),n.register("a0v0l",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6TnnE"),import.meta.url).toString()})),n.register("1lD69",(function(e,t){e.exports=new URL(n("27Lyk").resolve("lCHyy"),import.meta.url).toString()})),n.register("jfcxP",(function(e,t){e.exports=new URL(n("27Lyk").resolve("f0fy8"),import.meta.url).toString()})),n.register("ilgo9",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9Xw0E"),import.meta.url).toString()})),n.register("92tfF",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4VuBW"),import.meta.url).toString()})),n.register("etshw",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5uHDb"),import.meta.url).toString()})),n.register("5mgz9",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fWL68"),import.meta.url).toString()})),n.register("61v8j",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6pqgc"),import.meta.url).toString()})),n.register("dKL59",(function(e,t){e.exports=new URL(n("27Lyk").resolve("ghROA"),import.meta.url).toString()})),n.register("bnVxc",(function(e,t){e.exports=new URL(n("27Lyk").resolve("dc6kq"),import.meta.url).toString()})),n.register("8YZcm",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8KwSJ"),import.meta.url).toString()})),n.register("rmNTt",(function(e,t){e.exports=new URL(n("27Lyk").resolve("34VHX"),import.meta.url).toString()})),n.register("4xVWY",(function(e,t){e.exports=new URL(n("27Lyk").resolve("giL0r"),import.meta.url).toString()})),n.register("61Svf",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1BovV"),import.meta.url).toString()})),n.register("86i15",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kcwN9"),import.meta.url).toString()})),n.register("eCMLG",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hRKbg"),import.meta.url).toString()})),n.register("hkgAs",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bg5Qh"),import.meta.url).toString()})),n.register("eV2Mu",(function(e,t){e.exports=new URL(n("27Lyk").resolve("89MiG"),import.meta.url).toString()})),n.register("fzoRy",(function(e,t){e.exports=new URL(n("27Lyk").resolve("i8TkL"),import.meta.url).toString()})),n.register("bn9kD",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hzjPW"),import.meta.url).toString()})),n.register("dKFtp",(function(e,t){e.exports=new URL(n("27Lyk").resolve("g7HTD"),import.meta.url).toString()})),n.register("awcka",(function(e,t){e.exports=new URL(n("27Lyk").resolve("3Km1m"),import.meta.url).toString()})),n.register("52i2z",(function(e,t){e.exports=new URL(n("27Lyk").resolve("jKVho"),import.meta.url).toString()})),n.register("iyeOS",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5czfn"),import.meta.url).toString()})),n.register("gb2R8",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9Z4ZM"),import.meta.url).toString()})),n.register("b6tdD",(function(e,t){e.exports=new URL(n("27Lyk").resolve("gMj9u"),import.meta.url).toString()})),n.register("UYsu8",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6eSV6"),import.meta.url).toString()})),n.register("e0y8E",(function(e,t){e.exports=new URL(n("27Lyk").resolve("55qK2"),import.meta.url).toString()})),n.register("6QVDF",(function(e,t){e.exports=new URL(n("27Lyk").resolve("euj2n"),import.meta.url).toString()})),n.register("4q9kg",(function(e,t){e.exports=new URL(n("27Lyk").resolve("gzCTv"),import.meta.url).toString()})),n.register("2zxmO",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hwg1r"),import.meta.url).toString()})),n.register("7rF1E",(function(e,t){e.exports=new URL(n("27Lyk").resolve("jmsQv"),import.meta.url).toString()})),n.register("kQvBC",(function(e,t){e.exports=new URL(n("27Lyk").resolve("lElC3"),import.meta.url).toString()})),n.register("2hpzi",(function(e,t){e.exports=new URL(n("27Lyk").resolve("jO7pQ"),import.meta.url).toString()})),n.register("9gwX6",(function(e,t){e.exports=new URL(n("27Lyk").resolve("h4sXf"),import.meta.url).toString()})),n.register("88Oom",(function(e,t){e.exports=new URL(n("27Lyk").resolve("j5EN0"),import.meta.url).toString()})),n.register("kc3NH",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fKuUC"),import.meta.url).toString()})),n.register("40CPy",(function(e,t){e.exports=new URL(n("27Lyk").resolve("gQzzS"),import.meta.url).toString()})),n.register("lJn7Q",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9Pb6r"),import.meta.url).toString()})),n.register("eBHTR",(function(e,t){e.exports=new URL(n("27Lyk").resolve("34pTr"),import.meta.url).toString()})),n.register("g5A67",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4tfB8"),import.meta.url).toString()})),n.register("kyAEI",(function(e,t){e.exports=new URL(n("27Lyk").resolve("ffewC"),import.meta.url).toString()})),n.register("g7feg",(function(e,t){e.exports=new URL(n("27Lyk").resolve("WoCmp"),import.meta.url).toString()})),n.register("a1Jxk",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cSZLW"),import.meta.url).toString()})),n.register("bKUzC",(function(e,t){e.exports=new URL(n("27Lyk").resolve("2mHF8"),import.meta.url).toString()})),n.register("9aXjz",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4csbh"),import.meta.url).toString()})),n.register("hfvuU",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bCRFo"),import.meta.url).toString()})),n.register("4gLkA",(function(e,t){e.exports=new URL(n("27Lyk").resolve("2l7Et"),import.meta.url).toString()})),n.register("3HAUN",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hB3MQ"),import.meta.url).toString()})),n.register("la1r7",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bjYVv"),import.meta.url).toString()})),n.register("9fSJi",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5tGUj"),import.meta.url).toString()})),n.register("k1qbX",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8xtZJ"),import.meta.url).toString()})),n.register("1u6dV",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9CdXT"),import.meta.url).toString()})),n.register("dPu8f",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6DRtk"),import.meta.url).toString()})),n.register("bSHoC",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8UIiY"),import.meta.url).toString()})),n.register("betci",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8ePst"),import.meta.url).toString()})),n.register("7ExfT",(function(e,t){e.exports=new URL(n("27Lyk").resolve("48e5Q"),import.meta.url).toString()})),n.register("9v56M",(function(e,t){e.exports=new URL(n("27Lyk").resolve("7gqfi"),import.meta.url).toString()})),n.register("8pWsQ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("3U15P"),import.meta.url).toString()})),n.register("7bU35",(function(e,t){e.exports=new URL(n("27Lyk").resolve("chOaJ"),import.meta.url).toString()})),n.register("8V6Zl",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fzmcm"),import.meta.url).toString()})),n.register("9OuxM",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9zRXz"),import.meta.url).toString()})),n.register("5UMPc",(function(e,t){e.exports=new URL(n("27Lyk").resolve("7P7XB"),import.meta.url).toString()})),n.register("a1naR",(function(e,t){e.exports=new URL(n("27Lyk").resolve("2eySC"),import.meta.url).toString()})),n.register("k25sm",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hqxOO"),import.meta.url).toString()})),n.register("6s45F",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8cvb7"),import.meta.url).toString()})),n.register("7F9SI",(function(e,t){e.exports=new URL(n("27Lyk").resolve("a79kT"),import.meta.url).toString()})),n.register("epmsQ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("2enQg"),import.meta.url).toString()})),n.register("lVOrm",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5UMbD"),import.meta.url).toString()})),n.register("7n2bq",(function(e,t){e.exports=new URL(n("27Lyk").resolve("afhHD"),import.meta.url).toString()})),n.register("lJynn",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bxRQ3"),import.meta.url).toString()})),n.register("aIecx",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5SQZe"),import.meta.url).toString()})),n.register("fg20H",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1WMIZ"),import.meta.url).toString()})),n.register("03Ee8",(function(e,t){e.exports=new URL(n("27Lyk").resolve("eXsF5"),import.meta.url).toString()})),n.register("1kKRF",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4zDjY"),import.meta.url).toString()})),n.register("4czHp",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kB0ew"),import.meta.url).toString()})),n.register("cauwk",(function(e,t){e.exports=new URL(n("27Lyk").resolve("ddrqy"),import.meta.url).toString()})),n.register("csGZP",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cZmgQ"),import.meta.url).toString()})),n.register("2tRKJ",(function(e,t){e.exports=new URL(n("27Lyk").resolve("5fEeM"),import.meta.url).toString()})),n.register("e5O0h",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kZHdL"),import.meta.url).toString()})),n.register("ivwRf",(function(e,t){e.exports=new URL(n("27Lyk").resolve("61M6l"),import.meta.url).toString()})),n.register("5Natg",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bigld"),import.meta.url).toString()})),n.register("iXIzY",(function(e,t){e.exports=new URL(n("27Lyk").resolve("hINbf"),import.meta.url).toString()})),n.register("ejeiL",(function(e,t){e.exports=new URL(n("27Lyk").resolve("fNm19"),import.meta.url).toString()})),n.register("hf2wD",(function(e,t){e.exports=new URL(n("27Lyk").resolve("ddLjp"),import.meta.url).toString()})),n.register("7BUuc",(function(e,t){e.exports=new URL(n("27Lyk").resolve("eTl1g"),import.meta.url).toString()})),n.register("oQK7X",(function(e,t){e.exports=new URL(n("27Lyk").resolve("kL55A"),import.meta.url).toString()})),n.register("l7rpd",(function(e,t){e.exports=new URL(n("27Lyk").resolve("j79x4"),import.meta.url).toString()})),n.register("hcAf3",(function(e,t){e.exports=new URL(n("27Lyk").resolve("iIyoY"),import.meta.url).toString()})),n.register("jbg5i",(function(e,t){e.exports=new URL(n("27Lyk").resolve("bZzGK"),import.meta.url).toString()})),n.register("2pk3Y",(function(e,t){e.exports=new URL(n("27Lyk").resolve("2ZnEG"),import.meta.url).toString()})),n.register("9pZ1x",(function(e,t){e.exports=new URL(n("27Lyk").resolve("jyEhS"),import.meta.url).toString()})),n.register("j09Wg",(function(e,t){e.exports=new URL(n("27Lyk").resolve("aOW8M"),import.meta.url).toString()})),n.register("5jj80",(function(e,t){e.exports=new URL(n("27Lyk").resolve("chvcz"),import.meta.url).toString()})),n.register("5tRTq",(function(e,t){e.exports=new URL(n("27Lyk").resolve("3rxao"),import.meta.url).toString()})),n.register("1BHLT",(function(e,t){e.exports=new URL(n("27Lyk").resolve("4z70Y"),import.meta.url).toString()})),n.register("9QAiO",(function(e,t){e.exports=new URL(n("27Lyk").resolve("8EoUa"),import.meta.url).toString()})),n.register("frozH",(function(e,t){e.exports=new URL(n("27Lyk").resolve("iorHj"),import.meta.url).toString()})),n.register("5xAy0",(function(e,t){e.exports=new URL(n("27Lyk").resolve("c0kPk"),import.meta.url).toString()})),n.register("leoYP",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cbXrG"),import.meta.url).toString()})),n.register("4YbOi",(function(e,t){e.exports=new URL(n("27Lyk").resolve("1nodj"),import.meta.url).toString()})),n.register("YKAZv",(function(e,t){e.exports=new URL(n("27Lyk").resolve("jDUg7"),import.meta.url).toString()})),n.register("81dli",(function(e,t){e.exports=new URL(n("27Lyk").resolve("gphqW"),import.meta.url).toString()})),n.register("gfMsn",(function(e,t){e.exports=new URL(n("27Lyk").resolve("47Pvr"),import.meta.url).toString()})),n.register("d0uyI",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6cbLY"),import.meta.url).toString()})),n.register("63paY",(function(e,t){e.exports=new URL(n("27Lyk").resolve("cicW2"),import.meta.url).toString()})),n.register("c2ocL",(function(e,t){e.exports=new URL(n("27Lyk").resolve("60W0c"),import.meta.url).toString()})),n.register("it1tO",(function(e,t){e.exports=new URL(n("27Lyk").resolve("chz1H"),import.meta.url).toString()})),n.register("3bDSd",(function(e,t){e.exports=new URL(n("27Lyk").resolve("9p3gA"),import.meta.url).toString()})),n.register("F1F1Y",(function(e,t){e.exports=new URL(n("27Lyk").resolve("gHO7r"),import.meta.url).toString()})),n("27Lyk").register(JSON.parse('{"17fSe":"index.b7369160.js","k57aN":"tiles34.9ed4eaf2.png","dwPvt":"tiles31color.36c0cf62.png","7FSnQ":"tiles-sincity.0e9634a5.png","8dSx0":"tiles.60aa3fc2.png","kDrfW":"font.84b63647.png","8Qic0":"Minstrel_Dance.84f0fe17.mp3","dci1D":"level-requirement-1.39784509.ogg","6wmQa":"level-requirement-2.b939d53b.ogg","8AE6h":"lose-game-over.b2ac6941.ogg","25Nym":"Minstrel Dance Easter Egg.4ef0b0e0.ogg","9HrbR":"footstep-wood.8da8b302.ogg","2fyQO":"footstep-tile.ed285432.ogg","4qSI0":"footstep-water.41ed0f5b.ogg","3kwMs":"footstep-gravel.2ecfc65f.ogg","3zakP":"footstep-grass.46fcb678.ogg","9NYDb":"creak.6ed6b7c0.ogg","hUD0w":"creak-2.51d77164.ogg","eV2HF":"creak-3.609207b9.ogg","ihcZV":"creak-4.e35a5bbd.ogg","l7al6":"creak-5.8517ccd2.ogg","4m20I":"creak-6.58298378.ogg","l8Gs4":"squeak1.463f9d1d.wav","91j7m":"squeak2.be5c76a8.wav","dyBrj":"squeak3.f084da55.wav","kO5BQ":"squeak4.f2ef2e0b.wav","9stv3":"hit16.mp3.12db2307.flac","iFwHo":"hit17.mp3.f1f9a130.flac","cUkcS":"hit18.mp3.9e7af88b.flac","3WoZq":"hit19.mp3.d775e463.flac","4CRTl":"hit20.mp3.3b3594b6.flac","byhsW":"hit26.mp3.ad2a87c8.flac","9W38z":"hit27.mp3.68a7736d.flac","fWY3x":"coin.170ad949.ogg","6j9tB":"coin-2.b467d436.ogg","1TSGW":"coin-3.58153793.ogg","8v9j2":"coin-4.886754a5.ogg","hOjVZ":"coin-5.375e9b45.ogg","fr6SK":"Hmm.a0e363c7.ogg","dGACl":"What.549fabf2.ogg","13ZtD":"hey.10b98cf2.ogg","cIW1u":"hey-2.a9ba6219.ogg","8VThJ":"hey-3.3365a423.ogg","liehg":"what was that.f3d81617.ogg","d1w1I":"what was that-2.5515a177.ogg","1szZs":"what was that-3.9e14b250.ogg","3PKoN":"what was that-4.678dc972.ogg","WdFUc":"what was that-5.e7b8266a.ogg","sXil1":"who goes there.ead61472.ogg","kkp8R":"huh.7a58fb7d.ogg","1rJw8":"what.549fabf2.ogg","6TnnE":"wha.d4235147.ogg","lCHyy":"wait.f4e191a2.ogg","f0fy8":"who there.abd0dee5.ogg","9Xw0E":"what moved.3c40560d.ogg","4VuBW":"what in the shadows.40c735a3.ogg","5uHDb":"shadow move.a2c88b02.ogg","fWL68":"see something.677713e2.ogg","6pqgc":"hello.eae0a324.ogg","ghROA":"ugh.4874153e.ogg","dc6kq":"quiet out.fa80e9ae.ogg","8KwSJ":"jumpy.81de2330.ogg","34VHX":"jumpin shadows.ac194b09.ogg","giL0r":"ahh.dddfe597.ogg","1BovV":"aww.a6262cc6.ogg","kcwN9":"rest me bones.6274670b.ogg","hRKbg":"oh well.3085e1fe.ogg","bg5Qh":"case of the jitters.fe109193.ogg","89MiG":"must be seeing.78ec84d9.ogg","i8TkL":"what in my coffee.cf16ea27.ogg","hzjPW":"coffee too strong.f02d4f6c.ogg","g7HTD":"hmm nothing.3c124d8c.ogg","3Km1m":"well I though I saw.7cb198a1.ogg","jKVho":"nothing.b8e61268.ogg","5czfn":"hopefully nothing.77efcff0.ogg","9Z4ZM":"seeing things.19798c48.ogg","gMj9u":"hark.5ec1a7bb.ogg","6eSV6":"noise.930a57f5.ogg","55qK2":"heard something.784922cf.ogg","euj2n":"cant hear now.48b15b04.ogg","gzCTv":"hearing things.cbc64512.ogg","hwg1r":"noise again.8c4664ac.ogg","jmsQv":"someone there.e3a76bb1.ogg","lElC3":"who could that be.131bf65c.ogg","jO7pQ":"there it is again.9303b090.ogg","h4sXf":"better check it out.cb052215.ogg","j5EN0":"what keeps making those noises.a26ac1c4.ogg","fKuUC":"better be rats.c9318ac2.ogg","gQzzS":"again.9ec4ebd1.ogg","9Pb6r":"who that.4ba81dd0.ogg","34pTr":"come out come out.cfe1d81f.ogg","4tfB8":"guess nothing.26a3c63a.ogg","ffewC":"wonder it was.897f60c6.ogg","WoCmp":"back to post.0e4777e5.ogg","cSZLW":"quiet now.cf928542.ogg","2mHF8":"sure I heard something.d2a04400.ogg","4csbh":"not there anymore.61604bd9.ogg","bCRFo":"probably nothing.c7b5432d.ogg","2l7Et":"i dont know why i work here.566fdc13.ogg","hB3MQ":"waste of my time.273c9664.ogg","bjYVv":"why do I even try.a1904d65.ogg","5tGUj":"at least Im not on cleaning duty.bac1d40d.ogg","8xtZJ":"at least my shift ends soon.8c9c8d6d.ogg","9CdXT":"what do you want me to do about it.24a7b892.ogg","6DRtk":"whistle.85b036cd.ogg","8UIiY":"whistle-2.9b52b81a.ogg","8ePst":"whistle-3.e678d724.ogg","48e5Q":"where.513303e2.ogg","7gqfi":"coming.0db6eacf.ogg","3U15P":"here I come.8e660313.ogg","chOaJ":"to arms.ba4bc057.ogg","fzmcm":"what is it.80257b01.ogg","9zRXz":"i dont know how to whistle.e9ec0115.ogg","7P7XB":"get em.edc2d976.ogg","2eySC":"intruder.a7aa4991.ogg","hqxOO":"oh no its a thief.0db31f45.ogg","8cvb7":"we coming for you.ea62e8ec.ogg","a79kT":"coming for you.e214e5a5.ogg","2enQg":"halt.7b57590f.ogg","5UMbD":"see you.ac65caac.ogg","afhHD":"ill get you.1a03a032.ogg","bxRQ3":"a goner.0793b8c7.ogg","5SQZe":"just you wait.bcde3f99.ogg","1WMIZ":"you wont get away.f541ecc2.ogg","eXsF5":"no you dont.1fbf4625.ogg","4zDjY":"thief.33e0e9ad.ogg","kB0ew":"thief-2.d71679cb.ogg","ddrqy":"thief-3.293bb3f5.ogg","cZmgQ":"after them.c229ff9e.ogg","5fEeM":"what is thy business.33cb8e3d.ogg","kZHdL":"no mercy for the wicked.81a4069a.ogg","61M6l":"lost em.62322dce.ogg","bigld":"must have run.3b25a46a.ogg","hINbf":"where they go.634f6c4f.ogg","fNm19":"his holiness.8b071d33.ogg","ddLjp":"the boss.e15618d8.ogg","eTl1g":"huff puff give up.8624d048.ogg","kL55A":"where did he go.0feeb619.ogg","j79x4":"drats lost him.631f0017.ogg","iIyoY":"gone.94ae2668.ogg","bZzGK":"come back here.3af41230.ogg","2ZnEG":"rotten scoundrel.8a8a8570.ogg","jyEhS":"aargh.3186d290.ogg","aOW8M":"not coming back.dc8d0bdc.ogg","chvcz":"blast.2bad5953.ogg","3rxao":"dont come back.c6c2c256.ogg","4z70Y":"wont get away next time.9e907e0d.ogg","8EoUa":"for his holiness.51e6a34a.ogg","iorHj":"lousy day at work.d57a4be4.ogg","c0kPk":"i give up.b4d10a67.ogg","cbXrG":"what do i do help me.93f094d3.ogg","1nodj":"oh no he got away.8670e4de.ogg","jDUg7":"guard rant.2cb497ab.ogg","gphqW":"take that.e3a4ad48.ogg","47Pvr":"oof.d3084404.ogg","6cbLY":"uh.4c760b2d.ogg","cicW2":"ah.e48c7264.ogg","60W0c":"ah-2.05b2b996.ogg","chz1H":"ha ya.fd752710.ogg","9p3gA":"ha ya-2.00281ec3.ogg","gHO7r":"ha ya-3.327cfb61.ogg"}')),(s=i||(i={})).create=function(){return[0,0]},s.clone=function(e){return[e[0],e[1]]},s.fromValues=function(e,t){return[e,t]},s.copy=function(e,t){e[0]=t[0],e[1]=t[1]},s.set=function(e,t,o){e[0]=t,e[1]=o},s.add=function(e,t,o){e[0]=t[0]+o[0],e[1]=t[1]+o[1]},s.subtract=function(e,t,o){e[0]=t[0]-o[0],e[1]=t[1]-o[1]},s.multiply=function(e,t,o){e[0]=t[0]*o[0],e[1]=t[1]*o[1]},s.scale=function(e,t,o){e[0]=t[0]*o,e[1]=t[1]*o},s.scaleAndAdd=function(e,t,o,r){e[0]=t[0]+o[0]*r,e[1]=t[1]+o[1]*r},s.distance=function(e,t){const o=e[0]-t[0],r=e[1]-t[1];return Math.hypot(o,r)},s.squaredDistance=function(e,t){const o=e[0]-t[0],r=e[1]-t[1];return o*o+r*r},s.length=function(e){return Math.hypot(e[0],e[1])},s.squaredLength=function(e){const t=e[0],o=e[1];return t*t+o*o},s.negate=function(e,t){e[0]=-t[0],e[1]=-t[1]},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.lerp=function(e,t,o,r){e[0]=t[0]+r*(o[0]-t[0]),e[1]=t[1]+r*(o[1]-t[1])},s.zero=function(e){e[0]=0,e[1]=0},(l=a||(a={})).create=function(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},l.copy=function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},l.ortho=function(e,t,o,r,n,i,s){const a=1/(t-o),l=1/(r-n),u=1/(i-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+o)*a,e[13]=(n+r)*l,e[14]=(s+i)*u,e[15]=1},(p=d||(d={}))[p.Damage=0]="Damage",p[p.GuardChase=1]="GuardChase",p[p.GuardSeeThief=2]="GuardSeeThief",p[p.GuardHearThief=3]="GuardHearThief",p[p.GuardHearGuard=4]="GuardHearGuard",p[p.GuardInvestigate=5]="GuardInvestigate",p[p.Noise=6]="Noise",p[p.GuardEndChase=7]="GuardEndChase",p[p.GuardFinishInvestigating=8]="GuardFinishInvestigating",p[p.GuardFinishLooking=9]="GuardFinishLooking",p[p.GuardFinishListening=10]="GuardFinishListening";class f{constructor(){this.popups=[]}add(e,t){this.popups.push({popupType:e,posWorld:t})}clear(){this.popups.length=0}endOfUpdate(e){if(0===this.popups.length)return"";this.popups.sort(((e,t)=>e.popupType-t.popupType));const t=function(e){switch(e){case d.Damage:return"guardDamage";case d.GuardChase:return"guardChase";case d.GuardSeeThief:return"guardSeeThief";case d.GuardHearThief:return"guardHearThief";case d.GuardHearGuard:return"guardHearGuard";case d.GuardInvestigate:return"guardInvestigate";case d.Noise:return"";case d.GuardEndChase:return"guardEndChase";case d.GuardFinishInvestigating:return"guardFinishInvestigating";case d.GuardFinishLooking:return"guardFinishLooking";case d.GuardFinishListening:return"guardFinishListening"}}(this.popups[0].popupType);if(""==t)return"";const o=e[t].next();return o.sound.volume(.6),o.sound.play(),o.subtitle}}class h{constructor(e){this.lines=e,this.currentLineIndex=0}nextLine(){const e=this.lines[this.currentLineIndex];return this.currentLineIndex=(this.currentLineIndex+1)%this.lines.length,e}}new h(["Who goes there?","Huh?","What?","Wait...","Who's that?","Hey...","Hmm...","What moved?","Did that shadow move?","I see something...","Hello?"]),new h(["Huh?","What?","Hark!","A noise...","I heard something.","Hmm...","Who goes there?","What's that noise?","I hear something...","Hello?"]),new h(["Where?","I'm coming!","Here I come!","To arms!","Where is he?"]),new h(["Halt!","Hey!","Aha!","I see you!","I'm coming!","I'll get you!","Just you wait...","You won't get away!","Oh no you don't...","Get him!","After him!","Thief!"]),new h(["That noise again...","I heard it again!","Someone's there!","Who could that be?","There it is again!","What was that?","Better check it out...","What keeps making those noises?","That better be rats!","Again?"]),new h(["(huff, huff)","Where did he go?","Lost him!","Gone!","Come back!","Argh!","He's not coming back.","Blast!","Next time!"]),new h(["Guess it was nothing.","Wonder what it was?","Better get back.","It's quiet now.","This is where I heard it...","Nothing, now."]),new h(["Must have been rats.","Too much coffee!","I've got the jitters.","Probably nothing.","I thought I saw something.","Oh well.","Nothing.","Can't see it now.","I've been up too long.","Seeing things, I guess.","Hope it wasn't anything.","Did I imagine that?"]),new h(["Must have been rats.","Too much coffee!","I've got the jitters.","Probably nothing.","I thought I heard something.","Oh well.","Nothing.","Can't hear it now.","I've been up too long.","Hearing things, I guess.","Hope it wasn't anything.","Did I imagine that?"]),new h(["Oof!","Krak!","Pow!","Urk!","Smack!","Bif!"]);let g;var m;let _;var x;(m=g||(g={}))[m.StoodStill=0]="StoodStill",m[m.Moved=1]="Moved",m[m.BumpedPlayer=2]="BumpedPlayer",(x=_||(_={}))[x.Patrol=0]="Patrol",x[x.Look=1]="Look",x[x.Listen=2]="Listen",x[x.ChaseVisibleTarget=3]="ChaseVisibleTarget",x[x.MoveToLastSighting=4]="MoveToLastSighting",x[x.MoveToLastSound=5]="MoveToLastSound",x[x.MoveToGuardShout=6]="MoveToGuardShout",x[x.RelightTorch=7]="RelightTorch",x[x.PostRelightTorch=8]="PostRelightTorch";class y{constructor(e,t){const o=u(e.length),r=e[o];this.pos=i.clone(r),this.dir=i.fromValues(1,0),this.mode=_.Patrol,this.hasTorch=!1,this.speaking=!1,this.hasMoved=!1,this.heardThief=!1,this.hearingGuard=!1,this.heardGuard=!1,this.heardGuardPos=i.clone(r),this.goal=i.clone(r),this.modeTimeout=0,this.patrolPath=e,this.patrolPathIndex=o,this.patrolReverse=!1,this.patrolLoops=function(e){const t=e[0][0]-e[e.length-1][0],o=e[0][1]-e[e.length-1][1];return(0!=t||0!=o)&&Math.abs(t)<2&&Math.abs(o)<2}(e),this.updateDirInitial()}overheadIcon(){return v(this.mode)?E.Relaxed:this.mode==_.ChaseVisibleTarget?E.Chasing:E.Alerted}act(e,t,o,r){const n=this.mode,s=i.clone(this.pos);switch(v(this.mode)||(this.seesThief(e,o)?(i.copy(this.goal,o.pos),this.mode=_.ChaseVisibleTarget):this.mode===_.ChaseVisibleTarget&&(i.copy(this.goal,o.pos),this.mode=_.MoveToLastSighting,this.modeTimeout=3)),this.mode!==_.ChaseVisibleTarget&&(this.heardGuard&&(this.mode=_.MoveToGuardShout,this.modeTimeout=2+u(4),i.copy(this.goal,this.heardGuardPos)),this.heardThief&&(this.adjacentTo(o.pos)?(this.mode=_.ChaseVisibleTarget,i.copy(this.goal,o.pos)):v(this.mode)?(this.mode=_.Listen,this.modeTimeout=2+u(4),A(this.dir,this.pos,o.pos)):(this.mode=_.MoveToLastSound,this.modeTimeout=2+u(4),i.copy(this.goal,o.pos)))),this.mode){case _.Patrol:this.patrolStep(e,o);break;case _.Look:case _.Listen:this.modeTimeout-=1,0==this.modeTimeout&&(this.mode=_.Patrol);break;case _.ChaseVisibleTarget:this.adjacentTo(o.pos)?(A(this.dir,this.pos,this.goal),n==_.ChaseVisibleTarget&&(o.damagedLastTurn||t.add(d.Damage,this.pos),o.applyDamage(1))):this.moveTowardPosition(this.goal,e,o);break;case _.MoveToLastSighting:case _.MoveToLastSound:case _.MoveToGuardShout:this.moveTowardPosition(this.goal,e,o)!==g.Moved&&(this.modeTimeout-=1),0==this.modeTimeout&&(this.mode=_.Patrol);break;case _.RelightTorch:this.cardinallyAdjacentTo(this.goal)?(A(this.dir,this.pos,this.goal),this.mode=_.PostRelightTorch,this.modeTimeout=3):this.moveTowardAdjacentToPosition(this.goal,e,o)!==g.Moved&&(this.modeTimeout-=1,0===this.modeTimeout&&(this.mode=_.Patrol));break;case _.PostRelightTorch:--this.modeTimeout,A(this.dir,this.pos,this.goal),this.modeTimeout<=0&&(!function(e,t){for(const o of e.items)o.type===F.TorchUnlit&&o.pos[0]===t[0]&&o.pos[1]===t[1]&&(o.type=F.TorchLit);e.computeLighting()}(e,this.goal),this.mode=_.Patrol)}if(!this.hasTorch||this.pos[0]==s[0]&&this.pos[1]==s[1]||e.computeLighting(),this.seesThief(e,o))v(this.mode)&&!this.adjacentTo(o.pos)?(this.mode=_.Look,this.modeTimeout=2+u(4)):(i.copy(this.goal,o.pos),A(this.dir,this.pos,this.goal),this.mode=_.ChaseVisibleTarget);else if(this.mode==_.ChaseVisibleTarget)i.copy(this.goal,o.pos),this.mode=_.MoveToLastSighting,this.modeTimeout=3;else if(this.mode===_.Patrol){const t=function(e,t){let o,r=1/0;for(const n of e.items)if(n.type===F.TorchUnlit){const s=i.squaredDistance(n.pos,t);if(s>=r)continue;if(!L(e,t,n.pos))continue;r=s,o=n}return o}(e,this.pos);if(void 0!==t)i.copy(this.goal,t.pos),this.mode=_.RelightTorch,this.modeTimeout=3;else if(s[0]===this.pos[0]&&s[1]===this.pos[1]){const t=this.tryGetPosLookAt(e);void 0!==t&&A(this.dir,this.pos,t)}}this.heardThief=!1;const a=function(e,t){if(t==e)return;switch(t){case _.Patrol:switch(e){case _.Look:return d.GuardFinishLooking;case _.Listen:return d.GuardFinishListening;case _.MoveToLastSound:case _.MoveToGuardShout:return d.GuardFinishInvestigating;case _.MoveToLastSighting:return d.GuardEndChase;default:return}case _.Look:return d.GuardSeeThief;case _.Listen:return d.GuardHearThief;case _.ChaseVisibleTarget:return e!=_.MoveToLastSighting?d.GuardChase:void 0;case _.MoveToLastSighting:return;case _.MoveToLastSound:return d.GuardInvestigate;case _.MoveToGuardShout:return d.GuardHearGuard}return}(n,this.mode);void 0!==a&&t.add(a,this.pos),this.mode==_.ChaseVisibleTarget&&n!=_.ChaseVisibleTarget&&r.push({pos_shouter:this.pos,pos_target:o.pos})}cardinallyAdjacentTo(e){const t=Math.abs(e[0]-this.pos[0]),o=Math.abs(e[1]-this.pos[1]);return 1==t&&0==o||0==t&&1==o}adjacentTo(e){const t=e[0]-this.pos[0],o=e[1]-this.pos[1];return Math.abs(t)<2&&Math.abs(o)<2}seesThief(e,t){const o=i.create();if(i.subtract(o,t.pos,this.pos),i.dot(this.dir,o)<0)return!1;let r=e.cells.at(t.pos[0],t.pos[1]).lit;return!(i.squaredLength(o)>=this.sightCutoff(r))&&(!(t.hidden(e)||!L(e,this.pos,t.pos))||!v(this.mode)&&Math.abs(o[0])<2&&Math.abs(o[1])<2)}cutoffLit(){return v(this.mode)?40:75}cutoffUnlit(){return v(this.mode)?3:33}sightCutoff(e){return e?this.cutoffLit():this.cutoffUnlit()}patrolStep(e,t){let o;this.patrolPath[this.patrolPathIndex][0]===this.pos[0]&&this.patrolPath[this.patrolPathIndex][1]===this.pos[1]?(this.patrolReverse?0===this.patrolPathIndex?this.patrolLoops?this.patrolPathIndex=this.patrolPath.length-1:(this.patrolReverse=!1,this.patrolPathIndex=1):--this.patrolPathIndex:this.patrolPathIndex>=this.patrolPath.length-1?this.patrolLoops?this.patrolPathIndex=0:(this.patrolReverse=!0,this.patrolPathIndex=this.patrolPath.length-2):++this.patrolPathIndex,o=this.moveTowardPosition(this.patrolPath[this.patrolPathIndex],e,t)):(o=this.moveTowardPatrolPath(e,t),this.findPatrolPathIndex()),o===g.BumpedPlayer&&(this.mode=_.ChaseVisibleTarget,i.copy(this.goal,t.pos),A(this.dir,this.pos,this.goal))}updateDirInitial(){let e;e=this.patrolReverse?0===this.patrolPathIndex?this.patrolLoops?this.patrolPath.length-1:1:this.patrolPathIndex-1:this.patrolPathIndex>=this.patrolPath.length-1?this.patrolLoops?0:this.patrolPath.length-2:this.patrolPathIndex+1,A(this.dir,this.pos,this.patrolPath[e])}moveTowardPosition(e,t,o){const r=t.computeDistancesToPosition(e),n=S(t,r,this.pos);return n[0]==this.pos[0]&&n[1]==this.pos[1]?g.StoodStill:(A(this.dir,this.pos,n),o.pos[0]==n[0]&&o.pos[1]==n[1]?g.BumpedPlayer:(i.copy(this.pos,n),g.Moved))}moveTowardAdjacentToPosition(e,t,o){const r=t.computeDistancesToAdjacentToPosition(e),n=S(t,r,this.pos);return n[0]==this.pos[0]&&n[1]==this.pos[1]?g.StoodStill:(A(this.dir,this.pos,n),o.pos[0]==n[0]&&o.pos[1]==n[1]?g.BumpedPlayer:(i.copy(this.pos,n),g.Moved))}moveTowardPatrolPath(e,t){const o=e.computeDistancesToPatrolPath(this.patrolPath),r=S(e,o,this.pos);return r[0]==this.pos[0]&&r[1]==this.pos[1]?g.StoodStill:(A(this.dir,this.pos,r),t.pos[0]==r[0]&&t.pos[1]==r[1]?g.BumpedPlayer:(i.copy(this.pos,r),g.Moved))}findPatrolPathIndex(){for(let e=this.patrolPathIndex;e<this.patrolPath.length;++e){const t=this.patrolPath[e];if(t[0]===this.pos[0]&&t[1]===this.pos[1])return this.patrolPathIndex=e,!0}for(let e=this.patrolPathIndex-1;e>=0;--e){const t=this.patrolPath[e];if(t[0]===this.pos[0]&&t[1]===this.pos[1])return this.patrolPathIndex=e,!0}return!1}tryGetPosLookAt(e){const t=this.pos[0],o=this.pos[1];return t>0&&e.cells.at(t-1,o).type==M.OneWayWindowW?i.fromValues(t-1,o):t<e.cells.sizeX-1&&e.cells.at(t+1,o).type==M.OneWayWindowE?i.fromValues(t+1,o):o>0&&e.cells.at(t,o-1).type==M.OneWayWindowS?i.fromValues(t,o-1):o<e.cells.sizeY-1&&e.cells.at(t,o+1).type==M.OneWayWindowN?i.fromValues(t,o+1):void 0}}function v(e){return e===_.Patrol||e===_.RelightTorch||e===_.PostRelightTorch}function b(e,t,o){for(const t of e.guards)t.heardGuard=t.hearingGuard,t.hearingGuard=!1,t.speaking=!1,t.hasMoved=!1;const r=[];for(const n of e.guards)n.act(e,t,o,r),n.hasMoved=!0;for(const t of r)w(e,t)}function w(e,t){for(const o of e.guardsInEarshot(t.pos_shouter,25))o.pos[0]==t.pos_shouter[0]&&o.pos[1]==t.pos_shouter[1]||(o.hearingGuard=!0,i.copy(o.heardGuardPos,t.pos_shouter))}function S(e,t,o){let r=1/0,n=o;const s=i.fromValues(Math.max(0,o[0]-1),Math.max(0,o[1]-1)),a=i.fromValues(Math.min(e.cells.sizeX,o[0]+2),Math.min(e.cells.sizeY,o[1]+2));for(let l=s[0];l<a[0];++l)for(let u=s[1];u<a[1];++u){const s=t.get(l,u);if(s==1/0)continue;let a=i.fromValues(l,u);e.guardMoveCost(o,a)!=1/0&&(e.cells.at(a[0],a[1]).type!=M.GroundWater&&(e.isGuardAt(a[0],a[1])||s<r&&(r=s,n=a)))}return n}function A(e,t,o){const r=i.create();i.subtract(r,o,t);const n=i.fromValues(-e[1],e[0]);let s=i.dot(e,r),a=i.dot(n,r);Math.abs(s)>=Math.abs(a)?s>=0||i.negate(e,e):Math.abs(a)>Math.abs(s)?a>=0?i.copy(e,n):i.negate(e,n):s>0||(a>=0?i.copy(e,n):i.negate(e,n))}function L(e,t,o){let r=t[0],n=t[1];const i=o[0]-r,s=o[1]-n;let a=Math.abs(i),l=Math.abs(s);const u=i>0?1:-1,c=s>0?1:-1;let d=l-a,p=a+l-1;for(a*=2,l*=2;p>0;){if(d>0?(n+=c,d-=a):(r+=u,d+=l),e.cells.at(r,n).blocksSight)return!1;--p}return!0}const T=[i.fromValues(-1,0),i.fromValues(1,0),i.fromValues(0,-1),i.fromValues(0,1)];class R{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Uint8Array(e*t),this.fill(o)}fill(e){this.values.fill(e?1:0)}get(e,t){return 0!==this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o?1:0}}class I{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Int32Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}class H{constructor(e,t,o){this.sizeX=e,this.sizeY=t,this.values=new Float64Array(e*t),this.fill(o)}fill(e){this.values.fill(e)}get(e,t){return this.values[this.sizeX*t+e]}set(e,t,o){this.values[this.sizeX*t+e]=o}}let M;var k;(k=M||(M={}))[k.GroundNormal=0]="GroundNormal",k[k.GroundGrass=1]="GroundGrass",k[k.GroundWater=2]="GroundWater",k[k.GroundMarble=3]="GroundMarble",k[k.GroundWood=4]="GroundWood",k[k.GroundWoodCreaky=5]="GroundWoodCreaky",k[k.Wall0000=6]="Wall0000",k[k.Wall0001=7]="Wall0001",k[k.Wall0010=8]="Wall0010",k[k.Wall0011=9]="Wall0011",k[k.Wall0100=10]="Wall0100",k[k.Wall0101=11]="Wall0101",k[k.Wall0110=12]="Wall0110",k[k.Wall0111=13]="Wall0111",k[k.Wall1000=14]="Wall1000",k[k.Wall1001=15]="Wall1001",k[k.Wall1010=16]="Wall1010",k[k.Wall1011=17]="Wall1011",k[k.Wall1100=18]="Wall1100",k[k.Wall1101=19]="Wall1101",k[k.Wall1110=20]="Wall1110",k[k.Wall1111=21]="Wall1111",k[k.OneWayWindowE=22]="OneWayWindowE",k[k.OneWayWindowW=23]="OneWayWindowW",k[k.OneWayWindowN=24]="OneWayWindowN",k[k.OneWayWindowS=25]="OneWayWindowS",k[k.PortcullisNS=26]="PortcullisNS",k[k.PortcullisEW=27]="PortcullisEW",k[k.DoorNS=28]="DoorNS",k[k.DoorEW=29]="DoorEW",k[k.GardenDoorNS=30]="GardenDoorNS",k[k.GardenDoorEW=31]="GardenDoorEW";class C{constructor(e,t){this.sizeX=e,this.sizeY=t;const o=e*t;this.values=new Array(o);for(let e=0;e<o;++e)this.values[e]={type:M.GroundNormal,moveCost:1/0,blocksPlayerMove:!1,blocksPlayerSight:!1,blocksSight:!1,blocksSound:!1,hidesPlayer:!1,lit:!1,seen:!1}}at(e,t){const o=this.sizeX*t+e;return console.assert(o>=0),console.assert(o<this.values.length),this.values[o]}index(e,t){return this.sizeX*t+e}}let E;var P;let F;var W;function U(e){switch(e){case F.Chair:return 4;case F.Table:case F.Bush:return 10;case F.Coin:case F.DoorNS:case F.DoorEW:case F.PortcullisNS:case F.PortcullisEW:return 0;case F.TorchUnlit:case F.TorchLit:return 1/0}}(P=E||(E={}))[P.Relaxed=0]="Relaxed",P[P.Alerted=1]="Alerted",P[P.Chasing=2]="Chasing",(W=F||(F={}))[W.Chair=0]="Chair",W[W.Table=1]="Table",W[W.Bush=2]="Bush",W[W.Coin=3]="Coin",W[W.DoorNS=4]="DoorNS",W[W.DoorEW=5]="DoorEW",W[W.PortcullisNS=6]="PortcullisNS",W[W.PortcullisEW=7]="PortcullisEW",W[W.TorchUnlit=8]="TorchUnlit",W[W.TorchLit=9]="TorchLit";const G=5;class D{constructor(e){this.pos=i.clone(e),this.dir=i.fromValues(0,-1),this.health=G,this.loot=0,this.noisy=!1,this.damagedLastTurn=!1,this.turnsRemainingUnderwater=0}applyDamage(e){this.health-=Math.min(e,this.health),this.damagedLastTurn=!0}hidden(e){if(void 0!==e.guards.find((e=>e.mode==_.ChaseVisibleTarget)))return!1;if(e.cells.at(this.pos[0],this.pos[1]).hidesPlayer)return!0;return e.cells.at(this.pos[0],this.pos[1]).type==M.GroundWater&&this.turnsRemainingUnderwater>0}}const O=[{lx:-1,ly:-1,rx:-1,ry:1,nx:-1,ny:0},{lx:-1,ly:1,rx:1,ry:1,nx:0,ny:1},{lx:1,ly:1,rx:1,ry:-1,nx:1,ny:0},{lx:1,ly:-1,rx:-1,ry:-1,nx:0,ny:-1}];function V(e,t,o,r){return e*r>t*o}const z=[{dx:1,dy:0,cost:2},{dx:-1,dy:0,cost:2},{dx:0,dy:1,cost:2},{dx:0,dy:-1,cost:2},{dx:-1,dy:-1,cost:3},{dx:1,dy:-1,cost:3},{dx:-1,dy:1,cost:3},{dx:1,dy:1,cost:3}];class N{constructor(e){this.cells=e,this.patrolRegions=[],this.patrolRoutes=[],this.items=[],this.guards=[],this.playerStartPos=i.create()}collectLootAt(e,t){let o=0;return this.items=this.items.filter((r=>r.type!=F.Coin||r.pos[0]!=e||r.pos[1]!=t||(++o,!1))),o}collectAllLoot(){let e=0;return this.items=this.items.filter((t=>t.type!=F.Coin||(++e,!1))),e}allSeen(){for(const e of this.cells.values)if(!e.seen)return!1;return!0}percentSeen(){let e=0;for(const t of this.cells.values)t.seen&&++e;return Math.floor(100*e/this.cells.values.length)}markAllSeen(){for(const e of this.cells.values)e.seen=!0}markAllUnseen(){for(const e of this.cells.values)e.seen=!1}recomputeVisibility(e){this.recomputeVisibilityFromPos(e);const t=i.create();for(const o of T)this.playerCanSeeInDirection(e,o)&&(i.add(t,e,o),this.recomputeVisibilityFromPos(t))}recomputeVisibilityFromPos(e){for(const t of O)this.computeVisibility(e[0],e[1],e[0],e[1],t.lx,t.ly,t.rx,t.ry)}playerCanSeeInDirection(e,t){const o=i.create();return i.add(o,e,t),o[0]<0||o[1]<0||o[0]>=this.cells.sizeX||o[1]>=this.cells.sizeY||!this.cells.at(o[0],o[1]).blocksPlayerSight}computeVisibility(e,t,o,r,n,i,s,a){if(o<0||r<0||o>=this.cells.sizeX||r>=this.cells.sizeY)return;const l=2*(o-e),u=2*(r-t);if(!(l*l+u*u>1600||(this.cells.at(o,r).seen=!0,this.cells.at(o,r).blocksPlayerSight))){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let c=o+2*e-1,d=r+2*t-1,p=l+2*e-1,f=u+2*t-1;c>=0&&d>=0&&c<this.cells.sizeX&&d<this.cells.sizeY&&!V(n,i,p,f)&&!V(p,f,s,a)&&(this.cells.at(c,d).seen=!0)}for(const c of O){const d=l+c.lx,p=u+c.ly,f=l+c.rx,h=u+c.ry,[g,m]=V(n,i,d,p)?[n,i]:[d,p],[_,x]=V(s,a,f,h)?[f,h]:[s,a];V(_,x,g,m)&&this.computeVisibility(e,t,o+c.nx,r+c.ny,g,m,_,x)}}}computeLighting(){for(const e of this.cells.values)e.lit=!1;for(const e of this.items)e.type==F.TorchLit&&this.castLight(e.pos,180);for(const e of this.guards)e.hasTorch&&this.castLight(e.pos,60)}castLight(e,t){this.cells.at(e[0],e[1]).lit=!0;for(const o of O)this.castLightRecursive(e[0],e[1],e[0]+o.nx,e[1]+o.ny,o.lx,o.ly,o.rx,o.ry,t)}castLightRecursive(e,t,o,r,n,i,s,a,l){if(o<0||r<0||o>=this.cells.sizeX||r>=this.cells.sizeY)return;const u=2*(o-e),c=2*(r-t);if(u**2+c**2>l)return;const d=this.cells.at(o,r);if(d.lit=!0,!d.blocksSight){for(let e=0;e<2;++e)for(let t=0;t<2;++t){let l=o+2*e-1,d=r+2*t-1,p=u+2*e-1,f=c+2*t-1;l>=0&&d>=0&&l<this.cells.sizeX&&d<this.cells.sizeY&&!V(n,i,p,f)&&!V(p,f,s,a)&&(this.cells.at(l,d).lit=!0)}for(const d of O){const p=u+d.lx,f=c+d.ly,h=u+d.rx,g=c+d.ry,[m,_]=V(n,i,p,f)?[n,i]:[p,f],[x,y]=V(s,a,h,g)?[h,g]:[s,a];V(x,y,m,_)&&this.castLightRecursive(e,t,o+d.nx,r+d.ny,m,_,x,y,l)}}}allLootCollected(){return void 0===this.items.find((e=>e.type==F.Coin))}isGuardAt(e,t){return null!=this.guards.find((o=>o.hasMoved&&o.pos[0]==e&&o.pos[1]==t))}guardMoveCost(e,t){const o=this.cells.at(t[0],t[1]).moveCost;return o===1/0||e[0]==t[0]||e[1]==t[1]||this.cells.at(e[0],t[1]).moveCost!==1/0&&this.cells.at(t[0],e[1]).moveCost!==1/0?o:1/0}computeDistancesToPatrolPath(e){const t=[];for(const o of e){const e=this.cells.at(o[0],o[1]).moveCost;t.push({priority:e,pos:o})}return this.computeDistanceField(t)}computeDistancesToPosition(e){return console.assert(e[0]>=0),console.assert(e[1]>=0),console.assert(e[0]<this.cells.sizeX),console.assert(e[1]<this.cells.sizeY),this.computeDistanceField([{priority:0,pos:e}])}computeDistancesToAdjacentToPosition(e){const t=[];for(const o of T){const r=i.create();if(i.add(r,e,o),r[0]<0||r[1]<0||r[0]>=this.cells.sizeX||r[1]>=this.cells.sizeY)continue;const n=this.cells.at(r[0],r[1]);n.moveCost!==1/0&&t.push({priority:n.moveCost,pos:r})}return this.computeDistanceField(t)}computeDistanceField(e){let t=this.cells.sizeX,o=this.cells.sizeY;const r=[],n=new H(t,o,1/0);for(const t of e)Y(r,t);for(;r.length>0;){const e=B(r);if(!(e.priority>=n.get(e.pos[0],e.pos[1]))){n.set(e.pos[0],e.pos[1],e.priority);for(const s of z){const a=i.fromValues(e.pos[0]+s.dx,e.pos[1]+s.dy);if(a[0]<0||a[1]<0||a[0]>=t||a[1]>=o)continue;const l=this.guardMoveCost(e.pos,a);if(l==1/0)continue;const u=e.priority+l+s.cost;u<n.get(a[0],a[1])&&Y(r,{priority:u,pos:a})}}}return n}guardsInEarshot(e,t){const o=this.coordsInEarshot(e,t);return this.guards.filter((e=>o.has(this.cells.sizeX*e.pos[1]+e.pos[0])))}coordsInEarshot(e,t){let o=this.cells.sizeX,r=this.cells.sizeY;const n=[],s=new H(o,r,1/0),a=new Set;for(Y(n,{priority:0,pos:e});n.length>0;){const e=B(n);if(!(e.priority>=s.get(e.pos[0],e.pos[1]))){s.set(e.pos[0],e.pos[1],e.priority),a.add(o*e.pos[1]+e.pos[0]);for(const a of z){const l=i.fromValues(e.pos[0]+a.dx,e.pos[1]+a.dy);if(l[0]<0||l[1]<0||l[0]>=o||l[1]>=r)continue;const u=e.priority+a.cost;u>t||(this.cells.at(l[0],l[1]).blocksSound||u>=s.get(l[0],l[1])||Y(n,{priority:u,pos:l}))}}}return a}}function B(e){const t=e[0];e[0]=e[e.length-1],e.pop();let o=0;const r=e.length;for(;;){let t=o;const n=2*o+1;n<r&&e[n].priority<e[t].priority&&(t=n);const i=n+1;if(i<r&&e[i].priority<e[t].priority&&(t=i),t==o)break;[e[o],e[t]]=[e[t],e[o]],o=t}return t}function Y(e,t){e.push(t);let o=e.length-1;for(;o>0;){const t=Math.floor((o-1)/2);if(e[o].priority>=e[t].priority)break;[e[o],e[t]]=[e[t],e[o]],o=t}}const X=5,j=5,K=3;let q;var Q;function Z(e,t){const o=[];for(let t=0;t<e;++t){const e=$(t),r=ee(t);o.push({numRoomsX:e,numRoomsY:r,totalLoot:0})}let r=0;for(const e of o){r+=e.numRoomsX*e.numRoomsY}let n=0;for(const e of o){const o=e.numRoomsX*e.numRoomsY,i=Math.floor(t*o/r);n+=i,e.totalLoot=i}return o[o.length-1].totalLoot+=t-n,o}function J(e,t){const o=function(e,t){const o=new R(e,t,!0),r=Math.floor((e+1)/2);for(let e=Math.floor(t*r/4);e>0;--e){const e=u(r),n=u(t);o.set(e,n,!1)}for(let n=0;n<t;++n)for(let t=r;t<e;++t)o.set(t,n,o.get(e-1-t,n));return o}(t.numRoomsX,t.numRoomsY),[r,n]=function(e,t,o){const r=o.sizeX,n=o.sizeY,i=new I(r+1,n,0),s=new I(r,n+1,0);let a=u(3)-1;for(let e=0;e<n;++e)i.set(0,e,a);a=u(3)-1;for(let e=0;e<n;++e)i.set(r,e,a);a=u(3)-1;for(let e=0;e<r;++e)s.set(e,0,a);a=u(3)-1;for(let e=0;e<r;++e)s.set(e,n,a);for(let e=1;e<r;++e)for(let t=0;t<n;++t)i.set(e,t,u(3)-1);for(let e=0;e<r;++e)for(let t=1;t<n;++t)s.set(e,t,u(3)-1);for(let e=1;e<r;++e)for(let t=1;t<n;++t)0===u(2)?i.set(e,t,i.get(e,t-1)):s.set(e,t,s.get(e-1,t));if(e){if(0==(1&r)){const e=Math.floor(r/2);for(let t=0;t<n;++t)i.set(e,t,0)}for(let e=0;e<Math.floor((r+1)/2);++e)for(let t=0;t<n;++t)i.set(r-e,t,1-i.get(e,t));for(let e=0;e<Math.floor(r/2);++e)for(let t=0;t<n+1;++t)s.set(r-1-e,t,s.get(e,t))}if(t){if(0==(1&n)){const e=n/2;for(let t=0;t<r;++t)s.set(t,e,0)}for(let e=0;e<Math.floor((n+1)/2);++e)for(let t=0;t<r;++t)s.set(t,n-e,1-s.get(t,e));for(let e=0;e<Math.floor(n/2);++e)for(let t=0;t<r+1;++t)i.set(t,n-1-e,i.get(t,e))}let l=Number.MIN_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;for(let e=0;e<n;++e)l=Math.max(l,-i.get(0,e));for(let e=0;e<r;++e)c=Math.max(c,-s.get(e,0));l+=K,c+=K;for(let e=0;e<r+1;++e)for(let t=0;t<n;++t){const o=i.get(e,t)+l+e*X;i.set(e,t,o)}for(let e=0;e<r;++e)for(let t=0;t<n+1;++t)s.set(e,t,s.get(e,t)+c+t*j);return[i,s]}(true,false,o),s=function(e,t,o){const r=e.sizeX,n=e.sizeY;let i=0,s=0;for(let e=0;e<n;++e)i=Math.max(i,t.get(r,e));for(let e=0;e<r;++e)s=Math.max(s,o.get(e,n));i+=K+1,s+=K+1;const a=new C(i,s);for(let e=0;e<r;++e)for(let r=0;r<n;++r){const n=t.get(e,r),i=t.get(e+1,r)+1,s=o.get(e,r),l=o.get(e,r+1)+1;for(let e=n;e<i;++e)for(let t=s;t<l;++t){a.at(e,t).type=M.GroundGrass}}for(let i=0;i<r;++i)for(let s=0;s<n;++s){const l=e.get(i,s),u=t.get(i,s),c=t.get(i+1,s),d=o.get(i,s),p=o.get(i,s+1);(0==i||l)&&te(a,u,d,p),(i==r-1||l)&&te(a,c,d,p),(0==s||l)&&oe(a,u,d,c),(s==n-1||l)&&oe(a,u,p,c)}return a}(o,r,n),a=new N(s),[l,d,p]=function(e,t,o,r,n,s,a){const l=r.sizeX,d=r.sizeY,p=new I(l,d,0),f=[];f.push({roomType:q.Exterior,group:0,depth:0,posMin:i.fromValues(0,0),posMax:i.fromValues(0,0),edges:[]});for(let e=0;e<l;++e)for(let t=0;t<d;++t){let o=f.length;p.set(e,t,o),f.push({roomType:r.get(e,t)?q.PublicRoom:q.PublicCourtyard,group:o,depth:0,posMin:i.fromValues(n.get(e,t)+1,s.get(e,t)+1),posMax:i.fromValues(n.get(e+1,t),s.get(e,t+1)),edges:[]})}const h=function(e,t,o,r,n){let s=n.sizeX,a=n.sizeY;const l=[];{const u=[];{const e=[];let t=0;for(let a=0;a<s;++a){let s=o.get(a,t),u=o.get(a+1,t),c=r.get(a,t),d=l.length;e.push(d),l.push({origin:i.fromValues(s+1,c),dir:i.fromValues(1,0),length:u-(s+1),room_left:n.get(a,t),room_right:0,next_matching:d,door:!1,doorOffset:0})}u.push(e)}for(let e=1;e<a;++e){const t=[];for(let a=0;a<s;++a){let u=o.get(a,e),c=o.get(a,e-1),d=o.get(a+1,e),p=o.get(a+1,e-1),f=Math.max(c,u),h=Math.min(p,d),g=r.get(a,e);if(a>0&&c-u>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(u+1,g),dir:i.fromValues(1,0),length:c-(u+1),room_left:n.get(a,e),room_right:n.get(a-1,e-1),next_matching:o,door:!1,doorOffset:0})}if(h-f>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(f+1,g),dir:i.fromValues(1,0),length:h-(f+1),room_left:n.get(a,e),room_right:n.get(a,e-1),next_matching:o,door:!1,doorOffset:0})}if(a+1<s&&d-p>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(p+1,g),dir:i.fromValues(1,0),length:d-(p+1),room_left:n.get(a,e),room_right:n.get(a+1,e-1),next_matching:o,door:!1,doorOffset:0})}}u.push(t)}{const e=[];let t=a;for(let a=0;a<s;++a){let s=o.get(a,t-1),u=o.get(a+1,t-1),c=r.get(a,t),d=l.length;e.push(d),l.push({origin:i.fromValues(s+1,c),dir:i.fromValues(1,0),length:u-(s+1),room_left:0,room_right:n.get(a,t-1),next_matching:d,door:!1,doorOffset:0})}u.push(e)}if(e)for(let e=0;e<u.length;++e){let t=u[e],o=0,r=t.length-1;for(;o<r;){let e=t[o],n=t[r];l[e].next_matching=n,l[n].next_matching=e;{let e=l[n];i.scaleAndAdd(e.origin,e.origin,e.dir,e.length-1),i.negate(e.dir,e.dir),[e.room_left,e.room_right]=[e.room_right,e.room_left]}o+=1,r-=1}}if(t){let e=0,t=u.length-1;for(;e<t;){let o=u[e],r=u[t];console.assert(o.length==r.length);for(let e=0;e<o.length;++e){let t=o[e],n=r[e];l[t].next_matching=n,l[n].next_matching=t}e+=1,t-=1}}}{let u=[];{const e=[];let t=0;for(let s=0;s<a;++s){let a=r.get(t,s),u=r.get(t,s+1),c=o.get(t,s),d=l.length;e.push(d),l.push({origin:i.fromValues(c,a+1),dir:i.fromValues(0,1),length:u-(a+1),room_left:0,room_right:n.get(t,s),next_matching:d,door:!1,doorOffset:0})}u.push(e)}for(let e=1;e<s;++e){const t=[];for(let s=0;s<a;++s){let u=r.get(e-1,s),c=r.get(e,s),d=r.get(e-1,s+1),p=r.get(e,s+1),f=Math.max(u,c),h=Math.min(d,p),g=o.get(e,s);if(s>0&&u-c>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,c+1),dir:i.fromValues(0,1),length:u-(c+1),room_left:n.get(e-1,s-1),room_right:n.get(e,s),next_matching:o,door:!1,doorOffset:0})}if(h-f>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,f+1),dir:i.fromValues(0,1),length:h-(f+1),room_left:n.get(e-1,s),room_right:n.get(e,s),next_matching:o,door:!1,doorOffset:0})}if(s+1<a&&p-d>1){let o=l.length;t.push(o),l.push({origin:i.fromValues(g,d+1),dir:i.fromValues(0,1),length:p-(d+1),room_left:n.get(e-1,s+1),room_right:n.get(e,s),next_matching:o,door:!1,doorOffset:0})}}u.push(t)}{const e=[];let t=s;for(let s=0;s<a;++s){let a=r.get(t-1,s),u=r.get(t-1,s+1),c=o.get(t,s),d=l.length;l.push({origin:i.fromValues(c,a+1),dir:i.fromValues(0,1),length:u-(a+1),room_left:n.get(t-1,s),room_right:0,next_matching:d,door:!1,doorOffset:0}),e.push(d)}u.push(e)}if(t)for(let e=0;e<u.length;++e){let t=u[e],o=Math.floor(t.length/2);for(let e=0;e<o;++e){let o=t[e],r=t[t.length-1-e];l[o].next_matching=r,l[r].next_matching=o;{let e=l[r];i.scaleAndAdd(e.origin,e.origin,e.dir,e.length-1),i.negate(e.dir,e.dir),[e.room_left,e.room_right]=[e.room_right,e.room_left]}}}if(e){let e=0,t=u.length-1;for(;e<t;){let o=u[e],r=u[t];for(let e=0;e<o.length;++e){let t=o[e],n=r[e];l[t].next_matching=n,l[n].next_matching=t}e+=1,t-=1}}}return l}(t,o,n,s,p);!function(e,t){for(let o=0;o<e.length;++o){const r=e[o];let n=r.room_left,i=r.room_right;t[n].edges.push(o),t[i].edges.push(o)}}(h,f);let g=function(e,t){let o=function(e){const t=[];for(let o=0;o<e.length;++o){let r=e[o].next_matching;r>=o&&(r>o?t.push([o,r]):t.push([o]))}return c(t),t}(t);for(const o of t){let t=o.room_left,r=o.room_right;e[t].roomType==q.PublicCourtyard&&e[r].roomType==q.PublicCourtyard&&(o.door=!0,re(e,e[t].group,e[r].group))}for(const r of o){let o=!1;{let n=t[r[0]],i=n.room_left,s=n.room_right;if(e[i].roomType!=q.PublicRoom||e[s].roomType!=q.PublicRoom)continue;let a=e[i].group,l=e[s].group;(a!=l||Math.random()<.4)&&(n.door=!0,o=!0,re(e,a,l))}if(o)for(let o=1;o<r.length;++o){let n=t[r[o]],i=n.room_left,s=n.room_right,a=e[i].group,l=e[s].group;n.door=!0,re(e,a,l)}}for(const r of o){let o=!1;{let n=t[r[0]],i=n.room_left,s=n.room_right,a=e[i].roomType,l=e[s].roomType;if(a==l)continue;if(a==q.Exterior||l==q.Exterior)continue;let u=e[i].group,c=e[s].group;(u!=c||Math.random()<.4)&&(n.door=!0,o=!0,re(e,u,c))}if(o)for(let o=1;o<r.length;++o){let n=t[r[o]],i=n.room_left,s=n.room_right,a=e[i].group,l=e[s].group;n.door=!0,re(e,a,l)}}let r=i.fromValues(0,0);{let n=function(e,t,o){for(const r of o)for(const o of r){let r=t[o];if(0!=r.dir[0]&&!(r.next_matching>o)){if(r.next_matching==o){if(e[r.room_right].roomType!=q.Exterior)continue}else if(e[r.room_left].roomType!=q.Exterior)continue;return o}}return 0}(e,t,o);r[0]=t[n].origin[0]+t[n].dir[0]*Math.floor(t[n].length/2),r[1]=K-1,t[n].door=!0;let i=t[n].next_matching;i!=n&&(t[i].next_matching=i,t[n].next_matching=n)}return r}(f,h);return function(e,t,o){let r=o.length;o[0].depth=0;for(let e=1;e<o.length;++e)o[e].depth=r;const n=[];for(let t=0;t<e.sizeX;++t){let r=e.get(t,0);o[r].depth=1,n.push(r)}let i=0;for(;i<n.length;){let e=n[i];for(const i of o[e].edges){let s=t[i];if(!s.door)continue;const a=s.room_left==e?s.room_right:s.room_left;o[a].depth==r&&(o[a].depth=o[e].depth+1,n.push(a))}i+=1}let s=0;for(const e of o)s=Math.max(s,e.depth);const a=Math.floor(e.sizeX*e.sizeY/4);let l=0,u=s;for(;u>0;){for(const e of o)e.roomType!=q.PublicRoom&&e.roomType!=q.PublicCourtyard||e.depth==u&&(e.roomType=e.roomType==q.PublicRoom?q.PrivateRoom:q.PrivateCourtyard,e.roomType==q.PrivateRoom&&(l+=1));if(l>=a)break;u-=1}for(;;){let e=!1;for(let r=0;r<o.length;++r)if(o[r].roomType==q.PublicCourtyard)for(const n of o[r].edges){const i=t[n];if(o[i.room_left!=r?i.room_left:i.room_right].roomType==q.PrivateCourtyard){o[r].roomType=q.PrivateCourtyard,e=!0;break}}if(!e)break}}(p,h,f),function(e,t,o){for(const r of t){const t=e[r.room_left].roomType,n=e[r.room_right].roomType;if(be(t)&&be(n))for(let e=0;e<r.length;++e){const t=i.create();i.scaleAndAdd(t,r.origin,r.dir,e),o.cells.at(t[0],t[1]).type=M.GroundGrass}}for(let r=0;r<t.length;++r){const n=t[r],s=e[n.room_left].roomType,a=e[n.room_right].roomType,l=n.next_matching;if(l<r)continue;let c;c=l==r?Math.floor(n.length/2):n.length>2?1+u(n.length-2):u(n.length);let d=[];if(d.push(n),l!=r&&d.push(t[l]),!n.door&&s!=a)if(s==q.Exterior||a==q.Exterior){if(0!=(1&n.length)){let t=Math.floor(n.length/2);for(const r of d){const n=i.create();i.scaleAndAdd(n,r.origin,r.dir,t);let s=i.clone(r.dir);e[r.room_right].roomType==q.Exterior&&i.negate(s,s),o.cells.at(n[0],n[1]).type=ge(s)}}}else if(be(s)||be(a)){let t=u(2);const r=Math.floor((n.length+1)/2);for(;t<r;){for(const r of d){let n=i.clone(r.dir);be(e[r.room_right].roomType)&&i.negate(n,n);let s=ge(n);const a=i.create();i.scaleAndAdd(a,r.origin,r.dir,t);const l=i.create();i.scaleAndAdd(l,r.origin,r.dir,r.length-(t+1)),o.cells.at(a[0],a[1]).type=s,o.cells.at(l[0],l[1]).type=s}t+=2}}let p=Math.random()<.3333;for(const t of d){if(!t.door)continue;t.doorOffset=c;const r=i.create();i.scaleAndAdd(r,t.origin,t.dir,c);let n=0==t.dir[0],s=e[t.room_left].roomType,a=e[t.room_right].roomType;s==q.Exterior||a==q.Exterior?(o.cells.at(r[0],r[1]).type=n?M.PortcullisNS:M.PortcullisEW,xe(o,r[0],r[1],n?F.PortcullisNS:F.PortcullisEW)):be(s)&&be(a)?o.cells.at(r[0],r[1]).type=n?M.GardenDoorNS:M.GardenDoorEW:s!=q.PrivateRoom||a!=q.PrivateRoom||p?(o.cells.at(r[0],r[1]).type=n?M.DoorNS:M.DoorEW,xe(o,r[0],r[1],n?F.DoorNS:F.DoorEW)):o.cells.at(r[0],r[1]).type=n?M.DoorNS:M.DoorEW}}}(f,h,a),function(e,t,o){for(let r=1;r<t.length;++r){const n=t[r];let i;switch(n.roomType){case q.Exterior:i=M.GroundNormal;break;case q.PublicCourtyard:i=M.GroundGrass;break;case q.PublicRoom:i=M.GroundWood;break;case q.PrivateCourtyard:i=M.GroundGrass;break;case q.PrivateRoom:i=M.GroundMarble}for(let t=n.posMin[0];t<n.posMax[0];++t)for(let r=n.posMin[1];r<n.posMax[1];++r)i==M.GroundWood&&e>3&&Math.random()<.02?o.cells.at(t,r).type=M.GroundWoodCreaky:o.cells.at(t,r).type=i;let s=n.posMax[0]-n.posMin[0],a=n.posMax[1]-n.posMin[1];if(be(n.roomType)){if(s>=5&&a>=5)for(let e=n.posMin[0]+1;e<n.posMax[0]-1;++e)for(let t=n.posMin[1]+1;t<n.posMax[1]-1;++t)o.cells.at(e,t).type=M.GroundWater;else if(s>=2&&a>=2){const t=[F.Bush,F.Bush,F.Bush,F.Bush];s>2&&a>2&&t.push(me(e)),c(t);const r=[[n.posMin[0],n.posMin[1]],[n.posMax[0]-1,n.posMin[1]],[n.posMin[0],n.posMax[1]-1],[n.posMax[0]-1,n.posMax[1]-1]];for(let e=0;e<r.length;++e){const[n,i]=r[e];o.cells.at(n,i).type==M.GroundGrass&&_e(o,n,i,t[e])}}}else if(n.roomType==q.PublicRoom||n.roomType==q.PrivateRoom)if(s>=5&&a>=5){if(n.roomType==q.PrivateRoom)for(let e=2;e<s-2;++e)for(let t=2;t<a-2;++t)o.cells.at(n.posMin[0]+e,n.posMin[1]+t).type=M.GroundWater;o.cells.at(n.posMin[0]+1,n.posMin[1]+1).type=M.Wall0000,o.cells.at(n.posMax[0]-2,n.posMin[1]+1).type=M.Wall0000,o.cells.at(n.posMin[0]+1,n.posMax[1]-2).type=M.Wall0000,o.cells.at(n.posMax[0]-2,n.posMax[1]-2).type=M.Wall0000}else if(5==s&&a>=3&&(n.roomType==q.PublicRoom||Math.random()<.33333)){const t=new Array(a-2).fill(F.Table);t.push(me(e)),c(t);for(let e=1;e<a-1;++e)xe(o,n.posMin[0]+1,n.posMin[1]+e,F.Chair),xe(o,n.posMin[0]+2,n.posMin[1]+e,t[e-1]),xe(o,n.posMin[0]+3,n.posMin[1]+e,F.Chair)}else if(5==a&&s>=3&&(n.roomType==q.PublicRoom||Math.random()<.33333)){const t=new Array(s-2).fill(F.Table);t.push(me(e)),c(t);for(let e=1;e<s-1;++e)xe(o,n.posMin[0]+e,n.posMin[1]+1,F.Chair),xe(o,n.posMin[0]+e,n.posMin[1]+2,t[e-1]),xe(o,n.posMin[0]+e,n.posMin[1]+3,F.Chair)}else if(s>a&&1==(1&a)&&Math.random()<.66667){let t=Math.floor(n.posMin[1]+a/2);const r=n.roomType==q.PublicRoom?F.Table:F.Chair,i=[me(e),r];c(i),_e(o,n.posMin[0]+1,t,i[0]),_e(o,n.posMax[0]-2,t,i[1])}else if(a>s&&1==(1&s)&&Math.random()<.66667){let t=Math.floor(n.posMin[0]+s/2);const r=n.roomType==q.PublicRoom?F.Table:F.Chair,i=[me(e),r];c(i),_e(o,t,n.posMin[1]+1,i[0]),_e(o,t,n.posMax[1]-2,i[1])}else if(s>3&&a>3){const t=n.roomType==q.PublicRoom?F.Table:F.Chair,r=[me(e),t,t,t];c(r),_e(o,n.posMin[0],n.posMin[1],r[0]),_e(o,n.posMax[0]-1,n.posMin[1],r[1]),_e(o,n.posMin[0],n.posMax[1]-1,r[2]),_e(o,n.posMax[0]-1,n.posMax[1]-1,r[3])}}}(e,f,a),[f,h,g]}(e,true,false,o,r,n,a);i.copy(a.playerStartPos,p),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let r=0;r<t;++r){for(let t=o-K+1;t<o;++t){if(e.cells.at(r,t).type!=M.GroundNormal)continue;let o=e.cells.at(r,t);o.type=M.GroundGrass,o.seen=!0}0==(1&r)&&Math.random()<.8&&xe(e,r,o-1,F.Bush)}for(let r=K;r<o-K+1;++r){for(let t=0;t<K-1;++t){if(e.cells.at(t,r).type!=M.GroundNormal)continue;let o=e.cells.at(t,r);o.type=M.GroundGrass,o.seen=!0}for(let o=t-K+1;o<t;++o){if(e.cells.at(o,r).type!=M.GroundNormal)continue;let t=e.cells.at(o,r);t.type=M.GroundGrass,t.seen=!0}0!=(o-r&1)&&(Math.random()<.8&&xe(e,0,r,F.Bush),Math.random()<.8&&xe(e,t-1,r,F.Bush))}}(a),function(e){let t=e.cells.sizeX-1,o=Math.floor(e.cells.sizeX/2);for(let r=K;r<o;r+=5)e.cells.at(r,1).type=M.Wall0000,e.cells.at(t-r,1).type=M.Wall0000}(a),function(e,t,o,r){let n=0;for(const i of t){if(n>=e)break;if(i.roomType!=q.PublicRoom&&i.roomType!=q.PrivateRoom)continue;let t=0;for(const e of i.edges)o[e].door&&(t+=1);t<2&&ye(i.posMin,i.posMax,r)&&++n}for(const o of t){if(n>=e)break;o.roomType==q.PrivateRoom&&(Math.random()<.2||ye(o.posMin,o.posMax,r)&&++n)}let s=i.fromValues(0,0),a=i.fromValues(r.cells.sizeX,r.cells.sizeY);for(let t=1e3;t>0&&n<e;--t)ye(s,a,r)&&++n;console.assert(n===e)}(t.totalLoot,l,d,a),function(e){for(let t=0;t<e.sizeX;++t)for(let o=0;o<e.sizeY;++o){e.at(t,o).type==M.Wall0000&&(e.at(t,o).type=we(Ae(e,t,o)))}}(s),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let r=0;r<t;++r)for(let t=0;t<o;++t){const o=e.cells.at(r,t),n=o.type,i=n>=M.Wall0000&&n<=M.Wall1111,s=ce(n),a=n==M.GroundWater;o.moveCost=i||s?1/0:a?4096:0,o.blocksPlayerMove=i,o.blocksPlayerSight=i,o.blocksSight=i,o.blocksSound=i,o.hidesPlayer=!1}for(const t of e.items){let o=e.cells.at(t.pos[0],t.pos[1]),r=t.type;o.moveCost=Math.max(o.moveCost,U(r)),r!=F.DoorNS&&r!=F.DoorEW||(o.blocksPlayerSight=!0),r!=F.DoorNS&&r!=F.DoorEW&&r!=F.PortcullisNS&&r!=F.PortcullisEW&&r!=F.Bush||(o.blocksSight=!0),r!=F.Table&&r!=F.Bush||(o.hidesPlayer=!0)}}(a);const f=function(e,t,o){const r=Array(t.length).fill(!1);for(let e=0;e<t.length;++e){t[e].roomType!==q.Exterior&&(r[e]=!0)}const n=Array(t.length),s=Array(t.length);for(let e=0;e<t.length;++e)n[e]=-1,s[e]=-1;const a=[...o];c(a);for(const e of a){if(!e.door)continue;const t=e.room_left,o=e.room_right;r[t]&&r[o]&&(-1==n[t]&&-1==s[o]?(n[t]=o,s[o]=t):-1==n[o]&&-1==s[t]?(n[o]=t,s[t]=o):-1==n[t]&&-1==n[o]?(ie(n,s,o),n[t]=o,s[o]=t):-1==s[t]&&-1==s[o]&&(se(n,s,t),n[t]=o,s[o]=t))}const l=[];for(let o=0;o<t.length;++o){if(!r[o]){l.push(t[o].posMin);continue}const n=de(e,t[o]);l.push(n)}const d=Array(t.length).fill(!1),p=[];for(let a=0;a<t.length;++a){if(!r[a])continue;if(d[a])continue;if(-1==n[a]&&-1==s[a]){d[a]=!0;continue}const l=[];for(let r=ne(s,a);-1!=r&&!d[r];r=n[r]){d[r]=!0;const a=n[r],c=s[r],p=i.create(),f=i.create();if(-1===c){const n=ue(e,t[r]);n.length>0?i.copy(p,n[u(n.length)]):le(p,t,o,r,a),ae(f,t,o,r,a),l.push(i.clone(p))}else if(-1===a){ae(p,t,o,r,c);const n=ue(e,t[r]);n.length>0?i.copy(f,n[u(n.length)]):le(f,t,o,r,c)}else ae(p,t,o,r,c),ae(f,t,o,r,a);const h=pe(e,p,f);for(const e of h)l.push(e);-1===a&&(l.push(i.clone(f)),l.push(i.clone(f)))}p.push(l)}return p}(a,l,d);return function(e,t,o){if(e<=0)return;for(const e of o){const o=new y(e,t);t.guards.length<1&&(o.hasTorch=!0),t.guards.push(o)}}(e,a,f),function(e){let t=e.cells.sizeX,o=e.cells.sizeY;for(let r=0;r<t;++r)for(let n=0;n<o;++n)(e.cells.at(r,n).type==M.GroundNormal||r>0&&e.cells.at(r-1,n).type==M.GroundNormal||r>0&&n>0&&e.cells.at(r-1,n-1).type==M.GroundNormal||r>0&&n+1<o&&e.cells.at(r-1,n+1).type==M.GroundNormal||n>0&&e.cells.at(r,n-1).type==M.GroundNormal||n+1<o&&e.cells.at(r,n+1).type==M.GroundNormal||r+1<t&&e.cells.at(r+1,n).type==M.GroundNormal||r+1<t&&n>0&&e.cells.at(r+1,n-1).type==M.GroundNormal||r+1<t&&n+1<o&&e.cells.at(r+1,n+1).type==M.GroundNormal)&&(e.cells.at(r,n).seen=!0)}(a),a.computeLighting(),a.recomputeVisibility(a.playerStartPos),a}function $(e){let t=0;const o=Math.min(3,e);for(let e=0;e<o;++e)t+=u(2);return 2*t+3}function ee(e){if(0===e)return 2;{let t=3;const o=Math.min(4,e-1);for(let e=0;e<o;++e)t+=u(2);return t}}function te(e,t,o,r){for(let n=o;n<=r;++n)e.at(t,n).type=M.Wall0000}function oe(e,t,o,r){for(let n=t;n<=r;++n)e.at(n,o).type=M.Wall0000}function re(e,t,o){if(t!=o)for(const r of e)r.group==t&&(r.group=o)}function ne(e,t){let o=t;for(;-1!=e[o]&&(o=e[o],o!=t););return o}function ie(e,t,o){let r=-1;for(;-1!=o;){const n=t[o];e[o]=n,t[o]=r,r=o,o=n}}function se(e,t,o){let r=-1;for(;-1!=o;){const n=e[o];t[o]=n,e[o]=r,r=o,o=n}}function ae(e,t,o,r,n){for(const s of t[r].edges){const t=o[s];if(t.room_left===r&&t.room_right===n||t.room_left===n&&t.room_right===r)return void i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset)}i.zero(e)}function le(e,t,o,r,n){for(const s of t[r].edges){const t=o[s];if(t.room_left===r&&t.room_right===n){i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset);const o=i.fromValues(-t.dir[1],t.dir[0]);return void i.add(e,e,o)}if(t.room_left===n&&t.room_right===r){i.scaleAndAdd(e,t.origin,t.dir,t.doorOffset);const o=i.fromValues(t.dir[1],-t.dir[0]);return void i.add(e,e,o)}}i.zero(e)}function ue(e,t){const o=[];for(let r=t.posMin[0];r<t.posMax[0];++r){if(t.posMin[1]>0){e.cells.at(r,t.posMin[1]-1).type==M.OneWayWindowS&&0===e.cells.at(r,t.posMin[1]).moveCost&&o.push(i.fromValues(r,t.posMin[1]))}if(t.posMax[1]<e.cells.sizeY){e.cells.at(r,t.posMax[1]).type==M.OneWayWindowN&&0===e.cells.at(r,t.posMax[1]-1).moveCost&&o.push(i.fromValues(r,t.posMax[1]-1))}}for(let r=t.posMin[1];r<t.posMax[1];++r){if(t.posMin[0]>0){e.cells.at(t.posMin[0]-1,r).type==M.OneWayWindowW&&0===e.cells.at(t.posMin[0],r).moveCost&&o.push(i.fromValues(t.posMin[0],r))}if(t.posMax[0]<e.cells.sizeX){e.cells.at(t.posMax[0],r).type==M.OneWayWindowE&&0===e.cells.at(t.posMax[0]-1,r).moveCost&&o.push(i.fromValues(t.posMax[0]-1,r))}}if(o.length>0)return o;for(const r of e.items)if(r.type==F.Coin&&r.pos[0]>=t.posMin[0]&&r.pos[1]>=t.posMin[1]&&r.pos[0]<t.posMax[0]&&r.pos[1]<t.posMax[1])for(const n of[[1,0],[-1,0],[0,1],[0,-1]]){const s=r.pos[0]+n[0],a=r.pos[1]+n[1];s<t.posMin[0]||a<t.posMin[1]||s>=t.posMax[0]||a>=t.posMax[1]||0==e.cells.at(s,a).moveCost&&o.push(i.fromValues(s,a))}if(o.length>0)return o;for(const r of e.items)r.type==F.Chair&&r.pos[0]>=t.posMin[0]&&r.pos[1]>=t.posMin[1]&&r.pos[0]<t.posMax[0]&&r.pos[1]<t.posMax[1]&&o.push(i.clone(r.pos));return o}function ce(e){return e>=M.OneWayWindowE&&e<=M.OneWayWindowS}function de(e,t){const o=[];for(let r=t.posMin[0];r<t.posMax[0];++r)for(let n=t.posMin[1];n<t.posMax[1];++n)0===e.cells.at(r,n).moveCost&&o.push(i.fromValues(r,n));if(o.length<=0)return t.posMin;const r=(t.posMin[0]+t.posMax[0]-1)/2,n=(t.posMin[1]+t.posMax[1]-1)/2;return o.sort(((e,t)=>(e[0]-r)**2+(e[1]-n)**2-((t[0]-r)**2+(t[1]-n)**2))),o[0]}function pe(e,t,o){const r=e.computeDistancesToPosition(o),n=i.clone(t),s=[];for(;n[0]!==o[0]||n[1]!==o[1];){s.push(i.clone(n));const t=fe(e,r,n);if(t[0]===n[0]&&t[1]===n[1])break;i.copy(n,t)}return s}function fe(e,t,o){let r=1/0,n=i.clone(o);const s=i.fromValues(Math.max(0,o[0]-1),Math.max(0,o[1]-1)),a=i.fromValues(Math.min(e.cells.sizeX,o[0]+2),Math.min(e.cells.sizeY,o[1]+2));for(let l=s[0];l<a[0];++l)for(let u=s[1];u<a[1];++u){const s=t.get(l,u);if(s==1/0)continue;let a=i.fromValues(l,u);e.guardMoveCost(o,a)!=1/0&&(e.cells.at(a[0],a[1]).type!=M.GroundWater&&s<r&&(r=s,n=a))}if(n[0]===o[0]&&n[1]===o[1]){console.log("failed to proceed");for(let e=s[0];e<a[0];++e)for(let o=s[1];o<a[1];++o){const r=t.get(e,o);console.log(e,o,r)}}return n}(Q=q||(q={}))[Q.Exterior=0]="Exterior",Q[Q.PublicCourtyard=1]="PublicCourtyard",Q[Q.PublicRoom=2]="PublicRoom",Q[Q.PrivateCourtyard=3]="PrivateCourtyard",Q[Q.PrivateRoom=4]="PrivateRoom";const he=[M.OneWayWindowS,M.OneWayWindowE,M.OneWayWindowN,M.OneWayWindowW];function ge(e){return he[e[0]+2*Math.max(0,e[1])+1]}function me(e){return 0===e||Math.random()<.5?F.TorchUnlit:F.TorchLit}function _e(e,t,o,r){(function(e,t,o){return e.at(t-1,o).type>=M.PortcullisNS||(e.at(t+1,o).type>=M.PortcullisNS||(e.at(t,o-1).type>=M.PortcullisNS||e.at(t,o+1).type>=M.PortcullisNS))})(e.cells,t,o)||xe(e,t,o,r)}function xe(e,t,o,r){e.items.push({pos:i.fromValues(t,o),type:r})}function ye(e,t,o){let r=t[0]-e[0],n=t[1]-e[1];for(let t=1e3;t>0;--t){let t=i.fromValues(e[0]+u(r),e[1]+u(n)),s=o.cells.at(t[0],t[1]).type;if((s==M.GroundWood||s==M.GroundMarble)&&!ve(o,t[0],t[1]))return xe(o,t[0],t[1],F.Coin),!0}return!1}function ve(e,t,o){for(const r of e.items)if(r.pos[0]==t&&r.pos[1]==o)return!0;for(const r of e.guards)if(r.pos[0]==t&&r.pos[1]==o)return!0;return!1}function be(e){switch(e){case q.Exterior:return!1;case q.PublicCourtyard:return!0;case q.PublicRoom:return!1;case q.PrivateCourtyard:return!0;case q.PrivateRoom:return!1}}function we(e){return M.Wall0000+e}function Se(e){return e>=M.Wall0000&&e<=M.DoorEW}function Ae(e,t,o){const r=e.sizeX;let n=0;return o<e.sizeY-1&&Se(e.at(t,o+1).type)&&(n|=8),o>0&&Se(e.at(t,o-1).type)&&(n|=4),t<r-1&&Se(e.at(t+1,o).type)&&(n|=2),t>0&&Se(e.at(t-1,o).type)&&(n|=1),n}class Le{getScreenSize(e){}beginFrame=e=>{};start(e,t){}addGlyph(e,t,o,r,n,i=!0){}flush(){}constructor(e,t,o){this.tileSet=t,this.fontTileSet=o;const r=e.getContext("webgl2",{alpha:!1,depth:!1}),n=[o.image,t.image].map((e=>function(e,t){const o=16,r=16,n=o*r,i=t.naturalWidth/o,s=t.naturalHeight/r,a=1,l=i*a,u=s*a,c=document.createElement("canvas");c.width=l,c.height=u*n;const d=c.getContext("2d");d.imageSmoothingEnabled=!1;for(let e=0;e<r;++e)for(let r=0;r<o;++r){const n=r*i,a=e*s,c=0,p=(o*e+r)*u;d.drawImage(t,n,a,i,s,c,p,l,u)}const p=d.getImageData(0,0,c.width,c.height),f=new Uint8Array(p.data.buffer),h=e.createTexture();return e.bindTexture(e.TEXTURE_2D_ARRAY,h),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,l,u,n,0,e.RGBA,e.UNSIGNED_BYTE,f),h}(r,e))),s={vPosition:0,vTexcoord:1,vColor:2},l=[t.tileSize[0]/t.cellSize[0],t.tileSize[1]/t.cellSize[1]],u=function(e,t,o,r){const n=Te(e,e.VERTEX_SHADER,t),i=Te(e,e.FRAGMENT_SHADER,o),s=e.createProgram();e.attachShader(s,n),e.attachShader(s,i);for(const t in r)e.bindAttribLocation(s,r[t],t);e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s));return s}(r,"#version 300 es\n            in vec2 vPosition;\n            in vec3 vTexcoord;\n            in vec4 vColor;\n\n            uniform mat4 uMatScreenFromWorld;\n\n            out highp vec3 fTexcoord;\n            out highp vec4 fColor;\n\n            void main() {\n                fTexcoord = vTexcoord;\n                fColor = vColor;\n                gl_Position = uMatScreenFromWorld * vec4(vPosition, 0, 1);\n            }\n        ","#version 300 es\n            in highp vec3 fTexcoord;\n            in highp vec4 fColor;\n\n            uniform highp sampler2DArray uOpacity;\n\n            out lowp vec4 fragColor;\n\n            void main() {\n                fragColor = fColor * texture(uOpacity, fTexcoord);\n            }\n        ",s),c=r.getUniformLocation(u,"uMatScreenFromWorld"),d=r.getUniformLocation(u,"uOpacity"),p=2*Float32Array.BYTES_PER_ELEMENT+2*Uint32Array.BYTES_PER_ELEMENT,f=p,h=new ArrayBuffer(256*p),g=new Float32Array(h),m=new Uint32Array(h),_=r.createBuffer();let x=0;const y=a.create(),v=r.createVertexArray();r.bindVertexArray(v),r.enableVertexAttribArray(s.vPosition),r.enableVertexAttribArray(s.vTexcoord),r.enableVertexAttribArray(s.vColor),r.bindBuffer(r.ARRAY_BUFFER,_),r.vertexAttribPointer(s.vPosition,2,r.FLOAT,!1,p,0),r.vertexAttribPointer(s.vTexcoord,3,r.UNSIGNED_BYTE,!1,p,8),r.vertexAttribPointer(s.vColor,4,r.UNSIGNED_BYTE,!0,p,12),r.bufferData(r.ARRAY_BUFFER,h,r.DYNAMIC_DRAW);!function(e,t){const o=new Uint16Array(6*t);for(let e=0;e<t;++e){let t=6*e,r=4*e;o[t+0]=r+0,o[t+1]=r+1,o[t+2]=r+2,o[t+3]=r+2,o[t+4]=r+1,o[t+5]=r+3}const r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW)}(r,64);r.bindVertexArray(null),this.getScreenSize=e=>{const t=r.canvas;Re(t);const o=t.clientWidth,n=t.clientHeight;i.set(e,o,n)},this.start=(e,t)=>{a.copy(y,e),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D_ARRAY,n[t])},this.addGlyph=(e,t,o,r,n,i=!0)=>{x>=64&&this.flush(),o=e+(o-e)*l[0],r=t+(r-t)*l[1];const s=i?n.color?n.color:4294967295:n.unlitColor?n.unlitColor:4294967295,a=x*f,u=n.textureIndex<<16;g[a+0]=e,g[a+1]=t,m[a+2]=u+256,m[a+3]=s,g[a+4]=o,g[a+5]=t,m[a+6]=u+257,m[a+7]=s,g[a+8]=e,g[a+9]=r,m[a+10]=u,m[a+11]=s,g[a+12]=o,g[a+13]=r,m[a+14]=u+1,m[a+15]=s,++x},this.flush=()=>{x<=0||(r.useProgram(u),r.bindVertexArray(v),r.uniform1i(d,0),r.uniformMatrix4fv(c,!1,y),r.bindBuffer(r.ARRAY_BUFFER,_),r.bufferSubData(r.ARRAY_BUFFER,0,g,0),r.drawElements(r.TRIANGLES,6*x,r.UNSIGNED_SHORT,0),r.bindVertexArray(null),x=0)},this.beginFrame=e=>{const t=r.canvas;Re(t);const o=t.clientWidth,n=t.clientHeight;r.viewport(0,0,o,n),r.clear(r.COLOR_BUFFER_BIT)},r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),r.clearColor(0,0,0,1)}}function Te(e,t,o){const r=e.createShader(t);return e.shaderSource(r,o),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(r)),e.deleteShader(r)),r}function Re(e){const t=e.parentNode.getBoundingClientRect();e.width===t.width&&e.height===t.height||(e.width=t.width,e.height=t.height)}const Ie=4278190080,He=4289200128,Me=4278233088,ke=4289243136,Ce=4278190248,Ee=4278211752,Pe=4289243304,Fe=4283716692,We=4294857812,Ue=4294901332,Ge=4283716862,De=4294857982,Oe=4283760382,Ve=4294901502;var ze;ze=new URL(n("27Lyk").resolve("k57aN"),import.meta.url).toString();var Ne;Ne=new URL(n("27Lyk").resolve("dwPvt"),import.meta.url).toString();var Be;Be=new URL(n("27Lyk").resolve("7FSnQ"),import.meta.url).toString();var Ye;Ye=new URL(n("27Lyk").resolve("8dSx0"),import.meta.url).toString();function Xe(e){return 16*e[1]+e[0]}const je={name:"Basic Font",imageSrc:new URL(n("27Lyk").resolve("kDrfW"),import.meta.url).toString(),image:new Image,tileSize:[16,16],offset:[0,0],letterMap:[]},Ke={name:"Sin City Tileset",imageSrc:Be,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:Xe([0,0])},terrainTiles:[{textureIndex:Xe([5,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([2,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([4,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([0,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([1,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([1,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([0,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([2,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([4,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([6,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([1,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([9,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([8,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([12,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([3,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([10,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([7,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([14,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([5,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([13,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([11,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([15,1]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([0,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([2,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([3,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([1,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([10,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([10,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([6,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([4,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([2,4]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([2,4]),color:Fe,unlitColor:4287643712}],itemTiles:[{textureIndex:Xe([3,3]),unlitColor:Pe},{textureIndex:Xe([4,3]),unlitColor:Pe},{textureIndex:Xe([2,3]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([5,3]),unlitColor:Pe},{textureIndex:Xe([6,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([4,2]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([10,3]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([10,3]),color:Fe,unlitColor:4287643712},{textureIndex:Xe([0,3]),unlitColor:Pe},{textureIndex:Xe([1,3]),unlitColor:Pe},{textureIndex:Xe([6,3]),unlitColor:Pe}],npcTiles:[{textureIndex:Xe([3,5])},{textureIndex:Xe([2,5])},{textureIndex:Xe([4,5])},{textureIndex:Xe([1,5])},{textureIndex:Xe([3,5]),color:Fe},{textureIndex:Xe([2,5]),color:Fe},{textureIndex:Xe([4,5]),color:Fe},{textureIndex:Xe([1,5]),color:Fe},{textureIndex:Xe([3,5])},{textureIndex:Xe([2,5])},{textureIndex:Xe([4,5])},{textureIndex:Xe([1,5])}],playerTiles:[{textureIndex:Xe([0,5])},{textureIndex:Xe([0,5]),color:Ce},{textureIndex:Xe([0,5]),color:Fe},{textureIndex:Xe([0,5]),color:Ge},{textureIndex:Xe([0,5]),color:Pe}],guardStateTiles:[{textureIndex:Xe([4,0])},{textureIndex:Xe([5,5])},{textureIndex:Xe([6,5])}],ledgeTiles:[{textureIndex:Xe([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([15,4]),color:4285753415,unlitColor:4282922024}]},qe={name:"31 Color Tileset",imageSrc:Ne,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:Xe([0,0])},terrainTiles:[{textureIndex:Xe([11,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([8,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([0,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([7,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([7,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([0,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([2,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([4,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([6,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([1,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([9,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([8,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([12,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([3,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([7,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([14,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([5,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([13,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([11,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([15,9]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([0,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([2,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([3,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([1,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([7,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([5,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([8,4]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([8,4]),color:Ve,unlitColor:4288704624}],itemTiles:[{textureIndex:Xe([3,3]),unlitColor:4291866800},{textureIndex:Xe([4,3]),unlitColor:4291866800},{textureIndex:Xe([2,3]),color:Ve,unlitColor:4291858576},{textureIndex:Xe([5,3]),unlitColor:4294967295},{textureIndex:Xe([6,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([4,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([10,10]),color:Ve,unlitColor:4288704624},{textureIndex:Xe([0,3]),unlitColor:4294967295},{textureIndex:Xe([1,3]),unlitColor:4294967295},{textureIndex:Xe([6,3]),unlitColor:4288704624}],npcTiles:[{textureIndex:Xe([3,5])},{textureIndex:Xe([2,5])},{textureIndex:Xe([4,5])},{textureIndex:Xe([1,5])},{textureIndex:Xe([3,5]),color:Fe},{textureIndex:Xe([2,5]),color:Fe},{textureIndex:Xe([4,5]),color:Fe},{textureIndex:Xe([1,5]),color:Fe},{textureIndex:Xe([3,5])},{textureIndex:Xe([2,5])},{textureIndex:Xe([4,5])},{textureIndex:Xe([1,5])}],playerTiles:[{textureIndex:Xe([2,7])},{textureIndex:Xe([2,7]),color:Ce},{textureIndex:Xe([2,8]),color:Fe},{textureIndex:Xe([2,7]),color:Ge},{textureIndex:Xe([2,7]),color:Ve}],guardStateTiles:[{textureIndex:Xe([4,0])},{textureIndex:Xe([5,5])},{textureIndex:Xe([6,5])}],ledgeTiles:[{textureIndex:Xe([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([15,4]),color:4285753415,unlitColor:4282922024}]},Qe={name:"3/4 View Tileset",imageSrc:ze,image:new Image,tileSize:[24,36],cellSize:[24,24],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:Xe([8,0])},terrainTiles:[{textureIndex:Xe([8,3]),unlitColor:4288696400},{textureIndex:Xe([6,3]),unlitColor:4288696400},{textureIndex:Xe([10,3]),unlitColor:4288696400},{textureIndex:Xe([4,1]),unlitColor:4288696400},{textureIndex:Xe([9,3]),unlitColor:4288696400},{textureIndex:Xe([9,3]),unlitColor:4288696400},{textureIndex:Xe([0,0]),unlitColor:4288696400},{textureIndex:Xe([8,2]),unlitColor:4288696400},{textureIndex:Xe([7,2]),unlitColor:4288696400},{textureIndex:Xe([4,3]),unlitColor:4288696400},{textureIndex:Xe([4,2]),unlitColor:4288696400},{textureIndex:Xe([1,2]),unlitColor:4288696400},{textureIndex:Xe([0,2]),unlitColor:4288696400},{textureIndex:Xe([5,2]),unlitColor:4288696400},{textureIndex:Xe([0,3]),unlitColor:4288696400},{textureIndex:Xe([2,2]),unlitColor:4288696400},{textureIndex:Xe([3,2]),unlitColor:4288696400},{textureIndex:Xe([4,2]),unlitColor:4288696400},{textureIndex:Xe([5,3]),unlitColor:4288696400},{textureIndex:Xe([7,2]),unlitColor:4288696400},{textureIndex:Xe([6,2]),unlitColor:4288696400},{textureIndex:Xe([1,0]),unlitColor:4288696400},{textureIndex:Xe([4,0]),unlitColor:4288696400},{textureIndex:Xe([3,0]),unlitColor:4288696400},{textureIndex:Xe([2,0]),unlitColor:4288696400},{textureIndex:Xe([2,1]),unlitColor:4288696400},{textureIndex:Xe([0,1]),unlitColor:4288696400},{textureIndex:Xe([1,1]),unlitColor:4288696400},{textureIndex:Xe([6,0]),unlitColor:4288696400},{textureIndex:Xe([5,0]),unlitColor:4288696400},{textureIndex:Xe([6,3]),unlitColor:4288696400},{textureIndex:Xe([6,3]),unlitColor:4288696400}],itemTiles:[{textureIndex:Xe([5,5]),color:Ee,unlitColor:Fe},{textureIndex:Xe([3,5]),color:Ee,unlitColor:Fe},{textureIndex:Xe([0,6]),unlitColor:Fe},{textureIndex:Xe([14,5]),color:Oe,unlitColor:Fe},{textureIndex:Xe([6,0]),unlitColor:Fe},{textureIndex:Xe([5,0]),unlitColor:Fe},{textureIndex:Xe([0,1]),unlitColor:Fe},{textureIndex:Xe([1,1]),unlitColor:Fe},{textureIndex:Xe([15,4]),unlitColor:Pe},{textureIndex:Xe([14,4]),unlitColor:Pe},{textureIndex:Xe([13,4]),unlitColor:Pe}],npcTiles:[{textureIndex:Xe([9,4])},{textureIndex:Xe([10,4])},{textureIndex:Xe([11,4])},{textureIndex:Xe([12,4])},{textureIndex:Xe([9,4]),color:Fe},{textureIndex:Xe([10,4]),color:Fe},{textureIndex:Xe([11,4]),color:Fe},{textureIndex:Xe([12,4]),color:Fe},{textureIndex:Xe([9,4])},{textureIndex:Xe([10,4])},{textureIndex:Xe([11,4])},{textureIndex:Xe([12,4])}],playerTiles:[{textureIndex:Xe([0,4]),color:Fe},{textureIndex:Xe([0,4]),color:Ce},{textureIndex:Xe([0,4]),color:3490713616},{textureIndex:Xe([0,4]),color:Ue},{textureIndex:Xe([0,4]),color:We}],guardStateTiles:[{textureIndex:Xe([0,4]),color:Fe},{textureIndex:Xe([0,4]),color:Ce},{textureIndex:Xe([0,4]),color:3490713616}],ledgeTiles:[{textureIndex:Xe([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([15,4]),color:4285753415,unlitColor:4282922024}]};var Ze,Je={name:"Basic Tiles",imageSrc:Ye,image:new Image,tileSize:[16,16],cellSize:[16,16],offset:[0,0],flattenTexture:!0,unlitTile:{textureIndex:0,color:We},terrainTiles:[{textureIndex:112,color:Pe,unlitColor:He},{textureIndex:116,color:Me,unlitColor:He},{textureIndex:118,color:We,unlitColor:He},{textureIndex:120,color:ke,unlitColor:He},{textureIndex:122,color:Ee,unlitColor:He},{textureIndex:122,color:4278206576,unlitColor:He},{textureIndex:64,color:Pe,unlitColor:He},{textureIndex:65,color:Pe,unlitColor:He},{textureIndex:65,color:Pe,unlitColor:He},{textureIndex:65,color:Pe,unlitColor:He},{textureIndex:66,color:Pe,unlitColor:He},{textureIndex:67,color:Pe,unlitColor:He},{textureIndex:70,color:Pe,unlitColor:He},{textureIndex:73,color:Pe,unlitColor:He},{textureIndex:66,color:Pe,unlitColor:He},{textureIndex:68,color:Pe,unlitColor:He},{textureIndex:69,color:Pe,unlitColor:He},{textureIndex:72,color:Pe,unlitColor:He},{textureIndex:66,color:Pe,unlitColor:He},{textureIndex:74,color:Pe,unlitColor:He},{textureIndex:71,color:Pe,unlitColor:He},{textureIndex:75,color:Pe,unlitColor:He},{textureIndex:52,color:Pe,unlitColor:He},{textureIndex:53,color:Pe,unlitColor:He},{textureIndex:54,color:Pe,unlitColor:He},{textureIndex:55,color:Pe,unlitColor:He},{textureIndex:50,color:Pe,unlitColor:He},{textureIndex:50,color:Pe,unlitColor:He},{textureIndex:77,color:Pe,unlitColor:He},{textureIndex:76,color:Pe,unlitColor:He},{textureIndex:116,color:Me,unlitColor:He},{textureIndex:116,color:Me,unlitColor:He}],itemTiles:[{textureIndex:100,color:Ee,unlitColor:Fe},{textureIndex:98,color:Ee,unlitColor:Fe},{textureIndex:96,color:Me,unlitColor:Fe},{textureIndex:110,color:Oe,unlitColor:Fe},{textureIndex:89,color:Ee,unlitColor:Fe},{textureIndex:87,color:Ee,unlitColor:Fe},{textureIndex:50,color:Pe,unlitColor:Fe},{textureIndex:50,color:Pe,unlitColor:Fe},{textureIndex:80,color:Fe,unlitColor:Fe},{textureIndex:80,color:Oe,unlitColor:Fe},{textureIndex:80,color:Oe,unlitColor:Fe}],playerTiles:[{textureIndex:32,color:Fe},{textureIndex:32,color:Ce},{textureIndex:32,color:3490713616},{textureIndex:32,color:Ue},{textureIndex:32,color:We}],guardStateTiles:[{textureIndex:0},{textureIndex:39},{textureIndex:40}],npcTiles:[{textureIndex:33},{textureIndex:34},{textureIndex:35},{textureIndex:36},{textureIndex:33,color:Fe},{textureIndex:34,color:Fe},{textureIndex:35,color:Fe},{textureIndex:36,color:Fe},{textureIndex:33,color:De},{textureIndex:34,color:De},{textureIndex:35,color:De},{textureIndex:36,color:De}],ledgeTiles:[{textureIndex:Xe([12,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([13,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([14,4]),color:4285753415,unlitColor:4282922024},{textureIndex:Xe([15,4]),color:4285753415,unlitColor:4282922024}]};
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||o;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||o;if(e=parseFloat(e),t.ctx||c(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,o.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var s=t._howls[r]._soundById(n[i]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||o;t.ctx||c(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,o.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var s=t._howls[r]._soundById(n[i]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||o,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||o,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||o)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||o;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||o,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",i=n.match(/OPR\/([0-6].)/g),s=i&&parseInt(i[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),l=n.match(/Version\/(.*?) /),u=a&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(s||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(u||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||o;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(o){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(o){e.noAudio=!0;break}for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var i=e._howls[n]._getSoundIds(),s=0;s<i.length;s++){var a=e._howls[n]._soundById(i[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var o=0;o<e._howls.length;o++)e._howls[o]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||o;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||o;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&o.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&o.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var o=new e,r=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(e){var t=this;return o.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=o.usingWebAudio&&!t._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(o.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var i,a;if(e._format&&e._format[r])i=e._format[r];else{if("string"!=typeof(a=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(a))||(i=/\.([^.]+)$/.exec(a.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&o.codecs(i)){t=e._src[r];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new n(e),e._webAudio&&s(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e&&(e="__default",!r._playLock)){for(var i=0,s=0;s<r._sounds.length;s++)r._sounds[s]._paused&&!r._sounds[s]._ended&&(i++,n=r._sounds[s]._id);1===i?e=null:n=null}}var a=n?r._soundById(n):r._inactiveSound();if(!a)return null;if(n&&!e&&(e=a._sprite||"__default"),"loaded"!==r._state){a._sprite=e,a._ended=!1;var l=a._id;return r._queue.push({event:"play",action:function(){r.play(l)}}),l}if(n&&!a._paused)return t||r._loadQueue("play"),a._id;r._webAudio&&o._autoResume();var u=Math.max(0,a._seek>0?a._seek:r._sprite[e][0]/1e3),c=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(a._rate),p=r._sprite[e][0]/1e3,f=(r._sprite[e][0]+r._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var h=function(){a._paused=!1,a._seek=u,a._start=p,a._stop=f,a._loop=!(!a._loop&&!r._sprite[e][2])};if(!(u>=f)){var g=a._node;if(r._webAudio){var m=function(){r._playLock=!1,h(),r._refreshBuffer(a);var e=a._muted||r._muted?0:a._volume;g.gain.setValueAtTime(e,o.ctx.currentTime),a._playStart=o.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,u,86400):g.bufferSource.noteGrainOn(0,u,c):a._loop?g.bufferSource.start(0,u,86400):g.bufferSource.start(0,u,c),d!==1/0&&(r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),d)),t||setTimeout((function(){r._emit("play",a._id),r._loadQueue()}),0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(r._playLock=!0,r.once("resume",m),r._clearTimer(a._id))}else{var _=function(){g.currentTime=u,g.muted=a._muted||r._muted||o._muted||g.muted,g.volume=a._volume*o.volume(),g.playbackRate=a._rate;try{var n=g.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(r._playLock=!0,h(),n.then((function(){r._playLock=!1,g._unlocked=!0,t?r._loadQueue():r._emit("play",a._id)})).catch((function(){r._playLock=!1,r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(r._playLock=!1,h(),r._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),d):(r._endTimers[a._id]=function(){r._ended(a),g.removeEventListener("ended",r._endTimers[a._id],!1)},g.addEventListener("ended",r._endTimers[a._id],!1))}catch(e){r._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=r._src,g.load());var x=window&&window.ejecta||!g.readyState&&o._navigator.isCocoonJS;if(g.readyState>=3||x)_();else{r._playLock=!0,r._state="loading";var y=function(){r._state="loaded",_(),g.removeEventListener(o._canPlayEvent,y,!1)};g.addEventListener(o._canPlayEvent,y,!1),r._clearTimer(a._id)}}return a._id}r._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),r=0;r<o.length;r++){t._clearTimer(o[r]);var n=t._soundById(o[r]);if(n&&!n._paused&&(n._seek=t.seek(o[r]),n._rateSeek=0,n._paused=!0,t._stopFade(o[r]),n._node))if(t._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),t._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||t._emit("pause",n?n._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var r=o._getSoundIds(e),n=0;n<r.length;n++){o._clearTimer(r[n]);var i=o._soundById(r[n]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,o._stopFade(r[n]),i._node&&(o._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),o._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&o._clearSound(i._node))),t||o._emit("stop",i._id))}return o},mute:function(e,t){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var s=r._soundById(n[i]);s&&(s._muted=e,s._interval&&r._stopFade(s._id),r._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,o.ctx.currentTime):s._node&&(s._node.muted=!!o._muted||e),r._emit("mute",s._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]?n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var s=0;s<t.length;s++)(r=n._soundById(t[s]))&&(r._volume=e,i[2]||n._stopFade(t[s]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,o.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*o.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),r=parseFloat(r),i.volume(e,n);for(var s=i._getSoundIds(n),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(n||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=o.ctx.currentTime,c=u+r/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,r,s[a],void 0===n)}}return i},_startFadeInterval:function(e,t,o,r,n,i){var s=this,a=t,l=o-t,u=Math.abs(l/.01),c=Math.max(4,u>0?r/u:r),d=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var n=(Date.now()-d)/r;d=Date.now(),a+=l*n,a=Math.round(100*a)/100,a=l<0?Math.max(o,a):Math.min(o,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),i&&(s._volume=a),(o<t&&a<=o||o>t&&a>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(o,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,r=t._soundById(e);return r&&r._interval&&(t._webAudio&&r._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(r._interval),r._interval=null,t.volume(r._fadeTo,e),r._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,o,r=this,n=arguments;if(0===n.length)return r._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(o=r._soundById(parseInt(n[0],10)))&&o._loop;e=n[0],r._loop=e}else 2===n.length&&(e=n[0],t=parseInt(n[1],10));for(var i=r._getSoundIds(t),s=0;s<i.length;s++)(o=r._soundById(i[s]))&&(o._loop=e,r._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,r.playing(i[s])&&(r.pause(i[s],!0),r.play(i[s],!0)))));return r},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var s=0;s<t.length;s++)if(r=n._soundById(t[s])){n.playing(t[s])&&(r._rateSeek=n.seek(t[s]),r._playStart=n._webAudio?o.ctx.currentTime:r._playStart),r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,o.ctx.currentTime):r._node&&(r._node.playbackRate=e);var a=n.seek(t[s]),l=1e3*((n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-a)/Math.abs(r._rate);!n._endTimers[t[s]]&&r._paused||(n._clearTimer(t[s]),n._endTimers[t[s]]=setTimeout(n._ended.bind(n,r),l)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length)r._sounds.length&&(t=r._sounds[0]._id);else if(1===n.length){r._getSoundIds().indexOf(n[0])>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==r._state||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var i=r._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var s=r.playing(t)?o.ctx.currentTime-i._playStart:0,a=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(a+s*Math.abs(i._rate))}return i._node.currentTime}var l=r.playing(t);l&&r.pause(t,!0),i._seek=e,i._ended=!1,r._clearTimer(t),r._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var u=function(){l&&r.play(t,!0),r._emit("seek",t)};if(l&&!r._webAudio){var c=function(){r._playLock?setTimeout(c,0):u()};setTimeout(c,0)}else u()}return r},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,r=t._soundById(e);return r&&(o=t._sprite[r._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++)t[r]._paused||e.stop(t[r]._id),e._webAudio||(e._clearSound(t[r]._node),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(o._canPlayEvent,t[r]._loadFn,!1),t[r]._node.removeEventListener("ended",t[r]._endFn,!1),o._releaseHtml5Audio(t[r]._node)),delete t[r]._node,e._clearTimer(t[r]._id);var n=o._howls.indexOf(e);n>=0&&o._howls.splice(n,1);var s=!0;for(r=0;r<o._howls.length;r++)if(o._howls[r]._src===e._src||e._src.indexOf(o._howls[r]._src)>=0){s=!1;break}return i&&s&&delete i[e._src],o.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,r){var n=this["_on"+e];return"function"==typeof t&&n.push(r?{id:o,fn:t,once:r}:{id:o,fn:t}),this},off:function(e,t,o){var r=this,n=r["_on"+e],i=0;if("number"==typeof t&&(o=t,t=null),t||o)for(i=0;i<n.length;i++){var s=o===n[i].id;if(t===n[i].fn&&s||!t&&s){n.splice(i,1);break}}else if(e)r["_on"+e]=[];else{var a=Object.keys(r);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(r[a[i]])&&(r[a[i]]=[])}return r},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var r=this,n=r["_on"+e],i=n.length-1;i>=0;i--)n[i].id&&n[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(r,n[i].fn),0),n[i].once&&r.off(e,n[i].fn,n[i].id));return r._loadQueue(e),r},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var t=this,r=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[r][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=o.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),o._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new n(e)},_drain:function(){var e=this,t=e._pool,o=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&o++;for(r=e._sounds.length-1;r>=0;r--){if(o<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=o.ctx.createBufferSource(),e._node.bufferSource.buffer=i[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,o.ctx.currentTime),this},_cleanBuffer:function(e){var t=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=o._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(e){this._parent=e,this.init()};n.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++o._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,r=o._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),e._node.gain.setValueAtTime(r,o.ctx.currentTime),e._node.paused=!0,e._node.connect(o.masterGain)):o.noAudio||(e._node=o._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(o._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=r*o.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++o._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(o._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var i={},s=function(e){var t=e._src;if(i[t])return e._duration=i[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),r=new Uint8Array(o.length),n=0;n<o.length;++n)r[n]=o.charCodeAt(n);l(r.buffer,e)}else{var s=new XMLHttpRequest;s.open(e._xhr.method,t,!0),s.withCredentials=e._xhr.withCredentials,s.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){s.setRequestHeader(t,e._xhr.headers[t])})),s.onload=function(){var t=(s.status+"")[0];"0"===t||"2"===t||"3"===t?l(s.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete i[t],e.load())},a(s)}},a=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,t){var r=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(i[t._src]=e,u(t,e)):r()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(e).then(n).catch(r):o.ctx.decodeAudioData(e,n,r)},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(e){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),t=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!n&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:o,Howl:r}})),o,Ze=r,void 0!==t?(t.HowlerGlobal=e,t.Howler=o,t.Howl=r,t.Sound=n):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=o,window.Howl=r,window.Sound=n)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var o=t._howls.length-1;o>=0;o--)t._howls[o].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,o){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,o="number"!=typeof o?r._pos[2]:o,"number"!=typeof e?r._pos:(r._pos=[e,t,o],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,o,r,n,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,o="number"!=typeof o?a[2]:o,r="number"!=typeof r?a[3]:r,n="number"!=typeof n?a[4]:n,i="number"!=typeof i?a[5]:i,"number"!=typeof e?a:(s._orientation=[e,t,o,r,n,i],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,o,r,n,i),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var o=this;return o._orientation=t.orientation||[1,0,0],o._stereo=t.stereo||null,o._pos=t.pos||null,o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},o._onstereo=t.onstereo?[{fn:t.onstereo}]:[],o._onpos=t.onpos?[{fn:t.onpos}]:[],o._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,o)}}),r;var n=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===o){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var i=r._getSoundIds(o),s=0;s<i.length;s++){var a=r._soundById(i[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,n),"spatial"===n?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",a._id)}}return r},Howl.prototype.pos=function(e,o,r,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,o,r,n)}}),i;if(o="number"!=typeof o?0:o,r="number"!=typeof r?-.5:r,void 0===n){if("number"!=typeof e)return i._pos;i._pos=[e,o,r]}for(var s=i._getSoundIds(n),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,o,r],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):l._panner.setPosition(e,o,r)),i._emit("pos",l._id)}}return i},Howl.prototype.orientation=function(e,o,r,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,o,r,n)}}),i;if(o="number"!=typeof o?i._orientation[1]:o,r="number"!=typeof r?i._orientation[2]:r,void 0===n){if("number"!=typeof e)return i._orientation;i._orientation=[e,o,r]}for(var s=i._getSoundIds(n),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,o,r],l._node&&(l._panner||(l._pos||(l._pos=i._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):l._panner.setOrientation(e,o,r)),i._emit("orientation",l._id)}}return i},Howl.prototype.pannerAttr=function(){var e,o,r,n=this,i=arguments;if(!n._webAudio)return n;if(0===i.length)return n._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return(r=n._soundById(parseInt(i[0],10)))?r._pannerAttr:n._pannerAttr;e=i[0],void 0===o&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),n._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:n._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:n._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:n._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:n._panningModel})}else 2===i.length&&(e=i[0],o=parseInt(i[1],10));for(var s=n._getSoundIds(o),a=0;a<s.length;a++)if(r=n._soundById(s[a])){var l=r._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=r._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(r._pos||(r._pos=n._pos||[0,0,-.5]),t(r,"spatial"))}return n},Sound.prototype.init=function(e){return function(){var t=this,o=t._parent;t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,e.call(this),t._stereo?o.stereo(t._stereo):t._pos&&o.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,o=t._parent;return t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,t._stereo?o.stereo(t._stereo):t._pos?o.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,o._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}();var $e={};$e=new URL(n("27Lyk").resolve("8Qic0"),import.meta.url).toString();var et={};et=new URL(n("27Lyk").resolve("dci1D"),import.meta.url).toString();var tt={};tt=new URL(n("27Lyk").resolve("6wmQa"),import.meta.url).toString();var ot={};ot=new URL(n("27Lyk").resolve("8AE6h"),import.meta.url).toString();var rt={};rt=new URL(n("27Lyk").resolve("25Nym"),import.meta.url).toString();var nt={};nt=new URL(n("27Lyk").resolve("9HrbR"),import.meta.url).toString();var it={};it=new URL(n("27Lyk").resolve("2fyQO"),import.meta.url).toString();var st={};st=new URL(n("27Lyk").resolve("4qSI0"),import.meta.url).toString();var at={};at=new URL(n("27Lyk").resolve("3kwMs"),import.meta.url).toString();var lt={};lt=new URL(n("27Lyk").resolve("3zakP"),import.meta.url).toString();const ut=[n("bgyNt"),n("coakI"),n("7XfMr"),n("5jIXu"),n("h61MQ"),n("1OFiM"),n("hadbD"),n("dH5ka"),n("3twvr"),n("bBbdi")],ct=[n("kBrAM"),n("k6Tdk"),n("vDQ5G"),n("7DVvx"),n("al4v1"),n("fO2Fk"),n("kaxMC")],dt=[n("iCU64"),n("a3sPN"),n("9Y9d3"),n("a8Yhh"),n("9KHDZ")],pt=[[n("eiW2b"),"Hmm..."],[n("6x7Kh"),"What?"],[n("bMjEO"),"Hey!"],[n("3mayG"),"Hey!"],[n("blCN3"),"Hey!"],[n("bGiLK"),"What was that?"],[n("bjubH"),"What was that?"],[n("4PUSb"),"What was that?"],[n("1N1FC"),"What was that?"],[n("ktUCQ"),"What was that?"],[n("9xpZV"),"Who goes there?"],[n("8QCS3"),"Huh?"],[n("5drqJ"),"What?"],[n("a0v0l"),"Wha..."],[n("1lD69"),"Wait!"],[n("jfcxP"),"Who's out there?"],[n("ilgo9"),"What moved?"],[n("92tfF"),"What' in the shadows?"],[n("etshw"),"Did the shadows move?"],[n("5mgz9"),"Did I see something?"],[n("61v8j"),"Hello?"],[n("dKL59"),"Ugh..."]],ft=[[n("eiW2b"),"Hmm..."],[n("bMjEO"),"Hey!"],[n("3mayG"),"Hey!"],[n("blCN3"),"Hey!"],[n("6x7Kh"),"What?"],[n("bGiLK"),"What was that?"],[n("bnVxc"),"Quiet out..."],[n("8YZcm"),"Jumpy tonight..."],[n("rmNTt"),"I'm jumpin' at shadows..."],[n("4xVWY"),"Ahh..."],[n("4xVWY"),"Ahh..."],[n("eiW2b"),"Hmm..."],[n("61Svf"),"Aww..."],[n("86i15"),"Rest me bones..."],[n("eCMLG"),"Oh well..."],[n("hkgAs"),"Case of the jitters..."],[n("eV2Mu"),"Must be seeing..."],[n("fzoRy"),"What's in my coffee today?"],[n("bn9kD"),"Coffee must be too strong!"],[n("dKFtp"),"Hmm nothing..."],[n("awcka"),"Well I though I saw something."],[n("52i2z"),"Nothing..."],[n("iyeOS"),"Hopefully nothing."],[n("gb2R8"),"Must be seeing things..."],[n("gb2R8"),"I must be seeing things."]],ht=[[n("eiW2b"),"Hmm..."],[n("6x7Kh"),"What?"],[n("bMjEO"),"Hey!"],[n("3mayG"),"Hey!"],[n("blCN3"),"Hey!"],[n("bGiLK"),"What was that?"],[n("bjubH"),"What was that?"],[n("4PUSb"),"What was that?"],[n("1N1FC"),"What was that?"],[n("ktUCQ"),"What was that?"],[n("8QCS3"),"Huh?"],[n("5drqJ"),"What?"],[n("a0v0l"),"Wha..."],[n("1lD69"),"Wait!"],[n("jfcxP"),"Who's out there?"],[n("61v8j"),"Hello?"],[n("dKL59"),"Ugh..."],[n("b6tdD"),"Hark?"],[n("UYsu8"),"What was that noise?"],[n("e0y8E"),"I heard something..."]],gt=[[n("eiW2b"),"Hmm..."],[n("bMjEO"),"Hey!"],[n("3mayG"),"Hey!"],[n("blCN3"),"Hey!"],[n("6x7Kh"),"What?"],[n("bGiLK"),"What was that?"],[n("bnVxc"),"Quiet out..."],[n("8YZcm"),"Jumpy tonight..."],[n("4xVWY"),"Ahh..."],[n("4xVWY"),"Ahh..."],[n("eiW2b"),"Hmm..."],[n("61Svf"),"Aww..."],[n("86i15"),"Rest me bones..."],[n("eCMLG"),"Oh well..."],[n("hkgAs"),"Case of the jitters..."],[n("fzoRy"),"What's in my coffee today?"],[n("bn9kD"),"Coffee must be too strong!"],[n("dKFtp"),"Hmm nothing..."],[n("6QVDF"),"Can't hear it now."],[n("52i2z"),"Nothing..."],[n("iyeOS"),"Hopefully nothing."],[n("4q9kg"),"I must be hearing things."]],mt=[[n("eiW2b"),"Hmm..."],[n("bMjEO"),"Hey!"],[n("3mayG"),"Hey!"],[n("blCN3"),"Hey!"],[n("6x7Kh"),"What?"],[n("2zxmO"),"That noise again?"],[n("7rF1E"),"Someone there?"],[n("kQvBC"),"Who could that be?"],[n("2hpzi"),"There it is again."],[n("9gwX6"),"Better check it out."],[n("88Oom"),"What keeps making those noises?"],[n("kc3NH"),"Better be rats!"],[n("40CPy"),"Again!?"],[n("lJn7Q"),"Who is that?"],[n("eBHTR"),"Come out, Come out!"]],_t=[[n("eiW2b"),"Hmm..."],[n("rmNTt"),"Jumpin' at shadows!"],[n("8YZcm"),"Jumpy!"],[n("eCMLG"),"Oh, well."],[n("g5A67"),"Guess it was nothing."],[n("kyAEI"),"Wonder what it was."],[n("g7feg"),"Back to my post."],[n("a1Jxk"),"All quiet now."],[n("bKUzC"),"I'm sure I heard something."],[n("9aXjz"),"Not there anymore."],[n("hfvuU"),"Probably nothing."],[n("dKFtp"),"Hmm, nothing."],[n("4gLkA"),"I dont know why i work here."],[n("3HAUN"),"Waste of my time."],[n("la1r7"),"Why do I even try."],[n("9fSJi"),"At least Im not on cleaning duty."],[n("k1qbX"),"At least my shift ends soon."],[n("1u6dV"),"What do you want me to do about it?"]],xt=[[n("dPu8f"),"(Whistles to other guard)"],[n("bSHoC"),"(Whistles to other guard)"],[n("betci"),"(Whistles to other guard)"],[n("blCN3"),"(To other guard) Hey!"],[n("6x7Kh"),"(To other guard) What?"],[n("7ExfT"),"(To other guard) Where!?"],[n("9v56M"),"(To other guard) Coming!"],[n("8pWsQ"),"(To other guard) Here I come!"],[n("7bU35"),"(To other guard) To arms!"],[n("8V6Zl"),"(To other guard) What is it!?"],[n("9OuxM"),"(To other guard) I dont know how to whistle."]],yt=[[n("5UMPc"),"Get 'em!"],[n("a1naR"),"Intruder!"],[n("k25sm"),"Oh no... it's a thief."],[n("6s45F"),"We're coming for you!"],[n("7F9SI"),"Coming for you!"],[n("epmsQ"),"Halt!"],[n("lVOrm"),"We see you!"],[n("7n2bq"),"I'll get you!"],[n("lJynn"),"You're a goner!"],[n("aIecx"),"Just you wait!"],[n("fg20H"),"You won't get away!"],[n("03Ee8"),"No you dont!"],[n("1kKRF"),"Thief!"],[n("4czHp"),"Thief!"],[n("cauwk"),"Thief!"],[n("csGZP"),"After them!"],[n("2tRKJ"),"What is thy business with this gold?"],[n("e5O0h"),"No mercy for the wicked!"]],vt=[[n("ivwRf"),"Lost 'em!"],[n("5Natg"),"Must have run off..."],[n("eCMLG"),"Oh, well..."],[n("iXIzY"),"Where did they go?"],[n("ejeiL"),"His Holiness would not be pleased!"],[n("hf2wD"),"The boss will not be pleased!"],[n("7BUuc"),"(huffing) I give up!"],[n("oQK7X"),"Where did he go!?"],[n("l7rpd"),"Drats lost him!"],[n("hcAf3"),"Gone!"],[n("jbg5i"),"Come back here!"],[n("2pk3Y"),"Rotten scoundrel!"],[n("9pZ1x"),"Aargh!!"],[n("j09Wg"),"He's not coming back!"],[n("5jj80"),"Blast!"],[n("5tRTq"),"Don't come back!"],[n("1BHLT"),"You won't get away next time!"],[n("9QAiO"),"His Holiness is a lord of mercy!"],[n("frozH"),"What a lousy day at work!"],[n("5xAy0"),"I give up..."],[n("leoYP"),"What do i do help me, help me..."],[n("4YbOi"),"Oh no, he got away!"],[n("YKAZv"),"(guard rant)"]],bt=[[n("81dli"),"Take that!!"],[n("gfMsn"),"Oof!!"],[n("d0uyI"),"Ugg!!"],[n("63paY"),"Ahh!!"],[n("c2ocL"),"Ahh!!"],[n("it1tO"),"Aiyah!"],[n("3bDSd"),"Aiyah!"],[n("F1F1Y"),"Aiyah!"]];class wt{constructor(e){this.howls=e.map((e=>new Ze({src:[e]}))),this.howlNum=0,c(this.howls)}play(e){const t=this.nextHowl();return t.volume(e),t.play()}nextHowl(){return this.howlNum++,this.howlNum==this.howls.length&&(this.howlNum=0,c(this.howls)),this.howls[this.howlNum]}}class St{constructor(e){this.sounds=e.map(At),this.soundNum=0,c(this.sounds)}next(){const e=this.sounds[this.soundNum];return++this.soundNum,this.soundNum==this.sounds.length&&(this.soundNum=0,c(this.sounds)),e}}function At(e){return{sound:new Ze({src:[e[0]]}),subtitle:e[1]}}function Lt(e,t){e.footstepWood=new wt([nt]),e.footstepTile=new wt([it]),e.footstepWater=new wt([st]),e.footstepGravel=new wt([at]),e.footstepGrass=new wt([lt]),e.footstepCreaky=new wt(ut),e.titleSong=new wt([$e]),e.levelRequirementJingle=new wt([et]),e.levelCompleteJingle=new wt([tt]),e.gameOverJingle=new wt([ot]),e.easterEgg=new wt([rt]),e.hitPlayer=new wt(ct),e.coin=new wt(dt),t.guardInvestigate=new St(mt),t.guardFinishInvestigating=new St(_t),t.guardSeeThief=new St(pt),t.guardFinishLookingSet=new St(ft),t.guardChase=new St(yt),t.guardEndChase=new St(vt),t.guardHearGuard=new St(xt),t.guardHearThief=new St(ht),t.guardFinishListening=new St(gt),t.guardDamage=new St(bt)}const Tt=function(e){if("34view"==e)return Qe;if("basic"==e)return Je;if("sincity"==e)return Ke;if("31color"==e)return qe;throw new Error(`Unsupported tileset ${e}`)}("31color"),Rt=function(e){if("font"==e)return je;throw new Error(`Unsupported tileset ${e}`)}("font");window.onload=function(){Promise.all([Xt(Rt.imageSrc,Rt.image),Xt(Tt.imageSrc,Tt.image)]).then(Gt)};const It=10,Ht=100,Mt=65,kt=8,Ct=16,Et=16,Pt=16,Ft="Scout the entire mansion, then leave. Keep any loot you find.";let Wt;var Ut;function Gt(e){const t=document.querySelector("#canvas"),o=new Le(t,Tt,Rt),r=function(e,t){const o=0,r=Z(It,Ht),n=J(o,r[o]);return{tLast:void 0,shiftModifierActive:!1,shiftUpLastTimeStamp:-1/0,gameMode:Wt.Mansion,player:new D(n.playerStartPos),topStatusMessage:Ft,finishedLevel:!1,healCost:1,zoomLevel:3,seeAll:!1,seeGuardSight:!1,seeGuardPatrols:!1,camera:Kt(n.playerStartPos),level:o,gameMapRoughPlans:r,gameMap:n,sounds:e,subtitledSounds:t,popups:new f}}({},{});function n(){requestAnimationFrame((e=>Zt(e,o,r)))}document.body.addEventListener("keydown",(function(e){0==Object.keys(r.sounds).length&&Lt(r.sounds,r.subtitledSounds);if("KeyF"==e.code||"NumpadAdd"==e.code)return void(r.shiftModifierActive=!0);switch(r.gameMode){case Wt.Mansion:!function(e){if(e.ctrlKey)"KeyA"===e.code?(e.preventDefault(),r.seeAll=!r.seeAll):"KeyC"===e.code?(e.preventDefault(),r.player.loot+=r.gameMap.collectAllLoot(),Bt(r)):"KeyV"===e.code?(e.preventDefault(),r.seeGuardSight=!r.seeGuardSight):"KeyP"===e.code?(e.preventDefault(),r.seeGuardPatrols=!r.seeGuardPatrols):"Period"===e.code?(e.preventDefault(),r.level<r.gameMapRoughPlans.length-1&&(++r.level,Qt(r))):"Comma"===e.code?(e.preventDefault(),r.level>0&&(--r.level,Qt(r))):"KeyS"===e.code&&(e.preventDefault(),r.gameMap.markAllSeen(),Bt(r));else if("KeyR"==e.code)e.preventDefault(),qt(r);else if("KeyN"==e.code)e.preventDefault(),Qt(r);else if("BracketLeft"==e.code)e.preventDefault(),r.zoomLevel=Math.max(1,r.zoomLevel-1),r.camera.snapped=!1;else if("BracketRight"==e.code)e.preventDefault(),r.zoomLevel=Math.min(10,r.zoomLevel+1),r.camera.snapped=!1;else{const t=r.shiftModifierActive||e.shiftKey||e.timeStamp-r.shiftUpLastTimeStamp<1?2:1;"ArrowLeft"==e.code||"Numpad4"==e.code||"KeyA"==e.code||"KeyH"==e.code?(e.preventDefault(),Vt(r,-1,0,t)):"ArrowRight"==e.code||"Numpad6"==e.code||"KeyD"==e.code||"KeyL"==e.code?(e.preventDefault(),Vt(r,1,0,t)):"ArrowDown"==e.code||"Numpad2"==e.code||"KeyS"==e.code||"KeyJ"==e.code?(e.preventDefault(),Vt(r,0,-1,t)):"ArrowUp"==e.code||"Numpad8"==e.code||"KeyW"==e.code||"KeyK"==e.code?(e.preventDefault(),Vt(r,0,1,t)):"Period"!=e.code&&"Numpad5"!=e.code&&"KeyZ"!=e.code||(e.preventDefault(),Vt(r,0,0,1))}}(e);break;case Wt.Doctor:!function(e){"KeyR"==e.code?(e.preventDefault(),qt(r)):"KeyH"==e.code?(e.preventDefault(),function(e){if(e.player.health>=G)return;if(e.player.loot<e.healCost)return;e.player.loot-=e.healCost,e.player.health+=1,e.healCost*=2}(r)):"KeyN"==e.code&&(e.preventDefault(),function(e){if(e.level+=1,e.level>=It)return void qt(e);e.gameMap=J(e.level,e.gameMapRoughPlans[e.level]),e.topStatusMessage=Ft,e.finishedLevel=!1,e.player.pos=e.gameMap.playerStartPos,e.player.dir=i.fromValues(0,-1),e.player.noisy=!1,e.player.damagedLastTurn=!1,e.player.turnsRemainingUnderwater=0,e.popups.clear(),e.camera=Kt(e.gameMap.playerStartPos),e.gameMode=Wt.Mansion}(r))}(e);break;case Wt.Win:!function(e){"KeyR"==e.code&&(e.preventDefault(),qt(r))}(e)}r.shiftModifierActive=!1})),document.body.addEventListener("keyup",(function(e){"ShiftLeft"!=e.code&&"ShiftRight"!=e.code||(r.shiftUpLastTimeStamp=e.timeStamp)})),window.addEventListener("resize",(function(){n()})),n()}function Dt(e){e.gameMode=Wt.Doctor,e.topStatusMessage=""}function Ot(e){e.gameMode=Wt.Win,e.topStatusMessage=""}function Vt(e,t,o,r){const n=e.player;if(n.health<=0)return;if(0===t&&0===o||r<=0)return zt(e),void Nt(e);let s=function(e,t,o,r){const n=e.player;let s=i.clone(n.pos),a=0;for(let l=1;l<=r;++l){const r=i.fromValues(n.pos[0]+t*l,n.pos[1]+o*l);if(r[0]<0||r[1]<0||r[0]>=e.gameMap.cells.sizeX||r[1]>=e.gameMap.cells.sizeY){e.finishedLevel&&(a=l);break}if(Yt(e.gameMap,s,r))break;a=l,s=r}if(a>0){const r=i.fromValues(n.pos[0]+t*a,n.pos[1]+o*a);void 0!==e.gameMap.guards.find((e=>e.pos[0]==r[0]&&e.pos[1]==r[1]))&&(a=0)}if(a>0){const r=i.fromValues(n.pos[0]+t*a,n.pos[1]+o*a);void 0!==e.gameMap.items.find((e=>e.pos[0]===r[0]&&e.pos[1]===r[1]&&(e.type===F.TorchUnlit||e.type===F.TorchLit)))&&--a}return a}(e,t,o,r);if(s<=0){const r=i.fromValues(n.pos[0]+t*(s+1),n.pos[1]+o*(s+1)),a=e.gameMap.items.find((e=>e.pos[0]===r[0]&&e.pos[1]===r[1]));return void(void 0===a||a.type!==F.TorchUnlit&&a.type!==F.TorchLit||(zt(e),a.type=a.type===F.TorchUnlit?F.TorchLit:F.TorchUnlit,Nt(e)))}zt(e);const a=e.gameMap.cells.at(...n.pos).type;for(;s>0;--s){if(n.pos[0]+=t,n.pos[1]+=o,n.pos[0]<0||n.pos[1]<0||n.pos[0]>=e.gameMap.cells.sizeX||n.pos[1]>=e.gameMap.cells.sizeY){if(e.level!=It-1)return e.sounds.levelCompleteJingle.play(.5),void Dt(e);Ot(e)}const r=1*n.loot;n.loot+=e.gameMap.collectLootAt(n.pos[0],n.pos[1]),n.loot>r&&e.sounds.coin.play(1)}e.gameMap.cells.at(n.pos[0],n.pos[1]).type==M.GroundWoodCreaky&&function(e,t,o,r,n){t.noisy=!0,r.add(d.Noise,t.pos),n.footstepCreaky.play(.6);for(const r of e.guardsInEarshot(t.pos,o))r.heardThief=!0}(e.gameMap,n,17,e.popups,e.sounds),Nt(e);const l=.5+Math.random()/2,u=e.gameMap.cells.at(...n.pos).type,c=a!==u;switch(u){case M.GroundWoodCreaky:e.sounds.footstepCreaky.play(.15*l);break;case M.GroundWood:(c||Math.random()>.9)&&e.sounds.footstepWood.play(.15*l);break;case M.GroundNormal:(c||Math.random()>.5)&&e.sounds.footstepGravel.play(.03*l);break;case M.GroundGrass:(c||Math.random()>.75)&&e.sounds.footstepGrass.play(.05*l);break;case M.GroundWater:(c||Math.random()>.6)&&e.sounds.footstepWater.play(.02*l);break;case M.GroundMarble:(c||Math.random()>.8)&&e.sounds.footstepTile.play(.05*l);break;default:(c||Math.random()>.8)&&e.sounds.footstepTile.play(.02*l)}}function zt(e){e.popups.clear(),e.player.noisy=!1,e.player.damagedLastTurn=!1}function Nt(e){let t=e.player.health;e.gameMap.cells.at(e.player.pos[0],e.player.pos[1]).type==M.GroundWater?e.player.turnsRemainingUnderwater>0&&--e.player.turnsRemainingUnderwater:e.player.turnsRemainingUnderwater=7,b(e.gameMap,e.popups,e.player),e.gameMap.computeLighting(),e.gameMap.recomputeVisibility(e.player.pos),Bt(e),t>e.player.health&&e.sounds.hitPlayer.play(.5),t>0&&e.player.health<0&&setTimeout((()=>e.sounds.gameOverJingle.play(.5)),2e3)}function Bt(e){e.gameMap.allSeen()&&(e.finishedLevel||e.sounds.levelRequirementJingle.play(.5),e.finishedLevel=!0);const t=e.popups.endOfUpdate(e.subtitledSounds);e.player.health<=0?e.topStatusMessage="You are dead! Press R to restart a new game.":""!==t?e.topStatusMessage=t:e.finishedLevel&&(e.topStatusMessage="Mansion fully mapped! Exit any side.")}function Yt(e,t,o){if(o[0]<0||o[1]<0||o[0]>=e.cells.sizeX||o[1]>=e.cells.sizeY)return!0;if(t[0]==o[0]&&t[1]==o[1])return!1;const r=e.cells.at(o[0],o[1]),n=r.type;return!!r.blocksPlayerMove||(n==M.OneWayWindowE&&o[0]<=t[0]||(n==M.OneWayWindowW&&o[0]>=t[0]||(n==M.OneWayWindowN&&o[1]<=t[1]||n==M.OneWayWindowS&&o[1]>=t[1])))}function Xt(e,t){return new Promise(((o,r)=>{t.onload=()=>o(t),t.onerror=r,t.src=e}))}(Ut=Wt||(Wt={}))[Ut.Mansion=0]="Mansion",Ut[Ut.Doctor=1]="Doctor",Ut[Ut.Win=2]="Win";function jt(e){return e[1]>0?1:e[1]<0?3:e[0]>0?0:e[0]<0?2:3}function Kt(e){const t={position:i.create(),velocity:i.create(),snapped:!1};return i.copy(t.position,e),i.zero(t.velocity),t}function qt(e){e.gameMapRoughPlans=Z(It,Ht),e.level=0;const t=J(e.level,e.gameMapRoughPlans[e.level]);e.gameMode=Wt.Mansion,e.topStatusMessage=Ft,e.finishedLevel=!1,e.healCost=1,e.player=new D(t.playerStartPos),e.camera=Kt(t.playerStartPos),e.gameMap=t,e.popups.clear()}function Qt(e){const t=J(e.level,e.gameMapRoughPlans[e.level]);e.topStatusMessage=Ft,e.finishedLevel=!1,e.player=new D(t.playerStartPos),e.camera=Kt(t.playerStartPos),e.gameMap=t,e.popups.clear()}function Zt(e,t,o){const r=e/1e3,n=void 0===o.tLast?0:Math.min(1/30,r-o.tLast);o.tLast=r;const s=i.create();t.getScreenSize(s),o.camera.snapped||(o.camera.snapped=!0,function(e,t){Jt(e.camera.position,i.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos),i.zero(e.camera.velocity)}(o,s)),n>0&&function(e,t,o){!function(e,t,o){const r=i.create();Jt(r,i.fromValues(e.gameMap.cells.sizeX,e.gameMap.cells.sizeY),e.zoomLevel,t,e.player.pos);const n=i.create();i.subtract(n,r,e.camera.position);const s=i.create();i.negate(s,e.camera.velocity);const a=8,l=i.create();i.scale(l,n,a**2),i.scaleAndAdd(l,l,s,2*a);const u=i.create();i.scaleAndAdd(u,e.camera.velocity,l,o),i.scaleAndAdd(e.camera.position,e.camera.position,e.camera.velocity,.5*o),i.scaleAndAdd(e.camera.position,e.camera.position,u,.5*o),i.copy(e.camera.velocity,u)}(e,t,o)}(o,s,n),function(e,t,o){switch(e.beginFrame(t),o.gameMode){case Wt.Mansion:{const r=a.create();!function(e,t,o){const r=e.gameMap.cells.sizeX,n=e.gameMap.cells.sizeY,s=Ct*eo(t[0]),l=i.fromValues(t[0],t[1]-2*s),[u,c]=$t(l,r,n,e.zoomLevel),d=e.camera.position[0],p=e.camera.position[1],f=e.zoomLevel,h=s/(Pt*f),g=Math.floor(Et*(d-u/2))/Et,m=Math.floor(Pt*(p-c/2))/Pt;a.ortho(o,g,g+u,m-h,m+c+h,1,-1)}(o,t,r),e.start(r,1),function(e,t){const o={};for(let t of e.gameMap.items){const r=e.gameMap.cells.index(...t.pos);r in o?o[r].push(t):o[r]=[t]}for(let r=0;r<e.gameMap.cells.sizeX;++r)for(let n=e.gameMap.cells.sizeY-1;n>=0;--n){const i=e.gameMap.cells.at(r,n);if(!i.seen&&!e.seeAll)continue;const s=i.type,a=s>=M.Wall0000&&s<=M.DoorEW||i.lit;if(t.addGlyph(r,n,r+1,n+1,t.tileSet.terrainTiles[s],a),s===M.GroundWater){const o=t.tileSet.ledgeTiles;let i=0;for(let s of[[0,1],[0,-1],[-1,0],[1,0]])e.gameMap.cells.at(r+s[0],n+s[1]).type!==M.GroundWater&&t.addGlyph(r,n,r+1,n+1,o[i],a),i++}const l=e.gameMap.cells.index(r,n);if(l in o)for(let e of o[l]){const o=e.type>=F.DoorNS&&e.type<=F.PortcullisEW||e.type==F.Coin||i.lit;t.addGlyph(e.pos[0],e.pos[1],e.pos[0]+1,e.pos[1]+1,t.tileSet.itemTiles[e.type],o)}}}(o,e),function(e,t){const o=e.player,r=o.pos[0],n=o.pos[1],i=e.gameMap.cells.at(r,n).lit,s=o.hidden(e.gameMap),a=t.tileSet.playerTiles;let l=t.tileSet.unlitTile;l=o.damagedLastTurn?a[1]:o.noisy?a[3]:s?a[2]:i?a[0]:a[4],t.addGlyph(r,n,r+1,n+1,l)}(o,e),function(e,t){for(const o of e.gameMap.guards){let r=0+jt(o.dir);const n=e.gameMap.cells.at(o.pos[0],o.pos[1]),s=e.seeAll||n.seen||o.speaking;if(!s&&i.squaredDistance(e.player.pos,o.pos)>36)continue;let a=!0;s?o.mode!=_.Patrol||o.speaking||n.lit?r+=8:a=!1:r+=4;const l=t.tileSet.npcTiles[r];t.addGlyph(o.pos[0],o.pos[1],o.pos[0]+1,o.pos[1]+1,l,a)}}(o,e),function(e,t){for(const o of e.gameMap.guards){const r=e.gameMap.cells.at(o.pos[0],o.pos[1]);if(!(e.seeAll||r.seen||o.speaking)&&i.squaredDistance(e.player.pos,o.pos)>36)continue;const n=o.overheadIcon();if(n===E.Relaxed)continue;const s=o.pos[0],a=o.pos[1]+.625;t.addGlyph(s,a,s+1,a+1,t.tileSet.guardStateTiles[n],!0)}}(o,e),function(e,t){if(!e.seeGuardSight)return;const o=e.gameMap.cells.sizeX,r=e.gameMap.cells.sizeY,n=new R(o,r,!1),s=i.create(),a=i.create();for(const t of e.gameMap.guards){const l=3,u=Math.max(0,Math.floor(t.pos[0]-l)),c=Math.min(o,Math.floor(t.pos[0]+l)+1),d=Math.max(0,Math.floor(t.pos[1]-l)),p=Math.min(r,Math.floor(t.pos[1]+l)+1);for(let o=d;o<p;++o)for(let r=u;r<c;++r){i.set(s,r,o),i.subtract(a,s,t.pos);const l=e.gameMap.cells.at(r,o);n.get(r,o)||l.blocksPlayerMove||(e.seeAll||l.seen)&&(i.dot(t.dir,a)<0||i.squaredLength(a)>=t.sightCutoff(l.lit)||L(e.gameMap,t.pos,s)&&n.set(r,o,!0))}}for(let o=0;o<e.gameMap.cells.sizeY;++o)for(let r=0;r<e.gameMap.cells.sizeX;++r)n.get(r,o)&&t.addGlyph(r,o,r+1,o+1,{textureIndex:15,color:2684371072},!0)}(o,e),function(e,t){if(e.seeGuardPatrols)for(const o of e.gameMap.guards)for(const e of o.patrolPath)t.addGlyph(e[0],e[1],e[0]+1,e[1]+1,{textureIndex:249,color:2164260863},!0)}(o,e),e.flush(),to(e,t,o),ro(e,t,o)}break;case Wt.Doctor:{const r="H: Heal one heart for $"+o.healCost;to(e,t,o),ro(e,t,o),no(e,t,["      Healer","",r,"N: Next mansion"])}break;case Wt.Win:to(e,t,o),ro(e,t,o),no(e,t,["Mission Complete","","Collected "+o.player.loot+" of "+Ht+" loot","from the "+It+" mansions.","","Press R to restart a new game."])}}(t,s,o),requestAnimationFrame((e=>Zt(e,t,o)))}function Jt(e,t,o,r,n){const s=i.create(),a=i.create();!function(e,t,o,r,n){const s=e[0],a=e[1],l=Ct*eo(t[0]),u=i.fromValues(t[0],t[1]-2*l),[c,d]=$t(u,s,a,o);let p=c/2,f=e[0]-c/2;p>f&&(p=f=e[0]/2);let h=d/2,g=e[1]-d/2;h>g&&(h=g=e[1]/2);r[0]=p,r[1]=h,n[0]=f,n[1]=g}(t,r,o,s,a),e[0]=Math.max(s[0],Math.min(a[0],n[0]+.5)),e[1]=Math.max(s[1],Math.min(a[1],n[1]+.5))}function $t(e,t,o,r){const n=Et*r,i=Pt*r;return[e[0]/n,e[1]/i]}function eo(e){return Math.min(2,Math.max(1,Math.floor(e/(Mt*kt))))}function to(e,t,o){const r=eo(t[0]),n=r*Ct,i=t[0]/(r*kt),s=t[1]/n,l=1-s,u=a.create();a.ortho(u,0,i,l,s+l,1,-1),e.start(u,0);const c=Math.ceil(i);e.addGlyph(0,0,c,1,{textureIndex:219,color:4279242768});oo(e,Math.floor((c-o.topStatusMessage.length)/2+.5),o.topStatusMessage,Pe),e.flush()}function oo(e,t,o,r){for(let n=0;n<o.length;++n){const i=o.charCodeAt(n);e.addGlyph(t+n,0,t+n+1,1,{textureIndex:i,color:r})}}function ro(e,t,o){const r=eo(t[0]),n=t[0]/(r*kt),i=t[1]/(r*Ct),s=a.create();a.ortho(s,0,n,0,i,1,-1),e.start(s,0);const l=Math.ceil(n);e.addGlyph(0,0,l,1,{textureIndex:219,color:4279242768});oo(e,1,"Health",Ce);for(let t=0;t<G;++t){const r=t<o.player.health?Ce:Ie,n=3;e.addGlyph(t+1+7,0,t+1+8,1,{textureIndex:n,color:r})}if(o.gameMode==Wt.Mansion){if(o.gameMap.cells.at(o.player.pos[0],o.player.pos[1]).type==M.GroundWater&&o.player.turnsRemainingUnderwater>0){const t=1+G+88;oo(e,t,"Air",Ue);for(let r=0;r<o.player.turnsRemainingUnderwater;++r){const o=9;e.addGlyph(t+4+r,0,t+5+r,1,{textureIndex:o,color:Ue})}}const t=o.gameMap.percentSeen(),r="Mansion "+(o.level+1)+" - "+t+"% Mapped";oo(e,Math.floor((l-r.length)/2+.5),r,Pe)}let u="Loot "+o.player.loot;oo(e,l-(u.length+1),u,Oe),e.flush()}function no(e,t,o){let r=0;for(const e of o)r=Math.max(r,e.length);const n=Math.max(1,Math.floor(t[0]/520)),i=Math.max(1,Math.floor(t[1]/352)),s=Math.min(n,i),l=8*s,u=16*s,c=r*l,d=o.length*u,p=t[0]/l,f=t[1]/u,h=Math.floor((t[0]-c)/-2)/l,g=Math.floor((t[1]-d)/-2)/u,m=a.create();a.ortho(m,h,h+p,g,g+f,1,-1),e.start(m,0);e.addGlyph(-1,-1,r+1,o.length+1,{textureIndex:219,color:3763688789});for(let t=0;t<o.length;++t){const r=o.length-(1+t);for(let n=0;n<o[t].length;++n){const i=n;if(" "===o[t])continue;const s=o[t].charCodeAt(n);e.addGlyph(i,r,i+1,r+1,{textureIndex:s,color:4293848814})}}e.flush()}
//# sourceMappingURL=index.b7369160.js.map
